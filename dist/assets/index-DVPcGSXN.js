var ZP=Object.defineProperty;var YP=(n,t,e)=>t in n?ZP(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var KP=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var ni=(n,t,e)=>YP(n,typeof t!="symbol"?t+"":t,e);var jG=KP(Mi=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=e(s);fetch(s.href,l)}})();const tm={u_time:{value:0},u_fogFar:{value:900},u_fogNear:{value:150}};function JP(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)n("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),n("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var lh=1,ch=2,Yu=3,QP=4,cv=5,PM=6378137,tI=6356752314e-3,IM=.0066943799901413165,xp=484813681109536e-20,de=Math.PI/2,eI=.16666666666666666,iI=.04722222222222222,nI=.022156084656084655,Oe=1e-10,Ds=.017453292519943295,eo=57.29577951308232,sn=Math.PI/4,kp=Math.PI*2,qn=3.14159265359,Ur={};Ur.greenwich=0;Ur.lisbon=-9.131906111111;Ur.paris=2.337229166667;Ur.bogota=-74.080916666667;Ur.madrid=-3.687938888889;Ur.rome=12.452333333333;Ur.bern=7.439583333333;Ur.jakarta=106.807719444444;Ur.ferro=-17.666666666667;Ur.brussels=4.367975;Ur.stockholm=18.058277777778;Ur.athens=23.7163375;Ur.oslo=10.722916666667;const sI={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var RM=/[\s_\-\/\(\)]/g;function Jl(n,t){if(n[t])return n[t];for(var e=Object.keys(n),i=t.toLowerCase().replace(RM,""),s=-1,l,c;++s<e.length;)if(l=e[s],c=l.toLowerCase().replace(RM,""),c===i)return n[l]}function hv(n){var t={},e=n.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,p){var m=p.split("=");return m.push(!0),o[m[0].toLowerCase()]=m[1],o},{}),i,s,l,c={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*Ds},lat_1:function(o){t.lat1=o*Ds},lat_2:function(o){t.lat2=o*Ds},lat_ts:function(o){t.lat_ts=o*Ds},lon_0:function(o){t.long0=o*Ds},lon_1:function(o){t.long1=o*Ds},lon_2:function(o){t.long2=o*Ds},alpha:function(o){t.alpha=parseFloat(o)*Ds},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*Ds},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(p){return parseFloat(p)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var p=Jl(sI,o);p&&(t.to_meter=p.to_meter)},from_greenwich:function(o){t.from_greenwich=o*Ds},pm:function(o){var p=Jl(Ur,o);t.from_greenwich=(p||parseFloat(o))*Ds},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var p="ewnsud";o.length===3&&p.indexOf(o.substr(0,1))!==-1&&p.indexOf(o.substr(1,1))!==-1&&p.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(i in e)s=e[i],i in c?(l=c[i],typeof l=="function"?l(s):t[l]=s):t[i]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var Fp=1,AE=2,CE=3,Fg=4,PE=5,jb=-1,rI=/\s/,aI=/[A-Za-z]/,oI=/[A-Za-z84_]/,u0=/[,\]]/,IE=/[\d\.E\-\+]/;function Zo(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Fp}Zo.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==Fg)for(;rI.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case Fp:return this.neutral(n);case AE:return this.keyword(n);case Fg:return this.quoted(n);case PE:return this.afterquote(n);case CE:return this.number(n);case jb:return}};Zo.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=Fg;return}if(u0.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};Zo.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Fp;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Fp,this.currentObject=this.stack.pop(),this.currentObject||(this.state=jb);return}};Zo.prototype.number=function(n){if(IE.test(n)){this.word+=n;return}if(u0.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};Zo.prototype.quoted=function(n){if(n==='"'){this.state=PE;return}this.word+=n};Zo.prototype.keyword=function(n){if(oI.test(n)){this.word+=n;return}if(n==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=Fp;return}if(u0.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};Zo.prototype.neutral=function(n){if(aI.test(n)){this.word=n,this.state=AE;return}if(n==='"'){this.word="",this.state=Fg;return}if(IE.test(n)){this.word=n,this.state=CE;return}if(u0.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};Zo.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===jb)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function lI(n){var t=new Zo(n);return t.output()}function Gy(n,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var i=t?{}:n,s=e.reduce(function(l,c){return zu(c,l),l},i);t&&(n[t]=s)}function zu(n,t){if(!Array.isArray(n)){t[n]=!0;return}var e=n.shift();if(e==="PARAMETER"&&(e=n.shift()),n.length===1){if(Array.isArray(n[0])){t[e]={},zu(n[0],t[e]);return}t[e]=n[0];return}if(!n.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=n;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(n);return}Array.isArray(e)||(t[e]={});var i;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&zu(n[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:n[0],a:n[1],rf:n[2]},n.length===4&&zu(n[3],t[e]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":n[0]=["name",n[0]],Gy(t,e,n);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":n[0]=["name",n[0]],Gy(t,e,n),t[e].type=e;return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return zu(n,t[e]);return Gy(t,e,n)}}var cI=.017453292519943295,hI=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function uI(n,t){var e=t[0],i=t[1];!(e in n)&&i in n&&(n[e]=n[i],t.length===3&&(n[e]=t[2](n[e])))}function Ya(n){return n*cI}function RE(n){for(var t=Object.keys(n),e=0,i=t.length;e<i;++e){var s=t[e];hI.indexOf(s)!==-1&&dI(n[s]),typeof n[s]=="object"&&RE(n[s])}}function dI(n){if(n.AUTHORITY){var t=Object.keys(n.AUTHORITY)[0];t&&t in n.AUTHORITY&&(n.title=t+":"+n.AUTHORITY[t])}if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var e="",i=0,s=n.AXIS.length;i<s;++i){var l=[n.AXIS[i][0].toLowerCase(),n.AXIS[i][1].toLowerCase()];l[0].indexOf("north")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="north"?e+="n":l[0].indexOf("south")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="south"?e+="s":l[0].indexOf("east")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="east"?e+="e":(l[0].indexOf("west")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(n.axis=e)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var c=n.GEOGCS;n.type==="GEOGCS"&&(c=n),c&&(c.DATUM?n.datumCode=c.DATUM.name.toLowerCase():n.datumCode=c.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),n.datumCode==="new_zealand_1949"&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode==="belge_1972"&&(n.datumCode="rnb72"),c.DATUM&&c.DATUM.SPHEROID&&(n.ellps=c.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=c.DATUM.SPHEROID.a,n.rf=parseFloat(c.DATUM.SPHEROID.rf,10)),c.DATUM&&c.DATUM.TOWGS84&&(n.datum_params=c.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function o(x){var v=n.to_meter||1;return x*v}var p=function(x){return uI(n,x)},m=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ya],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ya],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Ya],["lat0","latitude_of_origin",Ya],["lat0","standard_parallel_1",Ya],["lat1","standard_parallel_1",Ya],["lat2","standard_parallel_2",Ya],["azimuth","Azimuth"],["alpha","azimuth",Ya],["srsCode","name"]];m.forEach(p),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=Ya(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=Ya(n.lat0>0?90:-90))}function DE(n){var t=lI(n),e=t[0],i={};return zu(t,i),RE(i),i[e]}function cr(n){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?cr[n]=hv(arguments[1]):cr[n]=DE(arguments[1]):cr[n]=e}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){Array.isArray(i)?cr.apply(t,i):cr(i)});if(typeof n=="string"){if(n in cr)return cr[n]}else"EPSG"in n?cr["EPSG:"+n.EPSG]=n:"ESRI"in n?cr["ESRI:"+n.ESRI]=n:"IAU2000"in n?cr["IAU2000:"+n.IAU2000]=n:console.log(n);return}}JP(cr);function fI(n){return typeof n=="string"}function pI(n){return n in cr}var mI=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function _I(n){return mI.some(function(t){return n.indexOf(t)>-1})}var gI=["3857","900913","3785","102113"];function yI(n){var t=Jl(n,"authority");if(t){var e=Jl(t,"epsg");return e&&gI.indexOf(e)>-1}}function xI(n){var t=Jl(n,"extension");if(t)return Jl(t,"proj4")}function vI(n){return n[0]==="+"}function bI(n){if(fI(n)){if(pI(n))return cr[n];if(_I(n)){var t=DE(n);if(yI(t))return cr["EPSG:3857"];var e=xI(t);return e?hv(e):t}if(vI(n))return hv(n)}else return n}function DM(n,t){n=n||{};var e,i;if(!t)return n;for(i in t)e=t[i],e!==void 0&&(n[i]=e);return n}function oo(n,t,e){var i=n*t;return e/Math.sqrt(1-i*i)}function em(n){return n<0?-1:1}function Ne(n){return Math.abs(n)<=qn?n:n-em(n)*kp}function Na(n,t,e){var i=n*e,s=.5*n;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(de-t))/i}function zp(n,t){for(var e=.5*n,i,s,l=de-2*Math.atan(t),c=0;c<=15;c++)if(i=n*Math.sin(l),s=de-2*Math.atan(t*Math.pow((1-i)/(1+i),e))-l,l+=s,Math.abs(s)<=1e-10)return l;return-9999}function wI(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=oo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function MI(n){var t=n.x,e=n.y;if(e*eo>90&&e*eo<-90&&t*eo>180&&t*eo<-180)return null;var i,s;if(Math.abs(Math.abs(e)-de)<=Oe)return null;if(this.sphere)i=this.x0+this.a*this.k0*Ne(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(sn+.5*e));else{var l=Math.sin(e),c=Na(this.e,e,l);i=this.x0+this.a*this.k0*Ne(t-this.long0),s=this.y0-this.a*this.k0*Math.log(c)}return n.x=i,n.y=s,n}function SI(n){var t=n.x-this.x0,e=n.y-this.y0,i,s;if(this.sphere)s=de-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var l=Math.exp(-e/(this.a*this.k0));if(s=zp(this.e,l),s===-9999)return null}return i=Ne(this.long0+t/(this.a*this.k0)),n.x=i,n.y=s,n}var TI=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const EI={init:wI,forward:MI,inverse:SI,names:TI};function AI(){}function LM(n){return n}var CI=["longlat","identity"];const PI={init:AI,forward:LM,inverse:LM,names:CI};var II=[EI,PI],vg={},zg=[];function LE(n,t){var e=zg.length;return n.names?(zg[e]=n,n.names.forEach(function(i){vg[i.toLowerCase()]=e}),this):(console.log(t),!0)}function RI(n){if(!n)return!1;var t=n.toLowerCase();if(typeof vg[t]<"u"&&zg[vg[t]])return zg[vg[t]]}function DI(){II.forEach(LE)}const LI={start:DI,add:LE,get:RI};var Mi={};Mi.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};Mi.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};Mi.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};Mi.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};Mi.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};Mi.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};Mi.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};Mi.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};Mi.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};Mi.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};Mi.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};Mi.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};Mi.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};Mi.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};Mi.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};Mi.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};Mi.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};Mi.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};Mi.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};Mi.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};Mi.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};Mi.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};Mi.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};Mi.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};Mi.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};Mi.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};Mi.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};Mi.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};Mi.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};Mi.hough={a:6378270,rf:297,ellipseName:"Hough"};Mi.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};Mi.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};Mi.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};Mi.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};Mi.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};Mi.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};Mi.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};Mi.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};Mi.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};Mi.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};Mi.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};Mi.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var kI=Mi.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Mi.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function FI(n,t,e,i){var s=n*n,l=t*t,c=(s-l)/s,o=0;i?(n*=1-c*(eI+c*(iI+c*nI)),s=n*n,c=0):o=Math.sqrt(c);var p=(s-l)/l;return{es:c,e:o,ep2:p}}function zI(n,t,e,i,s){if(!n){var l=Jl(Mi,i);l||(l=kI),n=l.a,t=l.b,e=l.rf}return e&&!t&&(t=(1-1/e)*n),(e===0||Math.abs(n-t)<Oe)&&(s=!0,t=n),{a:n,b:t,rf:e,sphere:s}}var bg={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var OI in bg){var kM=bg[OI];bg[kM.datumName]=kM}function BI(n,t,e,i,s,l,c){var o={};return n===void 0||n==="none"?o.datum_type=cv:o.datum_type=QP,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=lh),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=ch,o.datum_params[3]*=xp,o.datum_params[4]*=xp,o.datum_params[5]*=xp,o.datum_params[6]=o.datum_params[6]/1e6+1)),c&&(o.datum_type=Yu,o.grids=c),o.a=e,o.b=i,o.es=s,o.ep2=l,o}var kE={};function NI(n,t){var e=new DataView(t),i=GI(e),s=HI(e,i),l=jI(e,s,i),c={header:s,subgrids:l};return kE[n]=c,c}function UI(n){if(n===void 0)return null;var t=n.split(",");return t.map(VI)}function VI(n){if(n.length===0)return null;var t=n[0]==="@";return t&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:n,mandatory:!t,grid:kE[n]||null,isNull:!1}}function Ou(n){return n/3600*Math.PI/180}function GI(n){var t=n.getInt32(8,!1);return t===11?!1:(t=n.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function HI(n,t){return{nFields:n.getInt32(8,t),nSubgridFields:n.getInt32(24,t),nSubgrids:n.getInt32(40,t),shiftType:uv(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,t),fromSemiMinorAxis:n.getFloat64(136,t),toSemiMajorAxis:n.getFloat64(152,t),toSemiMinorAxis:n.getFloat64(168,t)}}function uv(n,t,e){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(t,e)))}function jI(n,t,e){for(var i=176,s=[],l=0;l<t.nSubgrids;l++){var c=qI(n,i,e),o=XI(n,i,c,e),p=Math.round(1+(c.upperLongitude-c.lowerLongitude)/c.longitudeInterval),m=Math.round(1+(c.upperLatitude-c.lowerLatitude)/c.latitudeInterval);s.push({ll:[Ou(c.lowerLongitude),Ou(c.lowerLatitude)],del:[Ou(c.longitudeInterval),Ou(c.latitudeInterval)],lim:[p,m],count:c.gridNodeCount,cvs:WI(o)}),i+=176+c.gridNodeCount*16}return s}function WI(n){return n.map(function(t){return[Ou(t.longitudeShift),Ou(t.latitudeShift)]})}function qI(n,t,e){return{name:uv(n,t+8,t+16).trim(),parent:uv(n,t+24,t+24+8).trim(),lowerLatitude:n.getFloat64(t+72,e),upperLatitude:n.getFloat64(t+88,e),lowerLongitude:n.getFloat64(t+104,e),upperLongitude:n.getFloat64(t+120,e),latitudeInterval:n.getFloat64(t+136,e),longitudeInterval:n.getFloat64(t+152,e),gridNodeCount:n.getInt32(t+168,e)}}function XI(n,t,e,i){for(var s=t+176,l=16,c=[],o=0;o<e.gridNodeCount;o++){var p={latitudeShift:n.getFloat32(s+o*l,i),longitudeShift:n.getFloat32(s+o*l+4,i),latitudeAccuracy:n.getFloat32(s+o*l+8,i),longitudeAccuracy:n.getFloat32(s+o*l+12,i)};c.push(p)}return c}function so(n,t){if(!(this instanceof so))return new so(n);t=t||function(m){if(m)throw m};var e=bI(n);if(typeof e!="object"){t("Could not parse to valid json: "+n);return}var i=so.projections.get(e.projName);if(!i){t("Could not get projection name from: "+n);return}if(e.datumCode&&e.datumCode!=="none"){var s=Jl(bg,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var l=zI(e.a,e.b,e.rf,e.ellps,e.sphere),c=FI(l.a,l.b,l.rf,e.R_A),o=UI(e.nadgrids),p=e.datum||BI(e.datumCode,e.datum_params,l.a,l.b,c.es,c.ep2,o);DM(this,e),DM(this,i),this.a=l.a,this.b=l.b,this.rf=l.rf,this.sphere=l.sphere,this.es=c.es,this.e=c.e,this.ep2=c.ep2,this.datum=p,this.init(),t(null,this)}so.projections=LI;so.projections.start();function $I(n,t){return n.datum_type!==t.datum_type||n.a!==t.a||Math.abs(n.es-t.es)>5e-11?!1:n.datum_type===lh?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]:n.datum_type===ch?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]&&n.datum_params[3]===t.datum_params[3]&&n.datum_params[4]===t.datum_params[4]&&n.datum_params[5]===t.datum_params[5]&&n.datum_params[6]===t.datum_params[6]:!0}function FE(n,t,e){var i=n.x,s=n.y,l=n.z?n.z:0,c,o,p,m;if(s<-de&&s>-1.001*de)s=-de;else if(s>de&&s<1.001*de)s=de;else{if(s<-de)return{x:-1/0,y:-1/0,z:n.z};if(s>de)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(s),m=Math.cos(s),p=o*o,c=e/Math.sqrt(1-t*p),{x:(c+l)*m*Math.cos(i),y:(c+l)*m*Math.sin(i),z:(c*(1-t)+l)*o}}function zE(n,t,e,i){var s=1e-12,l=s*s,c=30,o,p,m,x,v,b,E,D,k,P,I,V,U,B=n.x,Z=n.y,Y=n.z?n.z:0,K,nt,q;if(o=Math.sqrt(B*B+Z*Z),p=Math.sqrt(B*B+Z*Z+Y*Y),o/e<s){if(K=0,p/e<s)return nt=de,q=-i,{x:n.x,y:n.y,z:n.z}}else K=Math.atan2(Z,B);m=Y/p,x=o/p,v=1/Math.sqrt(1-t*(2-t)*x*x),D=x*(1-t)*v,k=m*v,U=0;do U++,E=e/Math.sqrt(1-t*k*k),q=o*D+Y*k-E*(1-t*k*k),b=t*E/(E+q),v=1/Math.sqrt(1-b*(2-b)*x*x),P=x*(1-b)*v,I=m*v,V=I*D-P*k,D=P,k=I;while(V*V>l&&U<c);return nt=Math.atan(I/Math.abs(P)),{x:K,y:nt,z:q}}function ZI(n,t,e){if(t===lh)return{x:n.x+e[0],y:n.y+e[1],z:n.z+e[2]};if(t===ch){var i=e[0],s=e[1],l=e[2],c=e[3],o=e[4],p=e[5],m=e[6];return{x:m*(n.x-p*n.y+o*n.z)+i,y:m*(p*n.x+n.y-c*n.z)+s,z:m*(-o*n.x+c*n.y+n.z)+l}}}function YI(n,t,e){if(t===lh)return{x:n.x-e[0],y:n.y-e[1],z:n.z-e[2]};if(t===ch){var i=e[0],s=e[1],l=e[2],c=e[3],o=e[4],p=e[5],m=e[6],x=(n.x-i)/m,v=(n.y-s)/m,b=(n.z-l)/m;return{x:x+p*v-o*b,y:-p*x+v+c*b,z:o*x-c*v+b}}}function __(n){return n===lh||n===ch}function KI(n,t,e){if($I(n,t)||n.datum_type===cv||t.datum_type===cv)return e;var i=n.a,s=n.es;if(n.datum_type===Yu){var l=FM(n,!1,e);if(l!==0)return;i=PM,s=IM}var c=t.a,o=t.b,p=t.es;if(t.datum_type===Yu&&(c=PM,o=tI,p=IM),s===p&&i===c&&!__(n.datum_type)&&!__(t.datum_type))return e;if(e=FE(e,s,i),__(n.datum_type)&&(e=ZI(e,n.datum_type,n.datum_params)),__(t.datum_type)&&(e=YI(e,t.datum_type,t.datum_params)),e=zE(e,p,c,o),t.datum_type===Yu){var m=FM(t,!0,e);if(m!==0)return}return e}function FM(n,t,e){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},l=[];t:for(var c=0;c<n.grids.length;c++){var o=n.grids[c];if(l.push(o.name),o.isNull){s=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var p=o.grid.subgrids,m=0,x=p.length;m<x;m++){var v=p[m],b=(Math.abs(v.del[1])+Math.abs(v.del[0]))/1e4,E=v.ll[0]-b,D=v.ll[1]-b,k=v.ll[0]+(v.lim[0]-1)*v.del[0]+b,P=v.ll[1]+(v.lim[1]-1)*v.del[1]+b;if(!(D>i.y||E>i.x||P<i.y||k<i.x)&&(s=JI(i,t,v),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*eo+" "+i.y*eo+" tried: '"+l+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function JI(n,t,e){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var s={x:n.x,y:n.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=Ne(s.x-Math.PI)+Math.PI;var l=zM(s,e);if(t){if(isNaN(l.x))return i;l.x=s.x-l.x,l.y=s.y-l.y;var c=9,o=1e-12,p,m;do{if(m=zM(l,e),isNaN(m.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}p={x:s.x-(m.x+l.x),y:s.y-(m.y+l.y)},l.x+=p.x,l.y+=p.y}while(c--&&Math.abs(p.x)>o&&Math.abs(p.y)>o);if(c<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=Ne(l.x+e.ll[0]),i.y=l.y+e.ll[1]}else isNaN(l.x)||(i.x=n.x+l.x,i.y=n.y+l.y);return i}function zM(n,t){var e={x:n.x/t.del[0],y:n.y/t.del[1]},i={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*i.x,y:e.y-1*i.y},l={x:Number.NaN,y:Number.NaN},c;if(i.x<0||i.x>=t.lim[0]||i.y<0||i.y>=t.lim[1])return l;c=i.y*t.lim[0]+i.x;var o={x:t.cvs[c][0],y:t.cvs[c][1]};c++;var p={x:t.cvs[c][0],y:t.cvs[c][1]};c+=t.lim[0];var m={x:t.cvs[c][0],y:t.cvs[c][1]};c--;var x={x:t.cvs[c][0],y:t.cvs[c][1]},v=s.x*s.y,b=s.x*(1-s.y),E=(1-s.x)*(1-s.y),D=(1-s.x)*s.y;return l.x=E*o.x+b*p.x+D*x.x+v*m.x,l.y=E*o.y+b*p.y+D*x.y+v*m.y,l}function OM(n,t,e){var i=e.x,s=e.y,l=e.z||0,c,o,p,m={};for(p=0;p<3;p++)if(!(t&&p===2&&e.z===void 0))switch(p===0?(c=i,"ew".indexOf(n.axis[p])!==-1?o="x":o="y"):p===1?(c=s,"ns".indexOf(n.axis[p])!==-1?o="y":o="x"):(c=l,o="z"),n.axis[p]){case"e":m[o]=c;break;case"w":m[o]=-c;break;case"n":m[o]=c;break;case"s":m[o]=-c;break;case"u":e[o]!==void 0&&(m.z=c);break;case"d":e[o]!==void 0&&(m.z=-c);break;default:return null}return m}function OE(n){var t={x:n[0],y:n[1]};return n.length>2&&(t.z=n[2]),n.length>3&&(t.m=n[3]),t}function QI(n){BM(n.x),BM(n.y)}function BM(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function tR(n,t){return(n.datum.datum_type===lh||n.datum.datum_type===ch||n.datum.datum_type===Yu)&&t.datumCode!=="WGS84"||(t.datum.datum_type===lh||t.datum.datum_type===ch||t.datum.datum_type===Yu)&&n.datumCode!=="WGS84"}function Og(n,t,e,i){var s;Array.isArray(e)?e=OE(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var l=e.z!==void 0;if(QI(e),n.datum&&t.datum&&tR(n,t)&&(s=new so("WGS84"),e=Og(n,s,e,i),n=s),i&&n.axis!=="enu"&&(e=OM(n,!1,e)),n.projName==="longlat")e={x:e.x*Ds,y:e.y*Ds,z:e.z||0};else if(n.to_meter&&(e={x:e.x*n.to_meter,y:e.y*n.to_meter,z:e.z||0}),e=n.inverse(e),!e)return;if(n.from_greenwich&&(e.x+=n.from_greenwich),e=KI(n.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*eo,y:e.y*eo,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),i&&t.axis!=="enu"?OM(t,!0,e):(e&&!l&&delete e.z,e)}var NM=so("WGS84");function Hy(n,t,e,i){var s,l,c;return Array.isArray(e)?(s=Og(n,t,e,i)||{x:NaN,y:NaN},e.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.slice(3)):[s.x,s.y,e[2]].concat(e.slice(3)):[s.x,s.y].concat(e.slice(2)):[s.x,s.y]):(l=Og(n,t,e,i),c=Object.keys(e),c.length===2||c.forEach(function(o){if(typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;l[o]=e[o]}),l)}function UM(n){return n instanceof so?n:n.oProj?n.oProj:so(n)}function gr(n,t,e){n=UM(n);var i=!1,s;return typeof t>"u"?(t=n,n=NM,i=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=n,n=NM,i=!0),t=UM(t),e?Hy(n,t,e):(s={forward:function(l,c){return Hy(n,t,l,c)},inverse:function(l,c){return Hy(t,n,l,c)}},i&&(s.oProj=t),s)}var VM=6,BE="AJSAJS",NE="AFAFAF",Bu=65,Ir=73,ma=79,lp=86,cp=90;const eR={forward:UE,inverse:iR,toPoint:VE};function UE(n,t){return t=t||5,rR(nR({lat:n[1],lon:n[0]}),t)}function iR(n){var t=Wb(HE(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function VE(n){var t=Wb(HE(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function jy(n){return n*(Math.PI/180)}function GM(n){return 180*(n/Math.PI)}function nR(n){var t=n.lat,e=n.lon,i=6378137,s=.00669438,l=.9996,c,o,p,m,x,v,b,E=jy(t),D=jy(e),k,P;P=Math.floor((e+180)/6)+1,e===180&&(P=60),t>=56&&t<64&&e>=3&&e<12&&(P=32),t>=72&&t<84&&(e>=0&&e<9?P=31:e>=9&&e<21?P=33:e>=21&&e<33?P=35:e>=33&&e<42&&(P=37)),c=(P-1)*6-180+3,k=jy(c),o=s/(1-s),p=i/Math.sqrt(1-s*Math.sin(E)*Math.sin(E)),m=Math.tan(E)*Math.tan(E),x=o*Math.cos(E)*Math.cos(E),v=Math.cos(E)*(D-k),b=i*((1-s/4-3*s*s/64-5*s*s*s/256)*E-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*E)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*E)-35*s*s*s/3072*Math.sin(6*E));var I=l*p*(v+(1-m+x)*v*v*v/6+(5-18*m+m*m+72*x-58*o)*v*v*v*v*v/120)+5e5,V=l*(b+p*Math.tan(E)*(v*v/2+(5-m+9*x+4*x*x)*v*v*v*v/24+(61-58*m+m*m+600*x-330*o)*v*v*v*v*v*v/720));return t<0&&(V+=1e7),{northing:Math.round(V),easting:Math.round(I),zoneNumber:P,zoneLetter:sR(t)}}function Wb(n){var t=n.northing,e=n.easting,i=n.zoneLetter,s=n.zoneNumber;if(s<0||s>60)return null;var l=.9996,c=6378137,o=.00669438,p,m=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),x,v,b,E,D,k,P,I,V,U=e-5e5,B=t;i<"N"&&(B-=1e7),P=(s-1)*6-180+3,p=o/(1-o),k=B/l,I=k/(c*(1-o/4-3*o*o/64-5*o*o*o/256)),V=I+(3*m/2-27*m*m*m/32)*Math.sin(2*I)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*I)+151*m*m*m/96*Math.sin(6*I),x=c/Math.sqrt(1-o*Math.sin(V)*Math.sin(V)),v=Math.tan(V)*Math.tan(V),b=p*Math.cos(V)*Math.cos(V),E=c*(1-o)/Math.pow(1-o*Math.sin(V)*Math.sin(V),1.5),D=U/(x*l);var Z=V-x*Math.tan(V)/E*(D*D/2-(5+3*v+10*b-4*b*b-9*p)*D*D*D*D/24+(61+90*v+298*b+45*v*v-252*p-3*b*b)*D*D*D*D*D*D/720);Z=GM(Z);var Y=(D-(1+2*v+b)*D*D*D/6+(5-2*b+28*v-3*b*b+8*p+24*v*v)*D*D*D*D*D/120)/Math.cos(V);Y=P+GM(Y);var K;if(n.accuracy){var nt=Wb({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});K={top:nt.lat,right:nt.lon,bottom:Z,left:Y}}else K={lat:Z,lon:Y};return K}function sR(n){var t="Z";return 84>=n&&n>=72?t="X":72>n&&n>=64?t="W":64>n&&n>=56?t="V":56>n&&n>=48?t="U":48>n&&n>=40?t="T":40>n&&n>=32?t="S":32>n&&n>=24?t="R":24>n&&n>=16?t="Q":16>n&&n>=8?t="P":8>n&&n>=0?t="N":0>n&&n>=-8?t="M":-8>n&&n>=-16?t="L":-16>n&&n>=-24?t="K":-24>n&&n>=-32?t="J":-32>n&&n>=-40?t="H":-40>n&&n>=-48?t="G":-48>n&&n>=-56?t="F":-56>n&&n>=-64?t="E":-64>n&&n>=-72?t="D":-72>n&&n>=-80&&(t="C"),t}function rR(n,t){var e="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+aR(n.easting,n.northing,n.zoneNumber)+e.substr(e.length-5,t)+i.substr(i.length-5,t)}function aR(n,t,e){var i=GE(e),s=Math.floor(n/1e5),l=Math.floor(t/1e5)%20;return oR(s,l,i)}function GE(n){var t=n%VM;return t===0&&(t=VM),t}function oR(n,t,e){var i=e-1,s=BE.charCodeAt(i),l=NE.charCodeAt(i),c=s+n-1,o=l+t,p=!1;c>cp&&(c=c-cp+Bu-1,p=!0),(c===Ir||s<Ir&&c>Ir||(c>Ir||s<Ir)&&p)&&c++,(c===ma||s<ma&&c>ma||(c>ma||s<ma)&&p)&&(c++,c===Ir&&c++),c>cp&&(c=c-cp+Bu-1),o>lp?(o=o-lp+Bu-1,p=!0):p=!1,(o===Ir||l<Ir&&o>Ir||(o>Ir||l<Ir)&&p)&&o++,(o===ma||l<ma&&o>ma||(o>ma||l<ma)&&p)&&(o++,o===Ir&&o++),o>lp&&(o=o-lp+Bu-1);var m=String.fromCharCode(c)+String.fromCharCode(o);return m}function HE(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var t=n.length,e=null,i="",s,l=0;!/[A-Z]/.test(s=n.charAt(l));){if(l>=2)throw"MGRSPoint bad conversion from: "+n;i+=s,l++}var c=parseInt(i,10);if(l===0||l+3>t)throw"MGRSPoint bad conversion from: "+n;var o=n.charAt(l++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+n;e=n.substring(l,l+=2);for(var p=GE(c),m=lR(e.charAt(0),p),x=cR(e.charAt(1),p);x<hR(o);)x+=2e6;var v=t-l;if(v%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var b=v/2,E=0,D=0,k,P,I,V,U;return b>0&&(k=1e5/Math.pow(10,b),P=n.substring(l,l+b),E=parseFloat(P)*k,I=n.substring(l+b),D=parseFloat(I)*k),V=E+m,U=D+x,{easting:V,northing:U,zoneLetter:o,zoneNumber:c,accuracy:k}}function lR(n,t){for(var e=BE.charCodeAt(t-1),i=1e5,s=!1;e!==n.charCodeAt(0);){if(e++,e===Ir&&e++,e===ma&&e++,e>cp){if(s)throw"Bad character: "+n;e=Bu,s=!0}i+=1e5}return i}function cR(n,t){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var e=NE.charCodeAt(t-1),i=0,s=!1;e!==n.charCodeAt(0);){if(e++,e===Ir&&e++,e===ma&&e++,e>lp){if(s)throw"Bad character: "+n;e=Bu,s=!0}i+=1e5}return i}function hR(n){var t;switch(n){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+n}function ad(n,t,e){if(!(this instanceof ad))return new ad(n,t,e);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof t>"u"){var i=n.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=n,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ad.fromMGRS=function(n){return new ad(VE(n))};ad.prototype.toMGRS=function(n){return UE([this.x,this.y],n)};var uR=1,dR=.25,HM=.046875,jM=.01953125,WM=.01068115234375,fR=.75,pR=.46875,mR=.013020833333333334,_R=.007120768229166667,gR=.3645833333333333,yR=.005696614583333333,xR=.3076171875;function qb(n){var t=[];t[0]=uR-n*(dR+n*(HM+n*(jM+n*WM))),t[1]=n*(fR-n*(HM+n*(jM+n*WM)));var e=n*n;return t[2]=e*(pR-n*(mR+n*_R)),e*=n,t[3]=e*(gR-n*yR),t[4]=e*n*xR,t}function Pd(n,t,e,i){return e*=t,t*=t,i[0]*n-e*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}var vR=20;function Xb(n,t,e){for(var i=1/(1-t),s=n,l=vR;l;--l){var c=Math.sin(s),o=1-t*c*c;if(o=(Pd(s,c,Math.cos(s),e)-n)*(o*Math.sqrt(o))*i,s-=o,Math.abs(o)<Oe)return s}return s}function bR(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=qb(this.es),this.ml0=Pd(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function wR(n){var t=n.x,e=n.y,i=Ne(t-this.long0),s,l,c,o=Math.sin(e),p=Math.cos(e);if(this.es){var x=p*i,v=Math.pow(x,2),b=this.ep2*Math.pow(p,2),E=Math.pow(b,2),D=Math.abs(p)>Oe?Math.tan(e):0,k=Math.pow(D,2),P=Math.pow(k,2);s=1-this.es*Math.pow(o,2),x=x/Math.sqrt(s);var I=Pd(e,o,p,this.en);l=this.a*(this.k0*x*(1+v/6*(1-k+b+v/20*(5-18*k+P+14*b-58*k*b+v/42*(61+179*P-P*k-479*k)))))+this.x0,c=this.a*(this.k0*(I-this.ml0+o*i*x/2*(1+v/12*(5-k+9*b+4*E+v/30*(61+P-58*k+270*b-330*k*b+v/56*(1385+543*P-P*k-3111*k))))))+this.y0}else{var m=p*Math.sin(i);if(Math.abs(Math.abs(m)-1)<Oe)return 93;if(l=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,c=p*Math.cos(i)/Math.sqrt(1-Math.pow(m,2)),m=Math.abs(c),m>=1){if(m-1>Oe)return 93;c=0}else c=Math.acos(c);e<0&&(c=-c),c=this.a*this.k0*(c-this.lat0)+this.y0}return n.x=l,n.y=c,n}function MR(n){var t,e,i,s,l=(n.x-this.x0)*(1/this.a),c=(n.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+c/this.k0,e=Xb(t,this.es,this.en),Math.abs(e)<de){var v=Math.sin(e),b=Math.cos(e),E=Math.abs(b)>Oe?Math.tan(e):0,D=this.ep2*Math.pow(b,2),k=Math.pow(D,2),P=Math.pow(E,2),I=Math.pow(P,2);t=1-this.es*Math.pow(v,2);var V=l*Math.sqrt(t)/this.k0,U=Math.pow(V,2);t=t*E,i=e-t*U/(1-this.es)*.5*(1-U/12*(5+3*P-9*D*P+D-4*k-U/30*(61+90*P-252*D*P+45*I+46*D-U/56*(1385+3633*P+4095*I+1574*I*P)))),s=Ne(this.long0+V*(1-U/6*(1+2*P+D-U/20*(5+28*P+24*I+8*D*P+6*D-U/42*(61+662*P+1320*I+720*I*P))))/b)}else i=de*em(c),s=0;else{var o=Math.exp(l/this.k0),p=.5*(o-1/o),m=this.lat0+c/this.k0,x=Math.cos(m);t=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(p,2))),i=Math.asin(t),c<0&&(i=-i),p===0&&x===0?s=0:s=Ne(Math.atan2(p,x)+this.long0)}return n.x=s,n.y=i,n}var SR=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const wg={init:bR,forward:wR,inverse:MR,names:SR};function jE(n){var t=Math.exp(n);return t=(t-1/t)/2,t}function Rr(n,t){n=Math.abs(n),t=Math.abs(t);var e=Math.max(n,t),i=Math.min(n,t)/(e||1);return e*Math.sqrt(1+Math.pow(i,2))}function TR(n){var t=1+n,e=t-1;return e===0?n:n*Math.log(t)/e}function ER(n){var t=Math.abs(n);return t=TR(t*(1+t/(Rr(1,t)+1))),n<0?-t:t}function $b(n,t){for(var e=2*Math.cos(2*t),i=n.length-1,s=n[i],l=0,c;--i>=0;)c=-l+e*s+n[i],l=s,s=c;return t+c*Math.sin(2*t)}function AR(n,t){for(var e=2*Math.cos(t),i=n.length-1,s=n[i],l=0,c;--i>=0;)c=-l+e*s+n[i],l=s,s=c;return Math.sin(t)*c}function CR(n){var t=Math.exp(n);return t=(t+1/t)/2,t}function WE(n,t,e){for(var i=Math.sin(t),s=Math.cos(t),l=jE(e),c=CR(e),o=2*s*c,p=-2*i*l,m=n.length-1,x=n[m],v=0,b=0,E=0,D,k;--m>=0;)D=b,k=v,b=x,v=E,x=-D+o*b-p*v+n[m],E=-k+p*b+o*v;return o=i*c,p=s*l,[o*x-p*E,o*E+p*x]}function PR(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(wg.init.apply(this),this.forward=wg.forward,this.inverse=wg.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),t=n/(2-n),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var i=$b(this.cbg,this.lat0);this.Zb=-this.Qn*(i+AR(this.gtu,2*i))}function IR(n){var t=Ne(n.x-this.long0),e=n.y;e=$b(this.cbg,e);var i=Math.sin(e),s=Math.cos(e),l=Math.sin(t),c=Math.cos(t);e=Math.atan2(i,c*s),t=Math.atan2(l*s,Rr(i,s*c)),t=ER(Math.tan(t));var o=WE(this.gtu,2*e,2*t);e=e+o[0],t=t+o[1];var p,m;return Math.abs(t)<=2.623395162778?(p=this.a*(this.Qn*t)+this.x0,m=this.a*(this.Qn*e+this.Zb)+this.y0):(p=1/0,m=1/0),n.x=p,n.y=m,n}function RR(n){var t=(n.x-this.x0)*(1/this.a),e=(n.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var i,s;if(Math.abs(t)<=2.623395162778){var l=WE(this.utg,2*e,2*t);e=e+l[0],t=t+l[1],t=Math.atan(jE(t));var c=Math.sin(e),o=Math.cos(e),p=Math.sin(t),m=Math.cos(t);e=Math.atan2(c*m,Rr(p,m*o)),t=Math.atan2(p,m*o),i=Ne(t+this.long0),s=$b(this.cgb,e)}else i=1/0,s=1/0;return n.x=i,n.y=s,n}var DR=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Mg={init:PR,forward:IR,inverse:RR,names:DR};function LR(n,t){if(n===void 0){if(n=Math.floor((Ne(t)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var kR="etmerc";function FR(){var n=LR(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Ds,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Mg.init.apply(this),this.forward=Mg.forward,this.inverse=Mg.inverse}var zR=["Universal Transverse Mercator System","utm"];const OR={init:FR,names:zR,dependsOn:kR};function Zb(n,t){return Math.pow((1-n)/(1+n),t)}var BR=20;function NR(){var n=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+sn)/(Math.pow(Math.tan(.5*this.lat0+sn),this.C)*Zb(this.e*n,this.ratexp))}function UR(n){var t=n.x,e=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+sn),this.C)*Zb(this.e*Math.sin(e),this.ratexp))-de,n.x=this.C*t,n}function VR(n){for(var t=1e-14,e=n.x/this.C,i=n.y,s=Math.pow(Math.tan(.5*i+sn)/this.K,1/this.C),l=BR;l>0&&(i=2*Math.atan(s*Zb(this.e*Math.sin(n.y),-.5*this.e))-de,!(Math.abs(i-n.y)<t));--l)n.y=i;return l?(n.x=e,n.y=i,n):null}var GR=["gauss"];const Yb={init:NR,forward:UR,inverse:VR,names:GR};function HR(){Yb.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function jR(n){var t,e,i,s;return n.x=Ne(n.x-this.long0),Yb.forward.apply(this,[n]),t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*i),n.x=s*e*Math.sin(n.x),n.y=s*(this.cosc0*t-this.sinc0*e*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function WR(n){var t,e,i,s,l;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,l=Rr(n.x,n.y)){var c=2*Math.atan2(l,this.R2);t=Math.sin(c),e=Math.cos(c),s=Math.asin(e*this.sinc0+n.y*t*this.cosc0/l),i=Math.atan2(n.x*t,l*this.cosc0*e-n.y*this.sinc0*t)}else s=this.phic0,i=0;return n.x=i,n.y=s,Yb.inverse.apply(this,[n]),n.x=Ne(n.x+this.long0),n}var qR=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const XR={init:HR,forward:jR,inverse:WR,names:qR};function $R(n,t,e){return t*=e,Math.tan(.5*(de+n))*Math.pow((1-t)/(1+t),.5*e)}function ZR(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Oe&&(this.k0=.5*(1+em(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Oe&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Oe&&Math.abs(Math.cos(this.lat_ts))>Oe&&(this.k0=.5*this.cons*oo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Na(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=oo(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-de,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function YR(n){var t=n.x,e=n.y,i=Math.sin(e),s=Math.cos(e),l,c,o,p,m,x,v=Ne(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=Oe&&Math.abs(e+this.lat0)<=Oe?(n.x=NaN,n.y=NaN,n):this.sphere?(l=2*this.k0/(1+this.sinlat0*i+this.coslat0*s*Math.cos(v)),n.x=this.a*l*s*Math.sin(v)+this.x0,n.y=this.a*l*(this.coslat0*i-this.sinlat0*s*Math.cos(v))+this.y0,n):(c=2*Math.atan(this.ssfn_(e,i,this.e))-de,p=Math.cos(c),o=Math.sin(c),Math.abs(this.coslat0)<=Oe?(m=Na(this.e,e*this.con,this.con*i),x=2*this.a*this.k0*m/this.cons,n.x=this.x0+x*Math.sin(t-this.long0),n.y=this.y0-this.con*x*Math.cos(t-this.long0),n):(Math.abs(this.sinlat0)<Oe?(l=2*this.a*this.k0/(1+p*Math.cos(v)),n.y=l*o):(l=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*p*Math.cos(v))),n.y=l*(this.cosX0*o-this.sinX0*p*Math.cos(v))+this.y0),n.x=l*p*Math.sin(v)+this.x0,n))}function KR(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,s,l,c=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var o=2*Math.atan(c/(2*this.a*this.k0));return t=this.long0,e=this.lat0,c<=Oe?(n.x=t,n.y=e,n):(e=Math.asin(Math.cos(o)*this.sinlat0+n.y*Math.sin(o)*this.coslat0/c),Math.abs(this.coslat0)<Oe?this.lat0>0?t=Ne(this.long0+Math.atan2(n.x,-1*n.y)):t=Ne(this.long0+Math.atan2(n.x,n.y)):t=Ne(this.long0+Math.atan2(n.x*Math.sin(o),c*this.coslat0*Math.cos(o)-n.y*this.sinlat0*Math.sin(o))),n.x=t,n.y=e,n)}else if(Math.abs(this.coslat0)<=Oe){if(c<=Oe)return e=this.lat0,t=this.long0,n.x=t,n.y=e,n;n.x*=this.con,n.y*=this.con,i=c*this.cons/(2*this.a*this.k0),e=this.con*zp(this.e,i),t=this.con*Ne(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else s=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,c<=Oe?l=this.X0:(l=Math.asin(Math.cos(s)*this.sinX0+n.y*Math.sin(s)*this.cosX0/c),t=Ne(this.long0+Math.atan2(n.x*Math.sin(s),c*this.cosX0*Math.cos(s)-n.y*this.sinX0*Math.sin(s)))),e=-1*zp(this.e,Math.tan(.5*(de+l)));return n.x=t,n.y=e,n}var JR=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const QR={init:ZR,forward:YR,inverse:KR,names:JR,ssfn_:$R};function tD(){var n=this.lat0;this.lambda0=this.long0;var t=Math.sin(n),e=this.a,i=this.rf,s=1/i,l=2*s-Math.pow(s,2),c=this.e=Math.sqrt(l);this.R=this.k0*e*Math.sqrt(1-l)/(1-l*Math.pow(t,2)),this.alpha=Math.sqrt(1+l/(1-l)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),p=Math.log(Math.tan(Math.PI/4+n/2)),m=Math.log((1+c*t)/(1-c*t));this.K=o-this.alpha*p+this.alpha*c/2*m}function eD(n){var t=Math.log(Math.tan(Math.PI/4-n.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),l=this.alpha*(n.x-this.lambda0),c=Math.atan(Math.sin(l)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(l))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(l));return n.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,n.x=this.R*c+this.x0,n}function iD(n){for(var t=n.x-this.x0,e=n.y-this.y0,i=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),l=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),c=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+c/this.alpha,p=0,m=l,x=-1e3,v=0;Math.abs(m-x)>1e-7;){if(++v>20)return;p=1/this.alpha*(Math.log(Math.tan(Math.PI/4+l/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(m))/2)),x=m,m=2*Math.atan(Math.exp(p))-Math.PI/2}return n.x=o,n.y=m,n}var nD=["somerc"];const sD={init:tD,forward:eD,inverse:iD,names:nD};var Fu=1e-7;function rD(n){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||t.indexOf(e)!==-1}function aD(){var n,t,e,i,s,l,c,o,p,m,x=0,v,b=0,E=0,D=0,k=0,P=0,I=0;this.no_off=rD(this),this.no_rot="no_rot"in this;var V=!1;"alpha"in this&&(V=!0);var U=!1;if("rectified_grid_angle"in this&&(U=!0),V&&(I=this.alpha),U&&(x=this.rectified_grid_angle*Ds),V||U)b=this.longc;else if(E=this.long1,k=this.lat1,D=this.long2,P=this.lat2,Math.abs(k-P)<=Fu||(n=Math.abs(k))<=Fu||Math.abs(n-de)<=Fu||Math.abs(Math.abs(this.lat0)-de)<=Fu||Math.abs(Math.abs(P)-de)<=Fu)throw new Error;var B=1-this.es;t=Math.sqrt(B),Math.abs(this.lat0)>Oe?(o=Math.sin(this.lat0),e=Math.cos(this.lat0),n=1-this.es*o*o,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/B),this.A=this.B*this.k0*t/n,i=this.B*t/(e*Math.sqrt(n)),s=i*i-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(Na(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=s=1),V||U?(V?(v=Math.asin(Math.sin(I)/i),U||(x=I)):(v=x,I=Math.asin(i*Math.sin(v))),this.lam0=b-Math.asin(.5*(s-1/s)*Math.tan(v))/this.B):(l=Math.pow(Na(this.e,k,Math.sin(k)),this.B),c=Math.pow(Na(this.e,P,Math.sin(P)),this.B),s=this.E/l,p=(c-l)/(c+l),m=this.E*this.E,m=(m-c*l)/(m+c*l),n=E-D,n<-Math.pi?D-=kp:n>Math.pi&&(D+=kp),this.lam0=Ne(.5*(E+D)-Math.atan(m*Math.tan(.5*this.B*(E-D))/p)/this.B),v=Math.atan(2*Math.sin(this.B*Ne(E-this.lam0))/(s-1/s)),x=I=Math.asin(i*Math.sin(v))),this.singam=Math.sin(v),this.cosgam=Math.cos(v),this.sinrot=Math.sin(x),this.cosrot=Math.cos(x),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(I))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*v,this.v_pole_n=this.ArB*Math.log(Math.tan(sn-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(sn+s))}function oD(n){var t={},e,i,s,l,c,o,p,m;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-de)>Oe){if(c=this.E/Math.pow(Na(this.e,n.y,Math.sin(n.y)),this.B),o=1/c,e=.5*(c-o),i=.5*(c+o),l=Math.sin(this.B*n.x),s=(e*this.singam-l*this.cosgam)/i,Math.abs(Math.abs(s)-1)<Oe)throw new Error;m=.5*this.ArB*Math.log((1-s)/(1+s)),o=Math.cos(this.B*n.x),Math.abs(o)<Fu?p=this.A*n.x:p=this.ArB*Math.atan2(e*this.cosgam+l*this.singam,o)}else m=n.y>0?this.v_pole_n:this.v_pole_s,p=this.ArB*n.y;return this.no_rot?(t.x=p,t.y=m):(p-=this.u_0,t.x=m*this.cosrot+p*this.sinrot,t.y=p*this.cosrot-m*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function lD(n){var t,e,i,s,l,c,o,p={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(e=n.y,t=n.x):(e=n.x*this.cosrot-n.y*this.sinrot,t=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*e),s=.5*(i-1/i),l=.5*(i+1/i),c=Math.sin(this.BrA*t),o=(c*this.cosgam+s*this.singam)/l,Math.abs(Math.abs(o)-1)<Oe)p.x=0,p.y=o<0?-de:de;else{if(p.y=this.E/Math.sqrt((1+o)/(1-o)),p.y=zp(this.e,Math.pow(p.y,1/this.B)),p.y===1/0)throw new Error;p.x=-this.rB*Math.atan2(s*this.cosgam-c*this.singam,Math.cos(this.BrA*t))}return p.x+=this.lam0,p}var cD=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const hD={init:aD,forward:oD,inverse:lD,names:cD};function uD(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Oe)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),i=oo(this.e,t,e),s=Na(this.e,this.lat1,t),l=Math.sin(this.lat2),c=Math.cos(this.lat2),o=oo(this.e,l,c),p=Na(this.e,this.lat2,l),m=Na(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Oe?this.ns=Math.log(i/o)/Math.log(s/p):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(m,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function dD(n){var t=n.x,e=n.y;Math.abs(2*Math.abs(e)-Math.PI)<=Oe&&(e=em(e)*(de-2*Oe));var i=Math.abs(Math.abs(e)-de),s,l;if(i>Oe)s=Na(this.e,e,Math.sin(e)),l=this.a*this.f0*Math.pow(s,this.ns);else{if(i=e*this.ns,i<=0)return null;l=0}var c=this.ns*Ne(t-this.long0);return n.x=this.k0*(l*Math.sin(c))+this.x0,n.y=this.k0*(this.rh-l*Math.cos(c))+this.y0,n}function fD(n){var t,e,i,s,l,c=(n.x-this.x0)/this.k0,o=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(c*c+o*o),e=1):(t=-Math.sqrt(c*c+o*o),e=-1);var p=0;if(t!==0&&(p=Math.atan2(e*c,e*o)),t!==0||this.ns>0){if(e=1/this.ns,i=Math.pow(t/(this.a*this.f0),e),s=zp(this.e,i),s===-9999)return null}else s=-de;return l=Ne(p/this.ns+this.long0),n.x=l,n.y=s,n}var pD=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const mD={init:uD,forward:dD,inverse:fD,names:pD};function _D(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function gD(n){var t,e,i,s,l,c,o,p=n.x,m=n.y,x=Ne(p-this.long0);return t=Math.pow((1+this.e*Math.sin(m))/(1-this.e*Math.sin(m)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(m/2+this.s45),this.alfa)/t)-this.s45),i=-x*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(i)),l=Math.asin(Math.cos(e)*Math.sin(i)/Math.cos(s)),c=this.n*l,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),n.y=o*Math.cos(c)/1,n.x=o*Math.sin(c)/1,this.czech||(n.y*=-1,n.x*=-1),n}function yD(n){var t,e,i,s,l,c,o,p,m=n.x;n.x=n.y,n.y=m,this.czech||(n.y*=-1,n.x*=-1),c=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.atan2(n.y,n.x),s=l/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/c,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),e=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(t)),n.x=this.long0-e/this.alfa,o=t,p=0;var x=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-n.y)<1e-10&&(p=1),o=n.y,x+=1;while(p===0&&x<15);return x>=15?null:n}var xD=["Krovak","krovak"];const vD={init:_D,forward:gD,inverse:yD,names:xD};function dr(n,t,e,i,s){return n*s-t*Math.sin(2*s)+e*Math.sin(4*s)-i*Math.sin(6*s)}function im(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function nm(n){return .375*n*(1+.25*n*(1+.46875*n))}function sm(n){return .05859375*n*n*(1+.75*n)}function rm(n){return n*n*n*(35/3072)}function od(n,t,e){var i=t*e;return n/Math.sqrt(1-i*i)}function rc(n){return Math.abs(n)<de?n:n-em(n)*Math.PI}function Bg(n,t,e,i,s){var l,c;l=n/t;for(var o=0;o<15;o++)if(c=(n-(t*l-e*Math.sin(2*l)+i*Math.sin(4*l)-s*Math.sin(6*l)))/(t-2*e*Math.cos(2*l)+4*i*Math.cos(4*l)-6*s*Math.cos(6*l)),l+=c,Math.abs(c)<=1e-10)return l;return NaN}function bD(){this.sphere||(this.e0=im(this.es),this.e1=nm(this.es),this.e2=sm(this.es),this.e3=rm(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function wD(n){var t,e,i=n.x,s=n.y;if(i=Ne(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(i)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var l=Math.sin(s),c=Math.cos(s),o=od(this.a,this.e,l),p=Math.tan(s)*Math.tan(s),m=i*Math.cos(s),x=m*m,v=this.es*c*c/(1-this.es),b=this.a*dr(this.e0,this.e1,this.e2,this.e3,s);t=o*m*(1-x*p*(1/6-(8-p+8*v)*x/120)),e=b-this.ml0+o*l/c*x*(.5+(5-p+6*v)*x/24)}return n.x=t+this.x0,n.y=e+this.y0,n}function MD(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,s;if(this.sphere){var l=e+this.lat0;i=Math.asin(Math.sin(l)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(l))}else{var c=this.ml0/this.a+e,o=Bg(c,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-de)<=Oe)return n.x=this.long0,n.y=de,e<0&&(n.y*=-1),n;var p=od(this.a,this.e,Math.sin(o)),m=p*p*p/this.a/this.a*(1-this.es),x=Math.pow(Math.tan(o),2),v=t*this.a/p,b=v*v;i=o-p*Math.tan(o)/m*v*v*(.5-(1+3*x)*v*v/24),s=v*(1-b*(x/3+(1+3*x)*x*b/15))/Math.cos(o)}return n.x=Ne(s+this.long0),n.y=rc(i),n}var SD=["Cassini","Cassini_Soldner","cass"];const TD={init:bD,forward:wD,inverse:MD,names:SD};function ql(n,t){var e;return n>1e-7?(e=n*t,(1-n*n)*(t/(1-e*e)-.5/n*Math.log((1-e)/(1+e)))):2*t}var ED=1,AD=2,CD=3,PD=4;function ID(){var n=Math.abs(this.lat0);if(Math.abs(n-de)<Oe?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<Oe?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=ql(this.e,1),this.mmf=.5/(1-this.es),this.apa=ND(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ql(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function RD(n){var t,e,i,s,l,c,o,p,m,x,v=n.x,b=n.y;if(v=Ne(v-this.long0),this.sphere){if(l=Math.sin(b),x=Math.cos(b),i=Math.cos(v),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+x*i:1+this.sinph0*l+this.cosph0*x*i,e<=Oe)return null;e=Math.sqrt(2/e),t=e*x*Math.sin(v),e*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*x*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(b+this.lat0)<Oe)return null;e=sn-b*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(v),e*=i}}else{switch(o=0,p=0,m=0,i=Math.cos(v),s=Math.sin(v),l=Math.sin(b),c=ql(this.e,l),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=c/this.qp,p=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:m=1+this.sinb1*o+this.cosb1*p*i;break;case this.EQUIT:m=1+p*i;break;case this.N_POLE:m=de+b,c=this.qp-c;break;case this.S_POLE:m=b-de,c=this.qp+c;break}if(Math.abs(m)<Oe)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),this.mode===this.OBLIQ?e=this.ymf*m*(this.cosb1*o-this.sinb1*p*i):e=(m=Math.sqrt(2/(1+p*i)))*o*this.ymf,t=this.xmf*m*p*s;break;case this.N_POLE:case this.S_POLE:c>=0?(t=(m=Math.sqrt(c))*s,e=i*(this.mode===this.S_POLE?m:-m)):t=e=0;break}}return n.x=this.a*t+this.x0,n.y=this.a*e+this.y0,n}function DD(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,s,l,c,o,p,m;if(this.sphere){var x=0,v,b=0;if(v=Math.sqrt(t*t+e*e),s=v*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(b=Math.sin(s),x=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(v)<=Oe?0:Math.asin(e*b/v),t*=b,e=x*v;break;case this.OBLIQ:s=Math.abs(v)<=Oe?this.lat0:Math.asin(x*this.sinph0+e*b*this.cosph0/v),t*=b*this.cosph0,e=(x-Math.sin(s)*this.sinph0)*v;break;case this.N_POLE:e=-e,s=de-s;break;case this.S_POLE:s-=de;break}i=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(m=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,p=Math.sqrt(t*t+e*e),p<Oe)return n.x=this.long0,n.y=this.lat0,n;c=2*Math.asin(.5*p/this.rq),l=Math.cos(c),t*=c=Math.sin(c),this.mode===this.OBLIQ?(m=l*this.sinb1+e*c*this.cosb1/p,o=this.qp*m,e=p*this.cosb1*l-e*this.sinb1*c):(m=e*c/p,o=this.qp*m,e=p*l)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),o=t*t+e*e,!o)return n.x=this.long0,n.y=this.lat0,n;m=1-o/this.qp,this.mode===this.S_POLE&&(m=-m)}i=Math.atan2(t,e),s=UD(Math.asin(m),this.apa)}return n.x=Ne(this.long0+i),n.y=s,n}var LD=.3333333333333333,kD=.17222222222222222,FD=.10257936507936508,zD=.06388888888888888,OD=.0664021164021164,BD=.016415012942191543;function ND(n){var t,e=[];return e[0]=n*LD,t=n*n,e[0]+=t*kD,e[1]=t*zD,t*=n,e[0]+=t*FD,e[1]+=t*OD,e[2]=t*BD,e}function UD(n,t){var e=n+n;return n+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var VD=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const GD={init:ID,forward:RD,inverse:DD,names:VD,S_POLE:ED,N_POLE:AD,EQUIT:CD,OBLIQ:PD};function Ql(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function HD(){Math.abs(this.lat1+this.lat2)<Oe||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=oo(this.e3,this.sin_po,this.cos_po),this.qs1=ql(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=oo(this.e3,this.sin_po,this.cos_po),this.qs2=ql(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ql(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Oe?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function jD(n){var t=n.x,e=n.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var i=ql(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,l=this.ns0*Ne(t-this.long0),c=s*Math.sin(l)+this.x0,o=this.rh-s*Math.cos(l)+this.y0;return n.x=c,n.y=o,n}function WD(n){var t,e,i,s,l,c;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),s=0,t!==0&&(s=Math.atan2(i*n.x,i*n.y)),i=t*this.ns0/this.a,this.sphere?c=Math.asin((this.c-i*i)/(2*this.ns0)):(e=(this.c-i*i)/this.ns0,c=this.phi1z(this.e3,e)),l=Ne(s/this.ns0+this.long0),n.x=l,n.y=c,n}function qD(n,t){var e,i,s,l,c,o=Ql(.5*t);if(n<Oe)return o;for(var p=n*n,m=1;m<=25;m++)if(e=Math.sin(o),i=Math.cos(o),s=n*e,l=1-s*s,c=.5*l*l/i*(t/(1-p)-e/l+.5/n*Math.log((1-s)/(1+s))),o=o+c,Math.abs(c)<=1e-7)return o;return null}var XD=["Albers_Conic_Equal_Area","Albers","aea"];const $D={init:HD,forward:jD,inverse:WD,names:XD,phi1z:qD};function ZD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function YD(n){var t,e,i,s,l,c,o,p,m=n.x,x=n.y;return i=Ne(m-this.long0),t=Math.sin(x),e=Math.cos(x),s=Math.cos(i),c=this.sin_p14*t+this.cos_p14*e*s,l=1,c>0||Math.abs(c)<=Oe?(o=this.x0+this.a*l*e*Math.sin(i)/c,p=this.y0+this.a*l*(this.cos_p14*t-this.sin_p14*e*s)/c):(o=this.x0+this.infinity_dist*e*Math.sin(i),p=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),n.x=o,n.y=p,n}function KD(n){var t,e,i,s,l,c;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(t=Math.sqrt(n.x*n.x+n.y*n.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),i=Math.cos(s),c=Ql(i*this.sin_p14+n.y*e*this.cos_p14/t),l=Math.atan2(n.x*e,t*this.cos_p14*i-n.y*this.sin_p14*e),l=Ne(this.long0+l)):(c=this.phic0,l=0),n.x=l,n.y=c,n}var JD=["gnom"];const QD={init:ZD,forward:YD,inverse:KD,names:JD};function tL(n,t){var e=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*de:de;for(var i=Math.asin(.5*t),s,l,c,o,p=0;p<30;p++)if(l=Math.sin(i),c=Math.cos(i),o=n*l,s=Math.pow(1-o*o,2)/(2*c)*(t/(1-n*n)-l/(1-o*o)+.5/n*Math.log((1-o)/(1+o))),i+=s,Math.abs(s)<=1e-10)return i;return NaN}function eL(){this.sphere||(this.k0=oo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function iL(n){var t=n.x,e=n.y,i,s,l=Ne(t-this.long0);if(this.sphere)i=this.x0+this.a*l*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var c=ql(this.e,Math.sin(e));i=this.x0+this.a*this.k0*l,s=this.y0+this.a*c*.5/this.k0}return n.x=i,n.y=s,n}function nL(n){n.x-=this.x0,n.y-=this.y0;var t,e;return this.sphere?(t=Ne(this.long0+n.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(e=tL(this.e,2*n.y*this.k0/this.a),t=Ne(this.long0+n.x/(this.a*this.k0))),n.x=t,n.y=e,n}var sL=["cea"];const rL={init:eL,forward:iL,inverse:nL,names:sL};function aL(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function oL(n){var t=n.x,e=n.y,i=Ne(t-this.long0),s=rc(e-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*s,n}function lL(n){var t=n.x,e=n.y;return n.x=Ne(this.long0+(t-this.x0)/(this.a*this.rc)),n.y=rc(this.lat0+(e-this.y0)/this.a),n}var cL=["Equirectangular","Equidistant_Cylindrical","eqc"];const hL={init:aL,forward:oL,inverse:lL,names:cL};var qM=20;function uL(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=im(this.es),this.e1=nm(this.es),this.e2=sm(this.es),this.e3=rm(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function dL(n){var t=n.x,e=n.y,i,s,l,c=Ne(t-this.long0);if(l=c*Math.sin(e),this.sphere)Math.abs(e)<=Oe?(i=this.a*c,s=-1*this.a*this.lat0):(i=this.a*Math.sin(l)/Math.tan(e),s=this.a*(rc(e-this.lat0)+(1-Math.cos(l))/Math.tan(e)));else if(Math.abs(e)<=Oe)i=this.a*c,s=-1*this.ml0;else{var o=od(this.a,this.e,Math.sin(e))/Math.tan(e);i=o*Math.sin(l),s=this.a*dr(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+o*(1-Math.cos(l))}return n.x=i+this.x0,n.y=s+this.y0,n}function fL(n){var t,e,i,s,l,c,o,p,m;if(i=n.x-this.x0,s=n.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Oe)t=Ne(i/this.a+this.long0),e=0;else{c=this.lat0+s/this.a,o=i*i/this.a/this.a+c*c,p=c;var x;for(l=qM;l;--l)if(x=Math.tan(p),m=-1*(c*(p*x+1)-p-.5*(p*p+o)*x)/((p-c)/x-1),p+=m,Math.abs(m)<=Oe){e=p;break}t=Ne(this.long0+Math.asin(i*Math.tan(p)/this.a)/Math.sin(e))}else if(Math.abs(s+this.ml0)<=Oe)e=0,t=Ne(this.long0+i/this.a);else{c=(this.ml0+s)/this.a,o=i*i/this.a/this.a+c*c,p=c;var v,b,E,D,k;for(l=qM;l;--l)if(k=this.e*Math.sin(p),v=Math.sqrt(1-k*k)*Math.tan(p),b=this.a*dr(this.e0,this.e1,this.e2,this.e3,p),E=this.e0-2*this.e1*Math.cos(2*p)+4*this.e2*Math.cos(4*p)-6*this.e3*Math.cos(6*p),D=b/this.a,m=(c*(v*D+1)-D-.5*v*(D*D+o))/(this.es*Math.sin(2*p)*(D*D+o-2*c*D)/(4*v)+(c-D)*(v*E-2/Math.sin(2*p))-E),p-=m,Math.abs(m)<=Oe){e=p;break}v=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=Ne(this.long0+Math.asin(i*v/this.a)/Math.sin(e))}return n.x=t,n.y=e,n}var pL=["Polyconic","poly"];const mL={init:uL,forward:dL,inverse:fL,names:pL};function _L(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function gL(n){var t,e=n.x,i=n.y,s=i-this.lat0,l=e-this.long0,c=s/xp*1e-5,o=l,p=1,m=0;for(t=1;t<=10;t++)p=p*c,m=m+this.A[t]*p;var x=m,v=o,b=1,E=0,D,k,P=0,I=0;for(t=1;t<=6;t++)D=b*x-E*v,k=E*x+b*v,b=D,E=k,P=P+this.B_re[t]*b-this.B_im[t]*E,I=I+this.B_im[t]*b+this.B_re[t]*E;return n.x=I*this.a+this.x0,n.y=P*this.a+this.y0,n}function yL(n){var t,e=n.x,i=n.y,s=e-this.x0,l=i-this.y0,c=l/this.a,o=s/this.a,p=1,m=0,x,v,b=0,E=0;for(t=1;t<=6;t++)x=p*c-m*o,v=m*c+p*o,p=x,m=v,b=b+this.C_re[t]*p-this.C_im[t]*m,E=E+this.C_im[t]*p+this.C_re[t]*m;for(var D=0;D<this.iterations;D++){var k=b,P=E,I,V,U=c,B=o;for(t=2;t<=6;t++)I=k*b-P*E,V=P*b+k*E,k=I,P=V,U=U+(t-1)*(this.B_re[t]*k-this.B_im[t]*P),B=B+(t-1)*(this.B_im[t]*k+this.B_re[t]*P);k=1,P=0;var Z=this.B_re[1],Y=this.B_im[1];for(t=2;t<=6;t++)I=k*b-P*E,V=P*b+k*E,k=I,P=V,Z=Z+t*(this.B_re[t]*k-this.B_im[t]*P),Y=Y+t*(this.B_im[t]*k+this.B_re[t]*P);var K=Z*Z+Y*Y;b=(U*Z+B*Y)/K,E=(B*Z-U*Y)/K}var nt=b,q=E,J=1,ct=0;for(t=1;t<=9;t++)J=J*nt,ct=ct+this.D[t]*J;var St=this.lat0+ct*xp*1e5,wt=this.long0+q;return n.x=wt,n.y=St,n}var xL=["New_Zealand_Map_Grid","nzmg"];const vL={init:_L,forward:gL,inverse:yL,names:xL};function bL(){}function wL(n){var t=n.x,e=n.y,i=Ne(t-this.long0),s=this.x0+this.a*i,l=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return n.x=s,n.y=l,n}function ML(n){n.x-=this.x0,n.y-=this.y0;var t=Ne(this.long0+n.x/this.a),e=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=t,n.y=e,n}var SL=["Miller_Cylindrical","mill"];const TL={init:bL,forward:wL,inverse:ML,names:SL};var EL=20;function AL(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=qb(this.es)}function CL(n){var t,e,i=n.x,s=n.y;if(i=Ne(i-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var l=this.n*Math.sin(s),c=EL;c;--c){var o=(this.m*s+Math.sin(s)-l)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<Oe)break}t=this.a*this.C_x*i*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var p=Math.sin(s),m=Math.cos(s);e=this.a*Pd(s,p,m,this.en),t=this.a*i*m/Math.sqrt(1-this.es*p*p)}return n.x=t,n.y=e,n}function PL(n){var t,e,i,s;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,t=n.y/this.a,this.sphere?(t/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(t))),this.m?t=Ql((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Ql(Math.sin(t)/this.n)),i=Ne(i+this.long0),t=rc(t)):(t=Xb(n.y/this.a,this.es,this.en),s=Math.abs(t),s<de?(s=Math.sin(t),e=this.long0+n.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),i=Ne(e)):s-Oe<de&&(i=this.long0)),n.x=i,n.y=t,n}var IL=["Sinusoidal","sinu"];const RL={init:AL,forward:CL,inverse:PL,names:IL};function DL(){}function LL(n){for(var t=n.x,e=n.y,i=Ne(t-this.long0),s=e,l=Math.PI*Math.sin(e);;){var c=-(s+Math.sin(s)-l)/(1+Math.cos(s));if(s+=c,Math.abs(c)<Oe)break}s/=2,Math.PI/2-Math.abs(e)<Oe&&(i=0);var o=.900316316158*this.a*i*Math.cos(s)+this.x0,p=1.4142135623731*this.a*Math.sin(s)+this.y0;return n.x=o,n.y=p,n}function kL(n){var t,e;n.x-=this.x0,n.y-=this.y0,e=n.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var i=Ne(this.long0+n.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return n.x=i,n.y=s,n}var FL=["Mollweide","moll"];const zL={init:DL,forward:LL,inverse:kL,names:FL};function OL(){Math.abs(this.lat1+this.lat2)<Oe||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=im(this.es),this.e1=nm(this.es),this.e2=sm(this.es),this.e3=rm(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=oo(this.e,this.sinphi,this.cosphi),this.ml1=dr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Oe?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=oo(this.e,this.sinphi,this.cosphi),this.ml2=dr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=dr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function BL(n){var t=n.x,e=n.y,i;if(this.sphere)i=this.a*(this.g-e);else{var s=dr(this.e0,this.e1,this.e2,this.e3,e);i=this.a*(this.g-s)}var l=this.ns*Ne(t-this.long0),c=this.x0+i*Math.sin(l),o=this.y0+this.rh-i*Math.cos(l);return n.x=c,n.y=o,n}function NL(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var t,e,i,s;this.ns>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),t=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*n.x,t*n.y)),this.sphere)return s=Ne(this.long0+l/this.ns),i=rc(this.g-e/this.a),n.x=s,n.y=i,n;var c=this.g-e/this.a;return i=Bg(c,this.e0,this.e1,this.e2,this.e3),s=Ne(this.long0+l/this.ns),n.x=s,n.y=i,n}var UL=["Equidistant_Conic","eqdc"];const VL={init:OL,forward:BL,inverse:NL,names:UL};function GL(){this.R=this.a}function HL(n){var t=n.x,e=n.y,i=Ne(t-this.long0),s,l;Math.abs(e)<=Oe&&(s=this.x0+this.R*i,l=this.y0);var c=Ql(2*Math.abs(e/Math.PI));(Math.abs(i)<=Oe||Math.abs(Math.abs(e)-de)<=Oe)&&(s=this.x0,e>=0?l=this.y0+Math.PI*this.R*Math.tan(.5*c):l=this.y0+Math.PI*this.R*-Math.tan(.5*c));var o=.5*Math.abs(Math.PI/i-i/Math.PI),p=o*o,m=Math.sin(c),x=Math.cos(c),v=x/(m+x-1),b=v*v,E=v*(2/m-1),D=E*E,k=Math.PI*this.R*(o*(v-D)+Math.sqrt(p*(v-D)*(v-D)-(D+p)*(b-D)))/(D+p);i<0&&(k=-k),s=this.x0+k;var P=p+v;return k=Math.PI*this.R*(E*P-o*Math.sqrt((D+p)*(p+1)-P*P))/(D+p),e>=0?l=this.y0+k:l=this.y0-k,n.x=s,n.y=l,n}function jL(n){var t,e,i,s,l,c,o,p,m,x,v,b,E;return n.x-=this.x0,n.y-=this.y0,v=Math.PI*this.R,i=n.x/v,s=n.y/v,l=i*i+s*s,c=-Math.abs(s)*(1+l),o=c-2*s*s+i*i,p=-2*c+1+2*s*s+l*l,E=s*s/p+(2*o*o*o/p/p/p-9*c*o/p/p)/27,m=(c-o*o/3/p)/p,x=2*Math.sqrt(-m/3),v=3*E/m/x,Math.abs(v)>1&&(v>=0?v=1:v=-1),b=Math.acos(v)/3,n.y>=0?e=(-x*Math.cos(b+Math.PI/3)-o/3/p)*Math.PI:e=-(-x*Math.cos(b+Math.PI/3)-o/3/p)*Math.PI,Math.abs(i)<Oe?t=this.long0:t=Ne(this.long0+Math.PI*(l-1+Math.sqrt(1+2*(i*i-s*s)+l*l))/2/i),n.x=t,n.y=e,n}var WL=["Van_der_Grinten_I","VanDerGrinten","vandg"];const qL={init:GL,forward:HL,inverse:jL,names:WL};function XL(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function $L(n){var t=n.x,e=n.y,i=Math.sin(n.y),s=Math.cos(n.y),l=Ne(t-this.long0),c,o,p,m,x,v,b,E,D,k,P,I,V,U,B,Z,Y,K,nt,q,J,ct,St;return this.sphere?Math.abs(this.sin_p12-1)<=Oe?(n.x=this.x0+this.a*(de-e)*Math.sin(l),n.y=this.y0-this.a*(de-e)*Math.cos(l),n):Math.abs(this.sin_p12+1)<=Oe?(n.x=this.x0+this.a*(de+e)*Math.sin(l),n.y=this.y0+this.a*(de+e)*Math.cos(l),n):(K=this.sin_p12*i+this.cos_p12*s*Math.cos(l),Z=Math.acos(K),Y=Z?Z/Math.sin(Z):1,n.x=this.x0+this.a*Y*s*Math.sin(l),n.y=this.y0+this.a*Y*(this.cos_p12*i-this.sin_p12*s*Math.cos(l)),n):(c=im(this.es),o=nm(this.es),p=sm(this.es),m=rm(this.es),Math.abs(this.sin_p12-1)<=Oe?(x=this.a*dr(c,o,p,m,de),v=this.a*dr(c,o,p,m,e),n.x=this.x0+(x-v)*Math.sin(l),n.y=this.y0-(x-v)*Math.cos(l),n):Math.abs(this.sin_p12+1)<=Oe?(x=this.a*dr(c,o,p,m,de),v=this.a*dr(c,o,p,m,e),n.x=this.x0+(x+v)*Math.sin(l),n.y=this.y0+(x+v)*Math.cos(l),n):(b=i/s,E=od(this.a,this.e,this.sin_p12),D=od(this.a,this.e,i),k=Math.atan((1-this.es)*b+this.es*E*this.sin_p12/(D*s)),P=Math.atan2(Math.sin(l),this.cos_p12*Math.tan(k)-this.sin_p12*Math.cos(l)),P===0?nt=Math.asin(this.cos_p12*Math.sin(k)-this.sin_p12*Math.cos(k)):Math.abs(Math.abs(P)-Math.PI)<=Oe?nt=-Math.asin(this.cos_p12*Math.sin(k)-this.sin_p12*Math.cos(k)):nt=Math.asin(Math.sin(l)*Math.cos(k)/Math.sin(P)),I=this.e*this.sin_p12/Math.sqrt(1-this.es),V=this.e*this.cos_p12*Math.cos(P)/Math.sqrt(1-this.es),U=I*V,B=V*V,q=nt*nt,J=q*nt,ct=J*nt,St=ct*nt,Z=E*nt*(1-q*B*(1-B)/6+J/8*U*(1-2*B)+ct/120*(B*(4-7*B)-3*I*I*(1-7*B))-St/48*U),n.x=this.x0+Z*Math.sin(P),n.y=this.y0+Z*Math.cos(P),n))}function ZL(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,s,l,c,o,p,m,x,v,b,E,D,k,P,I,V,U,B,Z,Y,K,nt;return this.sphere?(t=Math.sqrt(n.x*n.x+n.y*n.y),t>2*de*this.a?void 0:(e=t/this.a,i=Math.sin(e),s=Math.cos(e),l=this.long0,Math.abs(t)<=Oe?c=this.lat0:(c=Ql(s*this.sin_p12+n.y*i*this.cos_p12/t),o=Math.abs(this.lat0)-de,Math.abs(o)<=Oe?this.lat0>=0?l=Ne(this.long0+Math.atan2(n.x,-n.y)):l=Ne(this.long0-Math.atan2(-n.x,n.y)):l=Ne(this.long0+Math.atan2(n.x*i,t*this.cos_p12*s-n.y*this.sin_p12*i))),n.x=l,n.y=c,n)):(p=im(this.es),m=nm(this.es),x=sm(this.es),v=rm(this.es),Math.abs(this.sin_p12-1)<=Oe?(b=this.a*dr(p,m,x,v,de),t=Math.sqrt(n.x*n.x+n.y*n.y),E=b-t,c=Bg(E/this.a,p,m,x,v),l=Ne(this.long0+Math.atan2(n.x,-1*n.y)),n.x=l,n.y=c,n):Math.abs(this.sin_p12+1)<=Oe?(b=this.a*dr(p,m,x,v,de),t=Math.sqrt(n.x*n.x+n.y*n.y),E=t-b,c=Bg(E/this.a,p,m,x,v),l=Ne(this.long0+Math.atan2(n.x,n.y)),n.x=l,n.y=c,n):(t=Math.sqrt(n.x*n.x+n.y*n.y),P=Math.atan2(n.x,n.y),D=od(this.a,this.e,this.sin_p12),I=Math.cos(P),V=this.e*this.cos_p12*I,U=-V*V/(1-this.es),B=3*this.es*(1-U)*this.sin_p12*this.cos_p12*I/(1-this.es),Z=t/D,Y=Z-U*(1+U)*Math.pow(Z,3)/6-B*(1+3*U)*Math.pow(Z,4)/24,K=1-U*Y*Y/2-Z*Y*Y*Y/6,k=Math.asin(this.sin_p12*Math.cos(Y)+this.cos_p12*Math.sin(Y)*I),l=Ne(this.long0+Math.asin(Math.sin(P)*Math.sin(Y)/Math.cos(k))),nt=Math.sin(k),c=Math.atan2((nt-this.es*K*this.sin_p12)*Math.tan(k),nt*(1-this.es)),n.x=l,n.y=c,n))}var YL=["Azimuthal_Equidistant","aeqd"];const KL={init:XL,forward:$L,inverse:ZL,names:YL};function JL(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function QL(n){var t,e,i,s,l,c,o,p,m=n.x,x=n.y;return i=Ne(m-this.long0),t=Math.sin(x),e=Math.cos(x),s=Math.cos(i),c=this.sin_p14*t+this.cos_p14*e*s,l=1,(c>0||Math.abs(c)<=Oe)&&(o=this.a*l*e*Math.sin(i),p=this.y0+this.a*l*(this.cos_p14*t-this.sin_p14*e*s)),n.x=o,n.y=p,n}function t3(n){var t,e,i,s,l,c,o;return n.x-=this.x0,n.y-=this.y0,t=Math.sqrt(n.x*n.x+n.y*n.y),e=Ql(t/this.a),i=Math.sin(e),s=Math.cos(e),c=this.long0,Math.abs(t)<=Oe?(o=this.lat0,n.x=c,n.y=o,n):(o=Ql(s*this.sin_p14+n.y*i*this.cos_p14/t),l=Math.abs(this.lat0)-de,Math.abs(l)<=Oe?(this.lat0>=0?c=Ne(this.long0+Math.atan2(n.x,-n.y)):c=Ne(this.long0-Math.atan2(-n.x,n.y)),n.x=c,n.y=o,n):(c=Ne(this.long0+Math.atan2(n.x*i,t*this.cos_p14*s-n.y*this.sin_p14*i)),n.x=c,n.y=o,n))}var e3=["ortho"];const i3={init:JL,forward:QL,inverse:t3,names:e3};var Fn={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},rn={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function n3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=de-sn/2?this.face=Fn.TOP:this.lat0<=-(de-sn/2)?this.face=Fn.BOTTOM:Math.abs(this.long0)<=sn?this.face=Fn.FRONT:Math.abs(this.long0)<=de+sn?this.face=this.long0>0?Fn.RIGHT:Fn.LEFT:this.face=Fn.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function s3(n){var t={x:0,y:0},e,i,s,l,c,o,p={value:0};if(n.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):e=n.y,i=n.x,this.face===Fn.TOP)l=de-e,i>=sn&&i<=de+sn?(p.value=rn.AREA_0,s=i-de):i>de+sn||i<=-(de+sn)?(p.value=rn.AREA_1,s=i>0?i-qn:i+qn):i>-(de+sn)&&i<=-sn?(p.value=rn.AREA_2,s=i+de):(p.value=rn.AREA_3,s=i);else if(this.face===Fn.BOTTOM)l=de+e,i>=sn&&i<=de+sn?(p.value=rn.AREA_0,s=-i+de):i<sn&&i>=-sn?(p.value=rn.AREA_1,s=-i):i<-sn&&i>=-(de+sn)?(p.value=rn.AREA_2,s=-i-de):(p.value=rn.AREA_3,s=i>0?-i+qn:-i-qn);else{var m,x,v,b,E,D,k;this.face===Fn.RIGHT?i=Ku(i,+de):this.face===Fn.BACK?i=Ku(i,+qn):this.face===Fn.LEFT&&(i=Ku(i,-de)),b=Math.sin(e),E=Math.cos(e),D=Math.sin(i),k=Math.cos(i),m=E*k,x=E*D,v=b,this.face===Fn.FRONT?(l=Math.acos(m),s=g_(l,v,x,p)):this.face===Fn.RIGHT?(l=Math.acos(x),s=g_(l,v,-m,p)):this.face===Fn.BACK?(l=Math.acos(-m),s=g_(l,v,-x,p)):this.face===Fn.LEFT?(l=Math.acos(-x),s=g_(l,v,m,p)):(l=s=0,p.value=rn.AREA_0)}return o=Math.atan(12/qn*(s+Math.acos(Math.sin(s)*Math.cos(sn))-de)),c=Math.sqrt((1-Math.cos(l))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(s))))),p.value===rn.AREA_1?o+=de:p.value===rn.AREA_2?o+=qn:p.value===rn.AREA_3&&(o+=1.5*qn),t.x=c*Math.cos(o),t.y=c*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,n.x=t.x,n.y=t.y,n}function r3(n){var t={lam:0,phi:0},e,i,s,l,c,o,p,m,x,v={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),e=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?v.value=rn.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(v.value=rn.AREA_1,e-=de):n.x<0&&-n.x>=Math.abs(n.y)?(v.value=rn.AREA_2,e=e<0?e+qn:e-qn):(v.value=rn.AREA_3,e+=de),x=qn/12*Math.tan(e),c=Math.sin(x)/(Math.cos(x)-1/Math.sqrt(2)),o=Math.atan(c),s=Math.cos(e),l=Math.tan(i),p=1-s*s*l*l*(1-Math.cos(Math.atan(1/Math.cos(o)))),p<-1?p=-1:p>1&&(p=1),this.face===Fn.TOP)m=Math.acos(p),t.phi=de-m,v.value===rn.AREA_0?t.lam=o+de:v.value===rn.AREA_1?t.lam=o<0?o+qn:o-qn:v.value===rn.AREA_2?t.lam=o-de:t.lam=o;else if(this.face===Fn.BOTTOM)m=Math.acos(p),t.phi=m-de,v.value===rn.AREA_0?t.lam=-o+de:v.value===rn.AREA_1?t.lam=-o:v.value===rn.AREA_2?t.lam=-o-de:t.lam=o<0?-o-qn:-o+qn;else{var b,E,D;b=p,x=b*b,x>=1?D=0:D=Math.sqrt(1-x)*Math.sin(o),x+=D*D,x>=1?E=0:E=Math.sqrt(1-x),v.value===rn.AREA_1?(x=E,E=-D,D=x):v.value===rn.AREA_2?(E=-E,D=-D):v.value===rn.AREA_3&&(x=E,E=D,D=-x),this.face===Fn.RIGHT?(x=b,b=-E,E=x):this.face===Fn.BACK?(b=-b,E=-E):this.face===Fn.LEFT&&(x=b,b=E,E=-x),t.phi=Math.acos(-D)-de,t.lam=Math.atan2(E,b),this.face===Fn.RIGHT?t.lam=Ku(t.lam,-de):this.face===Fn.BACK?t.lam=Ku(t.lam,-qn):this.face===Fn.LEFT&&(t.lam=Ku(t.lam,+de))}if(this.es!==0){var k,P,I;k=t.phi<0?1:0,P=Math.tan(t.phi),I=this.b/Math.sqrt(P*P+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-I*I)/(this.one_minus_f*I)),k&&(t.phi=-t.phi)}return t.lam+=this.long0,n.x=t.lam,n.y=t.phi,n}function g_(n,t,e,i){var s;return n<Oe?(i.value=rn.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=sn?i.value=rn.AREA_0:s>sn&&s<=de+sn?(i.value=rn.AREA_1,s-=de):s>de+sn||s<=-(de+sn)?(i.value=rn.AREA_2,s=s>=0?s-qn:s+qn):(i.value=rn.AREA_3,s+=de)),s}function Ku(n,t){var e=n+t;return e<-qn?e+=kp:e>+qn&&(e-=kp),e}var a3=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const o3={init:n3,forward:s3,inverse:r3,names:a3};var dv=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],hp=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],qE=.8487,XE=1.3523,$E=eo/5,l3=1/$E,Nu=18,Ng=function(n,t){return n[0]+t*(n[1]+t*(n[2]+t*n[3]))},c3=function(n,t){return n[1]+t*(2*n[2]+t*3*n[3])};function h3(n,t,e,i){for(var s=t;i;--i){var l=n(s);if(s-=l,Math.abs(l)<e)break}return s}function u3(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function d3(n){var t=Ne(n.x-this.long0),e=Math.abs(n.y),i=Math.floor(e*$E);i<0?i=0:i>=Nu&&(i=Nu-1),e=eo*(e-l3*i);var s={x:Ng(dv[i],e)*t,y:Ng(hp[i],e)};return n.y<0&&(s.y=-s.y),s.x=s.x*this.a*qE+this.x0,s.y=s.y*this.a*XE+this.y0,s}function f3(n){var t={x:(n.x-this.x0)/(this.a*qE),y:Math.abs(n.y-this.y0)/(this.a*XE)};if(t.y>=1)t.x/=dv[Nu][0],t.y=n.y<0?-de:de;else{var e=Math.floor(t.y*Nu);for(e<0?e=0:e>=Nu&&(e=Nu-1);;)if(hp[e][0]>t.y)--e;else if(hp[e+1][0]<=t.y)++e;else break;var i=hp[e],s=5*(t.y-i[0])/(hp[e+1][0]-i[0]);s=h3(function(l){return(Ng(i,l)-t.y)/c3(i,l)},s,Oe,100),t.x/=Ng(dv[e],s),t.y=(5*e+s)*Ds,n.y<0&&(t.y=-t.y)}return t.x=Ne(t.x+this.long0),t}var p3=["Robinson","robin"];const m3={init:u3,forward:d3,inverse:f3,names:p3};function _3(){this.name="geocent"}function g3(n){var t=FE(n,this.es,this.a);return t}function y3(n){var t=zE(n,this.es,this.a,this.b);return t}var x3=["Geocentric","geocentric","geocent","Geocent"];const v3={init:_3,forward:g3,inverse:y3,names:x3};var $s={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Uf={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function b3(){if(Object.keys(Uf).forEach((function(e){if(typeof this[e]>"u")this[e]=Uf[e].def;else{if(Uf[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Uf[e].num&&(this[e]=parseFloat(this[e]))}Uf[e].degrees&&(this[e]=this[e]*Ds)}).bind(this)),Math.abs(Math.abs(this.lat0)-de)<Oe?this.mode=this.lat0<0?$s.S_POLE:$s.N_POLE:Math.abs(this.lat0)<Oe?this.mode=$s.EQUIT:(this.mode=$s.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(n),this.sw=Math.sin(n)}function w3(n){n.x-=this.long0;var t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),s,l;switch(this.mode){case $s.OBLIQ:l=this.sinph0*t+this.cosph0*e*i;break;case $s.EQUIT:l=e*i;break;case $s.S_POLE:l=-t;break;case $s.N_POLE:l=t;break}switch(l=this.pn1/(this.p-l),s=l*e*Math.sin(n.x),this.mode){case $s.OBLIQ:l*=this.cosph0*t-this.sinph0*e*i;break;case $s.EQUIT:l*=t;break;case $s.N_POLE:l*=-(e*i);break;case $s.S_POLE:l*=e*i;break}var c,o;return c=l*this.cg+s*this.sg,o=1/(c*this.sw*this.h1+this.cw),s=(s*this.cg-l*this.sg)*this.cw*o,l=c*o,n.x=s*this.a,n.y=l*this.a,n}function M3(n){n.x/=this.a,n.y/=this.a;var t={x:n.x,y:n.y},e,i,s;s=1/(this.pn1-n.y*this.sw),e=this.pn1*n.x*s,i=this.pn1*n.y*this.cw*s,n.x=e*this.cg+i*this.sg,n.y=i*this.cg-e*this.sg;var l=Rr(n.x,n.y);if(Math.abs(l)<Oe)t.x=0,t.y=n.y;else{var c,o;switch(o=1-l*l*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/l+l/this.pn1),c=Math.sqrt(1-o*o),this.mode){case $s.OBLIQ:t.y=Math.asin(c*this.sinph0+n.y*o*this.cosph0/l),n.y=(c-this.sinph0*Math.sin(t.y))*l,n.x*=o*this.cosph0;break;case $s.EQUIT:t.y=Math.asin(n.y*o/l),n.y=c*l,n.x*=o;break;case $s.N_POLE:t.y=Math.asin(c),n.y=-n.y;break;case $s.S_POLE:t.y=-Math.asin(c);break}t.x=Math.atan2(n.x,n.y)}return n.x=t.x+this.long0,n.y=t.y,n}var S3=["Tilted_Perspective","tpers"];const T3={init:b3,forward:w3,inverse:M3,names:S3};function E3(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,t=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function A3(n){var t=n.x,e=n.y,i,s,l,c;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var o=this.radius_p/Rr(this.radius_p*Math.cos(e),Math.sin(e));if(s=o*Math.cos(t)*Math.cos(e),l=o*Math.sin(t)*Math.cos(e),c=o*Math.sin(e),(this.radius_g-s)*s-l*l-c*c*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(l/Rr(c,i)),n.y=this.radius_g_1*Math.atan(c/i)):(n.x=this.radius_g_1*Math.atan(l/i),n.y=this.radius_g_1*Math.atan(c/Rr(l,i)))}else this.shape==="sphere"&&(i=Math.cos(e),s=Math.cos(t)*i,l=Math.sin(t)*i,c=Math.sin(e),i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(l/Rr(c,i)),n.y=this.radius_g_1*Math.atan(c/i)):(n.x=this.radius_g_1*Math.atan(l/i),n.y=this.radius_g_1*Math.atan(c/Rr(l,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function C3(n){var t=-1,e=0,i=0,s,l,c,o;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*Rr(1,i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Rr(1,e));var p=i/this.radius_p;if(s=e*e+p*p+t*t,l=2*this.radius_g*t,c=l*l-4*s*this.C,c<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-l-Math.sqrt(c))/(2*s),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+i*i+t*t,l=2*this.radius_g*t,c=l*l-4*s*this.C,c<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-l-Math.sqrt(c))/(2*s),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t)}return n.x=n.x+this.long0,n}var P3=["Geostationary Satellite View","Geostationary_Satellite","geos"];const I3={init:E3,forward:A3,inverse:C3,names:P3};var vp=1.340264,bp=-.081106,wp=893e-6,Mp=.003796,Ug=Math.sqrt(3)/2;function R3(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function D3(n){var t=Ne(n.x-this.long0),e=n.y,i=Math.asin(Ug*Math.sin(e)),s=i*i,l=s*s*s;return n.x=t*Math.cos(i)/(Ug*(vp+3*bp*s+l*(7*wp+9*Mp*s))),n.y=i*(vp+bp*s+l*(wp+Mp*s)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function L3(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var t=1e-9,e=12,i=n.y,s,l,c,o,p,m;for(m=0;m<e&&(s=i*i,l=s*s*s,c=i*(vp+bp*s+l*(wp+Mp*s))-n.y,o=vp+3*bp*s+l*(7*wp+9*Mp*s),i-=p=c/o,!(Math.abs(p)<t));++m);return s=i*i,l=s*s*s,n.x=Ug*n.x*(vp+3*bp*s+l*(7*wp+9*Mp*s))/Math.cos(i),n.y=Math.asin(Math.sin(i)/Ug),n.x=Ne(n.x+this.long0),n}var k3=["eqearth","Equal Earth","Equal_Earth"];const F3={init:R3,forward:D3,inverse:L3,names:k3};var Op=1e-10;function z3(){var n;if(this.phi1=this.lat1,Math.abs(this.phi1)<Op)throw new Error;this.es?(this.en=qb(this.es),this.m1=Pd(this.phi1,this.am1=Math.sin(this.phi1),n=Math.cos(this.phi1),this.en),this.am1=n/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=B3,this.forward=O3):(Math.abs(this.phi1)+Op>=de?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=U3,this.forward=N3)}function O3(n){var t=Ne(n.x-(this.long0||0)),e=n.y,i,s,l;return i=this.am1+this.m1-Pd(e,s=Math.sin(e),l=Math.cos(e),this.en),s=l*t/(i*Math.sqrt(1-this.es*s*s)),n.x=i*Math.sin(s),n.y=this.am1-i*Math.cos(s),n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function B3(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var t,e,i,s;if(e=Rr(n.x,n.y=this.am1-n.y),s=Xb(this.am1+this.m1-e,this.es,this.en),(t=Math.abs(s))<de)t=Math.sin(s),i=e*Math.atan2(n.x,n.y)*Math.sqrt(1-this.es*t*t)/Math.cos(s);else if(Math.abs(t-de)<=Op)i=0;else throw new Error;return n.x=Ne(i+(this.long0||0)),n.y=rc(s),n}function N3(n){var t=Ne(n.x-(this.long0||0)),e=n.y,i,s;return s=this.cphi1+this.phi1-e,Math.abs(s)>Op?(n.x=s*Math.sin(i=t*Math.cos(e)/s),n.y=this.cphi1-s*Math.cos(i)):n.x=n.y=0,n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function U3(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var t,e,i=Rr(n.x,n.y=this.cphi1-n.y);if(e=this.cphi1+this.phi1-i,Math.abs(e)>de)throw new Error;return Math.abs(Math.abs(e)-de)<=Op?t=0:t=i*Math.atan2(n.x,n.y)/Math.cos(e),n.x=Ne(t+(this.long0||0)),n.y=rc(e),n}var V3=["bonne","Bonne (Werner lat_1=90)"];const G3={init:z3,names:V3};function H3(n){n.Proj.projections.add(wg),n.Proj.projections.add(Mg),n.Proj.projections.add(OR),n.Proj.projections.add(XR),n.Proj.projections.add(QR),n.Proj.projections.add(sD),n.Proj.projections.add(hD),n.Proj.projections.add(mD),n.Proj.projections.add(vD),n.Proj.projections.add(TD),n.Proj.projections.add(GD),n.Proj.projections.add($D),n.Proj.projections.add(QD),n.Proj.projections.add(rL),n.Proj.projections.add(hL),n.Proj.projections.add(mL),n.Proj.projections.add(vL),n.Proj.projections.add(TL),n.Proj.projections.add(RL),n.Proj.projections.add(zL),n.Proj.projections.add(VL),n.Proj.projections.add(qL),n.Proj.projections.add(KL),n.Proj.projections.add(i3),n.Proj.projections.add(o3),n.Proj.projections.add(m3),n.Proj.projections.add(v3),n.Proj.projections.add(T3),n.Proj.projections.add(I3),n.Proj.projections.add(F3),n.Proj.projections.add(G3)}gr.defaultDatum="WGS84";gr.Proj=so;gr.WGS84=new gr.Proj("WGS84");gr.Point=ad;gr.toPoint=OE;gr.defs=cr;gr.nadgrid=NI;gr.transform=Og;gr.mgrs=eR;gr.version="__VERSION__";H3(gr);const ld=[-12043,-34145],XM=[139.699361,35.692191],j3=90;var up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var YE="Expected a function",$M=NaN,W3="[object Symbol]",q3=/^\s+|\s+$/g,X3=/^[-+]0x[0-9a-f]+$/i,$3=/^0b[01]+$/i,Z3=/^0o[0-7]+$/i,Y3=parseInt,K3=typeof up=="object"&&up&&up.Object===Object&&up,J3=typeof self=="object"&&self&&self.Object===Object&&self,Q3=K3||J3||Function("return this")(),tk=Object.prototype,ek=tk.toString,ik=Math.max,nk=Math.min,Wy=function(){return Q3.Date.now()};function sk(n,t,e){var i,s,l,c,o,p,m=0,x=!1,v=!1,b=!0;if(typeof n!="function")throw new TypeError(YE);t=ZM(t)||0,Vg(e)&&(x=!!e.leading,v="maxWait"in e,l=v?ik(ZM(e.maxWait)||0,t):l,b="trailing"in e?!!e.trailing:b);function E(Y){var K=i,nt=s;return i=s=void 0,m=Y,c=n.apply(nt,K),c}function D(Y){return m=Y,o=setTimeout(I,t),x?E(Y):c}function k(Y){var K=Y-p,nt=Y-m,q=t-K;return v?nk(q,l-nt):q}function P(Y){var K=Y-p,nt=Y-m;return p===void 0||K>=t||K<0||v&&nt>=l}function I(){var Y=Wy();if(P(Y))return V(Y);o=setTimeout(I,k(Y))}function V(Y){return o=void 0,b&&i?E(Y):(i=s=void 0,c)}function U(){o!==void 0&&clearTimeout(o),m=0,i=p=s=o=void 0}function B(){return o===void 0?c:V(Wy())}function Z(){var Y=Wy(),K=P(Y);if(i=arguments,s=this,p=Y,K){if(o===void 0)return D(p);if(v)return o=setTimeout(I,t),E(p)}return o===void 0&&(o=setTimeout(I,t)),c}return Z.cancel=U,Z.flush=B,Z}function rk(n,t,e){var i=!0,s=!0;if(typeof n!="function")throw new TypeError(YE);return Vg(e)&&(i="leading"in e?!!e.leading:i,s="trailing"in e?!!e.trailing:s),sk(n,t,{leading:i,maxWait:t,trailing:s})}function Vg(n){var t=typeof n;return!!n&&(t=="object"||t=="function")}function ak(n){return!!n&&typeof n=="object"}function ok(n){return typeof n=="symbol"||ak(n)&&ek.call(n)==W3}function ZM(n){if(typeof n=="number")return n;if(ok(n))return $M;if(Vg(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Vg(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=n.replace(q3,"");var e=$3.test(n);return e||Z3.test(n)?Y3(n.slice(2),e?2:8):X3.test(n)?$M:+n}var lk=rk;const ck=ZE(lk);gr.defs("EPSG:6677","+proj=tmerc +lat_0=36 +lon_0=139.833333333333 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs");const hk=(n,t)=>{const e=ld[0]+n,i=ld[1]+t*-1;return gr("EPSG:6677","WGS84",[e,i])},fv=(n,t)=>{const e=gr("WGS84","EPSG:6677",[n,t]),i=e[0]-ld[0],s=(e[1]-ld[1])*-1;return{x:i,z:s}},uk=n=>{const t=n.slice(1).split("/");if(t.length===3){const e=parseFloat(t[0]),i=e>=0&&e<=360?e:0,s=parseFloat(t[1]),l=parseFloat(t[2]);return{angle:i,lat:s,lng:l}}else return null},dk=(n,t,e)=>{const i=`${n.toFixed(2)}/${t.toFixed(6)}/${e.toFixed(6)}`;history.replaceState(null,"",`#${i}`)},fk=ck(dk,1e3);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const d0="170",Ta={ROTATE:0,DOLLY:1,PAN:2},Uu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},pk=0,YM=1,mk=2,KE=1,_k=2,ko=3,Va=0,pr=1,Qr=2,Xl=0,Ju=1,KM=2,JM=3,QM=4,gk=5,Jc=100,yk=101,xk=102,vk=103,bk=104,wk=200,Mk=201,Sk=202,Tk=203,pv=204,mv=205,Ek=206,Ak=207,Ck=208,Pk=209,Ik=210,Rk=211,Dk=212,Lk=213,kk=214,_v=0,gv=1,yv=2,cd=3,xv=4,vv=5,bv=6,wv=7,JE=0,Fk=1,zk=2,$l=0,Ok=1,Bk=2,Nk=3,Uk=4,Vk=5,Gk=6,Hk=7,tS="attached",jk="detached",QE=300,hd=301,ud=302,Mv=303,Sv=304,f0=306,dd=1e3,Ul=1001,Gg=1002,mr=1003,tA=1004,dp=1005,ea=1006,Sg=1007,No=1008,jo=1009,eA=1010,iA=1011,Bp=1012,Kb=1013,tc=1014,ia=1015,am=1016,Jb=1017,Qb=1018,fd=1020,nA=35902,sA=1021,rA=1022,Lr=1023,aA=1024,oA=1025,Qu=1026,pd=1027,t1=1028,p0=1029,lA=1030,e1=1031,i1=1033,Tg=33776,Eg=33777,Ag=33778,Cg=33779,Tv=35840,Ev=35841,Av=35842,Cv=35843,Pv=36196,Iv=37492,Rv=37496,Dv=37808,Lv=37809,kv=37810,Fv=37811,zv=37812,Ov=37813,Bv=37814,Nv=37815,Uv=37816,Vv=37817,Gv=37818,Hv=37819,jv=37820,Wv=37821,Pg=36492,qv=36494,Xv=36495,cA=36283,$v=36284,Zv=36285,Yv=36286,Wk=2200,qk=2201,Xk=2202,Np=2300,Up=2301,qy=2302,Vu=2400,Gu=2401,Hg=2402,n1=2500,$k=2501,Zk=0,hA=1,Kv=2,Yk=3200,Kk=3201,uA=0,Jk=1,Nl="",Ls="srgb",yr="srgb-linear",m0="linear",_n="srgb",hu=7680,eS=519,Qk=512,tF=513,eF=514,dA=515,iF=516,nF=517,sF=518,rF=519,Jv=35044,md="300 es",Uo=2e3,jg=2001;class ac{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const s=this._listeners[t];if(s!==void 0){const l=s.indexOf(e);l!==-1&&s.splice(l,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let l=0,c=s.length;l<c;l++)s[l].call(this,t);t.target=null}}}const js=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let iS=1234567;const Sp=Math.PI/180,_d=180/Math.PI;function Ua(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(js[n&255]+js[n>>8&255]+js[n>>16&255]+js[n>>24&255]+"-"+js[t&255]+js[t>>8&255]+"-"+js[t>>16&15|64]+js[t>>24&255]+"-"+js[e&63|128]+js[e>>8&255]+"-"+js[e>>16&255]+js[e>>24&255]+js[i&255]+js[i>>8&255]+js[i>>16&255]+js[i>>24&255]).toLowerCase()}function bs(n,t,e){return Math.max(t,Math.min(e,n))}function s1(n,t){return(n%t+t)%t}function aF(n,t,e,i,s){return i+(n-t)*(s-i)/(e-t)}function oF(n,t,e){return n!==t?(e-n)/(t-n):0}function Tp(n,t,e){return(1-e)*n+e*t}function lF(n,t,e,i){return Tp(n,t,1-Math.exp(-e*i))}function cF(n,t=1){return t-Math.abs(s1(n,t*2)-t)}function hF(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function uF(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function dF(n,t){return n+Math.floor(Math.random()*(t-n+1))}function fF(n,t){return n+Math.random()*(t-n)}function pF(n){return n*(.5-Math.random())}function mF(n){n!==void 0&&(iS=n);let t=iS+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function _F(n){return n*Sp}function gF(n){return n*_d}function yF(n){return(n&n-1)===0&&n!==0}function xF(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function vF(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function bF(n,t,e,i,s){const l=Math.cos,c=Math.sin,o=l(e/2),p=c(e/2),m=l((t+i)/2),x=c((t+i)/2),v=l((t-i)/2),b=c((t-i)/2),E=l((i-t)/2),D=c((i-t)/2);switch(s){case"XYX":n.set(o*x,p*v,p*b,o*m);break;case"YZY":n.set(p*b,o*x,p*v,o*m);break;case"ZXZ":n.set(p*v,p*b,o*x,o*m);break;case"XZX":n.set(o*x,p*D,p*E,o*m);break;case"YXY":n.set(p*E,o*x,p*D,o*m);break;case"ZYZ":n.set(p*D,p*E,o*x,o*m);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ba(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function hn(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const hh={DEG2RAD:Sp,RAD2DEG:_d,generateUUID:Ua,clamp:bs,euclideanModulo:s1,mapLinear:aF,inverseLerp:oF,lerp:Tp,damp:lF,pingpong:cF,smoothstep:hF,smootherstep:uF,randInt:dF,randFloat:fF,randFloatSpread:pF,seededRandom:mF,degToRad:_F,radToDeg:gF,isPowerOfTwo:yF,ceilPowerOfTwo:xF,floorPowerOfTwo:vF,setQuaternionFromProperEuler:bF,normalize:hn,denormalize:Ba};class si{constructor(t=0,e=0){si.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(bs(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),l=this.x-t.x,c=this.y-t.y;return this.x=l*i-c*s+t.x,this.y=l*s+c*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Li{constructor(t,e,i,s,l,c,o,p,m){Li.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,l,c,o,p,m)}set(t,e,i,s,l,c,o,p,m){const x=this.elements;return x[0]=t,x[1]=s,x[2]=o,x[3]=e,x[4]=l,x[5]=p,x[6]=i,x[7]=c,x[8]=m,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,l=this.elements,c=i[0],o=i[3],p=i[6],m=i[1],x=i[4],v=i[7],b=i[2],E=i[5],D=i[8],k=s[0],P=s[3],I=s[6],V=s[1],U=s[4],B=s[7],Z=s[2],Y=s[5],K=s[8];return l[0]=c*k+o*V+p*Z,l[3]=c*P+o*U+p*Y,l[6]=c*I+o*B+p*K,l[1]=m*k+x*V+v*Z,l[4]=m*P+x*U+v*Y,l[7]=m*I+x*B+v*K,l[2]=b*k+E*V+D*Z,l[5]=b*P+E*U+D*Y,l[8]=b*I+E*B+D*K,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],l=t[3],c=t[4],o=t[5],p=t[6],m=t[7],x=t[8];return e*c*x-e*o*m-i*l*x+i*o*p+s*l*m-s*c*p}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],l=t[3],c=t[4],o=t[5],p=t[6],m=t[7],x=t[8],v=x*c-o*m,b=o*p-x*l,E=m*l-c*p,D=e*v+i*b+s*E;if(D===0)return this.set(0,0,0,0,0,0,0,0,0);const k=1/D;return t[0]=v*k,t[1]=(s*m-x*i)*k,t[2]=(o*i-s*c)*k,t[3]=b*k,t[4]=(x*e-s*p)*k,t[5]=(s*l-o*e)*k,t[6]=E*k,t[7]=(i*p-m*e)*k,t[8]=(c*e-i*l)*k,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,l,c,o){const p=Math.cos(l),m=Math.sin(l);return this.set(i*p,i*m,-i*(p*c+m*o)+c+t,-s*m,s*p,-s*(-m*c+p*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Xy.makeScale(t,e)),this}rotate(t){return this.premultiply(Xy.makeRotation(-t)),this}translate(t,e){return this.premultiply(Xy.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Xy=new Li;function fA(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Vp(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function wF(){const n=Vp("canvas");return n.style.display="block",n}const nS={};function fp(n){n in nS||(nS[n]=!0,console.warn(n))}function MF(n,t,e){return new Promise(function(i,s){function l(){switch(n.clientWaitSync(t,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(l,e);break;default:i()}}setTimeout(l,e)})}function SF(n){const t=n.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function TF(n){const t=n.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const ji={enabled:!0,workingColorSpace:yr,spaces:{},convert:function(n,t,e){return this.enabled===!1||t===e||!t||!e||(this.spaces[t].transfer===_n&&(n.r=Go(n.r),n.g=Go(n.g),n.b=Go(n.b)),this.spaces[t].primaries!==this.spaces[e].primaries&&(n.applyMatrix3(this.spaces[t].toXYZ),n.applyMatrix3(this.spaces[e].fromXYZ)),this.spaces[e].transfer===_n&&(n.r=td(n.r),n.g=td(n.g),n.b=td(n.b))),n},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===Nl?m0:this.spaces[n].transfer},getLuminanceCoefficients:function(n,t=this.workingColorSpace){return n.fromArray(this.spaces[t].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,t,e){return n.copy(this.spaces[t].toXYZ).multiply(this.spaces[e].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function Go(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function td(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const sS=[.64,.33,.3,.6,.15,.06],rS=[.2126,.7152,.0722],aS=[.3127,.329],oS=new Li().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),lS=new Li().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ji.define({[yr]:{primaries:sS,whitePoint:aS,transfer:m0,toXYZ:oS,fromXYZ:lS,luminanceCoefficients:rS,workingColorSpaceConfig:{unpackColorSpace:Ls},outputColorSpaceConfig:{drawingBufferColorSpace:Ls}},[Ls]:{primaries:sS,whitePoint:aS,transfer:_n,toXYZ:oS,fromXYZ:lS,luminanceCoefficients:rS,outputColorSpaceConfig:{drawingBufferColorSpace:Ls}}});let uu;class EF{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{uu===void 0&&(uu=Vp("canvas")),uu.width=t.width,uu.height=t.height;const i=uu.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=uu}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Vp("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),l=s.data;for(let c=0;c<l.length;c++)l[c]=Go(l[c]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Go(e[i]/255)*255):e[i]=Go(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let AF=0;class pA{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:AF++}),this.uuid=Ua(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let l;if(Array.isArray(s)){l=[];for(let c=0,o=s.length;c<o;c++)s[c].isDataTexture?l.push($y(s[c].image)):l.push($y(s[c]))}else l=$y(s);i.url=l}return e||(t.images[this.uuid]=i),i}}function $y(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?EF.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let CF=0;class Ms extends ac{constructor(t=Ms.DEFAULT_IMAGE,e=Ms.DEFAULT_MAPPING,i=Ul,s=Ul,l=ea,c=No,o=Lr,p=jo,m=Ms.DEFAULT_ANISOTROPY,x=Nl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:CF++}),this.uuid=Ua(),this.name="",this.source=new pA(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=l,this.minFilter=c,this.anisotropy=m,this.format=o,this.internalFormat=null,this.type=p,this.offset=new si(0,0),this.repeat=new si(1,1),this.center=new si(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Li,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==QE)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case dd:t.x=t.x-Math.floor(t.x);break;case Ul:t.x=t.x<0?0:1;break;case Gg:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case dd:t.y=t.y-Math.floor(t.y);break;case Ul:t.y=t.y<0?0:1;break;case Gg:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ms.DEFAULT_IMAGE=null;Ms.DEFAULT_MAPPING=QE;Ms.DEFAULT_ANISOTROPY=1;class en{constructor(t=0,e=0,i=0,s=1){en.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,l=this.w,c=t.elements;return this.x=c[0]*e+c[4]*i+c[8]*s+c[12]*l,this.y=c[1]*e+c[5]*i+c[9]*s+c[13]*l,this.z=c[2]*e+c[6]*i+c[10]*s+c[14]*l,this.w=c[3]*e+c[7]*i+c[11]*s+c[15]*l,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,l;const p=t.elements,m=p[0],x=p[4],v=p[8],b=p[1],E=p[5],D=p[9],k=p[2],P=p[6],I=p[10];if(Math.abs(x-b)<.01&&Math.abs(v-k)<.01&&Math.abs(D-P)<.01){if(Math.abs(x+b)<.1&&Math.abs(v+k)<.1&&Math.abs(D+P)<.1&&Math.abs(m+E+I-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const U=(m+1)/2,B=(E+1)/2,Z=(I+1)/2,Y=(x+b)/4,K=(v+k)/4,nt=(D+P)/4;return U>B&&U>Z?U<.01?(i=0,s=.707106781,l=.707106781):(i=Math.sqrt(U),s=Y/i,l=K/i):B>Z?B<.01?(i=.707106781,s=0,l=.707106781):(s=Math.sqrt(B),i=Y/s,l=nt/s):Z<.01?(i=.707106781,s=.707106781,l=0):(l=Math.sqrt(Z),i=K/l,s=nt/l),this.set(i,s,l,e),this}let V=Math.sqrt((P-D)*(P-D)+(v-k)*(v-k)+(b-x)*(b-x));return Math.abs(V)<.001&&(V=1),this.x=(P-D)/V,this.y=(v-k)/V,this.z=(b-x)/V,this.w=Math.acos((m+E+I-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class PF extends ac{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new en(0,0,t,e),this.scissorTest=!1,this.viewport=new en(0,0,t,e);const s={width:t,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ea,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const l=new Ms(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);l.flipY=!1,l.generateMipmaps=i.generateMipmaps,l.internalFormat=i.internalFormat,this.textures=[];const c=i.count;for(let o=0;o<c;o++)this.textures[o]=l.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let s=0,l=this.textures.length;s<l;s++)this.textures[s].image.width=t,this.textures[s].image.height=e,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let i=0,s=t.textures.length;i<s;i++)this.textures[i]=t.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new pA(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class uh extends PF{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class mA extends Ms{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=mr,this.minFilter=mr,this.wrapR=Ul,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class IF extends Ms{constructor(t=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=mr,this.minFilter=mr,this.wrapR=Ul,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _r{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,l,c,o){let p=i[s+0],m=i[s+1],x=i[s+2],v=i[s+3];const b=l[c+0],E=l[c+1],D=l[c+2],k=l[c+3];if(o===0){t[e+0]=p,t[e+1]=m,t[e+2]=x,t[e+3]=v;return}if(o===1){t[e+0]=b,t[e+1]=E,t[e+2]=D,t[e+3]=k;return}if(v!==k||p!==b||m!==E||x!==D){let P=1-o;const I=p*b+m*E+x*D+v*k,V=I>=0?1:-1,U=1-I*I;if(U>Number.EPSILON){const Z=Math.sqrt(U),Y=Math.atan2(Z,I*V);P=Math.sin(P*Y)/Z,o=Math.sin(o*Y)/Z}const B=o*V;if(p=p*P+b*B,m=m*P+E*B,x=x*P+D*B,v=v*P+k*B,P===1-o){const Z=1/Math.sqrt(p*p+m*m+x*x+v*v);p*=Z,m*=Z,x*=Z,v*=Z}}t[e]=p,t[e+1]=m,t[e+2]=x,t[e+3]=v}static multiplyQuaternionsFlat(t,e,i,s,l,c){const o=i[s],p=i[s+1],m=i[s+2],x=i[s+3],v=l[c],b=l[c+1],E=l[c+2],D=l[c+3];return t[e]=o*D+x*v+p*E-m*b,t[e+1]=p*D+x*b+m*v-o*E,t[e+2]=m*D+x*E+o*b-p*v,t[e+3]=x*D-o*v-p*b-m*E,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,l=t._z,c=t._order,o=Math.cos,p=Math.sin,m=o(i/2),x=o(s/2),v=o(l/2),b=p(i/2),E=p(s/2),D=p(l/2);switch(c){case"XYZ":this._x=b*x*v+m*E*D,this._y=m*E*v-b*x*D,this._z=m*x*D+b*E*v,this._w=m*x*v-b*E*D;break;case"YXZ":this._x=b*x*v+m*E*D,this._y=m*E*v-b*x*D,this._z=m*x*D-b*E*v,this._w=m*x*v+b*E*D;break;case"ZXY":this._x=b*x*v-m*E*D,this._y=m*E*v+b*x*D,this._z=m*x*D+b*E*v,this._w=m*x*v-b*E*D;break;case"ZYX":this._x=b*x*v-m*E*D,this._y=m*E*v+b*x*D,this._z=m*x*D-b*E*v,this._w=m*x*v+b*E*D;break;case"YZX":this._x=b*x*v+m*E*D,this._y=m*E*v+b*x*D,this._z=m*x*D-b*E*v,this._w=m*x*v-b*E*D;break;case"XZY":this._x=b*x*v-m*E*D,this._y=m*E*v-b*x*D,this._z=m*x*D+b*E*v,this._w=m*x*v+b*E*D;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],l=e[8],c=e[1],o=e[5],p=e[9],m=e[2],x=e[6],v=e[10],b=i+o+v;if(b>0){const E=.5/Math.sqrt(b+1);this._w=.25/E,this._x=(x-p)*E,this._y=(l-m)*E,this._z=(c-s)*E}else if(i>o&&i>v){const E=2*Math.sqrt(1+i-o-v);this._w=(x-p)/E,this._x=.25*E,this._y=(s+c)/E,this._z=(l+m)/E}else if(o>v){const E=2*Math.sqrt(1+o-i-v);this._w=(l-m)/E,this._x=(s+c)/E,this._y=.25*E,this._z=(p+x)/E}else{const E=2*Math.sqrt(1+v-i-o);this._w=(c-s)/E,this._x=(l+m)/E,this._y=(p+x)/E,this._z=.25*E}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(bs(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,l=t._z,c=t._w,o=e._x,p=e._y,m=e._z,x=e._w;return this._x=i*x+c*o+s*m-l*p,this._y=s*x+c*p+l*o-i*m,this._z=l*x+c*m+i*p-s*o,this._w=c*x-i*o-s*p-l*m,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,l=this._z,c=this._w;let o=c*t._w+i*t._x+s*t._y+l*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=c,this._x=i,this._y=s,this._z=l,this;const p=1-o*o;if(p<=Number.EPSILON){const E=1-e;return this._w=E*c+e*this._w,this._x=E*i+e*this._x,this._y=E*s+e*this._y,this._z=E*l+e*this._z,this.normalize(),this}const m=Math.sqrt(p),x=Math.atan2(m,o),v=Math.sin((1-e)*x)/m,b=Math.sin(e*x)/m;return this._w=c*v+this._w*b,this._x=i*v+this._x*b,this._y=s*v+this._y*b,this._z=l*v+this._z*b,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),l=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),l*Math.sin(e),l*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class _t{constructor(t=0,e=0,i=0){_t.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(cS.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cS.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,l=t.elements;return this.x=l[0]*e+l[3]*i+l[6]*s,this.y=l[1]*e+l[4]*i+l[7]*s,this.z=l[2]*e+l[5]*i+l[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,l=t.elements,c=1/(l[3]*e+l[7]*i+l[11]*s+l[15]);return this.x=(l[0]*e+l[4]*i+l[8]*s+l[12])*c,this.y=(l[1]*e+l[5]*i+l[9]*s+l[13])*c,this.z=(l[2]*e+l[6]*i+l[10]*s+l[14])*c,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,l=t.x,c=t.y,o=t.z,p=t.w,m=2*(c*s-o*i),x=2*(o*e-l*s),v=2*(l*i-c*e);return this.x=e+p*m+c*v-o*x,this.y=i+p*x+o*m-l*v,this.z=s+p*v+l*x-c*m,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,l=t.elements;return this.x=l[0]*e+l[4]*i+l[8]*s,this.y=l[1]*e+l[5]*i+l[9]*s,this.z=l[2]*e+l[6]*i+l[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,l=t.z,c=e.x,o=e.y,p=e.z;return this.x=s*p-l*o,this.y=l*c-i*p,this.z=i*o-s*c,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Zy.copy(this).projectOnVector(t),this.sub(Zy)}reflect(t){return this.sub(Zy.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(bs(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Zy=new _t,cS=new _r;class Nn{constructor(t=new _t(1/0,1/0,1/0),e=new _t(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(La.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(La.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=La.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const l=i.getAttribute("position");if(e===!0&&l!==void 0&&t.isInstancedMesh!==!0)for(let c=0,o=l.count;c<o;c++)t.isMesh===!0?t.getVertexPosition(c,La):La.fromBufferAttribute(l,c),La.applyMatrix4(t.matrixWorld),this.expandByPoint(La);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),y_.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),y_.copy(i.boundingBox)),y_.applyMatrix4(t.matrixWorld),this.union(y_)}const s=t.children;for(let l=0,c=s.length;l<c;l++)this.expandByObject(s[l],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,La),La.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vf),x_.subVectors(this.max,Vf),du.subVectors(t.a,Vf),fu.subVectors(t.b,Vf),pu.subVectors(t.c,Vf),Cl.subVectors(fu,du),Pl.subVectors(pu,fu),kc.subVectors(du,pu);let e=[0,-Cl.z,Cl.y,0,-Pl.z,Pl.y,0,-kc.z,kc.y,Cl.z,0,-Cl.x,Pl.z,0,-Pl.x,kc.z,0,-kc.x,-Cl.y,Cl.x,0,-Pl.y,Pl.x,0,-kc.y,kc.x,0];return!Yy(e,du,fu,pu,x_)||(e=[1,0,0,0,1,0,0,0,1],!Yy(e,du,fu,pu,x_))?!1:(v_.crossVectors(Cl,Pl),e=[v_.x,v_.y,v_.z],Yy(e,du,fu,pu,x_))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,La).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(La).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Co[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Co[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Co[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Co[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Co[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Co[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Co[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Co[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Co),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Co=[new _t,new _t,new _t,new _t,new _t,new _t,new _t,new _t],La=new _t,y_=new Nn,du=new _t,fu=new _t,pu=new _t,Cl=new _t,Pl=new _t,kc=new _t,Vf=new _t,x_=new _t,v_=new _t,Fc=new _t;function Yy(n,t,e,i,s){for(let l=0,c=n.length-3;l<=c;l+=3){Fc.fromArray(n,l);const o=s.x*Math.abs(Fc.x)+s.y*Math.abs(Fc.y)+s.z*Math.abs(Fc.z),p=t.dot(Fc),m=e.dot(Fc),x=i.dot(Fc);if(Math.max(-Math.max(p,m,x),Math.min(p,m,x))>o)return!1}return!0}const RF=new Nn,Gf=new _t,Ky=new _t;class Ys{constructor(t=new _t,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):RF.setFromPoints(t).getCenter(i);let s=0;for(let l=0,c=t.length;l<c;l++)s=Math.max(s,i.distanceToSquared(t[l]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Gf.subVectors(t,this.center);const e=Gf.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(Gf,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Ky.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Gf.copy(t.center).add(Ky)),this.expandByPoint(Gf.copy(t.center).sub(Ky))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Po=new _t,Jy=new _t,b_=new _t,Il=new _t,Qy=new _t,w_=new _t,tx=new _t;class _h{constructor(t=new _t,e=new _t(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Po)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Po.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Po.copy(this.origin).addScaledVector(this.direction,e),Po.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){Jy.copy(t).add(e).multiplyScalar(.5),b_.copy(e).sub(t).normalize(),Il.copy(this.origin).sub(Jy);const l=t.distanceTo(e)*.5,c=-this.direction.dot(b_),o=Il.dot(this.direction),p=-Il.dot(b_),m=Il.lengthSq(),x=Math.abs(1-c*c);let v,b,E,D;if(x>0)if(v=c*p-o,b=c*o-p,D=l*x,v>=0)if(b>=-D)if(b<=D){const k=1/x;v*=k,b*=k,E=v*(v+c*b+2*o)+b*(c*v+b+2*p)+m}else b=l,v=Math.max(0,-(c*b+o)),E=-v*v+b*(b+2*p)+m;else b=-l,v=Math.max(0,-(c*b+o)),E=-v*v+b*(b+2*p)+m;else b<=-D?(v=Math.max(0,-(-c*l+o)),b=v>0?-l:Math.min(Math.max(-l,-p),l),E=-v*v+b*(b+2*p)+m):b<=D?(v=0,b=Math.min(Math.max(-l,-p),l),E=b*(b+2*p)+m):(v=Math.max(0,-(c*l+o)),b=v>0?l:Math.min(Math.max(-l,-p),l),E=-v*v+b*(b+2*p)+m);else b=c>0?-l:l,v=Math.max(0,-(c*b+o)),E=-v*v+b*(b+2*p)+m;return i&&i.copy(this.origin).addScaledVector(this.direction,v),s&&s.copy(Jy).addScaledVector(b_,b),E}intersectSphere(t,e){Po.subVectors(t.center,this.origin);const i=Po.dot(this.direction),s=Po.dot(Po)-i*i,l=t.radius*t.radius;if(s>l)return null;const c=Math.sqrt(l-s),o=i-c,p=i+c;return p<0?null:o<0?this.at(p,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,l,c,o,p;const m=1/this.direction.x,x=1/this.direction.y,v=1/this.direction.z,b=this.origin;return m>=0?(i=(t.min.x-b.x)*m,s=(t.max.x-b.x)*m):(i=(t.max.x-b.x)*m,s=(t.min.x-b.x)*m),x>=0?(l=(t.min.y-b.y)*x,c=(t.max.y-b.y)*x):(l=(t.max.y-b.y)*x,c=(t.min.y-b.y)*x),i>c||l>s||((l>i||isNaN(i))&&(i=l),(c<s||isNaN(s))&&(s=c),v>=0?(o=(t.min.z-b.z)*v,p=(t.max.z-b.z)*v):(o=(t.max.z-b.z)*v,p=(t.min.z-b.z)*v),i>p||o>s)||((o>i||i!==i)&&(i=o),(p<s||s!==s)&&(s=p),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,Po)!==null}intersectTriangle(t,e,i,s,l){Qy.subVectors(e,t),w_.subVectors(i,t),tx.crossVectors(Qy,w_);let c=this.direction.dot(tx),o;if(c>0){if(s)return null;o=1}else if(c<0)o=-1,c=-c;else return null;Il.subVectors(this.origin,t);const p=o*this.direction.dot(w_.crossVectors(Il,w_));if(p<0)return null;const m=o*this.direction.dot(Qy.cross(Il));if(m<0||p+m>c)return null;const x=-o*Il.dot(tx);return x<0?null:this.at(x/c,l)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class _i{constructor(t,e,i,s,l,c,o,p,m,x,v,b,E,D,k,P){_i.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,l,c,o,p,m,x,v,b,E,D,k,P)}set(t,e,i,s,l,c,o,p,m,x,v,b,E,D,k,P){const I=this.elements;return I[0]=t,I[4]=e,I[8]=i,I[12]=s,I[1]=l,I[5]=c,I[9]=o,I[13]=p,I[2]=m,I[6]=x,I[10]=v,I[14]=b,I[3]=E,I[7]=D,I[11]=k,I[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new _i().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/mu.setFromMatrixColumn(t,0).length(),l=1/mu.setFromMatrixColumn(t,1).length(),c=1/mu.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*l,e[5]=i[5]*l,e[6]=i[6]*l,e[7]=0,e[8]=i[8]*c,e[9]=i[9]*c,e[10]=i[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,l=t.z,c=Math.cos(i),o=Math.sin(i),p=Math.cos(s),m=Math.sin(s),x=Math.cos(l),v=Math.sin(l);if(t.order==="XYZ"){const b=c*x,E=c*v,D=o*x,k=o*v;e[0]=p*x,e[4]=-p*v,e[8]=m,e[1]=E+D*m,e[5]=b-k*m,e[9]=-o*p,e[2]=k-b*m,e[6]=D+E*m,e[10]=c*p}else if(t.order==="YXZ"){const b=p*x,E=p*v,D=m*x,k=m*v;e[0]=b+k*o,e[4]=D*o-E,e[8]=c*m,e[1]=c*v,e[5]=c*x,e[9]=-o,e[2]=E*o-D,e[6]=k+b*o,e[10]=c*p}else if(t.order==="ZXY"){const b=p*x,E=p*v,D=m*x,k=m*v;e[0]=b-k*o,e[4]=-c*v,e[8]=D+E*o,e[1]=E+D*o,e[5]=c*x,e[9]=k-b*o,e[2]=-c*m,e[6]=o,e[10]=c*p}else if(t.order==="ZYX"){const b=c*x,E=c*v,D=o*x,k=o*v;e[0]=p*x,e[4]=D*m-E,e[8]=b*m+k,e[1]=p*v,e[5]=k*m+b,e[9]=E*m-D,e[2]=-m,e[6]=o*p,e[10]=c*p}else if(t.order==="YZX"){const b=c*p,E=c*m,D=o*p,k=o*m;e[0]=p*x,e[4]=k-b*v,e[8]=D*v+E,e[1]=v,e[5]=c*x,e[9]=-o*x,e[2]=-m*x,e[6]=E*v+D,e[10]=b-k*v}else if(t.order==="XZY"){const b=c*p,E=c*m,D=o*p,k=o*m;e[0]=p*x,e[4]=-v,e[8]=m*x,e[1]=b*v+k,e[5]=c*x,e[9]=E*v-D,e[2]=D*v-E,e[6]=o*x,e[10]=k*v+b}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(DF,t,LF)}lookAt(t,e,i){const s=this.elements;return Yr.subVectors(t,e),Yr.lengthSq()===0&&(Yr.z=1),Yr.normalize(),Rl.crossVectors(i,Yr),Rl.lengthSq()===0&&(Math.abs(i.z)===1?Yr.x+=1e-4:Yr.z+=1e-4,Yr.normalize(),Rl.crossVectors(i,Yr)),Rl.normalize(),M_.crossVectors(Yr,Rl),s[0]=Rl.x,s[4]=M_.x,s[8]=Yr.x,s[1]=Rl.y,s[5]=M_.y,s[9]=Yr.y,s[2]=Rl.z,s[6]=M_.z,s[10]=Yr.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,l=this.elements,c=i[0],o=i[4],p=i[8],m=i[12],x=i[1],v=i[5],b=i[9],E=i[13],D=i[2],k=i[6],P=i[10],I=i[14],V=i[3],U=i[7],B=i[11],Z=i[15],Y=s[0],K=s[4],nt=s[8],q=s[12],J=s[1],ct=s[5],St=s[9],wt=s[13],Pt=s[2],Gt=s[6],Nt=s[10],Zt=s[14],qt=s[3],me=s[7],Ee=s[11],Le=s[15];return l[0]=c*Y+o*J+p*Pt+m*qt,l[4]=c*K+o*ct+p*Gt+m*me,l[8]=c*nt+o*St+p*Nt+m*Ee,l[12]=c*q+o*wt+p*Zt+m*Le,l[1]=x*Y+v*J+b*Pt+E*qt,l[5]=x*K+v*ct+b*Gt+E*me,l[9]=x*nt+v*St+b*Nt+E*Ee,l[13]=x*q+v*wt+b*Zt+E*Le,l[2]=D*Y+k*J+P*Pt+I*qt,l[6]=D*K+k*ct+P*Gt+I*me,l[10]=D*nt+k*St+P*Nt+I*Ee,l[14]=D*q+k*wt+P*Zt+I*Le,l[3]=V*Y+U*J+B*Pt+Z*qt,l[7]=V*K+U*ct+B*Gt+Z*me,l[11]=V*nt+U*St+B*Nt+Z*Ee,l[15]=V*q+U*wt+B*Zt+Z*Le,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],l=t[12],c=t[1],o=t[5],p=t[9],m=t[13],x=t[2],v=t[6],b=t[10],E=t[14],D=t[3],k=t[7],P=t[11],I=t[15];return D*(+l*p*v-s*m*v-l*o*b+i*m*b+s*o*E-i*p*E)+k*(+e*p*E-e*m*b+l*c*b-s*c*E+s*m*x-l*p*x)+P*(+e*m*v-e*o*E-l*c*v+i*c*E+l*o*x-i*m*x)+I*(-s*o*x-e*p*v+e*o*b+s*c*v-i*c*b+i*p*x)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],l=t[3],c=t[4],o=t[5],p=t[6],m=t[7],x=t[8],v=t[9],b=t[10],E=t[11],D=t[12],k=t[13],P=t[14],I=t[15],V=v*P*m-k*b*m+k*p*E-o*P*E-v*p*I+o*b*I,U=D*b*m-x*P*m-D*p*E+c*P*E+x*p*I-c*b*I,B=x*k*m-D*v*m+D*o*E-c*k*E-x*o*I+c*v*I,Z=D*v*p-x*k*p-D*o*b+c*k*b+x*o*P-c*v*P,Y=e*V+i*U+s*B+l*Z;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const K=1/Y;return t[0]=V*K,t[1]=(k*b*l-v*P*l-k*s*E+i*P*E+v*s*I-i*b*I)*K,t[2]=(o*P*l-k*p*l+k*s*m-i*P*m-o*s*I+i*p*I)*K,t[3]=(v*p*l-o*b*l-v*s*m+i*b*m+o*s*E-i*p*E)*K,t[4]=U*K,t[5]=(x*P*l-D*b*l+D*s*E-e*P*E-x*s*I+e*b*I)*K,t[6]=(D*p*l-c*P*l-D*s*m+e*P*m+c*s*I-e*p*I)*K,t[7]=(c*b*l-x*p*l+x*s*m-e*b*m-c*s*E+e*p*E)*K,t[8]=B*K,t[9]=(D*v*l-x*k*l-D*i*E+e*k*E+x*i*I-e*v*I)*K,t[10]=(c*k*l-D*o*l+D*i*m-e*k*m-c*i*I+e*o*I)*K,t[11]=(x*o*l-c*v*l-x*i*m+e*v*m+c*i*E-e*o*E)*K,t[12]=Z*K,t[13]=(x*k*s-D*v*s+D*i*b-e*k*b-x*i*P+e*v*P)*K,t[14]=(D*o*s-c*k*s-D*i*p+e*k*p+c*i*P-e*o*P)*K,t[15]=(c*v*s-x*o*s+x*i*p-e*v*p-c*i*b+e*o*b)*K,this}scale(t){const e=this.elements,i=t.x,s=t.y,l=t.z;return e[0]*=i,e[4]*=s,e[8]*=l,e[1]*=i,e[5]*=s,e[9]*=l,e[2]*=i,e[6]*=s,e[10]*=l,e[3]*=i,e[7]*=s,e[11]*=l,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),l=1-i,c=t.x,o=t.y,p=t.z,m=l*c,x=l*o;return this.set(m*c+i,m*o-s*p,m*p+s*o,0,m*o+s*p,x*o+i,x*p-s*c,0,m*p-s*o,x*p+s*c,l*p*p+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,l,c){return this.set(1,i,l,0,t,1,c,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,l=e._x,c=e._y,o=e._z,p=e._w,m=l+l,x=c+c,v=o+o,b=l*m,E=l*x,D=l*v,k=c*x,P=c*v,I=o*v,V=p*m,U=p*x,B=p*v,Z=i.x,Y=i.y,K=i.z;return s[0]=(1-(k+I))*Z,s[1]=(E+B)*Z,s[2]=(D-U)*Z,s[3]=0,s[4]=(E-B)*Y,s[5]=(1-(b+I))*Y,s[6]=(P+V)*Y,s[7]=0,s[8]=(D+U)*K,s[9]=(P-V)*K,s[10]=(1-(b+k))*K,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let l=mu.set(s[0],s[1],s[2]).length();const c=mu.set(s[4],s[5],s[6]).length(),o=mu.set(s[8],s[9],s[10]).length();this.determinant()<0&&(l=-l),t.x=s[12],t.y=s[13],t.z=s[14],ka.copy(this);const m=1/l,x=1/c,v=1/o;return ka.elements[0]*=m,ka.elements[1]*=m,ka.elements[2]*=m,ka.elements[4]*=x,ka.elements[5]*=x,ka.elements[6]*=x,ka.elements[8]*=v,ka.elements[9]*=v,ka.elements[10]*=v,e.setFromRotationMatrix(ka),i.x=l,i.y=c,i.z=o,this}makePerspective(t,e,i,s,l,c,o=Uo){const p=this.elements,m=2*l/(e-t),x=2*l/(i-s),v=(e+t)/(e-t),b=(i+s)/(i-s);let E,D;if(o===Uo)E=-(c+l)/(c-l),D=-2*c*l/(c-l);else if(o===jg)E=-c/(c-l),D=-c*l/(c-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return p[0]=m,p[4]=0,p[8]=v,p[12]=0,p[1]=0,p[5]=x,p[9]=b,p[13]=0,p[2]=0,p[6]=0,p[10]=E,p[14]=D,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(t,e,i,s,l,c,o=Uo){const p=this.elements,m=1/(e-t),x=1/(i-s),v=1/(c-l),b=(e+t)*m,E=(i+s)*x;let D,k;if(o===Uo)D=(c+l)*v,k=-2*v;else if(o===jg)D=l*v,k=-1*v;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return p[0]=2*m,p[4]=0,p[8]=0,p[12]=-b,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-E,p[2]=0,p[6]=0,p[10]=k,p[14]=-D,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const mu=new _t,ka=new _i,DF=new _t(0,0,0),LF=new _t(1,1,1),Rl=new _t,M_=new _t,Yr=new _t,hS=new _i,uS=new _r;class lo{constructor(t=0,e=0,i=0,s=lo.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,l=s[0],c=s[4],o=s[8],p=s[1],m=s[5],x=s[9],v=s[2],b=s[6],E=s[10];switch(e){case"XYZ":this._y=Math.asin(bs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-x,E),this._z=Math.atan2(-c,l)):(this._x=Math.atan2(b,m),this._z=0);break;case"YXZ":this._x=Math.asin(-bs(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(o,E),this._z=Math.atan2(p,m)):(this._y=Math.atan2(-v,l),this._z=0);break;case"ZXY":this._x=Math.asin(bs(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(-v,E),this._z=Math.atan2(-c,m)):(this._y=0,this._z=Math.atan2(p,l));break;case"ZYX":this._y=Math.asin(-bs(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(b,E),this._z=Math.atan2(p,l)):(this._x=0,this._z=Math.atan2(-c,m));break;case"YZX":this._z=Math.asin(bs(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,m),this._y=Math.atan2(-v,l)):(this._x=0,this._y=Math.atan2(o,E));break;case"XZY":this._z=Math.asin(-bs(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(b,m),this._y=Math.atan2(o,l)):(this._x=Math.atan2(-x,E),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return hS.makeRotationFromQuaternion(t),this.setFromRotationMatrix(hS,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return uS.setFromEuler(this),this.setFromQuaternion(uS,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}lo.DEFAULT_ORDER="XYZ";class r1{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let kF=0;const dS=new _t,_u=new _r,Io=new _i,S_=new _t,Hf=new _t,FF=new _t,zF=new _r,fS=new _t(1,0,0),pS=new _t(0,1,0),mS=new _t(0,0,1),_S={type:"added"},OF={type:"removed"},gu={type:"childadded",child:null},ex={type:"childremoved",child:null};class Un extends ac{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kF++}),this.uuid=Ua(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Un.DEFAULT_UP.clone();const t=new _t,e=new lo,i=new _r,s=new _t(1,1,1);function l(){i.setFromEuler(e,!1)}function c(){e.setFromQuaternion(i,void 0,!1)}e._onChange(l),i._onChange(c),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new _i},normalMatrix:{value:new Li}}),this.matrix=new _i,this.matrixWorld=new _i,this.matrixAutoUpdate=Un.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Un.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new r1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _u.setFromAxisAngle(t,e),this.quaternion.multiply(_u),this}rotateOnWorldAxis(t,e){return _u.setFromAxisAngle(t,e),this.quaternion.premultiply(_u),this}rotateX(t){return this.rotateOnAxis(fS,t)}rotateY(t){return this.rotateOnAxis(pS,t)}rotateZ(t){return this.rotateOnAxis(mS,t)}translateOnAxis(t,e){return dS.copy(t).applyQuaternion(this.quaternion),this.position.add(dS.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(fS,t)}translateY(t){return this.translateOnAxis(pS,t)}translateZ(t){return this.translateOnAxis(mS,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Io.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?S_.copy(t):S_.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Hf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Io.lookAt(Hf,S_,this.up):Io.lookAt(S_,Hf,this.up),this.quaternion.setFromRotationMatrix(Io),s&&(Io.extractRotation(s.matrixWorld),_u.setFromRotationMatrix(Io),this.quaternion.premultiply(_u.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(_S),gu.child=t,this.dispatchEvent(gu),gu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(OF),ex.child=t,this.dispatchEvent(ex),ex.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Io.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Io.multiply(t.parent.matrixWorld)),t.applyMatrix4(Io),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(_S),gu.child=t,this.dispatchEvent(gu),gu.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const c=this.children[i].getObjectByProperty(t,e);if(c!==void 0)return c}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let l=0,c=s.length;l<c;l++)s[l].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hf,t,FF),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hf,zF,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let l=0,c=s.length;l<c;l++)s[l].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function l(o,p){return o[p.uuid]===void 0&&(o[p.uuid]=p.toJSON(t)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=l(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const p=o.shapes;if(Array.isArray(p))for(let m=0,x=p.length;m<x;m++){const v=p[m];l(t.shapes,v)}else l(t.shapes,p)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let p=0,m=this.material.length;p<m;p++)o.push(l(t.materials,this.material[p]));s.material=o}else s.material=l(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const p=this.animations[o];s.animations.push(l(t.animations,p))}}if(e){const o=c(t.geometries),p=c(t.materials),m=c(t.textures),x=c(t.images),v=c(t.shapes),b=c(t.skeletons),E=c(t.animations),D=c(t.nodes);o.length>0&&(i.geometries=o),p.length>0&&(i.materials=p),m.length>0&&(i.textures=m),x.length>0&&(i.images=x),v.length>0&&(i.shapes=v),b.length>0&&(i.skeletons=b),E.length>0&&(i.animations=E),D.length>0&&(i.nodes=D)}return i.object=s,i;function c(o){const p=[];for(const m in o){const x=o[m];delete x.metadata,p.push(x)}return p}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}Un.DEFAULT_UP=new _t(0,1,0);Un.DEFAULT_MATRIX_AUTO_UPDATE=!0;Un.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Fa=new _t,Ro=new _t,ix=new _t,Do=new _t,yu=new _t,xu=new _t,gS=new _t,nx=new _t,sx=new _t,rx=new _t,ax=new en,ox=new en,lx=new en;class Fs{constructor(t=new _t,e=new _t,i=new _t){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),Fa.subVectors(t,e),s.cross(Fa);const l=s.lengthSq();return l>0?s.multiplyScalar(1/Math.sqrt(l)):s.set(0,0,0)}static getBarycoord(t,e,i,s,l){Fa.subVectors(s,e),Ro.subVectors(i,e),ix.subVectors(t,e);const c=Fa.dot(Fa),o=Fa.dot(Ro),p=Fa.dot(ix),m=Ro.dot(Ro),x=Ro.dot(ix),v=c*m-o*o;if(v===0)return l.set(0,0,0),null;const b=1/v,E=(m*p-o*x)*b,D=(c*x-o*p)*b;return l.set(1-E-D,D,E)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,Do)===null?!1:Do.x>=0&&Do.y>=0&&Do.x+Do.y<=1}static getInterpolation(t,e,i,s,l,c,o,p){return this.getBarycoord(t,e,i,s,Do)===null?(p.x=0,p.y=0,"z"in p&&(p.z=0),"w"in p&&(p.w=0),null):(p.setScalar(0),p.addScaledVector(l,Do.x),p.addScaledVector(c,Do.y),p.addScaledVector(o,Do.z),p)}static getInterpolatedAttribute(t,e,i,s,l,c){return ax.setScalar(0),ox.setScalar(0),lx.setScalar(0),ax.fromBufferAttribute(t,e),ox.fromBufferAttribute(t,i),lx.fromBufferAttribute(t,s),c.setScalar(0),c.addScaledVector(ax,l.x),c.addScaledVector(ox,l.y),c.addScaledVector(lx,l.z),c}static isFrontFacing(t,e,i,s){return Fa.subVectors(i,e),Ro.subVectors(t,e),Fa.cross(Ro).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Fa.subVectors(this.c,this.b),Ro.subVectors(this.a,this.b),Fa.cross(Ro).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Fs.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Fs.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,l){return Fs.getInterpolation(t,this.a,this.b,this.c,e,i,s,l)}containsPoint(t){return Fs.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Fs.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,l=this.c;let c,o;yu.subVectors(s,i),xu.subVectors(l,i),nx.subVectors(t,i);const p=yu.dot(nx),m=xu.dot(nx);if(p<=0&&m<=0)return e.copy(i);sx.subVectors(t,s);const x=yu.dot(sx),v=xu.dot(sx);if(x>=0&&v<=x)return e.copy(s);const b=p*v-x*m;if(b<=0&&p>=0&&x<=0)return c=p/(p-x),e.copy(i).addScaledVector(yu,c);rx.subVectors(t,l);const E=yu.dot(rx),D=xu.dot(rx);if(D>=0&&E<=D)return e.copy(l);const k=E*m-p*D;if(k<=0&&m>=0&&D<=0)return o=m/(m-D),e.copy(i).addScaledVector(xu,o);const P=x*D-E*v;if(P<=0&&v-x>=0&&E-D>=0)return gS.subVectors(l,s),o=(v-x)/(v-x+(E-D)),e.copy(s).addScaledVector(gS,o);const I=1/(P+k+b);return c=k*I,o=b*I,e.copy(i).addScaledVector(yu,c).addScaledVector(xu,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _A={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Dl={h:0,s:0,l:0},T_={h:0,s:0,l:0};function cx(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class vi{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ls){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ji.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s=ji.workingColorSpace){return this.r=t,this.g=e,this.b=i,ji.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s=ji.workingColorSpace){if(t=s1(t,1),e=bs(e,0,1),i=bs(i,0,1),e===0)this.r=this.g=this.b=i;else{const l=i<=.5?i*(1+e):i+e-i*e,c=2*i-l;this.r=cx(c,l,t+1/3),this.g=cx(c,l,t),this.b=cx(c,l,t-1/3)}return ji.toWorkingColorSpace(this,s),this}setStyle(t,e=Ls){function i(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let l;const c=s[1],o=s[2];switch(c){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,e);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,e);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const l=s[1],c=l.length;if(c===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,e);if(c===6)return this.setHex(parseInt(l,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Ls){const i=_A[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Go(t.r),this.g=Go(t.g),this.b=Go(t.b),this}copyLinearToSRGB(t){return this.r=td(t.r),this.g=td(t.g),this.b=td(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ls){return ji.fromWorkingColorSpace(Ws.copy(this),t),Math.round(bs(Ws.r*255,0,255))*65536+Math.round(bs(Ws.g*255,0,255))*256+Math.round(bs(Ws.b*255,0,255))}getHexString(t=Ls){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ji.workingColorSpace){ji.fromWorkingColorSpace(Ws.copy(this),e);const i=Ws.r,s=Ws.g,l=Ws.b,c=Math.max(i,s,l),o=Math.min(i,s,l);let p,m;const x=(o+c)/2;if(o===c)p=0,m=0;else{const v=c-o;switch(m=x<=.5?v/(c+o):v/(2-c-o),c){case i:p=(s-l)/v+(s<l?6:0);break;case s:p=(l-i)/v+2;break;case l:p=(i-s)/v+4;break}p/=6}return t.h=p,t.s=m,t.l=x,t}getRGB(t,e=ji.workingColorSpace){return ji.fromWorkingColorSpace(Ws.copy(this),e),t.r=Ws.r,t.g=Ws.g,t.b=Ws.b,t}getStyle(t=Ls){ji.fromWorkingColorSpace(Ws.copy(this),t);const e=Ws.r,i=Ws.g,s=Ws.b;return t!==Ls?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(Dl),this.setHSL(Dl.h+t,Dl.s+e,Dl.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Dl),t.getHSL(T_);const i=Tp(Dl.h,T_.h,e),s=Tp(Dl.s,T_.s,e),l=Tp(Dl.l,T_.l,e);return this.setHSL(i,s,l),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,l=t.elements;return this.r=l[0]*e+l[3]*i+l[6]*s,this.g=l[1]*e+l[4]*i+l[7]*s,this.b=l[2]*e+l[5]*i+l[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ws=new vi;vi.NAMES=_A;let BF=0;class ro extends ac{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:BF++}),this.uuid=Ua(),this.name="",this.blending=Ju,this.side=Va,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=pv,this.blendDst=mv,this.blendEquation=Jc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new vi(0,0,0),this.blendAlpha=0,this.depthFunc=cd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=eS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hu,this.stencilZFail=hu,this.stencilZPass=hu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ju&&(i.blending=this.blending),this.side!==Va&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==pv&&(i.blendSrc=this.blendSrc),this.blendDst!==mv&&(i.blendDst=this.blendDst),this.blendEquation!==Jc&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==cd&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==eS&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hu&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(l){const c=[];for(const o in l){const p=l[o];delete p.metadata,c.push(p)}return c}if(e){const l=s(t.textures),c=s(t.images);l.length>0&&(i.textures=l),c.length>0&&(i.images=c)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let l=0;l!==s;++l)i[l]=e[l].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class io extends ro{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new vi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lo,this.combine=JE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Qn=new _t,E_=new si;class $n{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Jv,this.updateRanges=[],this.gpuType=ia,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,l=this.itemSize;s<l;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)E_.fromBufferAttribute(this,e),E_.applyMatrix3(t),this.setXY(e,E_.x,E_.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Qn.fromBufferAttribute(this,e),Qn.applyMatrix3(t),this.setXYZ(e,Qn.x,Qn.y,Qn.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Qn.fromBufferAttribute(this,e),Qn.applyMatrix4(t),this.setXYZ(e,Qn.x,Qn.y,Qn.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Qn.fromBufferAttribute(this,e),Qn.applyNormalMatrix(t),this.setXYZ(e,Qn.x,Qn.y,Qn.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Qn.fromBufferAttribute(this,e),Qn.transformDirection(t),this.setXYZ(e,Qn.x,Qn.y,Qn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=Ba(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=hn(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ba(e,this.array)),e}setX(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ba(e,this.array)),e}setY(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ba(e,this.array)),e}setZ(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ba(e,this.array)),e}setW(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),s=hn(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,l){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),s=hn(s,this.array),l=hn(l,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=l,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Jv&&(t.usage=this.usage),t}}class gA extends $n{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class yA extends $n{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class na extends $n{constructor(t,e,i){super(new Float32Array(t),e,i)}}let NF=0;const pa=new _i,hx=new Un,vu=new _t,Kr=new Nn,jf=new Nn,xs=new _t;class Br extends ac{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:NF++}),this.uuid=Ua(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(fA(t)?yA:gA)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const l=new Li().getNormalMatrix(t);i.applyNormalMatrix(l),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return pa.makeRotationFromQuaternion(t),this.applyMatrix4(pa),this}rotateX(t){return pa.makeRotationX(t),this.applyMatrix4(pa),this}rotateY(t){return pa.makeRotationY(t),this.applyMatrix4(pa),this}rotateZ(t){return pa.makeRotationZ(t),this.applyMatrix4(pa),this}translate(t,e,i){return pa.makeTranslation(t,e,i),this.applyMatrix4(pa),this}scale(t,e,i){return pa.makeScale(t,e,i),this.applyMatrix4(pa),this}lookAt(t){return hx.lookAt(t),hx.updateMatrix(),this.applyMatrix4(hx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vu).negate(),this.translate(vu.x,vu.y,vu.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,l=t.length;s<l;s++){const c=t[s];i.push(c.x,c.y,c.z||0)}this.setAttribute("position",new na(i,3))}else{for(let i=0,s=e.count;i<s;i++){const l=t[i];e.setXYZ(i,l.x,l.y,l.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new _t(-1/0,-1/0,-1/0),new _t(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const l=e[i];Kr.setFromBufferAttribute(l),this.morphTargetsRelative?(xs.addVectors(this.boundingBox.min,Kr.min),this.boundingBox.expandByPoint(xs),xs.addVectors(this.boundingBox.max,Kr.max),this.boundingBox.expandByPoint(xs)):(this.boundingBox.expandByPoint(Kr.min),this.boundingBox.expandByPoint(Kr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ys);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new _t,1/0);return}if(t){const i=this.boundingSphere.center;if(Kr.setFromBufferAttribute(t),e)for(let l=0,c=e.length;l<c;l++){const o=e[l];jf.setFromBufferAttribute(o),this.morphTargetsRelative?(xs.addVectors(Kr.min,jf.min),Kr.expandByPoint(xs),xs.addVectors(Kr.max,jf.max),Kr.expandByPoint(xs)):(Kr.expandByPoint(jf.min),Kr.expandByPoint(jf.max))}Kr.getCenter(i);let s=0;for(let l=0,c=t.count;l<c;l++)xs.fromBufferAttribute(t,l),s=Math.max(s,i.distanceToSquared(xs));if(e)for(let l=0,c=e.length;l<c;l++){const o=e[l],p=this.morphTargetsRelative;for(let m=0,x=o.count;m<x;m++)xs.fromBufferAttribute(o,m),p&&(vu.fromBufferAttribute(t,m),xs.add(vu)),s=Math.max(s,i.distanceToSquared(xs))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.position,s=e.normal,l=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $n(new Float32Array(4*i.count),4));const c=this.getAttribute("tangent"),o=[],p=[];for(let nt=0;nt<i.count;nt++)o[nt]=new _t,p[nt]=new _t;const m=new _t,x=new _t,v=new _t,b=new si,E=new si,D=new si,k=new _t,P=new _t;function I(nt,q,J){m.fromBufferAttribute(i,nt),x.fromBufferAttribute(i,q),v.fromBufferAttribute(i,J),b.fromBufferAttribute(l,nt),E.fromBufferAttribute(l,q),D.fromBufferAttribute(l,J),x.sub(m),v.sub(m),E.sub(b),D.sub(b);const ct=1/(E.x*D.y-D.x*E.y);isFinite(ct)&&(k.copy(x).multiplyScalar(D.y).addScaledVector(v,-E.y).multiplyScalar(ct),P.copy(v).multiplyScalar(E.x).addScaledVector(x,-D.x).multiplyScalar(ct),o[nt].add(k),o[q].add(k),o[J].add(k),p[nt].add(P),p[q].add(P),p[J].add(P))}let V=this.groups;V.length===0&&(V=[{start:0,count:t.count}]);for(let nt=0,q=V.length;nt<q;++nt){const J=V[nt],ct=J.start,St=J.count;for(let wt=ct,Pt=ct+St;wt<Pt;wt+=3)I(t.getX(wt+0),t.getX(wt+1),t.getX(wt+2))}const U=new _t,B=new _t,Z=new _t,Y=new _t;function K(nt){Z.fromBufferAttribute(s,nt),Y.copy(Z);const q=o[nt];U.copy(q),U.sub(Z.multiplyScalar(Z.dot(q))).normalize(),B.crossVectors(Y,q);const ct=B.dot(p[nt])<0?-1:1;c.setXYZW(nt,U.x,U.y,U.z,ct)}for(let nt=0,q=V.length;nt<q;++nt){const J=V[nt],ct=J.start,St=J.count;for(let wt=ct,Pt=ct+St;wt<Pt;wt+=3)K(t.getX(wt+0)),K(t.getX(wt+1)),K(t.getX(wt+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new $n(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let b=0,E=i.count;b<E;b++)i.setXYZ(b,0,0,0);const s=new _t,l=new _t,c=new _t,o=new _t,p=new _t,m=new _t,x=new _t,v=new _t;if(t)for(let b=0,E=t.count;b<E;b+=3){const D=t.getX(b+0),k=t.getX(b+1),P=t.getX(b+2);s.fromBufferAttribute(e,D),l.fromBufferAttribute(e,k),c.fromBufferAttribute(e,P),x.subVectors(c,l),v.subVectors(s,l),x.cross(v),o.fromBufferAttribute(i,D),p.fromBufferAttribute(i,k),m.fromBufferAttribute(i,P),o.add(x),p.add(x),m.add(x),i.setXYZ(D,o.x,o.y,o.z),i.setXYZ(k,p.x,p.y,p.z),i.setXYZ(P,m.x,m.y,m.z)}else for(let b=0,E=e.count;b<E;b+=3)s.fromBufferAttribute(e,b+0),l.fromBufferAttribute(e,b+1),c.fromBufferAttribute(e,b+2),x.subVectors(c,l),v.subVectors(s,l),x.cross(v),i.setXYZ(b+0,x.x,x.y,x.z),i.setXYZ(b+1,x.x,x.y,x.z),i.setXYZ(b+2,x.x,x.y,x.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)xs.fromBufferAttribute(t,e),xs.normalize(),t.setXYZ(e,xs.x,xs.y,xs.z)}toNonIndexed(){function t(o,p){const m=o.array,x=o.itemSize,v=o.normalized,b=new m.constructor(p.length*x);let E=0,D=0;for(let k=0,P=p.length;k<P;k++){o.isInterleavedBufferAttribute?E=p[k]*o.data.stride+o.offset:E=p[k]*x;for(let I=0;I<x;I++)b[D++]=m[E++]}return new $n(b,x,v)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Br,i=this.index.array,s=this.attributes;for(const o in s){const p=s[o],m=t(p,i);e.setAttribute(o,m)}const l=this.morphAttributes;for(const o in l){const p=[],m=l[o];for(let x=0,v=m.length;x<v;x++){const b=m[x],E=t(b,i);p.push(E)}e.morphAttributes[o]=p}e.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let o=0,p=c.length;o<p;o++){const m=c[o];e.addGroup(m.start,m.count,m.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const p=this.parameters;for(const m in p)p[m]!==void 0&&(t[m]=p[m]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const p in i){const m=i[p];t.data.attributes[p]=m.toJSON(t.data)}const s={};let l=!1;for(const p in this.morphAttributes){const m=this.morphAttributes[p],x=[];for(let v=0,b=m.length;v<b;v++){const E=m[v];x.push(E.toJSON(t.data))}x.length>0&&(s[p]=x,l=!0)}l&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(t.data.groups=JSON.parse(JSON.stringify(c)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const s=t.attributes;for(const m in s){const x=s[m];this.setAttribute(m,x.clone(e))}const l=t.morphAttributes;for(const m in l){const x=[],v=l[m];for(let b=0,E=v.length;b<E;b++)x.push(v[b].clone(e));this.morphAttributes[m]=x}this.morphTargetsRelative=t.morphTargetsRelative;const c=t.groups;for(let m=0,x=c.length;m<x;m++){const v=c[m];this.addGroup(v.start,v.count,v.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const p=t.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const yS=new _i,zc=new _h,A_=new Ys,xS=new _t,C_=new _t,P_=new _t,I_=new _t,ux=new _t,R_=new _t,vS=new _t,D_=new _t;class os extends Un{constructor(t=new Br,e=new io){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,c=s.length;l<c;l++){const o=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=l}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,l=i.morphAttributes.position,c=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const o=this.morphTargetInfluences;if(l&&o){R_.set(0,0,0);for(let p=0,m=l.length;p<m;p++){const x=o[p],v=l[p];x!==0&&(ux.fromBufferAttribute(v,t),c?R_.addScaledVector(ux,x):R_.addScaledVector(ux.sub(e),x))}e.add(R_)}return e}raycast(t,e){const i=this.geometry,s=this.material,l=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),A_.copy(i.boundingSphere),A_.applyMatrix4(l),zc.copy(t.ray).recast(t.near),!(A_.containsPoint(zc.origin)===!1&&(zc.intersectSphere(A_,xS)===null||zc.origin.distanceToSquared(xS)>(t.far-t.near)**2))&&(yS.copy(l).invert(),zc.copy(t.ray).applyMatrix4(yS),!(i.boundingBox!==null&&zc.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,zc)))}_computeIntersections(t,e,i){let s;const l=this.geometry,c=this.material,o=l.index,p=l.attributes.position,m=l.attributes.uv,x=l.attributes.uv1,v=l.attributes.normal,b=l.groups,E=l.drawRange;if(o!==null)if(Array.isArray(c))for(let D=0,k=b.length;D<k;D++){const P=b[D],I=c[P.materialIndex],V=Math.max(P.start,E.start),U=Math.min(o.count,Math.min(P.start+P.count,E.start+E.count));for(let B=V,Z=U;B<Z;B+=3){const Y=o.getX(B),K=o.getX(B+1),nt=o.getX(B+2);s=L_(this,I,t,i,m,x,v,Y,K,nt),s&&(s.faceIndex=Math.floor(B/3),s.face.materialIndex=P.materialIndex,e.push(s))}}else{const D=Math.max(0,E.start),k=Math.min(o.count,E.start+E.count);for(let P=D,I=k;P<I;P+=3){const V=o.getX(P),U=o.getX(P+1),B=o.getX(P+2);s=L_(this,c,t,i,m,x,v,V,U,B),s&&(s.faceIndex=Math.floor(P/3),e.push(s))}}else if(p!==void 0)if(Array.isArray(c))for(let D=0,k=b.length;D<k;D++){const P=b[D],I=c[P.materialIndex],V=Math.max(P.start,E.start),U=Math.min(p.count,Math.min(P.start+P.count,E.start+E.count));for(let B=V,Z=U;B<Z;B+=3){const Y=B,K=B+1,nt=B+2;s=L_(this,I,t,i,m,x,v,Y,K,nt),s&&(s.faceIndex=Math.floor(B/3),s.face.materialIndex=P.materialIndex,e.push(s))}}else{const D=Math.max(0,E.start),k=Math.min(p.count,E.start+E.count);for(let P=D,I=k;P<I;P+=3){const V=P,U=P+1,B=P+2;s=L_(this,c,t,i,m,x,v,V,U,B),s&&(s.faceIndex=Math.floor(P/3),e.push(s))}}}}function UF(n,t,e,i,s,l,c,o){let p;if(t.side===pr?p=i.intersectTriangle(c,l,s,!0,o):p=i.intersectTriangle(s,l,c,t.side===Va,o),p===null)return null;D_.copy(o),D_.applyMatrix4(n.matrixWorld);const m=e.ray.origin.distanceTo(D_);return m<e.near||m>e.far?null:{distance:m,point:D_.clone(),object:n}}function L_(n,t,e,i,s,l,c,o,p,m){n.getVertexPosition(o,C_),n.getVertexPosition(p,P_),n.getVertexPosition(m,I_);const x=UF(n,t,e,i,C_,P_,I_,vS);if(x){const v=new _t;Fs.getBarycoord(vS,C_,P_,I_,v),s&&(x.uv=Fs.getInterpolatedAttribute(s,o,p,m,v,new si)),l&&(x.uv1=Fs.getInterpolatedAttribute(l,o,p,m,v,new si)),c&&(x.normal=Fs.getInterpolatedAttribute(c,o,p,m,v,new _t),x.normal.dot(i.direction)>0&&x.normal.multiplyScalar(-1));const b={a:o,b:p,c:m,normal:new _t,materialIndex:0};Fs.getNormal(C_,P_,I_,b.normal),x.face=b,x.barycoord=v}return x}class om extends Br{constructor(t=1,e=1,i=1,s=1,l=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:l,depthSegments:c};const o=this;s=Math.floor(s),l=Math.floor(l),c=Math.floor(c);const p=[],m=[],x=[],v=[];let b=0,E=0;D("z","y","x",-1,-1,i,e,t,c,l,0),D("z","y","x",1,-1,i,e,-t,c,l,1),D("x","z","y",1,1,t,i,e,s,c,2),D("x","z","y",1,-1,t,i,-e,s,c,3),D("x","y","z",1,-1,t,e,i,s,l,4),D("x","y","z",-1,-1,t,e,-i,s,l,5),this.setIndex(p),this.setAttribute("position",new na(m,3)),this.setAttribute("normal",new na(x,3)),this.setAttribute("uv",new na(v,2));function D(k,P,I,V,U,B,Z,Y,K,nt,q){const J=B/K,ct=Z/nt,St=B/2,wt=Z/2,Pt=Y/2,Gt=K+1,Nt=nt+1;let Zt=0,qt=0;const me=new _t;for(let Ee=0;Ee<Nt;Ee++){const Le=Ee*ct-wt;for(let ri=0;ri<Gt;ri++){const Ni=ri*J-St;me[k]=Ni*V,me[P]=Le*U,me[I]=Pt,m.push(me.x,me.y,me.z),me[k]=0,me[P]=0,me[I]=Y>0?1:-1,x.push(me.x,me.y,me.z),v.push(ri/K),v.push(1-Ee/nt),Zt+=1}}for(let Ee=0;Ee<nt;Ee++)for(let Le=0;Le<K;Le++){const ri=b+Le+Gt*Ee,Ni=b+Le+Gt*(Ee+1),Jt=b+(Le+1)+Gt*(Ee+1),le=b+(Le+1)+Gt*Ee;p.push(ri,Ni,le),p.push(Ni,Jt,le),qt+=6}o.addGroup(E,qt,q),E+=qt,b+=Zt}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new om(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function gd(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const s=n[e][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=s.clone():Array.isArray(s)?t[e][i]=s.slice():t[e][i]=s}}return t}function ar(n){const t={};for(let e=0;e<n.length;e++){const i=gd(n[e]);for(const s in i)t[s]=i[s]}return t}function VF(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}function xA(n){const t=n.getRenderTarget();return t===null?n.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ji.workingColorSpace}const GF={clone:gd,merge:ar};var HF=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jF=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ea extends ro{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=HF,this.fragmentShader=jF,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=gd(t.uniforms),this.uniformsGroups=VF(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const c=this.uniforms[s].value;c&&c.isTexture?e.uniforms[s]={type:"t",value:c.toJSON(t).uuid}:c&&c.isColor?e.uniforms[s]={type:"c",value:c.getHex()}:c&&c.isVector2?e.uniforms[s]={type:"v2",value:c.toArray()}:c&&c.isVector3?e.uniforms[s]={type:"v3",value:c.toArray()}:c&&c.isVector4?e.uniforms[s]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?e.uniforms[s]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?e.uniforms[s]={type:"m4",value:c.toArray()}:e.uniforms[s]={value:c}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class vA extends Un{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new _i,this.projectionMatrix=new _i,this.projectionMatrixInverse=new _i,this.coordinateSystem=Uo}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ll=new _t,bS=new si,wS=new si;class hr extends vA{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=_d*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Sp*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return _d*2*Math.atan(Math.tan(Sp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){Ll.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Ll.x,Ll.y).multiplyScalar(-t/Ll.z),Ll.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ll.x,Ll.y).multiplyScalar(-t/Ll.z)}getViewSize(t,e){return this.getViewBounds(t,bS,wS),e.subVectors(wS,bS)}setViewOffset(t,e,i,s,l,c){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=l,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Sp*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,l=-.5*s;const c=this.view;if(this.view!==null&&this.view.enabled){const p=c.fullWidth,m=c.fullHeight;l+=c.offsetX*s/p,e-=c.offsetY*i/m,s*=c.width/p,i*=c.height/m}const o=this.filmOffset;o!==0&&(l+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+s,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const bu=-90,wu=1;class WF extends Un{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new hr(bu,wu,t,e);s.layers=this.layers,this.add(s);const l=new hr(bu,wu,t,e);l.layers=this.layers,this.add(l);const c=new hr(bu,wu,t,e);c.layers=this.layers,this.add(c);const o=new hr(bu,wu,t,e);o.layers=this.layers,this.add(o);const p=new hr(bu,wu,t,e);p.layers=this.layers,this.add(p);const m=new hr(bu,wu,t,e);m.layers=this.layers,this.add(m)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,s,l,c,o,p]=e;for(const m of e)this.remove(m);if(t===Uo)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),c.up.set(0,0,1),c.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),p.up.set(0,1,0),p.lookAt(0,0,-1);else if(t===jg)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),c.up.set(0,0,-1),c.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),p.up.set(0,-1,0),p.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const m of e)this.add(m),m.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[l,c,o,p,m,x]=this.children,v=t.getRenderTarget(),b=t.getActiveCubeFace(),E=t.getActiveMipmapLevel(),D=t.xr.enabled;t.xr.enabled=!1;const k=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,s),t.render(e,l),t.setRenderTarget(i,1,s),t.render(e,c),t.setRenderTarget(i,2,s),t.render(e,o),t.setRenderTarget(i,3,s),t.render(e,p),t.setRenderTarget(i,4,s),t.render(e,m),i.texture.generateMipmaps=k,t.setRenderTarget(i,5,s),t.render(e,x),t.setRenderTarget(v,b,E),t.xr.enabled=D,i.texture.needsPMREMUpdate=!0}}class bA extends Ms{constructor(t,e,i,s,l,c,o,p,m,x){t=t!==void 0?t:[],e=e!==void 0?e:hd,super(t,e,i,s,l,c,o,p,m,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class qF extends uh{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},s=[i,i,i,i,i,i];this.texture=new bA(s,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:ea}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new om(5,5,5),l=new Ea({name:"CubemapFromEquirect",uniforms:gd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:pr,blending:Xl});l.uniforms.tEquirect.value=e;const c=new os(s,l),o=e.minFilter;return e.minFilter===No&&(e.minFilter=ea),new WF(1,10,this).update(t,c),e.minFilter=o,c.geometry.dispose(),c.material.dispose(),this}clear(t,e,i,s){const l=t.getRenderTarget();for(let c=0;c<6;c++)t.setRenderTarget(this,c),t.clear(e,i,s);t.setRenderTarget(l)}}const dx=new _t,XF=new _t,$F=new Li;class Ja{constructor(t=new _t(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=dx.subVectors(i,e).cross(XF.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(dx),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const l=-(t.start.dot(this.normal)+this.constant)/s;return l<0||l>1?null:e.copy(t.start).addScaledVector(i,l)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||$F.getNormalMatrix(t),s=this.coplanarPoint(dx).applyMatrix4(t),l=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(l),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Oc=new Ys,k_=new _t;class _0{constructor(t=new Ja,e=new Ja,i=new Ja,s=new Ja,l=new Ja,c=new Ja){this.planes=[t,e,i,s,l,c]}set(t,e,i,s,l,c){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(s),o[4].copy(l),o[5].copy(c),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=Uo){const i=this.planes,s=t.elements,l=s[0],c=s[1],o=s[2],p=s[3],m=s[4],x=s[5],v=s[6],b=s[7],E=s[8],D=s[9],k=s[10],P=s[11],I=s[12],V=s[13],U=s[14],B=s[15];if(i[0].setComponents(p-l,b-m,P-E,B-I).normalize(),i[1].setComponents(p+l,b+m,P+E,B+I).normalize(),i[2].setComponents(p+c,b+x,P+D,B+V).normalize(),i[3].setComponents(p-c,b-x,P-D,B-V).normalize(),i[4].setComponents(p-o,b-v,P-k,B-U).normalize(),e===Uo)i[5].setComponents(p+o,b+v,P+k,B+U).normalize();else if(e===jg)i[5].setComponents(o,v,k,U).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Oc.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Oc.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Oc)}intersectsSprite(t){return Oc.center.set(0,0,0),Oc.radius=.7071067811865476,Oc.applyMatrix4(t.matrixWorld),this.intersectsSphere(Oc)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let l=0;l<6;l++)if(e[l].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(k_.x=s.normal.x>0?t.max.x:t.min.x,k_.y=s.normal.y>0?t.max.y:t.min.y,k_.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(k_)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function wA(){let n=null,t=!1,e=null,i=null;function s(l,c){e(l,c),i=n.requestAnimationFrame(s)}return{start:function(){t!==!0&&e!==null&&(i=n.requestAnimationFrame(s),t=!0)},stop:function(){n.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(l){e=l},setContext:function(l){n=l}}}function ZF(n){const t=new WeakMap;function e(o,p){const m=o.array,x=o.usage,v=m.byteLength,b=n.createBuffer();n.bindBuffer(p,b),n.bufferData(p,m,x),o.onUploadCallback();let E;if(m instanceof Float32Array)E=n.FLOAT;else if(m instanceof Uint16Array)o.isFloat16BufferAttribute?E=n.HALF_FLOAT:E=n.UNSIGNED_SHORT;else if(m instanceof Int16Array)E=n.SHORT;else if(m instanceof Uint32Array)E=n.UNSIGNED_INT;else if(m instanceof Int32Array)E=n.INT;else if(m instanceof Int8Array)E=n.BYTE;else if(m instanceof Uint8Array)E=n.UNSIGNED_BYTE;else if(m instanceof Uint8ClampedArray)E=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+m);return{buffer:b,type:E,bytesPerElement:m.BYTES_PER_ELEMENT,version:o.version,size:v}}function i(o,p,m){const x=p.array,v=p.updateRanges;if(n.bindBuffer(m,o),v.length===0)n.bufferSubData(m,0,x);else{v.sort((E,D)=>E.start-D.start);let b=0;for(let E=1;E<v.length;E++){const D=v[b],k=v[E];k.start<=D.start+D.count+1?D.count=Math.max(D.count,k.start+k.count-D.start):(++b,v[b]=k)}v.length=b+1;for(let E=0,D=v.length;E<D;E++){const k=v[E];n.bufferSubData(m,k.start*x.BYTES_PER_ELEMENT,x,k.start,k.count)}p.clearUpdateRanges()}p.onUploadCallback()}function s(o){return o.isInterleavedBufferAttribute&&(o=o.data),t.get(o)}function l(o){o.isInterleavedBufferAttribute&&(o=o.data);const p=t.get(o);p&&(n.deleteBuffer(p.buffer),t.delete(o))}function c(o,p){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const x=t.get(o);(!x||x.version<o.version)&&t.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const m=t.get(o);if(m===void 0)t.set(o,e(o,p));else if(m.version<o.version){if(m.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(m.buffer,o,p),m.version=o.version}}return{get:s,remove:l,update:c}}class g0 extends Br{constructor(t=1,e=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s};const l=t/2,c=e/2,o=Math.floor(i),p=Math.floor(s),m=o+1,x=p+1,v=t/o,b=e/p,E=[],D=[],k=[],P=[];for(let I=0;I<x;I++){const V=I*b-c;for(let U=0;U<m;U++){const B=U*v-l;D.push(B,-V,0),k.push(0,0,1),P.push(U/o),P.push(1-I/p)}}for(let I=0;I<p;I++)for(let V=0;V<o;V++){const U=V+m*I,B=V+m*(I+1),Z=V+1+m*(I+1),Y=V+1+m*I;E.push(U,B,Y),E.push(B,Z,Y)}this.setIndex(E),this.setAttribute("position",new na(D,3)),this.setAttribute("normal",new na(k,3)),this.setAttribute("uv",new na(P,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new g0(t.width,t.height,t.widthSegments,t.heightSegments)}}var YF=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,KF=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,JF=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,QF=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tz=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,ez=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,iz=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nz=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,sz=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,rz=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,az=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,oz=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lz=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,cz=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,hz=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,uz=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,dz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,fz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,pz=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,mz=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,_z=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,yz=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,xz=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,vz=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bz=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wz=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Mz=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Sz=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Tz=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ez="gl_FragColor = linearToOutputTexel( gl_FragColor );",Az=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Cz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Pz=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Iz=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Rz=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Dz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Lz=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,kz=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Fz=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zz=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Oz=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Bz=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Nz=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Uz=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Vz=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Gz=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Hz=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jz=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Wz=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qz=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Xz=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,$z=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Zz=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Yz=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Kz=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Jz=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Qz=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tO=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eO=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,iO=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,nO=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,sO=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,rO=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aO=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oO=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lO=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,cO=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,hO=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,uO=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,dO=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,fO=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,pO=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,mO=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_O=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gO=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,yO=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,xO=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,vO=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,bO=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,wO=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,MO=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,SO=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,TO=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,EO=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,AO=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CO=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,PO=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,IO=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,RO=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,DO=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,LO=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,kO=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,FO=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,zO=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,OO=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,BO=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,NO=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,UO=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,VO=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,GO=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,HO=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,jO=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,WO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,XO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,$O=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const ZO=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,YO=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,KO=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,JO=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QO=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,tB=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,eB=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,iB=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,nB=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,sB=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,rB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,aB=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,oB=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lB=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cB=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,hB=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uB=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dB=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fB=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,pB=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mB=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,_B=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,gB=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yB=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xB=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,vB=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bB=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wB=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MB=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,SB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TB=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EB=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,AB=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,CB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Bi={alphahash_fragment:YF,alphahash_pars_fragment:KF,alphamap_fragment:JF,alphamap_pars_fragment:QF,alphatest_fragment:tz,alphatest_pars_fragment:ez,aomap_fragment:iz,aomap_pars_fragment:nz,batching_pars_vertex:sz,batching_vertex:rz,begin_vertex:az,beginnormal_vertex:oz,bsdfs:lz,iridescence_fragment:cz,bumpmap_pars_fragment:hz,clipping_planes_fragment:uz,clipping_planes_pars_fragment:dz,clipping_planes_pars_vertex:fz,clipping_planes_vertex:pz,color_fragment:mz,color_pars_fragment:_z,color_pars_vertex:gz,color_vertex:yz,common:xz,cube_uv_reflection_fragment:vz,defaultnormal_vertex:bz,displacementmap_pars_vertex:wz,displacementmap_vertex:Mz,emissivemap_fragment:Sz,emissivemap_pars_fragment:Tz,colorspace_fragment:Ez,colorspace_pars_fragment:Az,envmap_fragment:Cz,envmap_common_pars_fragment:Pz,envmap_pars_fragment:Iz,envmap_pars_vertex:Rz,envmap_physical_pars_fragment:Gz,envmap_vertex:Dz,fog_vertex:Lz,fog_pars_vertex:kz,fog_fragment:Fz,fog_pars_fragment:zz,gradientmap_pars_fragment:Oz,lightmap_pars_fragment:Bz,lights_lambert_fragment:Nz,lights_lambert_pars_fragment:Uz,lights_pars_begin:Vz,lights_toon_fragment:Hz,lights_toon_pars_fragment:jz,lights_phong_fragment:Wz,lights_phong_pars_fragment:qz,lights_physical_fragment:Xz,lights_physical_pars_fragment:$z,lights_fragment_begin:Zz,lights_fragment_maps:Yz,lights_fragment_end:Kz,logdepthbuf_fragment:Jz,logdepthbuf_pars_fragment:Qz,logdepthbuf_pars_vertex:tO,logdepthbuf_vertex:eO,map_fragment:iO,map_pars_fragment:nO,map_particle_fragment:sO,map_particle_pars_fragment:rO,metalnessmap_fragment:aO,metalnessmap_pars_fragment:oO,morphinstance_vertex:lO,morphcolor_vertex:cO,morphnormal_vertex:hO,morphtarget_pars_vertex:uO,morphtarget_vertex:dO,normal_fragment_begin:fO,normal_fragment_maps:pO,normal_pars_fragment:mO,normal_pars_vertex:_O,normal_vertex:gO,normalmap_pars_fragment:yO,clearcoat_normal_fragment_begin:xO,clearcoat_normal_fragment_maps:vO,clearcoat_pars_fragment:bO,iridescence_pars_fragment:wO,opaque_fragment:MO,packing:SO,premultiplied_alpha_fragment:TO,project_vertex:EO,dithering_fragment:AO,dithering_pars_fragment:CO,roughnessmap_fragment:PO,roughnessmap_pars_fragment:IO,shadowmap_pars_fragment:RO,shadowmap_pars_vertex:DO,shadowmap_vertex:LO,shadowmask_pars_fragment:kO,skinbase_vertex:FO,skinning_pars_vertex:zO,skinning_vertex:OO,skinnormal_vertex:BO,specularmap_fragment:NO,specularmap_pars_fragment:UO,tonemapping_fragment:VO,tonemapping_pars_fragment:GO,transmission_fragment:HO,transmission_pars_fragment:jO,uv_pars_fragment:WO,uv_pars_vertex:qO,uv_vertex:XO,worldpos_vertex:$O,background_vert:ZO,background_frag:YO,backgroundCube_vert:KO,backgroundCube_frag:JO,cube_vert:QO,cube_frag:tB,depth_vert:eB,depth_frag:iB,distanceRGBA_vert:nB,distanceRGBA_frag:sB,equirect_vert:rB,equirect_frag:aB,linedashed_vert:oB,linedashed_frag:lB,meshbasic_vert:cB,meshbasic_frag:hB,meshlambert_vert:uB,meshlambert_frag:dB,meshmatcap_vert:fB,meshmatcap_frag:pB,meshnormal_vert:mB,meshnormal_frag:_B,meshphong_vert:gB,meshphong_frag:yB,meshphysical_vert:xB,meshphysical_frag:vB,meshtoon_vert:bB,meshtoon_frag:wB,points_vert:MB,points_frag:SB,shadow_vert:TB,shadow_frag:EB,sprite_vert:AB,sprite_frag:CB},ze={common:{diffuse:{value:new vi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Li},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Li}},envmap:{envMap:{value:null},envMapRotation:{value:new Li},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Li}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Li}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Li},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Li},normalScale:{value:new si(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Li},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Li}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Li}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Li}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0},uvTransform:{value:new Li}},sprite:{diffuse:{value:new vi(16777215)},opacity:{value:1},center:{value:new si(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Li},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0}}},Qa={basic:{uniforms:ar([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.fog]),vertexShader:Bi.meshbasic_vert,fragmentShader:Bi.meshbasic_frag},lambert:{uniforms:ar([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new vi(0)}}]),vertexShader:Bi.meshlambert_vert,fragmentShader:Bi.meshlambert_frag},phong:{uniforms:ar([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new vi(0)},specular:{value:new vi(1118481)},shininess:{value:30}}]),vertexShader:Bi.meshphong_vert,fragmentShader:Bi.meshphong_frag},standard:{uniforms:ar([ze.common,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.roughnessmap,ze.metalnessmap,ze.fog,ze.lights,{emissive:{value:new vi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Bi.meshphysical_vert,fragmentShader:Bi.meshphysical_frag},toon:{uniforms:ar([ze.common,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.gradientmap,ze.fog,ze.lights,{emissive:{value:new vi(0)}}]),vertexShader:Bi.meshtoon_vert,fragmentShader:Bi.meshtoon_frag},matcap:{uniforms:ar([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,{matcap:{value:null}}]),vertexShader:Bi.meshmatcap_vert,fragmentShader:Bi.meshmatcap_frag},points:{uniforms:ar([ze.points,ze.fog]),vertexShader:Bi.points_vert,fragmentShader:Bi.points_frag},dashed:{uniforms:ar([ze.common,ze.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bi.linedashed_vert,fragmentShader:Bi.linedashed_frag},depth:{uniforms:ar([ze.common,ze.displacementmap]),vertexShader:Bi.depth_vert,fragmentShader:Bi.depth_frag},normal:{uniforms:ar([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,{opacity:{value:1}}]),vertexShader:Bi.meshnormal_vert,fragmentShader:Bi.meshnormal_frag},sprite:{uniforms:ar([ze.sprite,ze.fog]),vertexShader:Bi.sprite_vert,fragmentShader:Bi.sprite_frag},background:{uniforms:{uvTransform:{value:new Li},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Bi.background_vert,fragmentShader:Bi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Li}},vertexShader:Bi.backgroundCube_vert,fragmentShader:Bi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bi.cube_vert,fragmentShader:Bi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Bi.equirect_vert,fragmentShader:Bi.equirect_frag},distanceRGBA:{uniforms:ar([ze.common,ze.displacementmap,{referencePosition:{value:new _t},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Bi.distanceRGBA_vert,fragmentShader:Bi.distanceRGBA_frag},shadow:{uniforms:ar([ze.lights,ze.fog,{color:{value:new vi(0)},opacity:{value:1}}]),vertexShader:Bi.shadow_vert,fragmentShader:Bi.shadow_frag}};Qa.physical={uniforms:ar([Qa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Li},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Li},clearcoatNormalScale:{value:new si(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Li},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Li},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Li},sheen:{value:0},sheenColor:{value:new vi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Li},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Li},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Li},transmissionSamplerSize:{value:new si},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Li},attenuationDistance:{value:0},attenuationColor:{value:new vi(0)},specularColor:{value:new vi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Li},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Li},anisotropyVector:{value:new si},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Li}}]),vertexShader:Bi.meshphysical_vert,fragmentShader:Bi.meshphysical_frag};const F_={r:0,b:0,g:0},Bc=new lo,PB=new _i;function IB(n,t,e,i,s,l,c){const o=new vi(0);let p=l===!0?0:1,m,x,v=null,b=0,E=null;function D(V){let U=V.isScene===!0?V.background:null;return U&&U.isTexture&&(U=(V.backgroundBlurriness>0?e:t).get(U)),U}function k(V){let U=!1;const B=D(V);B===null?I(o,p):B&&B.isColor&&(I(B,1),U=!0);const Z=n.xr.getEnvironmentBlendMode();Z==="additive"?i.buffers.color.setClear(0,0,0,1,c):Z==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,c),(n.autoClear||U)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function P(V,U){const B=D(U);B&&(B.isCubeTexture||B.mapping===f0)?(x===void 0&&(x=new os(new om(1,1,1),new Ea({name:"BackgroundCubeMaterial",uniforms:gd(Qa.backgroundCube.uniforms),vertexShader:Qa.backgroundCube.vertexShader,fragmentShader:Qa.backgroundCube.fragmentShader,side:pr,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(Z,Y,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(x)),Bc.copy(U.backgroundRotation),Bc.x*=-1,Bc.y*=-1,Bc.z*=-1,B.isCubeTexture&&B.isRenderTargetTexture===!1&&(Bc.y*=-1,Bc.z*=-1),x.material.uniforms.envMap.value=B,x.material.uniforms.flipEnvMap.value=B.isCubeTexture&&B.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=U.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=U.backgroundIntensity,x.material.uniforms.backgroundRotation.value.setFromMatrix4(PB.makeRotationFromEuler(Bc)),x.material.toneMapped=ji.getTransfer(B.colorSpace)!==_n,(v!==B||b!==B.version||E!==n.toneMapping)&&(x.material.needsUpdate=!0,v=B,b=B.version,E=n.toneMapping),x.layers.enableAll(),V.unshift(x,x.geometry,x.material,0,0,null)):B&&B.isTexture&&(m===void 0&&(m=new os(new g0(2,2),new Ea({name:"BackgroundMaterial",uniforms:gd(Qa.background.uniforms),vertexShader:Qa.background.vertexShader,fragmentShader:Qa.background.fragmentShader,side:Va,depthTest:!1,depthWrite:!1,fog:!1})),m.geometry.deleteAttribute("normal"),Object.defineProperty(m.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(m)),m.material.uniforms.t2D.value=B,m.material.uniforms.backgroundIntensity.value=U.backgroundIntensity,m.material.toneMapped=ji.getTransfer(B.colorSpace)!==_n,B.matrixAutoUpdate===!0&&B.updateMatrix(),m.material.uniforms.uvTransform.value.copy(B.matrix),(v!==B||b!==B.version||E!==n.toneMapping)&&(m.material.needsUpdate=!0,v=B,b=B.version,E=n.toneMapping),m.layers.enableAll(),V.unshift(m,m.geometry,m.material,0,0,null))}function I(V,U){V.getRGB(F_,xA(n)),i.buffers.color.setClear(F_.r,F_.g,F_.b,U,c)}return{getClearColor:function(){return o},setClearColor:function(V,U=1){o.set(V),p=U,I(o,p)},getClearAlpha:function(){return p},setClearAlpha:function(V){p=V,I(o,p)},render:k,addToRenderList:P}}function RB(n,t){const e=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=b(null);let l=s,c=!1;function o(J,ct,St,wt,Pt){let Gt=!1;const Nt=v(wt,St,ct);l!==Nt&&(l=Nt,m(l.object)),Gt=E(J,wt,St,Pt),Gt&&D(J,wt,St,Pt),Pt!==null&&t.update(Pt,n.ELEMENT_ARRAY_BUFFER),(Gt||c)&&(c=!1,B(J,ct,St,wt),Pt!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(Pt).buffer))}function p(){return n.createVertexArray()}function m(J){return n.bindVertexArray(J)}function x(J){return n.deleteVertexArray(J)}function v(J,ct,St){const wt=St.wireframe===!0;let Pt=i[J.id];Pt===void 0&&(Pt={},i[J.id]=Pt);let Gt=Pt[ct.id];Gt===void 0&&(Gt={},Pt[ct.id]=Gt);let Nt=Gt[wt];return Nt===void 0&&(Nt=b(p()),Gt[wt]=Nt),Nt}function b(J){const ct=[],St=[],wt=[];for(let Pt=0;Pt<e;Pt++)ct[Pt]=0,St[Pt]=0,wt[Pt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ct,enabledAttributes:St,attributeDivisors:wt,object:J,attributes:{},index:null}}function E(J,ct,St,wt){const Pt=l.attributes,Gt=ct.attributes;let Nt=0;const Zt=St.getAttributes();for(const qt in Zt)if(Zt[qt].location>=0){const Ee=Pt[qt];let Le=Gt[qt];if(Le===void 0&&(qt==="instanceMatrix"&&J.instanceMatrix&&(Le=J.instanceMatrix),qt==="instanceColor"&&J.instanceColor&&(Le=J.instanceColor)),Ee===void 0||Ee.attribute!==Le||Le&&Ee.data!==Le.data)return!0;Nt++}return l.attributesNum!==Nt||l.index!==wt}function D(J,ct,St,wt){const Pt={},Gt=ct.attributes;let Nt=0;const Zt=St.getAttributes();for(const qt in Zt)if(Zt[qt].location>=0){let Ee=Gt[qt];Ee===void 0&&(qt==="instanceMatrix"&&J.instanceMatrix&&(Ee=J.instanceMatrix),qt==="instanceColor"&&J.instanceColor&&(Ee=J.instanceColor));const Le={};Le.attribute=Ee,Ee&&Ee.data&&(Le.data=Ee.data),Pt[qt]=Le,Nt++}l.attributes=Pt,l.attributesNum=Nt,l.index=wt}function k(){const J=l.newAttributes;for(let ct=0,St=J.length;ct<St;ct++)J[ct]=0}function P(J){I(J,0)}function I(J,ct){const St=l.newAttributes,wt=l.enabledAttributes,Pt=l.attributeDivisors;St[J]=1,wt[J]===0&&(n.enableVertexAttribArray(J),wt[J]=1),Pt[J]!==ct&&(n.vertexAttribDivisor(J,ct),Pt[J]=ct)}function V(){const J=l.newAttributes,ct=l.enabledAttributes;for(let St=0,wt=ct.length;St<wt;St++)ct[St]!==J[St]&&(n.disableVertexAttribArray(St),ct[St]=0)}function U(J,ct,St,wt,Pt,Gt,Nt){Nt===!0?n.vertexAttribIPointer(J,ct,St,Pt,Gt):n.vertexAttribPointer(J,ct,St,wt,Pt,Gt)}function B(J,ct,St,wt){k();const Pt=wt.attributes,Gt=St.getAttributes(),Nt=ct.defaultAttributeValues;for(const Zt in Gt){const qt=Gt[Zt];if(qt.location>=0){let me=Pt[Zt];if(me===void 0&&(Zt==="instanceMatrix"&&J.instanceMatrix&&(me=J.instanceMatrix),Zt==="instanceColor"&&J.instanceColor&&(me=J.instanceColor)),me!==void 0){const Ee=me.normalized,Le=me.itemSize,ri=t.get(me);if(ri===void 0)continue;const Ni=ri.buffer,Jt=ri.type,le=ri.bytesPerElement,qe=Jt===n.INT||Jt===n.UNSIGNED_INT||me.gpuType===Kb;if(me.isInterleavedBufferAttribute){const be=me.data,Qe=be.stride,gi=me.offset;if(be.isInstancedInterleavedBuffer){for(let bi=0;bi<qt.locationSize;bi++)I(qt.location+bi,be.meshPerAttribute);J.isInstancedMesh!==!0&&wt._maxInstanceCount===void 0&&(wt._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let bi=0;bi<qt.locationSize;bi++)P(qt.location+bi);n.bindBuffer(n.ARRAY_BUFFER,Ni);for(let bi=0;bi<qt.locationSize;bi++)U(qt.location+bi,Le/qt.locationSize,Jt,Ee,Qe*le,(gi+Le/qt.locationSize*bi)*le,qe)}else{if(me.isInstancedBufferAttribute){for(let be=0;be<qt.locationSize;be++)I(qt.location+be,me.meshPerAttribute);J.isInstancedMesh!==!0&&wt._maxInstanceCount===void 0&&(wt._maxInstanceCount=me.meshPerAttribute*me.count)}else for(let be=0;be<qt.locationSize;be++)P(qt.location+be);n.bindBuffer(n.ARRAY_BUFFER,Ni);for(let be=0;be<qt.locationSize;be++)U(qt.location+be,Le/qt.locationSize,Jt,Ee,Le*le,Le/qt.locationSize*be*le,qe)}}else if(Nt!==void 0){const Ee=Nt[Zt];if(Ee!==void 0)switch(Ee.length){case 2:n.vertexAttrib2fv(qt.location,Ee);break;case 3:n.vertexAttrib3fv(qt.location,Ee);break;case 4:n.vertexAttrib4fv(qt.location,Ee);break;default:n.vertexAttrib1fv(qt.location,Ee)}}}}V()}function Z(){nt();for(const J in i){const ct=i[J];for(const St in ct){const wt=ct[St];for(const Pt in wt)x(wt[Pt].object),delete wt[Pt];delete ct[St]}delete i[J]}}function Y(J){if(i[J.id]===void 0)return;const ct=i[J.id];for(const St in ct){const wt=ct[St];for(const Pt in wt)x(wt[Pt].object),delete wt[Pt];delete ct[St]}delete i[J.id]}function K(J){for(const ct in i){const St=i[ct];if(St[J.id]===void 0)continue;const wt=St[J.id];for(const Pt in wt)x(wt[Pt].object),delete wt[Pt];delete St[J.id]}}function nt(){q(),c=!0,l!==s&&(l=s,m(l.object))}function q(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:nt,resetDefaultState:q,dispose:Z,releaseStatesOfGeometry:Y,releaseStatesOfProgram:K,initAttributes:k,enableAttribute:P,disableUnusedAttributes:V}}function DB(n,t,e){let i;function s(m){i=m}function l(m,x){n.drawArrays(i,m,x),e.update(x,i,1)}function c(m,x,v){v!==0&&(n.drawArraysInstanced(i,m,x,v),e.update(x,i,v))}function o(m,x,v){if(v===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,m,0,x,0,v);let E=0;for(let D=0;D<v;D++)E+=x[D];e.update(E,i,1)}function p(m,x,v,b){if(v===0)return;const E=t.get("WEBGL_multi_draw");if(E===null)for(let D=0;D<m.length;D++)c(m[D],x[D],b[D]);else{E.multiDrawArraysInstancedWEBGL(i,m,0,x,0,b,0,v);let D=0;for(let k=0;k<v;k++)D+=x[k]*b[k];e.update(D,i,1)}}this.setMode=s,this.render=l,this.renderInstances=c,this.renderMultiDraw=o,this.renderMultiDrawInstances=p}function LB(n,t,e,i){let s;function l(){if(s!==void 0)return s;if(t.has("EXT_texture_filter_anisotropic")===!0){const K=t.get("EXT_texture_filter_anisotropic");s=n.getParameter(K.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function c(K){return!(K!==Lr&&i.convert(K)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(K){const nt=K===am&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(K!==jo&&i.convert(K)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&K!==ia&&!nt)}function p(K){if(K==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";K="mediump"}return K==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let m=e.precision!==void 0?e.precision:"highp";const x=p(m);x!==m&&(console.warn("THREE.WebGLRenderer:",m,"not supported, using",x,"instead."),m=x);const v=e.logarithmicDepthBuffer===!0,b=e.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),E=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),D=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),k=n.getParameter(n.MAX_TEXTURE_SIZE),P=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),I=n.getParameter(n.MAX_VERTEX_ATTRIBS),V=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),U=n.getParameter(n.MAX_VARYING_VECTORS),B=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),Z=D>0,Y=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:l,getMaxPrecision:p,textureFormatReadable:c,textureTypeReadable:o,precision:m,logarithmicDepthBuffer:v,reverseDepthBuffer:b,maxTextures:E,maxVertexTextures:D,maxTextureSize:k,maxCubemapSize:P,maxAttributes:I,maxVertexUniforms:V,maxVaryings:U,maxFragmentUniforms:B,vertexTextures:Z,maxSamples:Y}}function kB(n){const t=this;let e=null,i=0,s=!1,l=!1;const c=new Ja,o=new Li,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(v,b){const E=v.length!==0||b||i!==0||s;return s=b,i=v.length,E},this.beginShadows=function(){l=!0,x(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(v,b){e=x(v,b,0)},this.setState=function(v,b,E){const D=v.clippingPlanes,k=v.clipIntersection,P=v.clipShadows,I=n.get(v);if(!s||D===null||D.length===0||l&&!P)l?x(null):m();else{const V=l?0:i,U=V*4;let B=I.clippingState||null;p.value=B,B=x(D,b,U,E);for(let Z=0;Z!==U;++Z)B[Z]=e[Z];I.clippingState=B,this.numIntersection=k?this.numPlanes:0,this.numPlanes+=V}};function m(){p.value!==e&&(p.value=e,p.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function x(v,b,E,D){const k=v!==null?v.length:0;let P=null;if(k!==0){if(P=p.value,D!==!0||P===null){const I=E+k*4,V=b.matrixWorldInverse;o.getNormalMatrix(V),(P===null||P.length<I)&&(P=new Float32Array(I));for(let U=0,B=E;U!==k;++U,B+=4)c.copy(v[U]).applyMatrix4(V,o),c.normal.toArray(P,B),P[B+3]=c.constant}p.value=P,p.needsUpdate=!0}return t.numPlanes=k,t.numIntersection=0,P}}function FB(n){let t=new WeakMap;function e(c,o){return o===Mv?c.mapping=hd:o===Sv&&(c.mapping=ud),c}function i(c){if(c&&c.isTexture){const o=c.mapping;if(o===Mv||o===Sv)if(t.has(c)){const p=t.get(c).texture;return e(p,c.mapping)}else{const p=c.image;if(p&&p.height>0){const m=new qF(p.height);return m.fromEquirectangularTexture(n,c),t.set(c,m),c.addEventListener("dispose",s),e(m.texture,c.mapping)}else return null}}return c}function s(c){const o=c.target;o.removeEventListener("dispose",s);const p=t.get(o);p!==void 0&&(t.delete(o),p.dispose())}function l(){t=new WeakMap}return{get:i,dispose:l}}class a1 extends vA{constructor(t=-1,e=1,i=1,s=-1,l=.1,c=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=l,this.far=c,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,l,c){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=l,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let l=i-t,c=i+t,o=s+e,p=s-e;if(this.view!==null&&this.view.enabled){const m=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=m*this.view.offsetX,c=l+m*this.view.width,o-=x*this.view.offsetY,p=o-x*this.view.height}this.projectionMatrix.makeOrthographic(l,c,o,p,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Hu=4,MS=[.125,.215,.35,.446,.526,.582],Qc=20,fx=new a1,SS=new vi;let px=null,mx=0,_x=0,gx=!1;const Yc=(1+Math.sqrt(5))/2,Mu=1/Yc,TS=[new _t(-Yc,Mu,0),new _t(Yc,Mu,0),new _t(-Mu,0,Yc),new _t(Mu,0,Yc),new _t(0,Yc,-Mu),new _t(0,Yc,Mu),new _t(-1,1,-1),new _t(1,1,-1),new _t(-1,1,1),new _t(1,1,1)];class ES{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,s=100){px=this._renderer.getRenderTarget(),mx=this._renderer.getActiveCubeFace(),_x=this._renderer.getActiveMipmapLevel(),gx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(t,i,s,l),e>0&&this._blur(l,0,0,e),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=PS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=CS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(px,mx,_x),this._renderer.xr.enabled=gx,t.scissorTest=!1,z_(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===hd||t.mapping===ud?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),px=this._renderer.getRenderTarget(),mx=this._renderer.getActiveCubeFace(),_x=this._renderer.getActiveMipmapLevel(),gx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:ea,minFilter:ea,generateMipmaps:!1,type:am,format:Lr,colorSpace:yr,depthBuffer:!1},s=AS(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=AS(t,e,i);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=zB(l)),this._blurMaterial=OB(l,t,e)}return s}_compileMaterial(t){const e=new os(this._lodPlanes[0],t);this._renderer.compile(e,fx)}_sceneToCubeUV(t,e,i,s){const o=new hr(90,1,e,i),p=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],x=this._renderer,v=x.autoClear,b=x.toneMapping;x.getClearColor(SS),x.toneMapping=$l,x.autoClear=!1;const E=new io({name:"PMREM.Background",side:pr,depthWrite:!1,depthTest:!1}),D=new os(new om,E);let k=!1;const P=t.background;P?P.isColor&&(E.color.copy(P),t.background=null,k=!0):(E.color.copy(SS),k=!0);for(let I=0;I<6;I++){const V=I%3;V===0?(o.up.set(0,p[I],0),o.lookAt(m[I],0,0)):V===1?(o.up.set(0,0,p[I]),o.lookAt(0,m[I],0)):(o.up.set(0,p[I],0),o.lookAt(0,0,m[I]));const U=this._cubeSize;z_(s,V*U,I>2?U:0,U,U),x.setRenderTarget(s),k&&x.render(D,o),x.render(t,o)}D.geometry.dispose(),D.material.dispose(),x.toneMapping=b,x.autoClear=v,t.background=P}_textureToCubeUV(t,e){const i=this._renderer,s=t.mapping===hd||t.mapping===ud;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=PS()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=CS());const l=s?this._cubemapMaterial:this._equirectMaterial,c=new os(this._lodPlanes[0],l),o=l.uniforms;o.envMap.value=t;const p=this._cubeSize;z_(e,0,0,3*p,2*p),i.setRenderTarget(e),i.render(c,fx)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const s=this._lodPlanes.length;for(let l=1;l<s;l++){const c=Math.sqrt(this._sigmas[l]*this._sigmas[l]-this._sigmas[l-1]*this._sigmas[l-1]),o=TS[(s-l-1)%TS.length];this._blur(t,l-1,l,c,o)}e.autoClear=i}_blur(t,e,i,s,l){const c=this._pingPongRenderTarget;this._halfBlur(t,c,e,i,s,"latitudinal",l),this._halfBlur(c,t,i,i,s,"longitudinal",l)}_halfBlur(t,e,i,s,l,c,o){const p=this._renderer,m=this._blurMaterial;c!=="latitudinal"&&c!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=3,v=new os(this._lodPlanes[s],m),b=m.uniforms,E=this._sizeLods[i]-1,D=isFinite(l)?Math.PI/(2*E):2*Math.PI/(2*Qc-1),k=l/D,P=isFinite(l)?1+Math.floor(x*k):Qc;P>Qc&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${Qc}`);const I=[];let V=0;for(let K=0;K<Qc;++K){const nt=K/k,q=Math.exp(-nt*nt/2);I.push(q),K===0?V+=q:K<P&&(V+=2*q)}for(let K=0;K<I.length;K++)I[K]=I[K]/V;b.envMap.value=t.texture,b.samples.value=P,b.weights.value=I,b.latitudinal.value=c==="latitudinal",o&&(b.poleAxis.value=o);const{_lodMax:U}=this;b.dTheta.value=D,b.mipInt.value=U-i;const B=this._sizeLods[s],Z=3*B*(s>U-Hu?s-U+Hu:0),Y=4*(this._cubeSize-B);z_(e,Z,Y,3*B,2*B),p.setRenderTarget(e),p.render(v,fx)}}function zB(n){const t=[],e=[],i=[];let s=n;const l=n-Hu+1+MS.length;for(let c=0;c<l;c++){const o=Math.pow(2,s);e.push(o);let p=1/o;c>n-Hu?p=MS[c-n+Hu-1]:c===0&&(p=0),i.push(p);const m=1/(o-2),x=-m,v=1+m,b=[x,x,v,x,v,v,x,x,v,v,x,v],E=6,D=6,k=3,P=2,I=1,V=new Float32Array(k*D*E),U=new Float32Array(P*D*E),B=new Float32Array(I*D*E);for(let Y=0;Y<E;Y++){const K=Y%3*2/3-1,nt=Y>2?0:-1,q=[K,nt,0,K+2/3,nt,0,K+2/3,nt+1,0,K,nt,0,K+2/3,nt+1,0,K,nt+1,0];V.set(q,k*D*Y),U.set(b,P*D*Y);const J=[Y,Y,Y,Y,Y,Y];B.set(J,I*D*Y)}const Z=new Br;Z.setAttribute("position",new $n(V,k)),Z.setAttribute("uv",new $n(U,P)),Z.setAttribute("faceIndex",new $n(B,I)),t.push(Z),s>Hu&&s--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function AS(n,t,e){const i=new uh(n,t,e);return i.texture.mapping=f0,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function z_(n,t,e,i,s){n.viewport.set(t,e,i,s),n.scissor.set(t,e,i,s)}function OB(n,t,e){const i=new Float32Array(Qc),s=new _t(0,1,0);return new Ea({name:"SphericalGaussianBlur",defines:{n:Qc,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:o1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function CS(){return new Ea({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:o1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function PS(){return new Ea({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:o1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function o1(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function BB(n){let t=new WeakMap,e=null;function i(o){if(o&&o.isTexture){const p=o.mapping,m=p===Mv||p===Sv,x=p===hd||p===ud;if(m||x){let v=t.get(o);const b=v!==void 0?v.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==b)return e===null&&(e=new ES(n)),v=m?e.fromEquirectangular(o,v):e.fromCubemap(o,v),v.texture.pmremVersion=o.pmremVersion,t.set(o,v),v.texture;if(v!==void 0)return v.texture;{const E=o.image;return m&&E&&E.height>0||x&&E&&s(E)?(e===null&&(e=new ES(n)),v=m?e.fromEquirectangular(o):e.fromCubemap(o),v.texture.pmremVersion=o.pmremVersion,t.set(o,v),o.addEventListener("dispose",l),v.texture):null}}}return o}function s(o){let p=0;const m=6;for(let x=0;x<m;x++)o[x]!==void 0&&p++;return p===m}function l(o){const p=o.target;p.removeEventListener("dispose",l);const m=t.get(p);m!==void 0&&(t.delete(p),m.dispose())}function c(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:c}}function NB(n){const t={};function e(i){if(t[i]!==void 0)return t[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return t[i]=s,s}return{has:function(i){return e(i)!==null},init:function(){e("EXT_color_buffer_float"),e("WEBGL_clip_cull_distance"),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture"),e("WEBGL_render_shared_exponent")},get:function(i){const s=e(i);return s===null&&fp("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function UB(n,t,e,i){const s={},l=new WeakMap;function c(v){const b=v.target;b.index!==null&&t.remove(b.index);for(const D in b.attributes)t.remove(b.attributes[D]);for(const D in b.morphAttributes){const k=b.morphAttributes[D];for(let P=0,I=k.length;P<I;P++)t.remove(k[P])}b.removeEventListener("dispose",c),delete s[b.id];const E=l.get(b);E&&(t.remove(E),l.delete(b)),i.releaseStatesOfGeometry(b),b.isInstancedBufferGeometry===!0&&delete b._maxInstanceCount,e.memory.geometries--}function o(v,b){return s[b.id]===!0||(b.addEventListener("dispose",c),s[b.id]=!0,e.memory.geometries++),b}function p(v){const b=v.attributes;for(const D in b)t.update(b[D],n.ARRAY_BUFFER);const E=v.morphAttributes;for(const D in E){const k=E[D];for(let P=0,I=k.length;P<I;P++)t.update(k[P],n.ARRAY_BUFFER)}}function m(v){const b=[],E=v.index,D=v.attributes.position;let k=0;if(E!==null){const V=E.array;k=E.version;for(let U=0,B=V.length;U<B;U+=3){const Z=V[U+0],Y=V[U+1],K=V[U+2];b.push(Z,Y,Y,K,K,Z)}}else if(D!==void 0){const V=D.array;k=D.version;for(let U=0,B=V.length/3-1;U<B;U+=3){const Z=U+0,Y=U+1,K=U+2;b.push(Z,Y,Y,K,K,Z)}}else return;const P=new(fA(b)?yA:gA)(b,1);P.version=k;const I=l.get(v);I&&t.remove(I),l.set(v,P)}function x(v){const b=l.get(v);if(b){const E=v.index;E!==null&&b.version<E.version&&m(v)}else m(v);return l.get(v)}return{get:o,update:p,getWireframeAttribute:x}}function VB(n,t,e){let i;function s(b){i=b}let l,c;function o(b){l=b.type,c=b.bytesPerElement}function p(b,E){n.drawElements(i,E,l,b*c),e.update(E,i,1)}function m(b,E,D){D!==0&&(n.drawElementsInstanced(i,E,l,b*c,D),e.update(E,i,D))}function x(b,E,D){if(D===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,E,0,l,b,0,D);let P=0;for(let I=0;I<D;I++)P+=E[I];e.update(P,i,1)}function v(b,E,D,k){if(D===0)return;const P=t.get("WEBGL_multi_draw");if(P===null)for(let I=0;I<b.length;I++)m(b[I]/c,E[I],k[I]);else{P.multiDrawElementsInstancedWEBGL(i,E,0,l,b,0,k,0,D);let I=0;for(let V=0;V<D;V++)I+=E[V]*k[V];e.update(I,i,1)}}this.setMode=s,this.setIndex=o,this.render=p,this.renderInstances=m,this.renderMultiDraw=x,this.renderMultiDrawInstances=v}function GB(n){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(l,c,o){switch(e.calls++,c){case n.TRIANGLES:e.triangles+=o*(l/3);break;case n.LINES:e.lines+=o*(l/2);break;case n.LINE_STRIP:e.lines+=o*(l-1);break;case n.LINE_LOOP:e.lines+=o*l;break;case n.POINTS:e.points+=o*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function s(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:s,update:i}}function HB(n,t,e){const i=new WeakMap,s=new en;function l(c,o,p){const m=c.morphTargetInfluences,x=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,v=x!==void 0?x.length:0;let b=i.get(o);if(b===void 0||b.count!==v){let J=function(){nt.dispose(),i.delete(o),o.removeEventListener("dispose",J)};var E=J;b!==void 0&&b.texture.dispose();const D=o.morphAttributes.position!==void 0,k=o.morphAttributes.normal!==void 0,P=o.morphAttributes.color!==void 0,I=o.morphAttributes.position||[],V=o.morphAttributes.normal||[],U=o.morphAttributes.color||[];let B=0;D===!0&&(B=1),k===!0&&(B=2),P===!0&&(B=3);let Z=o.attributes.position.count*B,Y=1;Z>t.maxTextureSize&&(Y=Math.ceil(Z/t.maxTextureSize),Z=t.maxTextureSize);const K=new Float32Array(Z*Y*4*v),nt=new mA(K,Z,Y,v);nt.type=ia,nt.needsUpdate=!0;const q=B*4;for(let ct=0;ct<v;ct++){const St=I[ct],wt=V[ct],Pt=U[ct],Gt=Z*Y*4*ct;for(let Nt=0;Nt<St.count;Nt++){const Zt=Nt*q;D===!0&&(s.fromBufferAttribute(St,Nt),K[Gt+Zt+0]=s.x,K[Gt+Zt+1]=s.y,K[Gt+Zt+2]=s.z,K[Gt+Zt+3]=0),k===!0&&(s.fromBufferAttribute(wt,Nt),K[Gt+Zt+4]=s.x,K[Gt+Zt+5]=s.y,K[Gt+Zt+6]=s.z,K[Gt+Zt+7]=0),P===!0&&(s.fromBufferAttribute(Pt,Nt),K[Gt+Zt+8]=s.x,K[Gt+Zt+9]=s.y,K[Gt+Zt+10]=s.z,K[Gt+Zt+11]=Pt.itemSize===4?s.w:1)}}b={count:v,texture:nt,size:new si(Z,Y)},i.set(o,b),o.addEventListener("dispose",J)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)p.getUniforms().setValue(n,"morphTexture",c.morphTexture,e);else{let D=0;for(let P=0;P<m.length;P++)D+=m[P];const k=o.morphTargetsRelative?1:1-D;p.getUniforms().setValue(n,"morphTargetBaseInfluence",k),p.getUniforms().setValue(n,"morphTargetInfluences",m)}p.getUniforms().setValue(n,"morphTargetsTexture",b.texture,e),p.getUniforms().setValue(n,"morphTargetsTextureSize",b.size)}return{update:l}}function jB(n,t,e,i){let s=new WeakMap;function l(p){const m=i.render.frame,x=p.geometry,v=t.get(p,x);if(s.get(v)!==m&&(t.update(v),s.set(v,m)),p.isInstancedMesh&&(p.hasEventListener("dispose",o)===!1&&p.addEventListener("dispose",o),s.get(p)!==m&&(e.update(p.instanceMatrix,n.ARRAY_BUFFER),p.instanceColor!==null&&e.update(p.instanceColor,n.ARRAY_BUFFER),s.set(p,m))),p.isSkinnedMesh){const b=p.skeleton;s.get(b)!==m&&(b.update(),s.set(b,m))}return v}function c(){s=new WeakMap}function o(p){const m=p.target;m.removeEventListener("dispose",o),e.remove(m.instanceMatrix),m.instanceColor!==null&&e.remove(m.instanceColor)}return{update:l,dispose:c}}class MA extends Ms{constructor(t,e,i,s,l,c,o,p,m,x=Qu){if(x!==Qu&&x!==pd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===Qu&&(i=tc),i===void 0&&x===pd&&(i=fd),super(null,s,l,c,o,p,x,i,m),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:mr,this.minFilter=p!==void 0?p:mr,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const SA=new Ms,IS=new MA(1,1),TA=new mA,EA=new IF,AA=new bA,RS=[],DS=[],LS=new Float32Array(16),kS=new Float32Array(9),FS=new Float32Array(4);function Id(n,t,e){const i=n[0];if(i<=0||i>0)return n;const s=t*e;let l=RS[s];if(l===void 0&&(l=new Float32Array(s),RS[s]=l),t!==0){i.toArray(l,0);for(let c=1,o=0;c!==t;++c)o+=e,n[c].toArray(l,o)}return l}function ls(n,t){if(n.length!==t.length)return!1;for(let e=0,i=n.length;e<i;e++)if(n[e]!==t[e])return!1;return!0}function cs(n,t){for(let e=0,i=t.length;e<i;e++)n[e]=t[e]}function y0(n,t){let e=DS[t];e===void 0&&(e=new Int32Array(t),DS[t]=e);for(let i=0;i!==t;++i)e[i]=n.allocateTextureUnit();return e}function WB(n,t){const e=this.cache;e[0]!==t&&(n.uniform1f(this.addr,t),e[0]=t)}function qB(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ls(e,t))return;n.uniform2fv(this.addr,t),cs(e,t)}}function XB(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(ls(e,t))return;n.uniform3fv(this.addr,t),cs(e,t)}}function $B(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ls(e,t))return;n.uniform4fv(this.addr,t),cs(e,t)}}function ZB(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ls(e,t))return;n.uniformMatrix2fv(this.addr,!1,t),cs(e,t)}else{if(ls(e,i))return;FS.set(i),n.uniformMatrix2fv(this.addr,!1,FS),cs(e,i)}}function YB(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ls(e,t))return;n.uniformMatrix3fv(this.addr,!1,t),cs(e,t)}else{if(ls(e,i))return;kS.set(i),n.uniformMatrix3fv(this.addr,!1,kS),cs(e,i)}}function KB(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ls(e,t))return;n.uniformMatrix4fv(this.addr,!1,t),cs(e,t)}else{if(ls(e,i))return;LS.set(i),n.uniformMatrix4fv(this.addr,!1,LS),cs(e,i)}}function JB(n,t){const e=this.cache;e[0]!==t&&(n.uniform1i(this.addr,t),e[0]=t)}function QB(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ls(e,t))return;n.uniform2iv(this.addr,t),cs(e,t)}}function tN(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ls(e,t))return;n.uniform3iv(this.addr,t),cs(e,t)}}function eN(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ls(e,t))return;n.uniform4iv(this.addr,t),cs(e,t)}}function iN(n,t){const e=this.cache;e[0]!==t&&(n.uniform1ui(this.addr,t),e[0]=t)}function nN(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ls(e,t))return;n.uniform2uiv(this.addr,t),cs(e,t)}}function sN(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ls(e,t))return;n.uniform3uiv(this.addr,t),cs(e,t)}}function rN(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ls(e,t))return;n.uniform4uiv(this.addr,t),cs(e,t)}}function aN(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let l;this.type===n.SAMPLER_2D_SHADOW?(IS.compareFunction=dA,l=IS):l=SA,e.setTexture2D(t||l,s)}function oN(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture3D(t||EA,s)}function lN(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTextureCube(t||AA,s)}function cN(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2DArray(t||TA,s)}function hN(n){switch(n){case 5126:return WB;case 35664:return qB;case 35665:return XB;case 35666:return $B;case 35674:return ZB;case 35675:return YB;case 35676:return KB;case 5124:case 35670:return JB;case 35667:case 35671:return QB;case 35668:case 35672:return tN;case 35669:case 35673:return eN;case 5125:return iN;case 36294:return nN;case 36295:return sN;case 36296:return rN;case 35678:case 36198:case 36298:case 36306:case 35682:return aN;case 35679:case 36299:case 36307:return oN;case 35680:case 36300:case 36308:case 36293:return lN;case 36289:case 36303:case 36311:case 36292:return cN}}function uN(n,t){n.uniform1fv(this.addr,t)}function dN(n,t){const e=Id(t,this.size,2);n.uniform2fv(this.addr,e)}function fN(n,t){const e=Id(t,this.size,3);n.uniform3fv(this.addr,e)}function pN(n,t){const e=Id(t,this.size,4);n.uniform4fv(this.addr,e)}function mN(n,t){const e=Id(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,e)}function _N(n,t){const e=Id(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,e)}function gN(n,t){const e=Id(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,e)}function yN(n,t){n.uniform1iv(this.addr,t)}function xN(n,t){n.uniform2iv(this.addr,t)}function vN(n,t){n.uniform3iv(this.addr,t)}function bN(n,t){n.uniform4iv(this.addr,t)}function wN(n,t){n.uniform1uiv(this.addr,t)}function MN(n,t){n.uniform2uiv(this.addr,t)}function SN(n,t){n.uniform3uiv(this.addr,t)}function TN(n,t){n.uniform4uiv(this.addr,t)}function EN(n,t,e){const i=this.cache,s=t.length,l=y0(e,s);ls(i,l)||(n.uniform1iv(this.addr,l),cs(i,l));for(let c=0;c!==s;++c)e.setTexture2D(t[c]||SA,l[c])}function AN(n,t,e){const i=this.cache,s=t.length,l=y0(e,s);ls(i,l)||(n.uniform1iv(this.addr,l),cs(i,l));for(let c=0;c!==s;++c)e.setTexture3D(t[c]||EA,l[c])}function CN(n,t,e){const i=this.cache,s=t.length,l=y0(e,s);ls(i,l)||(n.uniform1iv(this.addr,l),cs(i,l));for(let c=0;c!==s;++c)e.setTextureCube(t[c]||AA,l[c])}function PN(n,t,e){const i=this.cache,s=t.length,l=y0(e,s);ls(i,l)||(n.uniform1iv(this.addr,l),cs(i,l));for(let c=0;c!==s;++c)e.setTexture2DArray(t[c]||TA,l[c])}function IN(n){switch(n){case 5126:return uN;case 35664:return dN;case 35665:return fN;case 35666:return pN;case 35674:return mN;case 35675:return _N;case 35676:return gN;case 5124:case 35670:return yN;case 35667:case 35671:return xN;case 35668:case 35672:return vN;case 35669:case 35673:return bN;case 5125:return wN;case 36294:return MN;case 36295:return SN;case 36296:return TN;case 35678:case 36198:case 36298:case 36306:case 35682:return EN;case 35679:case 36299:case 36307:return AN;case 35680:case 36300:case 36308:case 36293:return CN;case 36289:case 36303:case 36311:case 36292:return PN}}class RN{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=hN(e.type)}}class DN{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=IN(e.type)}}class LN{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const s=this.seq;for(let l=0,c=s.length;l!==c;++l){const o=s[l];o.setValue(t,e[o.id],i)}}}const yx=/(\w+)(\])?(\[|\.)?/g;function zS(n,t){n.seq.push(t),n.map[t.id]=t}function kN(n,t,e){const i=n.name,s=i.length;for(yx.lastIndex=0;;){const l=yx.exec(i),c=yx.lastIndex;let o=l[1];const p=l[2]==="]",m=l[3];if(p&&(o=o|0),m===void 0||m==="["&&c+2===s){zS(e,m===void 0?new RN(o,n,t):new DN(o,n,t));break}else{let v=e.map[o];v===void 0&&(v=new LN(o),zS(e,v)),e=v}}}class Ig{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const l=t.getActiveUniform(e,s),c=t.getUniformLocation(e,l.name);kN(l,c,this)}}setValue(t,e,i,s){const l=this.map[e];l!==void 0&&l.setValue(t,i,s)}setOptional(t,e,i){const s=e[i];s!==void 0&&this.setValue(t,i,s)}static upload(t,e,i,s){for(let l=0,c=e.length;l!==c;++l){const o=e[l],p=i[o.id];p.needsUpdate!==!1&&o.setValue(t,p.value,s)}}static seqWithValue(t,e){const i=[];for(let s=0,l=t.length;s!==l;++s){const c=t[s];c.id in e&&i.push(c)}return i}}function OS(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}const FN=37297;let zN=0;function ON(n,t){const e=n.split(`
`),i=[],s=Math.max(t-6,0),l=Math.min(t+6,e.length);for(let c=s;c<l;c++){const o=c+1;i.push(`${o===t?">":" "} ${o}: ${e[c]}`)}return i.join(`
`)}const BS=new Li;function BN(n){ji._getMatrix(BS,ji.workingColorSpace,n);const t=`mat3( ${BS.elements.map(e=>e.toFixed(4))} )`;switch(ji.getTransfer(n)){case m0:return[t,"LinearTransferOETF"];case _n:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[t,"LinearTransferOETF"]}}function NS(n,t,e){const i=n.getShaderParameter(t,n.COMPILE_STATUS),s=n.getShaderInfoLog(t).trim();if(i&&s==="")return"";const l=/ERROR: 0:(\d+)/.exec(s);if(l){const c=parseInt(l[1]);return e.toUpperCase()+`

`+s+`

`+ON(n.getShaderSource(t),c)}else return s}function NN(n,t){const e=BN(t);return[`vec4 ${n}( vec4 value ) {`,`	return ${e[1]}( vec4( value.rgb * ${e[0]}, value.a ) );`,"}"].join(`
`)}function UN(n,t){let e;switch(t){case Ok:e="Linear";break;case Bk:e="Reinhard";break;case Nk:e="Cineon";break;case Uk:e="ACESFilmic";break;case Gk:e="AgX";break;case Hk:e="Neutral";break;case Vk:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+n+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}const O_=new _t;function VN(){ji.getLuminanceCoefficients(O_);const n=O_.x.toFixed(4),t=O_.y.toFixed(4),e=O_.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${t}, ${e} );`,"	return dot( weights, rgb );","}"].join(`
`)}function GN(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(pp).join(`
`)}function HN(n){const t=[];for(const e in n){const i=n[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function jN(n,t){const e={},i=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const l=n.getActiveAttrib(t,s),c=l.name;let o=1;l.type===n.FLOAT_MAT2&&(o=2),l.type===n.FLOAT_MAT3&&(o=3),l.type===n.FLOAT_MAT4&&(o=4),e[c]={type:l.type,location:n.getAttribLocation(t,c),locationSize:o}}return e}function pp(n){return n!==""}function US(n,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function VS(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const WN=/^[ \t]*#include +<([\w\d./]+)>/gm;function Qv(n){return n.replace(WN,XN)}const qN=new Map;function XN(n,t){let e=Bi[t];if(e===void 0){const i=qN.get(t);if(i!==void 0)e=Bi[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,i);else throw new Error("Can not resolve #include <"+t+">")}return Qv(e)}const $N=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function GS(n){return n.replace($N,ZN)}function ZN(n,t,e,i){let s="";for(let l=parseInt(t);l<parseInt(e);l++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return s}function HS(n){let t=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?t+=`
#define HIGH_PRECISION`:n.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function YN(n){let t="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===KE?t="SHADOWMAP_TYPE_PCF":n.shadowMapType===_k?t="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===ko&&(t="SHADOWMAP_TYPE_VSM"),t}function KN(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case hd:case ud:t="ENVMAP_TYPE_CUBE";break;case f0:t="ENVMAP_TYPE_CUBE_UV";break}return t}function JN(n){let t="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ud:t="ENVMAP_MODE_REFRACTION";break}return t}function QN(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case JE:t="ENVMAP_BLENDING_MULTIPLY";break;case Fk:t="ENVMAP_BLENDING_MIX";break;case zk:t="ENVMAP_BLENDING_ADD";break}return t}function tU(n){const t=n.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function eU(n,t,e,i){const s=n.getContext(),l=e.defines;let c=e.vertexShader,o=e.fragmentShader;const p=YN(e),m=KN(e),x=JN(e),v=QN(e),b=tU(e),E=GN(e),D=HN(l),k=s.createProgram();let P,I,V=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(P=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,D].filter(pp).join(`
`),P.length>0&&(P+=`
`),I=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,D].filter(pp).join(`
`),I.length>0&&(I+=`
`)):(P=[HS(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,D,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.batchingColor?"#define USE_BATCHING_COLOR":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+x:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+p:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(pp).join(`
`),I=[HS(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,D,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+m:"",e.envMap?"#define "+x:"",e.envMap?"#define "+v:"",b?"#define CUBEUV_TEXEL_WIDTH "+b.texelWidth:"",b?"#define CUBEUV_TEXEL_HEIGHT "+b.texelHeight:"",b?"#define CUBEUV_MAX_MIP "+b.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor||e.batchingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+p:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==$l?"#define TONE_MAPPING":"",e.toneMapping!==$l?Bi.tonemapping_pars_fragment:"",e.toneMapping!==$l?UN("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Bi.colorspace_pars_fragment,NN("linearToOutputTexel",e.outputColorSpace),VN(),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(pp).join(`
`)),c=Qv(c),c=US(c,e),c=VS(c,e),o=Qv(o),o=US(o,e),o=VS(o,e),c=GS(c),o=GS(o),e.isRawShaderMaterial!==!0&&(V=`#version 300 es
`,P=[E,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,I=["#define varying in",e.glslVersion===md?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===md?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+I);const U=V+P+c,B=V+I+o,Z=OS(s,s.VERTEX_SHADER,U),Y=OS(s,s.FRAGMENT_SHADER,B);s.attachShader(k,Z),s.attachShader(k,Y),e.index0AttributeName!==void 0?s.bindAttribLocation(k,0,e.index0AttributeName):e.morphTargets===!0&&s.bindAttribLocation(k,0,"position"),s.linkProgram(k);function K(ct){if(n.debug.checkShaderErrors){const St=s.getProgramInfoLog(k).trim(),wt=s.getShaderInfoLog(Z).trim(),Pt=s.getShaderInfoLog(Y).trim();let Gt=!0,Nt=!0;if(s.getProgramParameter(k,s.LINK_STATUS)===!1)if(Gt=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,k,Z,Y);else{const Zt=NS(s,Z,"vertex"),qt=NS(s,Y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(k,s.VALIDATE_STATUS)+`

Material Name: `+ct.name+`
Material Type: `+ct.type+`

Program Info Log: `+St+`
`+Zt+`
`+qt)}else St!==""?console.warn("THREE.WebGLProgram: Program Info Log:",St):(wt===""||Pt==="")&&(Nt=!1);Nt&&(ct.diagnostics={runnable:Gt,programLog:St,vertexShader:{log:wt,prefix:P},fragmentShader:{log:Pt,prefix:I}})}s.deleteShader(Z),s.deleteShader(Y),nt=new Ig(s,k),q=jN(s,k)}let nt;this.getUniforms=function(){return nt===void 0&&K(this),nt};let q;this.getAttributes=function(){return q===void 0&&K(this),q};let J=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return J===!1&&(J=s.getProgramParameter(k,FN)),J},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(k),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=zN++,this.cacheKey=t,this.usedTimes=1,this.program=k,this.vertexShader=Z,this.fragmentShader=Y,this}let iU=0;class nU{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,s=this._getShaderStage(e),l=this._getShaderStage(i),c=this._getShaderCacheForMaterial(t);return c.has(s)===!1&&(c.add(s),s.usedTimes++),c.has(l)===!1&&(c.add(l),l.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return i===void 0&&(i=new sU(t),e.set(t,i)),i}}class sU{constructor(t){this.id=iU++,this.code=t,this.usedTimes=0}}function rU(n,t,e,i,s,l,c){const o=new r1,p=new nU,m=new Set,x=[],v=s.logarithmicDepthBuffer,b=s.vertexTextures;let E=s.precision;const D={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function k(q){return m.add(q),q===0?"uv":`uv${q}`}function P(q,J,ct,St,wt){const Pt=St.fog,Gt=wt.geometry,Nt=q.isMeshStandardMaterial?St.environment:null,Zt=(q.isMeshStandardMaterial?e:t).get(q.envMap||Nt),qt=Zt&&Zt.mapping===f0?Zt.image.height:null,me=D[q.type];q.precision!==null&&(E=s.getMaxPrecision(q.precision),E!==q.precision&&console.warn("THREE.WebGLProgram.getParameters:",q.precision,"not supported, using",E,"instead."));const Ee=Gt.morphAttributes.position||Gt.morphAttributes.normal||Gt.morphAttributes.color,Le=Ee!==void 0?Ee.length:0;let ri=0;Gt.morphAttributes.position!==void 0&&(ri=1),Gt.morphAttributes.normal!==void 0&&(ri=2),Gt.morphAttributes.color!==void 0&&(ri=3);let Ni,Jt,le,qe;if(me){const xt=Qa[me];Ni=xt.vertexShader,Jt=xt.fragmentShader}else Ni=q.vertexShader,Jt=q.fragmentShader,p.update(q),le=p.getVertexShaderID(q),qe=p.getFragmentShaderID(q);const be=n.getRenderTarget(),Qe=n.state.buffers.depth.getReversed(),gi=wt.isInstancedMesh===!0,bi=wt.isBatchedMesh===!0,Zi=!!q.map,Ei=!!q.matcap,$i=!!Zt,zt=!!q.aoMap,jn=!!q.lightMap,Ft=!!q.bumpMap,Ai=!!q.normalMap,oi=!!q.displacementMap,ti=!!q.emissiveMap,ke=!!q.metalnessMap,mt=!!q.roughnessMap,st=q.anisotropy>0,Ht=q.clearcoat>0,re=q.dispersion>0,ae=q.iridescence>0,ie=q.sheen>0,$e=q.transmission>0,Ut=st&&!!q.anisotropyMap,Ie=Ht&&!!q.clearcoatMap,yi=Ht&&!!q.clearcoatNormalMap,ue=Ht&&!!q.clearcoatRoughnessMap,Be=ae&&!!q.iridescenceMap,Yt=ae&&!!q.iridescenceThicknessMap,ge=ie&&!!q.sheenColorMap,ne=ie&&!!q.sheenRoughnessMap,xi=!!q.specularMap,ci=!!q.specularColorMap,Re=!!q.specularIntensityMap,It=$e&&!!q.transmissionMap,Me=$e&&!!q.thicknessMap,Kt=!!q.gradientMap,se=!!q.alphaMap,lt=q.alphaTest>0,W=!!q.alphaHash,X=!!q.extensions;let it=$l;q.toneMapped&&(be===null||be.isXRRenderTarget===!0)&&(it=n.toneMapping);const ut={shaderID:me,shaderType:q.type,shaderName:q.name,vertexShader:Ni,fragmentShader:Jt,defines:q.defines,customVertexShaderID:le,customFragmentShaderID:qe,isRawShaderMaterial:q.isRawShaderMaterial===!0,glslVersion:q.glslVersion,precision:E,batching:bi,batchingColor:bi&&wt._colorsTexture!==null,instancing:gi,instancingColor:gi&&wt.instanceColor!==null,instancingMorph:gi&&wt.morphTexture!==null,supportsVertexTextures:b,outputColorSpace:be===null?n.outputColorSpace:be.isXRRenderTarget===!0?be.texture.colorSpace:yr,alphaToCoverage:!!q.alphaToCoverage,map:Zi,matcap:Ei,envMap:$i,envMapMode:$i&&Zt.mapping,envMapCubeUVHeight:qt,aoMap:zt,lightMap:jn,bumpMap:Ft,normalMap:Ai,displacementMap:b&&oi,emissiveMap:ti,normalMapObjectSpace:Ai&&q.normalMapType===Jk,normalMapTangentSpace:Ai&&q.normalMapType===uA,metalnessMap:ke,roughnessMap:mt,anisotropy:st,anisotropyMap:Ut,clearcoat:Ht,clearcoatMap:Ie,clearcoatNormalMap:yi,clearcoatRoughnessMap:ue,dispersion:re,iridescence:ae,iridescenceMap:Be,iridescenceThicknessMap:Yt,sheen:ie,sheenColorMap:ge,sheenRoughnessMap:ne,specularMap:xi,specularColorMap:ci,specularIntensityMap:Re,transmission:$e,transmissionMap:It,thicknessMap:Me,gradientMap:Kt,opaque:q.transparent===!1&&q.blending===Ju&&q.alphaToCoverage===!1,alphaMap:se,alphaTest:lt,alphaHash:W,combine:q.combine,mapUv:Zi&&k(q.map.channel),aoMapUv:zt&&k(q.aoMap.channel),lightMapUv:jn&&k(q.lightMap.channel),bumpMapUv:Ft&&k(q.bumpMap.channel),normalMapUv:Ai&&k(q.normalMap.channel),displacementMapUv:oi&&k(q.displacementMap.channel),emissiveMapUv:ti&&k(q.emissiveMap.channel),metalnessMapUv:ke&&k(q.metalnessMap.channel),roughnessMapUv:mt&&k(q.roughnessMap.channel),anisotropyMapUv:Ut&&k(q.anisotropyMap.channel),clearcoatMapUv:Ie&&k(q.clearcoatMap.channel),clearcoatNormalMapUv:yi&&k(q.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ue&&k(q.clearcoatRoughnessMap.channel),iridescenceMapUv:Be&&k(q.iridescenceMap.channel),iridescenceThicknessMapUv:Yt&&k(q.iridescenceThicknessMap.channel),sheenColorMapUv:ge&&k(q.sheenColorMap.channel),sheenRoughnessMapUv:ne&&k(q.sheenRoughnessMap.channel),specularMapUv:xi&&k(q.specularMap.channel),specularColorMapUv:ci&&k(q.specularColorMap.channel),specularIntensityMapUv:Re&&k(q.specularIntensityMap.channel),transmissionMapUv:It&&k(q.transmissionMap.channel),thicknessMapUv:Me&&k(q.thicknessMap.channel),alphaMapUv:se&&k(q.alphaMap.channel),vertexTangents:!!Gt.attributes.tangent&&(Ai||st),vertexColors:q.vertexColors,vertexAlphas:q.vertexColors===!0&&!!Gt.attributes.color&&Gt.attributes.color.itemSize===4,pointsUvs:wt.isPoints===!0&&!!Gt.attributes.uv&&(Zi||se),fog:!!Pt,useFog:q.fog===!0,fogExp2:!!Pt&&Pt.isFogExp2,flatShading:q.flatShading===!0,sizeAttenuation:q.sizeAttenuation===!0,logarithmicDepthBuffer:v,reverseDepthBuffer:Qe,skinning:wt.isSkinnedMesh===!0,morphTargets:Gt.morphAttributes.position!==void 0,morphNormals:Gt.morphAttributes.normal!==void 0,morphColors:Gt.morphAttributes.color!==void 0,morphTargetsCount:Le,morphTextureStride:ri,numDirLights:J.directional.length,numPointLights:J.point.length,numSpotLights:J.spot.length,numSpotLightMaps:J.spotLightMap.length,numRectAreaLights:J.rectArea.length,numHemiLights:J.hemi.length,numDirLightShadows:J.directionalShadowMap.length,numPointLightShadows:J.pointShadowMap.length,numSpotLightShadows:J.spotShadowMap.length,numSpotLightShadowsWithMaps:J.numSpotLightShadowsWithMaps,numLightProbes:J.numLightProbes,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,dithering:q.dithering,shadowMapEnabled:n.shadowMap.enabled&&ct.length>0,shadowMapType:n.shadowMap.type,toneMapping:it,decodeVideoTexture:Zi&&q.map.isVideoTexture===!0&&ji.getTransfer(q.map.colorSpace)===_n,decodeVideoTextureEmissive:ti&&q.emissiveMap.isVideoTexture===!0&&ji.getTransfer(q.emissiveMap.colorSpace)===_n,premultipliedAlpha:q.premultipliedAlpha,doubleSided:q.side===Qr,flipSided:q.side===pr,useDepthPacking:q.depthPacking>=0,depthPacking:q.depthPacking||0,index0AttributeName:q.index0AttributeName,extensionClipCullDistance:X&&q.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(X&&q.extensions.multiDraw===!0||bi)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:q.customProgramCacheKey()};return ut.vertexUv1s=m.has(1),ut.vertexUv2s=m.has(2),ut.vertexUv3s=m.has(3),m.clear(),ut}function I(q){const J=[];if(q.shaderID?J.push(q.shaderID):(J.push(q.customVertexShaderID),J.push(q.customFragmentShaderID)),q.defines!==void 0)for(const ct in q.defines)J.push(ct),J.push(q.defines[ct]);return q.isRawShaderMaterial===!1&&(V(J,q),U(J,q),J.push(n.outputColorSpace)),J.push(q.customProgramCacheKey),J.join()}function V(q,J){q.push(J.precision),q.push(J.outputColorSpace),q.push(J.envMapMode),q.push(J.envMapCubeUVHeight),q.push(J.mapUv),q.push(J.alphaMapUv),q.push(J.lightMapUv),q.push(J.aoMapUv),q.push(J.bumpMapUv),q.push(J.normalMapUv),q.push(J.displacementMapUv),q.push(J.emissiveMapUv),q.push(J.metalnessMapUv),q.push(J.roughnessMapUv),q.push(J.anisotropyMapUv),q.push(J.clearcoatMapUv),q.push(J.clearcoatNormalMapUv),q.push(J.clearcoatRoughnessMapUv),q.push(J.iridescenceMapUv),q.push(J.iridescenceThicknessMapUv),q.push(J.sheenColorMapUv),q.push(J.sheenRoughnessMapUv),q.push(J.specularMapUv),q.push(J.specularColorMapUv),q.push(J.specularIntensityMapUv),q.push(J.transmissionMapUv),q.push(J.thicknessMapUv),q.push(J.combine),q.push(J.fogExp2),q.push(J.sizeAttenuation),q.push(J.morphTargetsCount),q.push(J.morphAttributeCount),q.push(J.numDirLights),q.push(J.numPointLights),q.push(J.numSpotLights),q.push(J.numSpotLightMaps),q.push(J.numHemiLights),q.push(J.numRectAreaLights),q.push(J.numDirLightShadows),q.push(J.numPointLightShadows),q.push(J.numSpotLightShadows),q.push(J.numSpotLightShadowsWithMaps),q.push(J.numLightProbes),q.push(J.shadowMapType),q.push(J.toneMapping),q.push(J.numClippingPlanes),q.push(J.numClipIntersection),q.push(J.depthPacking)}function U(q,J){o.disableAll(),J.supportsVertexTextures&&o.enable(0),J.instancing&&o.enable(1),J.instancingColor&&o.enable(2),J.instancingMorph&&o.enable(3),J.matcap&&o.enable(4),J.envMap&&o.enable(5),J.normalMapObjectSpace&&o.enable(6),J.normalMapTangentSpace&&o.enable(7),J.clearcoat&&o.enable(8),J.iridescence&&o.enable(9),J.alphaTest&&o.enable(10),J.vertexColors&&o.enable(11),J.vertexAlphas&&o.enable(12),J.vertexUv1s&&o.enable(13),J.vertexUv2s&&o.enable(14),J.vertexUv3s&&o.enable(15),J.vertexTangents&&o.enable(16),J.anisotropy&&o.enable(17),J.alphaHash&&o.enable(18),J.batching&&o.enable(19),J.dispersion&&o.enable(20),J.batchingColor&&o.enable(21),q.push(o.mask),o.disableAll(),J.fog&&o.enable(0),J.useFog&&o.enable(1),J.flatShading&&o.enable(2),J.logarithmicDepthBuffer&&o.enable(3),J.reverseDepthBuffer&&o.enable(4),J.skinning&&o.enable(5),J.morphTargets&&o.enable(6),J.morphNormals&&o.enable(7),J.morphColors&&o.enable(8),J.premultipliedAlpha&&o.enable(9),J.shadowMapEnabled&&o.enable(10),J.doubleSided&&o.enable(11),J.flipSided&&o.enable(12),J.useDepthPacking&&o.enable(13),J.dithering&&o.enable(14),J.transmission&&o.enable(15),J.sheen&&o.enable(16),J.opaque&&o.enable(17),J.pointsUvs&&o.enable(18),J.decodeVideoTexture&&o.enable(19),J.decodeVideoTextureEmissive&&o.enable(20),J.alphaToCoverage&&o.enable(21),q.push(o.mask)}function B(q){const J=D[q.type];let ct;if(J){const St=Qa[J];ct=GF.clone(St.uniforms)}else ct=q.uniforms;return ct}function Z(q,J){let ct;for(let St=0,wt=x.length;St<wt;St++){const Pt=x[St];if(Pt.cacheKey===J){ct=Pt,++ct.usedTimes;break}}return ct===void 0&&(ct=new eU(n,J,q,l),x.push(ct)),ct}function Y(q){if(--q.usedTimes===0){const J=x.indexOf(q);x[J]=x[x.length-1],x.pop(),q.destroy()}}function K(q){p.remove(q)}function nt(){p.dispose()}return{getParameters:P,getProgramCacheKey:I,getUniforms:B,acquireProgram:Z,releaseProgram:Y,releaseShaderCache:K,programs:x,dispose:nt}}function aU(){let n=new WeakMap;function t(c){return n.has(c)}function e(c){let o=n.get(c);return o===void 0&&(o={},n.set(c,o)),o}function i(c){n.delete(c)}function s(c,o,p){n.get(c)[o]=p}function l(){n=new WeakMap}return{has:t,get:e,remove:i,update:s,dispose:l}}function oU(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function jS(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function WS(){const n=[];let t=0;const e=[],i=[],s=[];function l(){t=0,e.length=0,i.length=0,s.length=0}function c(v,b,E,D,k,P){let I=n[t];return I===void 0?(I={id:v.id,object:v,geometry:b,material:E,groupOrder:D,renderOrder:v.renderOrder,z:k,group:P},n[t]=I):(I.id=v.id,I.object=v,I.geometry=b,I.material=E,I.groupOrder=D,I.renderOrder=v.renderOrder,I.z=k,I.group=P),t++,I}function o(v,b,E,D,k,P){const I=c(v,b,E,D,k,P);E.transmission>0?i.push(I):E.transparent===!0?s.push(I):e.push(I)}function p(v,b,E,D,k,P){const I=c(v,b,E,D,k,P);E.transmission>0?i.unshift(I):E.transparent===!0?s.unshift(I):e.unshift(I)}function m(v,b){e.length>1&&e.sort(v||oU),i.length>1&&i.sort(b||jS),s.length>1&&s.sort(b||jS)}function x(){for(let v=t,b=n.length;v<b;v++){const E=n[v];if(E.id===null)break;E.id=null,E.object=null,E.geometry=null,E.material=null,E.group=null}}return{opaque:e,transmissive:i,transparent:s,init:l,push:o,unshift:p,finish:x,sort:m}}function lU(){let n=new WeakMap;function t(i,s){const l=n.get(i);let c;return l===void 0?(c=new WS,n.set(i,[c])):s>=l.length?(c=new WS,l.push(c)):c=l[s],c}function e(){n=new WeakMap}return{get:t,dispose:e}}function cU(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new _t,color:new vi};break;case"SpotLight":e={position:new _t,direction:new _t,color:new vi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new _t,color:new vi,distance:0,decay:0};break;case"HemisphereLight":e={direction:new _t,skyColor:new vi,groundColor:new vi};break;case"RectAreaLight":e={color:new vi,position:new _t,halfWidth:new _t,halfHeight:new _t};break}return n[t.id]=e,e}}}function hU(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si};break;case"SpotLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si};break;case"PointLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[t.id]=e,e}}}let uU=0;function dU(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function fU(n){const t=new cU,e=hU(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let m=0;m<9;m++)i.probe.push(new _t);const s=new _t,l=new _i,c=new _i;function o(m){let x=0,v=0,b=0;for(let q=0;q<9;q++)i.probe[q].set(0,0,0);let E=0,D=0,k=0,P=0,I=0,V=0,U=0,B=0,Z=0,Y=0,K=0;m.sort(dU);for(let q=0,J=m.length;q<J;q++){const ct=m[q],St=ct.color,wt=ct.intensity,Pt=ct.distance,Gt=ct.shadow&&ct.shadow.map?ct.shadow.map.texture:null;if(ct.isAmbientLight)x+=St.r*wt,v+=St.g*wt,b+=St.b*wt;else if(ct.isLightProbe){for(let Nt=0;Nt<9;Nt++)i.probe[Nt].addScaledVector(ct.sh.coefficients[Nt],wt);K++}else if(ct.isDirectionalLight){const Nt=t.get(ct);if(Nt.color.copy(ct.color).multiplyScalar(ct.intensity),ct.castShadow){const Zt=ct.shadow,qt=e.get(ct);qt.shadowIntensity=Zt.intensity,qt.shadowBias=Zt.bias,qt.shadowNormalBias=Zt.normalBias,qt.shadowRadius=Zt.radius,qt.shadowMapSize=Zt.mapSize,i.directionalShadow[E]=qt,i.directionalShadowMap[E]=Gt,i.directionalShadowMatrix[E]=ct.shadow.matrix,V++}i.directional[E]=Nt,E++}else if(ct.isSpotLight){const Nt=t.get(ct);Nt.position.setFromMatrixPosition(ct.matrixWorld),Nt.color.copy(St).multiplyScalar(wt),Nt.distance=Pt,Nt.coneCos=Math.cos(ct.angle),Nt.penumbraCos=Math.cos(ct.angle*(1-ct.penumbra)),Nt.decay=ct.decay,i.spot[k]=Nt;const Zt=ct.shadow;if(ct.map&&(i.spotLightMap[Z]=ct.map,Z++,Zt.updateMatrices(ct),ct.castShadow&&Y++),i.spotLightMatrix[k]=Zt.matrix,ct.castShadow){const qt=e.get(ct);qt.shadowIntensity=Zt.intensity,qt.shadowBias=Zt.bias,qt.shadowNormalBias=Zt.normalBias,qt.shadowRadius=Zt.radius,qt.shadowMapSize=Zt.mapSize,i.spotShadow[k]=qt,i.spotShadowMap[k]=Gt,B++}k++}else if(ct.isRectAreaLight){const Nt=t.get(ct);Nt.color.copy(St).multiplyScalar(wt),Nt.halfWidth.set(ct.width*.5,0,0),Nt.halfHeight.set(0,ct.height*.5,0),i.rectArea[P]=Nt,P++}else if(ct.isPointLight){const Nt=t.get(ct);if(Nt.color.copy(ct.color).multiplyScalar(ct.intensity),Nt.distance=ct.distance,Nt.decay=ct.decay,ct.castShadow){const Zt=ct.shadow,qt=e.get(ct);qt.shadowIntensity=Zt.intensity,qt.shadowBias=Zt.bias,qt.shadowNormalBias=Zt.normalBias,qt.shadowRadius=Zt.radius,qt.shadowMapSize=Zt.mapSize,qt.shadowCameraNear=Zt.camera.near,qt.shadowCameraFar=Zt.camera.far,i.pointShadow[D]=qt,i.pointShadowMap[D]=Gt,i.pointShadowMatrix[D]=ct.shadow.matrix,U++}i.point[D]=Nt,D++}else if(ct.isHemisphereLight){const Nt=t.get(ct);Nt.skyColor.copy(ct.color).multiplyScalar(wt),Nt.groundColor.copy(ct.groundColor).multiplyScalar(wt),i.hemi[I]=Nt,I++}}P>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=ze.LTC_FLOAT_1,i.rectAreaLTC2=ze.LTC_FLOAT_2):(i.rectAreaLTC1=ze.LTC_HALF_1,i.rectAreaLTC2=ze.LTC_HALF_2)),i.ambient[0]=x,i.ambient[1]=v,i.ambient[2]=b;const nt=i.hash;(nt.directionalLength!==E||nt.pointLength!==D||nt.spotLength!==k||nt.rectAreaLength!==P||nt.hemiLength!==I||nt.numDirectionalShadows!==V||nt.numPointShadows!==U||nt.numSpotShadows!==B||nt.numSpotMaps!==Z||nt.numLightProbes!==K)&&(i.directional.length=E,i.spot.length=k,i.rectArea.length=P,i.point.length=D,i.hemi.length=I,i.directionalShadow.length=V,i.directionalShadowMap.length=V,i.pointShadow.length=U,i.pointShadowMap.length=U,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=V,i.pointShadowMatrix.length=U,i.spotLightMatrix.length=B+Z-Y,i.spotLightMap.length=Z,i.numSpotLightShadowsWithMaps=Y,i.numLightProbes=K,nt.directionalLength=E,nt.pointLength=D,nt.spotLength=k,nt.rectAreaLength=P,nt.hemiLength=I,nt.numDirectionalShadows=V,nt.numPointShadows=U,nt.numSpotShadows=B,nt.numSpotMaps=Z,nt.numLightProbes=K,i.version=uU++)}function p(m,x){let v=0,b=0,E=0,D=0,k=0;const P=x.matrixWorldInverse;for(let I=0,V=m.length;I<V;I++){const U=m[I];if(U.isDirectionalLight){const B=i.directional[v];B.direction.setFromMatrixPosition(U.matrixWorld),s.setFromMatrixPosition(U.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(P),v++}else if(U.isSpotLight){const B=i.spot[E];B.position.setFromMatrixPosition(U.matrixWorld),B.position.applyMatrix4(P),B.direction.setFromMatrixPosition(U.matrixWorld),s.setFromMatrixPosition(U.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(P),E++}else if(U.isRectAreaLight){const B=i.rectArea[D];B.position.setFromMatrixPosition(U.matrixWorld),B.position.applyMatrix4(P),c.identity(),l.copy(U.matrixWorld),l.premultiply(P),c.extractRotation(l),B.halfWidth.set(U.width*.5,0,0),B.halfHeight.set(0,U.height*.5,0),B.halfWidth.applyMatrix4(c),B.halfHeight.applyMatrix4(c),D++}else if(U.isPointLight){const B=i.point[b];B.position.setFromMatrixPosition(U.matrixWorld),B.position.applyMatrix4(P),b++}else if(U.isHemisphereLight){const B=i.hemi[k];B.direction.setFromMatrixPosition(U.matrixWorld),B.direction.transformDirection(P),k++}}}return{setup:o,setupView:p,state:i}}function qS(n){const t=new fU(n),e=[],i=[];function s(x){m.camera=x,e.length=0,i.length=0}function l(x){e.push(x)}function c(x){i.push(x)}function o(){t.setup(e)}function p(x){t.setupView(e,x)}const m={lightsArray:e,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:s,state:m,setupLights:o,setupLightsView:p,pushLight:l,pushShadow:c}}function pU(n){let t=new WeakMap;function e(s,l=0){const c=t.get(s);let o;return c===void 0?(o=new qS(n),t.set(s,[o])):l>=c.length?(o=new qS(n),c.push(o)):o=c[l],o}function i(){t=new WeakMap}return{get:e,dispose:i}}class mU extends ro{static get type(){return"MeshDepthMaterial"}constructor(t){super(),this.isMeshDepthMaterial=!0,this.depthPacking=Yk,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class _U extends ro{static get type(){return"MeshDistanceMaterial"}constructor(t){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const gU=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yU=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function xU(n,t,e){let i=new _0;const s=new si,l=new si,c=new en,o=new mU({depthPacking:Kk}),p=new _U,m={},x=e.maxTextureSize,v={[Va]:pr,[pr]:Va,[Qr]:Qr},b=new Ea({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new si},radius:{value:4}},vertexShader:gU,fragmentShader:yU}),E=b.clone();E.defines.HORIZONTAL_PASS=1;const D=new Br;D.setAttribute("position",new $n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const k=new os(D,b),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=KE;let I=this.type;this.render=function(Y,K,nt){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||Y.length===0)return;const q=n.getRenderTarget(),J=n.getActiveCubeFace(),ct=n.getActiveMipmapLevel(),St=n.state;St.setBlending(Xl),St.buffers.color.setClear(1,1,1,1),St.buffers.depth.setTest(!0),St.setScissorTest(!1);const wt=I!==ko&&this.type===ko,Pt=I===ko&&this.type!==ko;for(let Gt=0,Nt=Y.length;Gt<Nt;Gt++){const Zt=Y[Gt],qt=Zt.shadow;if(qt===void 0){console.warn("THREE.WebGLShadowMap:",Zt,"has no shadow.");continue}if(qt.autoUpdate===!1&&qt.needsUpdate===!1)continue;s.copy(qt.mapSize);const me=qt.getFrameExtents();if(s.multiply(me),l.copy(qt.mapSize),(s.x>x||s.y>x)&&(s.x>x&&(l.x=Math.floor(x/me.x),s.x=l.x*me.x,qt.mapSize.x=l.x),s.y>x&&(l.y=Math.floor(x/me.y),s.y=l.y*me.y,qt.mapSize.y=l.y)),qt.map===null||wt===!0||Pt===!0){const Le=this.type!==ko?{minFilter:mr,magFilter:mr}:{};qt.map!==null&&qt.map.dispose(),qt.map=new uh(s.x,s.y,Le),qt.map.texture.name=Zt.name+".shadowMap",qt.camera.updateProjectionMatrix()}n.setRenderTarget(qt.map),n.clear();const Ee=qt.getViewportCount();for(let Le=0;Le<Ee;Le++){const ri=qt.getViewport(Le);c.set(l.x*ri.x,l.y*ri.y,l.x*ri.z,l.y*ri.w),St.viewport(c),qt.updateMatrices(Zt,Le),i=qt.getFrustum(),B(K,nt,qt.camera,Zt,this.type)}qt.isPointLightShadow!==!0&&this.type===ko&&V(qt,nt),qt.needsUpdate=!1}I=this.type,P.needsUpdate=!1,n.setRenderTarget(q,J,ct)};function V(Y,K){const nt=t.update(k);b.defines.VSM_SAMPLES!==Y.blurSamples&&(b.defines.VSM_SAMPLES=Y.blurSamples,E.defines.VSM_SAMPLES=Y.blurSamples,b.needsUpdate=!0,E.needsUpdate=!0),Y.mapPass===null&&(Y.mapPass=new uh(s.x,s.y)),b.uniforms.shadow_pass.value=Y.map.texture,b.uniforms.resolution.value=Y.mapSize,b.uniforms.radius.value=Y.radius,n.setRenderTarget(Y.mapPass),n.clear(),n.renderBufferDirect(K,null,nt,b,k,null),E.uniforms.shadow_pass.value=Y.mapPass.texture,E.uniforms.resolution.value=Y.mapSize,E.uniforms.radius.value=Y.radius,n.setRenderTarget(Y.map),n.clear(),n.renderBufferDirect(K,null,nt,E,k,null)}function U(Y,K,nt,q){let J=null;const ct=nt.isPointLight===!0?Y.customDistanceMaterial:Y.customDepthMaterial;if(ct!==void 0)J=ct;else if(J=nt.isPointLight===!0?p:o,n.localClippingEnabled&&K.clipShadows===!0&&Array.isArray(K.clippingPlanes)&&K.clippingPlanes.length!==0||K.displacementMap&&K.displacementScale!==0||K.alphaMap&&K.alphaTest>0||K.map&&K.alphaTest>0){const St=J.uuid,wt=K.uuid;let Pt=m[St];Pt===void 0&&(Pt={},m[St]=Pt);let Gt=Pt[wt];Gt===void 0&&(Gt=J.clone(),Pt[wt]=Gt,K.addEventListener("dispose",Z)),J=Gt}if(J.visible=K.visible,J.wireframe=K.wireframe,q===ko?J.side=K.shadowSide!==null?K.shadowSide:K.side:J.side=K.shadowSide!==null?K.shadowSide:v[K.side],J.alphaMap=K.alphaMap,J.alphaTest=K.alphaTest,J.map=K.map,J.clipShadows=K.clipShadows,J.clippingPlanes=K.clippingPlanes,J.clipIntersection=K.clipIntersection,J.displacementMap=K.displacementMap,J.displacementScale=K.displacementScale,J.displacementBias=K.displacementBias,J.wireframeLinewidth=K.wireframeLinewidth,J.linewidth=K.linewidth,nt.isPointLight===!0&&J.isMeshDistanceMaterial===!0){const St=n.properties.get(J);St.light=nt}return J}function B(Y,K,nt,q,J){if(Y.visible===!1)return;if(Y.layers.test(K.layers)&&(Y.isMesh||Y.isLine||Y.isPoints)&&(Y.castShadow||Y.receiveShadow&&J===ko)&&(!Y.frustumCulled||i.intersectsObject(Y))){Y.modelViewMatrix.multiplyMatrices(nt.matrixWorldInverse,Y.matrixWorld);const wt=t.update(Y),Pt=Y.material;if(Array.isArray(Pt)){const Gt=wt.groups;for(let Nt=0,Zt=Gt.length;Nt<Zt;Nt++){const qt=Gt[Nt],me=Pt[qt.materialIndex];if(me&&me.visible){const Ee=U(Y,me,q,J);Y.onBeforeShadow(n,Y,K,nt,wt,Ee,qt),n.renderBufferDirect(nt,null,wt,Ee,Y,qt),Y.onAfterShadow(n,Y,K,nt,wt,Ee,qt)}}}else if(Pt.visible){const Gt=U(Y,Pt,q,J);Y.onBeforeShadow(n,Y,K,nt,wt,Gt,null),n.renderBufferDirect(nt,null,wt,Gt,Y,null),Y.onAfterShadow(n,Y,K,nt,wt,Gt,null)}}const St=Y.children;for(let wt=0,Pt=St.length;wt<Pt;wt++)B(St[wt],K,nt,q,J)}function Z(Y){Y.target.removeEventListener("dispose",Z);for(const nt in m){const q=m[nt],J=Y.target.uuid;J in q&&(q[J].dispose(),delete q[J])}}}const vU={[_v]:gv,[yv]:bv,[xv]:wv,[cd]:vv,[gv]:_v,[bv]:yv,[wv]:xv,[vv]:cd};function bU(n,t){function e(){let It=!1;const Me=new en;let Kt=null;const se=new en(0,0,0,0);return{setMask:function(lt){Kt!==lt&&!It&&(n.colorMask(lt,lt,lt,lt),Kt=lt)},setLocked:function(lt){It=lt},setClear:function(lt,W,X,it,ut){ut===!0&&(lt*=it,W*=it,X*=it),Me.set(lt,W,X,it),se.equals(Me)===!1&&(n.clearColor(lt,W,X,it),se.copy(Me))},reset:function(){It=!1,Kt=null,se.set(-1,0,0,0)}}}function i(){let It=!1,Me=!1,Kt=null,se=null,lt=null;return{setReversed:function(W){if(Me!==W){const X=t.get("EXT_clip_control");Me?X.clipControlEXT(X.LOWER_LEFT_EXT,X.ZERO_TO_ONE_EXT):X.clipControlEXT(X.LOWER_LEFT_EXT,X.NEGATIVE_ONE_TO_ONE_EXT);const it=lt;lt=null,this.setClear(it)}Me=W},getReversed:function(){return Me},setTest:function(W){W?be(n.DEPTH_TEST):Qe(n.DEPTH_TEST)},setMask:function(W){Kt!==W&&!It&&(n.depthMask(W),Kt=W)},setFunc:function(W){if(Me&&(W=vU[W]),se!==W){switch(W){case _v:n.depthFunc(n.NEVER);break;case gv:n.depthFunc(n.ALWAYS);break;case yv:n.depthFunc(n.LESS);break;case cd:n.depthFunc(n.LEQUAL);break;case xv:n.depthFunc(n.EQUAL);break;case vv:n.depthFunc(n.GEQUAL);break;case bv:n.depthFunc(n.GREATER);break;case wv:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}se=W}},setLocked:function(W){It=W},setClear:function(W){lt!==W&&(Me&&(W=1-W),n.clearDepth(W),lt=W)},reset:function(){It=!1,Kt=null,se=null,lt=null,Me=!1}}}function s(){let It=!1,Me=null,Kt=null,se=null,lt=null,W=null,X=null,it=null,ut=null;return{setTest:function(xt){It||(xt?be(n.STENCIL_TEST):Qe(n.STENCIL_TEST))},setMask:function(xt){Me!==xt&&!It&&(n.stencilMask(xt),Me=xt)},setFunc:function(xt,Et,Dt){(Kt!==xt||se!==Et||lt!==Dt)&&(n.stencilFunc(xt,Et,Dt),Kt=xt,se=Et,lt=Dt)},setOp:function(xt,Et,Dt){(W!==xt||X!==Et||it!==Dt)&&(n.stencilOp(xt,Et,Dt),W=xt,X=Et,it=Dt)},setLocked:function(xt){It=xt},setClear:function(xt){ut!==xt&&(n.clearStencil(xt),ut=xt)},reset:function(){It=!1,Me=null,Kt=null,se=null,lt=null,W=null,X=null,it=null,ut=null}}}const l=new e,c=new i,o=new s,p=new WeakMap,m=new WeakMap;let x={},v={},b=new WeakMap,E=[],D=null,k=!1,P=null,I=null,V=null,U=null,B=null,Z=null,Y=null,K=new vi(0,0,0),nt=0,q=!1,J=null,ct=null,St=null,wt=null,Pt=null;const Gt=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Nt=!1,Zt=0;const qt=n.getParameter(n.VERSION);qt.indexOf("WebGL")!==-1?(Zt=parseFloat(/^WebGL (\d)/.exec(qt)[1]),Nt=Zt>=1):qt.indexOf("OpenGL ES")!==-1&&(Zt=parseFloat(/^OpenGL ES (\d)/.exec(qt)[1]),Nt=Zt>=2);let me=null,Ee={};const Le=n.getParameter(n.SCISSOR_BOX),ri=n.getParameter(n.VIEWPORT),Ni=new en().fromArray(Le),Jt=new en().fromArray(ri);function le(It,Me,Kt,se){const lt=new Uint8Array(4),W=n.createTexture();n.bindTexture(It,W),n.texParameteri(It,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(It,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let X=0;X<Kt;X++)It===n.TEXTURE_3D||It===n.TEXTURE_2D_ARRAY?n.texImage3D(Me,0,n.RGBA,1,1,se,0,n.RGBA,n.UNSIGNED_BYTE,lt):n.texImage2D(Me+X,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,lt);return W}const qe={};qe[n.TEXTURE_2D]=le(n.TEXTURE_2D,n.TEXTURE_2D,1),qe[n.TEXTURE_CUBE_MAP]=le(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),qe[n.TEXTURE_2D_ARRAY]=le(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),qe[n.TEXTURE_3D]=le(n.TEXTURE_3D,n.TEXTURE_3D,1,1),l.setClear(0,0,0,1),c.setClear(1),o.setClear(0),be(n.DEPTH_TEST),c.setFunc(cd),Ft(!1),Ai(YM),be(n.CULL_FACE),zt(Xl);function be(It){x[It]!==!0&&(n.enable(It),x[It]=!0)}function Qe(It){x[It]!==!1&&(n.disable(It),x[It]=!1)}function gi(It,Me){return v[It]!==Me?(n.bindFramebuffer(It,Me),v[It]=Me,It===n.DRAW_FRAMEBUFFER&&(v[n.FRAMEBUFFER]=Me),It===n.FRAMEBUFFER&&(v[n.DRAW_FRAMEBUFFER]=Me),!0):!1}function bi(It,Me){let Kt=E,se=!1;if(It){Kt=b.get(Me),Kt===void 0&&(Kt=[],b.set(Me,Kt));const lt=It.textures;if(Kt.length!==lt.length||Kt[0]!==n.COLOR_ATTACHMENT0){for(let W=0,X=lt.length;W<X;W++)Kt[W]=n.COLOR_ATTACHMENT0+W;Kt.length=lt.length,se=!0}}else Kt[0]!==n.BACK&&(Kt[0]=n.BACK,se=!0);se&&n.drawBuffers(Kt)}function Zi(It){return D!==It?(n.useProgram(It),D=It,!0):!1}const Ei={[Jc]:n.FUNC_ADD,[yk]:n.FUNC_SUBTRACT,[xk]:n.FUNC_REVERSE_SUBTRACT};Ei[vk]=n.MIN,Ei[bk]=n.MAX;const $i={[wk]:n.ZERO,[Mk]:n.ONE,[Sk]:n.SRC_COLOR,[pv]:n.SRC_ALPHA,[Ik]:n.SRC_ALPHA_SATURATE,[Ck]:n.DST_COLOR,[Ek]:n.DST_ALPHA,[Tk]:n.ONE_MINUS_SRC_COLOR,[mv]:n.ONE_MINUS_SRC_ALPHA,[Pk]:n.ONE_MINUS_DST_COLOR,[Ak]:n.ONE_MINUS_DST_ALPHA,[Rk]:n.CONSTANT_COLOR,[Dk]:n.ONE_MINUS_CONSTANT_COLOR,[Lk]:n.CONSTANT_ALPHA,[kk]:n.ONE_MINUS_CONSTANT_ALPHA};function zt(It,Me,Kt,se,lt,W,X,it,ut,xt){if(It===Xl){k===!0&&(Qe(n.BLEND),k=!1);return}if(k===!1&&(be(n.BLEND),k=!0),It!==gk){if(It!==P||xt!==q){if((I!==Jc||B!==Jc)&&(n.blendEquation(n.FUNC_ADD),I=Jc,B=Jc),xt)switch(It){case Ju:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case KM:n.blendFunc(n.ONE,n.ONE);break;case JM:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QM:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",It);break}else switch(It){case Ju:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case KM:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case JM:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QM:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",It);break}V=null,U=null,Z=null,Y=null,K.set(0,0,0),nt=0,P=It,q=xt}return}lt=lt||Me,W=W||Kt,X=X||se,(Me!==I||lt!==B)&&(n.blendEquationSeparate(Ei[Me],Ei[lt]),I=Me,B=lt),(Kt!==V||se!==U||W!==Z||X!==Y)&&(n.blendFuncSeparate($i[Kt],$i[se],$i[W],$i[X]),V=Kt,U=se,Z=W,Y=X),(it.equals(K)===!1||ut!==nt)&&(n.blendColor(it.r,it.g,it.b,ut),K.copy(it),nt=ut),P=It,q=!1}function jn(It,Me){It.side===Qr?Qe(n.CULL_FACE):be(n.CULL_FACE);let Kt=It.side===pr;Me&&(Kt=!Kt),Ft(Kt),It.blending===Ju&&It.transparent===!1?zt(Xl):zt(It.blending,It.blendEquation,It.blendSrc,It.blendDst,It.blendEquationAlpha,It.blendSrcAlpha,It.blendDstAlpha,It.blendColor,It.blendAlpha,It.premultipliedAlpha),c.setFunc(It.depthFunc),c.setTest(It.depthTest),c.setMask(It.depthWrite),l.setMask(It.colorWrite);const se=It.stencilWrite;o.setTest(se),se&&(o.setMask(It.stencilWriteMask),o.setFunc(It.stencilFunc,It.stencilRef,It.stencilFuncMask),o.setOp(It.stencilFail,It.stencilZFail,It.stencilZPass)),ti(It.polygonOffset,It.polygonOffsetFactor,It.polygonOffsetUnits),It.alphaToCoverage===!0?be(n.SAMPLE_ALPHA_TO_COVERAGE):Qe(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ft(It){J!==It&&(It?n.frontFace(n.CW):n.frontFace(n.CCW),J=It)}function Ai(It){It!==pk?(be(n.CULL_FACE),It!==ct&&(It===YM?n.cullFace(n.BACK):It===mk?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Qe(n.CULL_FACE),ct=It}function oi(It){It!==St&&(Nt&&n.lineWidth(It),St=It)}function ti(It,Me,Kt){It?(be(n.POLYGON_OFFSET_FILL),(wt!==Me||Pt!==Kt)&&(n.polygonOffset(Me,Kt),wt=Me,Pt=Kt)):Qe(n.POLYGON_OFFSET_FILL)}function ke(It){It?be(n.SCISSOR_TEST):Qe(n.SCISSOR_TEST)}function mt(It){It===void 0&&(It=n.TEXTURE0+Gt-1),me!==It&&(n.activeTexture(It),me=It)}function st(It,Me,Kt){Kt===void 0&&(me===null?Kt=n.TEXTURE0+Gt-1:Kt=me);let se=Ee[Kt];se===void 0&&(se={type:void 0,texture:void 0},Ee[Kt]=se),(se.type!==It||se.texture!==Me)&&(me!==Kt&&(n.activeTexture(Kt),me=Kt),n.bindTexture(It,Me||qe[It]),se.type=It,se.texture=Me)}function Ht(){const It=Ee[me];It!==void 0&&It.type!==void 0&&(n.bindTexture(It.type,null),It.type=void 0,It.texture=void 0)}function re(){try{n.compressedTexImage2D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function ae(){try{n.compressedTexImage3D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function ie(){try{n.texSubImage2D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function $e(){try{n.texSubImage3D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function Ut(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function Ie(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function yi(){try{n.texStorage2D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function ue(){try{n.texStorage3D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function Be(){try{n.texImage2D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function Yt(){try{n.texImage3D.apply(n,arguments)}catch(It){console.error("THREE.WebGLState:",It)}}function ge(It){Ni.equals(It)===!1&&(n.scissor(It.x,It.y,It.z,It.w),Ni.copy(It))}function ne(It){Jt.equals(It)===!1&&(n.viewport(It.x,It.y,It.z,It.w),Jt.copy(It))}function xi(It,Me){let Kt=m.get(Me);Kt===void 0&&(Kt=new WeakMap,m.set(Me,Kt));let se=Kt.get(It);se===void 0&&(se=n.getUniformBlockIndex(Me,It.name),Kt.set(It,se))}function ci(It,Me){const se=m.get(Me).get(It);p.get(Me)!==se&&(n.uniformBlockBinding(Me,se,It.__bindingPointIndex),p.set(Me,se))}function Re(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),c.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),x={},me=null,Ee={},v={},b=new WeakMap,E=[],D=null,k=!1,P=null,I=null,V=null,U=null,B=null,Z=null,Y=null,K=new vi(0,0,0),nt=0,q=!1,J=null,ct=null,St=null,wt=null,Pt=null,Ni.set(0,0,n.canvas.width,n.canvas.height),Jt.set(0,0,n.canvas.width,n.canvas.height),l.reset(),c.reset(),o.reset()}return{buffers:{color:l,depth:c,stencil:o},enable:be,disable:Qe,bindFramebuffer:gi,drawBuffers:bi,useProgram:Zi,setBlending:zt,setMaterial:jn,setFlipSided:Ft,setCullFace:Ai,setLineWidth:oi,setPolygonOffset:ti,setScissorTest:ke,activeTexture:mt,bindTexture:st,unbindTexture:Ht,compressedTexImage2D:re,compressedTexImage3D:ae,texImage2D:Be,texImage3D:Yt,updateUBOMapping:xi,uniformBlockBinding:ci,texStorage2D:yi,texStorage3D:ue,texSubImage2D:ie,texSubImage3D:$e,compressedTexSubImage2D:Ut,compressedTexSubImage3D:Ie,scissor:ge,viewport:ne,reset:Re}}function XS(n,t,e,i){const s=wU(i);switch(e){case sA:return n*t;case aA:return n*t;case oA:return n*t*2;case t1:return n*t/s.components*s.byteLength;case p0:return n*t/s.components*s.byteLength;case lA:return n*t*2/s.components*s.byteLength;case e1:return n*t*2/s.components*s.byteLength;case rA:return n*t*3/s.components*s.byteLength;case Lr:return n*t*4/s.components*s.byteLength;case i1:return n*t*4/s.components*s.byteLength;case Tg:case Eg:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case Ag:case Cg:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Ev:case Cv:return Math.max(n,16)*Math.max(t,8)/4;case Tv:case Av:return Math.max(n,8)*Math.max(t,8)/2;case Pv:case Iv:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case Rv:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Dv:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Lv:return Math.floor((n+4)/5)*Math.floor((t+3)/4)*16;case kv:return Math.floor((n+4)/5)*Math.floor((t+4)/5)*16;case Fv:return Math.floor((n+5)/6)*Math.floor((t+4)/5)*16;case zv:return Math.floor((n+5)/6)*Math.floor((t+5)/6)*16;case Ov:return Math.floor((n+7)/8)*Math.floor((t+4)/5)*16;case Bv:return Math.floor((n+7)/8)*Math.floor((t+5)/6)*16;case Nv:return Math.floor((n+7)/8)*Math.floor((t+7)/8)*16;case Uv:return Math.floor((n+9)/10)*Math.floor((t+4)/5)*16;case Vv:return Math.floor((n+9)/10)*Math.floor((t+5)/6)*16;case Gv:return Math.floor((n+9)/10)*Math.floor((t+7)/8)*16;case Hv:return Math.floor((n+9)/10)*Math.floor((t+9)/10)*16;case jv:return Math.floor((n+11)/12)*Math.floor((t+9)/10)*16;case Wv:return Math.floor((n+11)/12)*Math.floor((t+11)/12)*16;case Pg:case qv:case Xv:return Math.ceil(n/4)*Math.ceil(t/4)*16;case cA:case $v:return Math.ceil(n/4)*Math.ceil(t/4)*8;case Zv:case Yv:return Math.ceil(n/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function wU(n){switch(n){case jo:case eA:return{byteLength:1,components:1};case Bp:case iA:case am:return{byteLength:2,components:1};case Jb:case Qb:return{byteLength:2,components:4};case tc:case Kb:case ia:return{byteLength:4,components:1};case nA:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function MU(n,t,e,i,s,l,c){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new si,x=new WeakMap;let v;const b=new WeakMap;let E=!1;try{E=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function D(mt,st){return E?new OffscreenCanvas(mt,st):Vp("canvas")}function k(mt,st,Ht){let re=1;const ae=ke(mt);if((ae.width>Ht||ae.height>Ht)&&(re=Ht/Math.max(ae.width,ae.height)),re<1)if(typeof HTMLImageElement<"u"&&mt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&mt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&mt instanceof ImageBitmap||typeof VideoFrame<"u"&&mt instanceof VideoFrame){const ie=Math.floor(re*ae.width),$e=Math.floor(re*ae.height);v===void 0&&(v=D(ie,$e));const Ut=st?D(ie,$e):v;return Ut.width=ie,Ut.height=$e,Ut.getContext("2d").drawImage(mt,0,0,ie,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ae.width+"x"+ae.height+") to ("+ie+"x"+$e+")."),Ut}else return"data"in mt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ae.width+"x"+ae.height+")."),mt;return mt}function P(mt){return mt.generateMipmaps}function I(mt){n.generateMipmap(mt)}function V(mt){return mt.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:mt.isWebGL3DRenderTarget?n.TEXTURE_3D:mt.isWebGLArrayRenderTarget||mt.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function U(mt,st,Ht,re,ae=!1){if(mt!==null){if(n[mt]!==void 0)return n[mt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+mt+"'")}let ie=st;if(st===n.RED&&(Ht===n.FLOAT&&(ie=n.R32F),Ht===n.HALF_FLOAT&&(ie=n.R16F),Ht===n.UNSIGNED_BYTE&&(ie=n.R8)),st===n.RED_INTEGER&&(Ht===n.UNSIGNED_BYTE&&(ie=n.R8UI),Ht===n.UNSIGNED_SHORT&&(ie=n.R16UI),Ht===n.UNSIGNED_INT&&(ie=n.R32UI),Ht===n.BYTE&&(ie=n.R8I),Ht===n.SHORT&&(ie=n.R16I),Ht===n.INT&&(ie=n.R32I)),st===n.RG&&(Ht===n.FLOAT&&(ie=n.RG32F),Ht===n.HALF_FLOAT&&(ie=n.RG16F),Ht===n.UNSIGNED_BYTE&&(ie=n.RG8)),st===n.RG_INTEGER&&(Ht===n.UNSIGNED_BYTE&&(ie=n.RG8UI),Ht===n.UNSIGNED_SHORT&&(ie=n.RG16UI),Ht===n.UNSIGNED_INT&&(ie=n.RG32UI),Ht===n.BYTE&&(ie=n.RG8I),Ht===n.SHORT&&(ie=n.RG16I),Ht===n.INT&&(ie=n.RG32I)),st===n.RGB_INTEGER&&(Ht===n.UNSIGNED_BYTE&&(ie=n.RGB8UI),Ht===n.UNSIGNED_SHORT&&(ie=n.RGB16UI),Ht===n.UNSIGNED_INT&&(ie=n.RGB32UI),Ht===n.BYTE&&(ie=n.RGB8I),Ht===n.SHORT&&(ie=n.RGB16I),Ht===n.INT&&(ie=n.RGB32I)),st===n.RGBA_INTEGER&&(Ht===n.UNSIGNED_BYTE&&(ie=n.RGBA8UI),Ht===n.UNSIGNED_SHORT&&(ie=n.RGBA16UI),Ht===n.UNSIGNED_INT&&(ie=n.RGBA32UI),Ht===n.BYTE&&(ie=n.RGBA8I),Ht===n.SHORT&&(ie=n.RGBA16I),Ht===n.INT&&(ie=n.RGBA32I)),st===n.RGB&&Ht===n.UNSIGNED_INT_5_9_9_9_REV&&(ie=n.RGB9_E5),st===n.RGBA){const $e=ae?m0:ji.getTransfer(re);Ht===n.FLOAT&&(ie=n.RGBA32F),Ht===n.HALF_FLOAT&&(ie=n.RGBA16F),Ht===n.UNSIGNED_BYTE&&(ie=$e===_n?n.SRGB8_ALPHA8:n.RGBA8),Ht===n.UNSIGNED_SHORT_4_4_4_4&&(ie=n.RGBA4),Ht===n.UNSIGNED_SHORT_5_5_5_1&&(ie=n.RGB5_A1)}return(ie===n.R16F||ie===n.R32F||ie===n.RG16F||ie===n.RG32F||ie===n.RGBA16F||ie===n.RGBA32F)&&t.get("EXT_color_buffer_float"),ie}function B(mt,st){let Ht;return mt?st===null||st===tc||st===fd?Ht=n.DEPTH24_STENCIL8:st===ia?Ht=n.DEPTH32F_STENCIL8:st===Bp&&(Ht=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):st===null||st===tc||st===fd?Ht=n.DEPTH_COMPONENT24:st===ia?Ht=n.DEPTH_COMPONENT32F:st===Bp&&(Ht=n.DEPTH_COMPONENT16),Ht}function Z(mt,st){return P(mt)===!0||mt.isFramebufferTexture&&mt.minFilter!==mr&&mt.minFilter!==ea?Math.log2(Math.max(st.width,st.height))+1:mt.mipmaps!==void 0&&mt.mipmaps.length>0?mt.mipmaps.length:mt.isCompressedTexture&&Array.isArray(mt.image)?st.mipmaps.length:1}function Y(mt){const st=mt.target;st.removeEventListener("dispose",Y),nt(st),st.isVideoTexture&&x.delete(st)}function K(mt){const st=mt.target;st.removeEventListener("dispose",K),J(st)}function nt(mt){const st=i.get(mt);if(st.__webglInit===void 0)return;const Ht=mt.source,re=b.get(Ht);if(re){const ae=re[st.__cacheKey];ae.usedTimes--,ae.usedTimes===0&&q(mt),Object.keys(re).length===0&&b.delete(Ht)}i.remove(mt)}function q(mt){const st=i.get(mt);n.deleteTexture(st.__webglTexture);const Ht=mt.source,re=b.get(Ht);delete re[st.__cacheKey],c.memory.textures--}function J(mt){const st=i.get(mt);if(mt.depthTexture&&(mt.depthTexture.dispose(),i.remove(mt.depthTexture)),mt.isWebGLCubeRenderTarget)for(let re=0;re<6;re++){if(Array.isArray(st.__webglFramebuffer[re]))for(let ae=0;ae<st.__webglFramebuffer[re].length;ae++)n.deleteFramebuffer(st.__webglFramebuffer[re][ae]);else n.deleteFramebuffer(st.__webglFramebuffer[re]);st.__webglDepthbuffer&&n.deleteRenderbuffer(st.__webglDepthbuffer[re])}else{if(Array.isArray(st.__webglFramebuffer))for(let re=0;re<st.__webglFramebuffer.length;re++)n.deleteFramebuffer(st.__webglFramebuffer[re]);else n.deleteFramebuffer(st.__webglFramebuffer);if(st.__webglDepthbuffer&&n.deleteRenderbuffer(st.__webglDepthbuffer),st.__webglMultisampledFramebuffer&&n.deleteFramebuffer(st.__webglMultisampledFramebuffer),st.__webglColorRenderbuffer)for(let re=0;re<st.__webglColorRenderbuffer.length;re++)st.__webglColorRenderbuffer[re]&&n.deleteRenderbuffer(st.__webglColorRenderbuffer[re]);st.__webglDepthRenderbuffer&&n.deleteRenderbuffer(st.__webglDepthRenderbuffer)}const Ht=mt.textures;for(let re=0,ae=Ht.length;re<ae;re++){const ie=i.get(Ht[re]);ie.__webglTexture&&(n.deleteTexture(ie.__webglTexture),c.memory.textures--),i.remove(Ht[re])}i.remove(mt)}let ct=0;function St(){ct=0}function wt(){const mt=ct;return mt>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+mt+" texture units while this GPU supports only "+s.maxTextures),ct+=1,mt}function Pt(mt){const st=[];return st.push(mt.wrapS),st.push(mt.wrapT),st.push(mt.wrapR||0),st.push(mt.magFilter),st.push(mt.minFilter),st.push(mt.anisotropy),st.push(mt.internalFormat),st.push(mt.format),st.push(mt.type),st.push(mt.generateMipmaps),st.push(mt.premultiplyAlpha),st.push(mt.flipY),st.push(mt.unpackAlignment),st.push(mt.colorSpace),st.join()}function Gt(mt,st){const Ht=i.get(mt);if(mt.isVideoTexture&&oi(mt),mt.isRenderTargetTexture===!1&&mt.version>0&&Ht.__version!==mt.version){const re=mt.image;if(re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Jt(Ht,mt,st);return}}e.bindTexture(n.TEXTURE_2D,Ht.__webglTexture,n.TEXTURE0+st)}function Nt(mt,st){const Ht=i.get(mt);if(mt.version>0&&Ht.__version!==mt.version){Jt(Ht,mt,st);return}e.bindTexture(n.TEXTURE_2D_ARRAY,Ht.__webglTexture,n.TEXTURE0+st)}function Zt(mt,st){const Ht=i.get(mt);if(mt.version>0&&Ht.__version!==mt.version){Jt(Ht,mt,st);return}e.bindTexture(n.TEXTURE_3D,Ht.__webglTexture,n.TEXTURE0+st)}function qt(mt,st){const Ht=i.get(mt);if(mt.version>0&&Ht.__version!==mt.version){le(Ht,mt,st);return}e.bindTexture(n.TEXTURE_CUBE_MAP,Ht.__webglTexture,n.TEXTURE0+st)}const me={[dd]:n.REPEAT,[Ul]:n.CLAMP_TO_EDGE,[Gg]:n.MIRRORED_REPEAT},Ee={[mr]:n.NEAREST,[tA]:n.NEAREST_MIPMAP_NEAREST,[dp]:n.NEAREST_MIPMAP_LINEAR,[ea]:n.LINEAR,[Sg]:n.LINEAR_MIPMAP_NEAREST,[No]:n.LINEAR_MIPMAP_LINEAR},Le={[Qk]:n.NEVER,[rF]:n.ALWAYS,[tF]:n.LESS,[dA]:n.LEQUAL,[eF]:n.EQUAL,[sF]:n.GEQUAL,[iF]:n.GREATER,[nF]:n.NOTEQUAL};function ri(mt,st){if(st.type===ia&&t.has("OES_texture_float_linear")===!1&&(st.magFilter===ea||st.magFilter===Sg||st.magFilter===dp||st.magFilter===No||st.minFilter===ea||st.minFilter===Sg||st.minFilter===dp||st.minFilter===No)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(mt,n.TEXTURE_WRAP_S,me[st.wrapS]),n.texParameteri(mt,n.TEXTURE_WRAP_T,me[st.wrapT]),(mt===n.TEXTURE_3D||mt===n.TEXTURE_2D_ARRAY)&&n.texParameteri(mt,n.TEXTURE_WRAP_R,me[st.wrapR]),n.texParameteri(mt,n.TEXTURE_MAG_FILTER,Ee[st.magFilter]),n.texParameteri(mt,n.TEXTURE_MIN_FILTER,Ee[st.minFilter]),st.compareFunction&&(n.texParameteri(mt,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(mt,n.TEXTURE_COMPARE_FUNC,Le[st.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(st.magFilter===mr||st.minFilter!==dp&&st.minFilter!==No||st.type===ia&&t.has("OES_texture_float_linear")===!1)return;if(st.anisotropy>1||i.get(st).__currentAnisotropy){const Ht=t.get("EXT_texture_filter_anisotropic");n.texParameterf(mt,Ht.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(st.anisotropy,s.getMaxAnisotropy())),i.get(st).__currentAnisotropy=st.anisotropy}}}function Ni(mt,st){let Ht=!1;mt.__webglInit===void 0&&(mt.__webglInit=!0,st.addEventListener("dispose",Y));const re=st.source;let ae=b.get(re);ae===void 0&&(ae={},b.set(re,ae));const ie=Pt(st);if(ie!==mt.__cacheKey){ae[ie]===void 0&&(ae[ie]={texture:n.createTexture(),usedTimes:0},c.memory.textures++,Ht=!0),ae[ie].usedTimes++;const $e=ae[mt.__cacheKey];$e!==void 0&&(ae[mt.__cacheKey].usedTimes--,$e.usedTimes===0&&q(st)),mt.__cacheKey=ie,mt.__webglTexture=ae[ie].texture}return Ht}function Jt(mt,st,Ht){let re=n.TEXTURE_2D;(st.isDataArrayTexture||st.isCompressedArrayTexture)&&(re=n.TEXTURE_2D_ARRAY),st.isData3DTexture&&(re=n.TEXTURE_3D);const ae=Ni(mt,st),ie=st.source;e.bindTexture(re,mt.__webglTexture,n.TEXTURE0+Ht);const $e=i.get(ie);if(ie.version!==$e.__version||ae===!0){e.activeTexture(n.TEXTURE0+Ht);const Ut=ji.getPrimaries(ji.workingColorSpace),Ie=st.colorSpace===Nl?null:ji.getPrimaries(st.colorSpace),yi=st.colorSpace===Nl||Ut===Ie?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,st.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,st.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,st.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,yi);let ue=k(st.image,!1,s.maxTextureSize);ue=ti(st,ue);const Be=l.convert(st.format,st.colorSpace),Yt=l.convert(st.type);let ge=U(st.internalFormat,Be,Yt,st.colorSpace,st.isVideoTexture);ri(re,st);let ne;const xi=st.mipmaps,ci=st.isVideoTexture!==!0,Re=$e.__version===void 0||ae===!0,It=ie.dataReady,Me=Z(st,ue);if(st.isDepthTexture)ge=B(st.format===pd,st.type),Re&&(ci?e.texStorage2D(n.TEXTURE_2D,1,ge,ue.width,ue.height):e.texImage2D(n.TEXTURE_2D,0,ge,ue.width,ue.height,0,Be,Yt,null));else if(st.isDataTexture)if(xi.length>0){ci&&Re&&e.texStorage2D(n.TEXTURE_2D,Me,ge,xi[0].width,xi[0].height);for(let Kt=0,se=xi.length;Kt<se;Kt++)ne=xi[Kt],ci?It&&e.texSubImage2D(n.TEXTURE_2D,Kt,0,0,ne.width,ne.height,Be,Yt,ne.data):e.texImage2D(n.TEXTURE_2D,Kt,ge,ne.width,ne.height,0,Be,Yt,ne.data);st.generateMipmaps=!1}else ci?(Re&&e.texStorage2D(n.TEXTURE_2D,Me,ge,ue.width,ue.height),It&&e.texSubImage2D(n.TEXTURE_2D,0,0,0,ue.width,ue.height,Be,Yt,ue.data)):e.texImage2D(n.TEXTURE_2D,0,ge,ue.width,ue.height,0,Be,Yt,ue.data);else if(st.isCompressedTexture)if(st.isCompressedArrayTexture){ci&&Re&&e.texStorage3D(n.TEXTURE_2D_ARRAY,Me,ge,xi[0].width,xi[0].height,ue.depth);for(let Kt=0,se=xi.length;Kt<se;Kt++)if(ne=xi[Kt],st.format!==Lr)if(Be!==null)if(ci){if(It)if(st.layerUpdates.size>0){const lt=XS(ne.width,ne.height,st.format,st.type);for(const W of st.layerUpdates){const X=ne.data.subarray(W*lt/ne.data.BYTES_PER_ELEMENT,(W+1)*lt/ne.data.BYTES_PER_ELEMENT);e.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,W,ne.width,ne.height,1,Be,X)}st.clearLayerUpdates()}else e.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,ne.width,ne.height,ue.depth,Be,ne.data)}else e.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Kt,ge,ne.width,ne.height,ue.depth,0,ne.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ci?It&&e.texSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,ne.width,ne.height,ue.depth,Be,Yt,ne.data):e.texImage3D(n.TEXTURE_2D_ARRAY,Kt,ge,ne.width,ne.height,ue.depth,0,Be,Yt,ne.data)}else{ci&&Re&&e.texStorage2D(n.TEXTURE_2D,Me,ge,xi[0].width,xi[0].height);for(let Kt=0,se=xi.length;Kt<se;Kt++)ne=xi[Kt],st.format!==Lr?Be!==null?ci?It&&e.compressedTexSubImage2D(n.TEXTURE_2D,Kt,0,0,ne.width,ne.height,Be,ne.data):e.compressedTexImage2D(n.TEXTURE_2D,Kt,ge,ne.width,ne.height,0,ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ci?It&&e.texSubImage2D(n.TEXTURE_2D,Kt,0,0,ne.width,ne.height,Be,Yt,ne.data):e.texImage2D(n.TEXTURE_2D,Kt,ge,ne.width,ne.height,0,Be,Yt,ne.data)}else if(st.isDataArrayTexture)if(ci){if(Re&&e.texStorage3D(n.TEXTURE_2D_ARRAY,Me,ge,ue.width,ue.height,ue.depth),It)if(st.layerUpdates.size>0){const Kt=XS(ue.width,ue.height,st.format,st.type);for(const se of st.layerUpdates){const lt=ue.data.subarray(se*Kt/ue.data.BYTES_PER_ELEMENT,(se+1)*Kt/ue.data.BYTES_PER_ELEMENT);e.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,se,ue.width,ue.height,1,Be,Yt,lt)}st.clearLayerUpdates()}else e.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ue.width,ue.height,ue.depth,Be,Yt,ue.data)}else e.texImage3D(n.TEXTURE_2D_ARRAY,0,ge,ue.width,ue.height,ue.depth,0,Be,Yt,ue.data);else if(st.isData3DTexture)ci?(Re&&e.texStorage3D(n.TEXTURE_3D,Me,ge,ue.width,ue.height,ue.depth),It&&e.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ue.width,ue.height,ue.depth,Be,Yt,ue.data)):e.texImage3D(n.TEXTURE_3D,0,ge,ue.width,ue.height,ue.depth,0,Be,Yt,ue.data);else if(st.isFramebufferTexture){if(Re)if(ci)e.texStorage2D(n.TEXTURE_2D,Me,ge,ue.width,ue.height);else{let Kt=ue.width,se=ue.height;for(let lt=0;lt<Me;lt++)e.texImage2D(n.TEXTURE_2D,lt,ge,Kt,se,0,Be,Yt,null),Kt>>=1,se>>=1}}else if(xi.length>0){if(ci&&Re){const Kt=ke(xi[0]);e.texStorage2D(n.TEXTURE_2D,Me,ge,Kt.width,Kt.height)}for(let Kt=0,se=xi.length;Kt<se;Kt++)ne=xi[Kt],ci?It&&e.texSubImage2D(n.TEXTURE_2D,Kt,0,0,Be,Yt,ne):e.texImage2D(n.TEXTURE_2D,Kt,ge,Be,Yt,ne);st.generateMipmaps=!1}else if(ci){if(Re){const Kt=ke(ue);e.texStorage2D(n.TEXTURE_2D,Me,ge,Kt.width,Kt.height)}It&&e.texSubImage2D(n.TEXTURE_2D,0,0,0,Be,Yt,ue)}else e.texImage2D(n.TEXTURE_2D,0,ge,Be,Yt,ue);P(st)&&I(re),$e.__version=ie.version,st.onUpdate&&st.onUpdate(st)}mt.__version=st.version}function le(mt,st,Ht){if(st.image.length!==6)return;const re=Ni(mt,st),ae=st.source;e.bindTexture(n.TEXTURE_CUBE_MAP,mt.__webglTexture,n.TEXTURE0+Ht);const ie=i.get(ae);if(ae.version!==ie.__version||re===!0){e.activeTexture(n.TEXTURE0+Ht);const $e=ji.getPrimaries(ji.workingColorSpace),Ut=st.colorSpace===Nl?null:ji.getPrimaries(st.colorSpace),Ie=st.colorSpace===Nl||$e===Ut?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,st.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,st.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,st.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ie);const yi=st.isCompressedTexture||st.image[0].isCompressedTexture,ue=st.image[0]&&st.image[0].isDataTexture,Be=[];for(let se=0;se<6;se++)!yi&&!ue?Be[se]=k(st.image[se],!0,s.maxCubemapSize):Be[se]=ue?st.image[se].image:st.image[se],Be[se]=ti(st,Be[se]);const Yt=Be[0],ge=l.convert(st.format,st.colorSpace),ne=l.convert(st.type),xi=U(st.internalFormat,ge,ne,st.colorSpace),ci=st.isVideoTexture!==!0,Re=ie.__version===void 0||re===!0,It=ae.dataReady;let Me=Z(st,Yt);ri(n.TEXTURE_CUBE_MAP,st);let Kt;if(yi){ci&&Re&&e.texStorage2D(n.TEXTURE_CUBE_MAP,Me,xi,Yt.width,Yt.height);for(let se=0;se<6;se++){Kt=Be[se].mipmaps;for(let lt=0;lt<Kt.length;lt++){const W=Kt[lt];st.format!==Lr?ge!==null?ci?It&&e.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt,0,0,W.width,W.height,ge,W.data):e.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt,xi,W.width,W.height,0,W.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ci?It&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt,0,0,W.width,W.height,ge,ne,W.data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt,xi,W.width,W.height,0,ge,ne,W.data)}}}else{if(Kt=st.mipmaps,ci&&Re){Kt.length>0&&Me++;const se=ke(Be[0]);e.texStorage2D(n.TEXTURE_CUBE_MAP,Me,xi,se.width,se.height)}for(let se=0;se<6;se++)if(ue){ci?It&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,0,0,Be[se].width,Be[se].height,ge,ne,Be[se].data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,xi,Be[se].width,Be[se].height,0,ge,ne,Be[se].data);for(let lt=0;lt<Kt.length;lt++){const X=Kt[lt].image[se].image;ci?It&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt+1,0,0,X.width,X.height,ge,ne,X.data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt+1,xi,X.width,X.height,0,ge,ne,X.data)}}else{ci?It&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,0,0,ge,ne,Be[se]):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,xi,ge,ne,Be[se]);for(let lt=0;lt<Kt.length;lt++){const W=Kt[lt];ci?It&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt+1,0,0,ge,ne,W.image[se]):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+se,lt+1,xi,ge,ne,W.image[se])}}}P(st)&&I(n.TEXTURE_CUBE_MAP),ie.__version=ae.version,st.onUpdate&&st.onUpdate(st)}mt.__version=st.version}function qe(mt,st,Ht,re,ae,ie){const $e=l.convert(Ht.format,Ht.colorSpace),Ut=l.convert(Ht.type),Ie=U(Ht.internalFormat,$e,Ut,Ht.colorSpace),yi=i.get(st),ue=i.get(Ht);if(ue.__renderTarget=st,!yi.__hasExternalTextures){const Be=Math.max(1,st.width>>ie),Yt=Math.max(1,st.height>>ie);ae===n.TEXTURE_3D||ae===n.TEXTURE_2D_ARRAY?e.texImage3D(ae,ie,Ie,Be,Yt,st.depth,0,$e,Ut,null):e.texImage2D(ae,ie,Ie,Be,Yt,0,$e,Ut,null)}e.bindFramebuffer(n.FRAMEBUFFER,mt),Ai(st)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,re,ae,ue.__webglTexture,0,Ft(st)):(ae===n.TEXTURE_2D||ae>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ae<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,re,ae,ue.__webglTexture,ie),e.bindFramebuffer(n.FRAMEBUFFER,null)}function be(mt,st,Ht){if(n.bindRenderbuffer(n.RENDERBUFFER,mt),st.depthBuffer){const re=st.depthTexture,ae=re&&re.isDepthTexture?re.type:null,ie=B(st.stencilBuffer,ae),$e=st.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ut=Ft(st);Ai(st)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ut,ie,st.width,st.height):Ht?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ut,ie,st.width,st.height):n.renderbufferStorage(n.RENDERBUFFER,ie,st.width,st.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,$e,n.RENDERBUFFER,mt)}else{const re=st.textures;for(let ae=0;ae<re.length;ae++){const ie=re[ae],$e=l.convert(ie.format,ie.colorSpace),Ut=l.convert(ie.type),Ie=U(ie.internalFormat,$e,Ut,ie.colorSpace),yi=Ft(st);Ht&&Ai(st)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,yi,Ie,st.width,st.height):Ai(st)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,yi,Ie,st.width,st.height):n.renderbufferStorage(n.RENDERBUFFER,Ie,st.width,st.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Qe(mt,st){if(st&&st.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(n.FRAMEBUFFER,mt),!(st.depthTexture&&st.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const re=i.get(st.depthTexture);re.__renderTarget=st,(!re.__webglTexture||st.depthTexture.image.width!==st.width||st.depthTexture.image.height!==st.height)&&(st.depthTexture.image.width=st.width,st.depthTexture.image.height=st.height,st.depthTexture.needsUpdate=!0),Gt(st.depthTexture,0);const ae=re.__webglTexture,ie=Ft(st);if(st.depthTexture.format===Qu)Ai(st)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ae,0,ie):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ae,0);else if(st.depthTexture.format===pd)Ai(st)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ae,0,ie):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ae,0);else throw new Error("Unknown depthTexture format")}function gi(mt){const st=i.get(mt),Ht=mt.isWebGLCubeRenderTarget===!0;if(st.__boundDepthTexture!==mt.depthTexture){const re=mt.depthTexture;if(st.__depthDisposeCallback&&st.__depthDisposeCallback(),re){const ae=()=>{delete st.__boundDepthTexture,delete st.__depthDisposeCallback,re.removeEventListener("dispose",ae)};re.addEventListener("dispose",ae),st.__depthDisposeCallback=ae}st.__boundDepthTexture=re}if(mt.depthTexture&&!st.__autoAllocateDepthBuffer){if(Ht)throw new Error("target.depthTexture not supported in Cube render targets");Qe(st.__webglFramebuffer,mt)}else if(Ht){st.__webglDepthbuffer=[];for(let re=0;re<6;re++)if(e.bindFramebuffer(n.FRAMEBUFFER,st.__webglFramebuffer[re]),st.__webglDepthbuffer[re]===void 0)st.__webglDepthbuffer[re]=n.createRenderbuffer(),be(st.__webglDepthbuffer[re],mt,!1);else{const ae=mt.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ie=st.__webglDepthbuffer[re];n.bindRenderbuffer(n.RENDERBUFFER,ie),n.framebufferRenderbuffer(n.FRAMEBUFFER,ae,n.RENDERBUFFER,ie)}}else if(e.bindFramebuffer(n.FRAMEBUFFER,st.__webglFramebuffer),st.__webglDepthbuffer===void 0)st.__webglDepthbuffer=n.createRenderbuffer(),be(st.__webglDepthbuffer,mt,!1);else{const re=mt.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ae=st.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ae),n.framebufferRenderbuffer(n.FRAMEBUFFER,re,n.RENDERBUFFER,ae)}e.bindFramebuffer(n.FRAMEBUFFER,null)}function bi(mt,st,Ht){const re=i.get(mt);st!==void 0&&qe(re.__webglFramebuffer,mt,mt.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Ht!==void 0&&gi(mt)}function Zi(mt){const st=mt.texture,Ht=i.get(mt),re=i.get(st);mt.addEventListener("dispose",K);const ae=mt.textures,ie=mt.isWebGLCubeRenderTarget===!0,$e=ae.length>1;if($e||(re.__webglTexture===void 0&&(re.__webglTexture=n.createTexture()),re.__version=st.version,c.memory.textures++),ie){Ht.__webglFramebuffer=[];for(let Ut=0;Ut<6;Ut++)if(st.mipmaps&&st.mipmaps.length>0){Ht.__webglFramebuffer[Ut]=[];for(let Ie=0;Ie<st.mipmaps.length;Ie++)Ht.__webglFramebuffer[Ut][Ie]=n.createFramebuffer()}else Ht.__webglFramebuffer[Ut]=n.createFramebuffer()}else{if(st.mipmaps&&st.mipmaps.length>0){Ht.__webglFramebuffer=[];for(let Ut=0;Ut<st.mipmaps.length;Ut++)Ht.__webglFramebuffer[Ut]=n.createFramebuffer()}else Ht.__webglFramebuffer=n.createFramebuffer();if($e)for(let Ut=0,Ie=ae.length;Ut<Ie;Ut++){const yi=i.get(ae[Ut]);yi.__webglTexture===void 0&&(yi.__webglTexture=n.createTexture(),c.memory.textures++)}if(mt.samples>0&&Ai(mt)===!1){Ht.__webglMultisampledFramebuffer=n.createFramebuffer(),Ht.__webglColorRenderbuffer=[],e.bindFramebuffer(n.FRAMEBUFFER,Ht.__webglMultisampledFramebuffer);for(let Ut=0;Ut<ae.length;Ut++){const Ie=ae[Ut];Ht.__webglColorRenderbuffer[Ut]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Ht.__webglColorRenderbuffer[Ut]);const yi=l.convert(Ie.format,Ie.colorSpace),ue=l.convert(Ie.type),Be=U(Ie.internalFormat,yi,ue,Ie.colorSpace,mt.isXRRenderTarget===!0),Yt=Ft(mt);n.renderbufferStorageMultisample(n.RENDERBUFFER,Yt,Be,mt.width,mt.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ut,n.RENDERBUFFER,Ht.__webglColorRenderbuffer[Ut])}n.bindRenderbuffer(n.RENDERBUFFER,null),mt.depthBuffer&&(Ht.__webglDepthRenderbuffer=n.createRenderbuffer(),be(Ht.__webglDepthRenderbuffer,mt,!0)),e.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ie){e.bindTexture(n.TEXTURE_CUBE_MAP,re.__webglTexture),ri(n.TEXTURE_CUBE_MAP,st);for(let Ut=0;Ut<6;Ut++)if(st.mipmaps&&st.mipmaps.length>0)for(let Ie=0;Ie<st.mipmaps.length;Ie++)qe(Ht.__webglFramebuffer[Ut][Ie],mt,st,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,Ie);else qe(Ht.__webglFramebuffer[Ut],mt,st,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0);P(st)&&I(n.TEXTURE_CUBE_MAP),e.unbindTexture()}else if($e){for(let Ut=0,Ie=ae.length;Ut<Ie;Ut++){const yi=ae[Ut],ue=i.get(yi);e.bindTexture(n.TEXTURE_2D,ue.__webglTexture),ri(n.TEXTURE_2D,yi),qe(Ht.__webglFramebuffer,mt,yi,n.COLOR_ATTACHMENT0+Ut,n.TEXTURE_2D,0),P(yi)&&I(n.TEXTURE_2D)}e.unbindTexture()}else{let Ut=n.TEXTURE_2D;if((mt.isWebGL3DRenderTarget||mt.isWebGLArrayRenderTarget)&&(Ut=mt.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),e.bindTexture(Ut,re.__webglTexture),ri(Ut,st),st.mipmaps&&st.mipmaps.length>0)for(let Ie=0;Ie<st.mipmaps.length;Ie++)qe(Ht.__webglFramebuffer[Ie],mt,st,n.COLOR_ATTACHMENT0,Ut,Ie);else qe(Ht.__webglFramebuffer,mt,st,n.COLOR_ATTACHMENT0,Ut,0);P(st)&&I(Ut),e.unbindTexture()}mt.depthBuffer&&gi(mt)}function Ei(mt){const st=mt.textures;for(let Ht=0,re=st.length;Ht<re;Ht++){const ae=st[Ht];if(P(ae)){const ie=V(mt),$e=i.get(ae).__webglTexture;e.bindTexture(ie,$e),I(ie),e.unbindTexture()}}}const $i=[],zt=[];function jn(mt){if(mt.samples>0){if(Ai(mt)===!1){const st=mt.textures,Ht=mt.width,re=mt.height;let ae=n.COLOR_BUFFER_BIT;const ie=mt.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,$e=i.get(mt),Ut=st.length>1;if(Ut)for(let Ie=0;Ie<st.length;Ie++)e.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ie,n.RENDERBUFFER,null),e.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ie,n.TEXTURE_2D,null,0);e.bindFramebuffer(n.READ_FRAMEBUFFER,$e.__webglMultisampledFramebuffer),e.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglFramebuffer);for(let Ie=0;Ie<st.length;Ie++){if(mt.resolveDepthBuffer&&(mt.depthBuffer&&(ae|=n.DEPTH_BUFFER_BIT),mt.stencilBuffer&&mt.resolveStencilBuffer&&(ae|=n.STENCIL_BUFFER_BIT)),Ut){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,$e.__webglColorRenderbuffer[Ie]);const yi=i.get(st[Ie]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,yi,0)}n.blitFramebuffer(0,0,Ht,re,0,0,Ht,re,ae,n.NEAREST),p===!0&&($i.length=0,zt.length=0,$i.push(n.COLOR_ATTACHMENT0+Ie),mt.depthBuffer&&mt.resolveDepthBuffer===!1&&($i.push(ie),zt.push(ie),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,zt)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,$i))}if(e.bindFramebuffer(n.READ_FRAMEBUFFER,null),e.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ut)for(let Ie=0;Ie<st.length;Ie++){e.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ie,n.RENDERBUFFER,$e.__webglColorRenderbuffer[Ie]);const yi=i.get(st[Ie]).__webglTexture;e.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ie,n.TEXTURE_2D,yi,0)}e.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglMultisampledFramebuffer)}else if(mt.depthBuffer&&mt.resolveDepthBuffer===!1&&p){const st=mt.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[st])}}}function Ft(mt){return Math.min(s.maxSamples,mt.samples)}function Ai(mt){const st=i.get(mt);return mt.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&st.__useRenderToTexture!==!1}function oi(mt){const st=c.render.frame;x.get(mt)!==st&&(x.set(mt,st),mt.update())}function ti(mt,st){const Ht=mt.colorSpace,re=mt.format,ae=mt.type;return mt.isCompressedTexture===!0||mt.isVideoTexture===!0||Ht!==yr&&Ht!==Nl&&(ji.getTransfer(Ht)===_n?(re!==Lr||ae!==jo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ht)),st}function ke(mt){return typeof HTMLImageElement<"u"&&mt instanceof HTMLImageElement?(m.width=mt.naturalWidth||mt.width,m.height=mt.naturalHeight||mt.height):typeof VideoFrame<"u"&&mt instanceof VideoFrame?(m.width=mt.displayWidth,m.height=mt.displayHeight):(m.width=mt.width,m.height=mt.height),m}this.allocateTextureUnit=wt,this.resetTextureUnits=St,this.setTexture2D=Gt,this.setTexture2DArray=Nt,this.setTexture3D=Zt,this.setTextureCube=qt,this.rebindTextures=bi,this.setupRenderTarget=Zi,this.updateRenderTargetMipmap=Ei,this.updateMultisampleRenderTarget=jn,this.setupDepthRenderbuffer=gi,this.setupFrameBufferTexture=qe,this.useMultisampledRTT=Ai}function SU(n,t){function e(i,s=Nl){let l;const c=ji.getTransfer(s);if(i===jo)return n.UNSIGNED_BYTE;if(i===Jb)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Qb)return n.UNSIGNED_SHORT_5_5_5_1;if(i===nA)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===eA)return n.BYTE;if(i===iA)return n.SHORT;if(i===Bp)return n.UNSIGNED_SHORT;if(i===Kb)return n.INT;if(i===tc)return n.UNSIGNED_INT;if(i===ia)return n.FLOAT;if(i===am)return n.HALF_FLOAT;if(i===sA)return n.ALPHA;if(i===rA)return n.RGB;if(i===Lr)return n.RGBA;if(i===aA)return n.LUMINANCE;if(i===oA)return n.LUMINANCE_ALPHA;if(i===Qu)return n.DEPTH_COMPONENT;if(i===pd)return n.DEPTH_STENCIL;if(i===t1)return n.RED;if(i===p0)return n.RED_INTEGER;if(i===lA)return n.RG;if(i===e1)return n.RG_INTEGER;if(i===i1)return n.RGBA_INTEGER;if(i===Tg||i===Eg||i===Ag||i===Cg)if(c===_n)if(l=t.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(i===Tg)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Eg)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Ag)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Cg)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=t.get("WEBGL_compressed_texture_s3tc"),l!==null){if(i===Tg)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Eg)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ag)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Cg)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Tv||i===Ev||i===Av||i===Cv)if(l=t.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(i===Tv)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Ev)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Av)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Cv)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Pv||i===Iv||i===Rv)if(l=t.get("WEBGL_compressed_texture_etc"),l!==null){if(i===Pv||i===Iv)return c===_n?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(i===Rv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Dv||i===Lv||i===kv||i===Fv||i===zv||i===Ov||i===Bv||i===Nv||i===Uv||i===Vv||i===Gv||i===Hv||i===jv||i===Wv)if(l=t.get("WEBGL_compressed_texture_astc"),l!==null){if(i===Dv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Lv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===kv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Fv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===zv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Ov)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Bv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Nv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Uv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Vv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Gv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Hv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===jv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Wv)return c===_n?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Pg||i===qv||i===Xv)if(l=t.get("EXT_texture_compression_bptc"),l!==null){if(i===Pg)return c===_n?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===qv)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Xv)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===cA||i===$v||i===Zv||i===Yv)if(l=t.get("EXT_texture_compression_rgtc"),l!==null){if(i===Pg)return l.COMPRESSED_RED_RGTC1_EXT;if(i===$v)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Zv)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Yv)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===fd?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:e}}class TU extends hr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class eh extends Un{constructor(){super(),this.isGroup=!0,this.type="Group"}}const EU={type:"move"};class xx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new eh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new eh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new _t,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new _t),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new eh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new _t,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new _t),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let s=null,l=null,c=null;const o=this._targetRay,p=this._grip,m=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(m&&t.hand){c=!0;for(const k of t.hand.values()){const P=e.getJointPose(k,i),I=this._getHandJoint(m,k);P!==null&&(I.matrix.fromArray(P.transform.matrix),I.matrix.decompose(I.position,I.rotation,I.scale),I.matrixWorldNeedsUpdate=!0,I.jointRadius=P.radius),I.visible=P!==null}const x=m.joints["index-finger-tip"],v=m.joints["thumb-tip"],b=x.position.distanceTo(v.position),E=.02,D=.005;m.inputState.pinching&&b>E+D?(m.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!m.inputState.pinching&&b<=E-D&&(m.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else p!==null&&t.gripSpace&&(l=e.getPose(t.gripSpace,i),l!==null&&(p.matrix.fromArray(l.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,l.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(l.linearVelocity)):p.hasLinearVelocity=!1,l.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(l.angularVelocity)):p.hasAngularVelocity=!1));o!==null&&(s=e.getPose(t.targetRaySpace,i),s===null&&l!==null&&(s=l),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(EU)))}return o!==null&&(o.visible=s!==null),p!==null&&(p.visible=l!==null),m!==null&&(m.visible=c!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const i=new eh;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}const AU=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,CU=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class PU{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,i){if(this.texture===null){const s=new Ms,l=t.properties.get(s);l.__webglTexture=e.texture,(e.depthNear!=i.depthNear||e.depthFar!=i.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=s}}getMesh(t){if(this.texture!==null&&this.mesh===null){const e=t.cameras[0].viewport,i=new Ea({vertexShader:AU,fragmentShader:CU,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new os(new g0(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class IU extends ac{constructor(t,e){super();const i=this;let s=null,l=1,c=null,o="local-floor",p=1,m=null,x=null,v=null,b=null,E=null,D=null;const k=new PU,P=e.getContextAttributes();let I=null,V=null;const U=[],B=[],Z=new si;let Y=null;const K=new hr;K.viewport=new en;const nt=new hr;nt.viewport=new en;const q=[K,nt],J=new TU;let ct=null,St=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Jt){let le=U[Jt];return le===void 0&&(le=new xx,U[Jt]=le),le.getTargetRaySpace()},this.getControllerGrip=function(Jt){let le=U[Jt];return le===void 0&&(le=new xx,U[Jt]=le),le.getGripSpace()},this.getHand=function(Jt){let le=U[Jt];return le===void 0&&(le=new xx,U[Jt]=le),le.getHandSpace()};function wt(Jt){const le=B.indexOf(Jt.inputSource);if(le===-1)return;const qe=U[le];qe!==void 0&&(qe.update(Jt.inputSource,Jt.frame,m||c),qe.dispatchEvent({type:Jt.type,data:Jt.inputSource}))}function Pt(){s.removeEventListener("select",wt),s.removeEventListener("selectstart",wt),s.removeEventListener("selectend",wt),s.removeEventListener("squeeze",wt),s.removeEventListener("squeezestart",wt),s.removeEventListener("squeezeend",wt),s.removeEventListener("end",Pt),s.removeEventListener("inputsourceschange",Gt);for(let Jt=0;Jt<U.length;Jt++){const le=B[Jt];le!==null&&(B[Jt]=null,U[Jt].disconnect(le))}ct=null,St=null,k.reset(),t.setRenderTarget(I),E=null,b=null,v=null,s=null,V=null,Ni.stop(),i.isPresenting=!1,t.setPixelRatio(Y),t.setSize(Z.width,Z.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Jt){l=Jt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Jt){o=Jt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return m||c},this.setReferenceSpace=function(Jt){m=Jt},this.getBaseLayer=function(){return b!==null?b:E},this.getBinding=function(){return v},this.getFrame=function(){return D},this.getSession=function(){return s},this.setSession=async function(Jt){if(s=Jt,s!==null){if(I=t.getRenderTarget(),s.addEventListener("select",wt),s.addEventListener("selectstart",wt),s.addEventListener("selectend",wt),s.addEventListener("squeeze",wt),s.addEventListener("squeezestart",wt),s.addEventListener("squeezeend",wt),s.addEventListener("end",Pt),s.addEventListener("inputsourceschange",Gt),P.xrCompatible!==!0&&await e.makeXRCompatible(),Y=t.getPixelRatio(),t.getSize(Z),s.renderState.layers===void 0){const le={antialias:P.antialias,alpha:!0,depth:P.depth,stencil:P.stencil,framebufferScaleFactor:l};E=new XRWebGLLayer(s,e,le),s.updateRenderState({baseLayer:E}),t.setPixelRatio(1),t.setSize(E.framebufferWidth,E.framebufferHeight,!1),V=new uh(E.framebufferWidth,E.framebufferHeight,{format:Lr,type:jo,colorSpace:t.outputColorSpace,stencilBuffer:P.stencil})}else{let le=null,qe=null,be=null;P.depth&&(be=P.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,le=P.stencil?pd:Qu,qe=P.stencil?fd:tc);const Qe={colorFormat:e.RGBA8,depthFormat:be,scaleFactor:l};v=new XRWebGLBinding(s,e),b=v.createProjectionLayer(Qe),s.updateRenderState({layers:[b]}),t.setPixelRatio(1),t.setSize(b.textureWidth,b.textureHeight,!1),V=new uh(b.textureWidth,b.textureHeight,{format:Lr,type:jo,depthTexture:new MA(b.textureWidth,b.textureHeight,qe,void 0,void 0,void 0,void 0,void 0,void 0,le),stencilBuffer:P.stencil,colorSpace:t.outputColorSpace,samples:P.antialias?4:0,resolveDepthBuffer:b.ignoreDepthValues===!1})}V.isXRRenderTarget=!0,this.setFoveation(p),m=null,c=await s.requestReferenceSpace(o),Ni.setContext(s),Ni.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return k.getDepthTexture()};function Gt(Jt){for(let le=0;le<Jt.removed.length;le++){const qe=Jt.removed[le],be=B.indexOf(qe);be>=0&&(B[be]=null,U[be].disconnect(qe))}for(let le=0;le<Jt.added.length;le++){const qe=Jt.added[le];let be=B.indexOf(qe);if(be===-1){for(let gi=0;gi<U.length;gi++)if(gi>=B.length){B.push(qe),be=gi;break}else if(B[gi]===null){B[gi]=qe,be=gi;break}if(be===-1)break}const Qe=U[be];Qe&&Qe.connect(qe)}}const Nt=new _t,Zt=new _t;function qt(Jt,le,qe){Nt.setFromMatrixPosition(le.matrixWorld),Zt.setFromMatrixPosition(qe.matrixWorld);const be=Nt.distanceTo(Zt),Qe=le.projectionMatrix.elements,gi=qe.projectionMatrix.elements,bi=Qe[14]/(Qe[10]-1),Zi=Qe[14]/(Qe[10]+1),Ei=(Qe[9]+1)/Qe[5],$i=(Qe[9]-1)/Qe[5],zt=(Qe[8]-1)/Qe[0],jn=(gi[8]+1)/gi[0],Ft=bi*zt,Ai=bi*jn,oi=be/(-zt+jn),ti=oi*-zt;if(le.matrixWorld.decompose(Jt.position,Jt.quaternion,Jt.scale),Jt.translateX(ti),Jt.translateZ(oi),Jt.matrixWorld.compose(Jt.position,Jt.quaternion,Jt.scale),Jt.matrixWorldInverse.copy(Jt.matrixWorld).invert(),Qe[10]===-1)Jt.projectionMatrix.copy(le.projectionMatrix),Jt.projectionMatrixInverse.copy(le.projectionMatrixInverse);else{const ke=bi+oi,mt=Zi+oi,st=Ft-ti,Ht=Ai+(be-ti),re=Ei*Zi/mt*ke,ae=$i*Zi/mt*ke;Jt.projectionMatrix.makePerspective(st,Ht,re,ae,ke,mt),Jt.projectionMatrixInverse.copy(Jt.projectionMatrix).invert()}}function me(Jt,le){le===null?Jt.matrixWorld.copy(Jt.matrix):Jt.matrixWorld.multiplyMatrices(le.matrixWorld,Jt.matrix),Jt.matrixWorldInverse.copy(Jt.matrixWorld).invert()}this.updateCamera=function(Jt){if(s===null)return;let le=Jt.near,qe=Jt.far;k.texture!==null&&(k.depthNear>0&&(le=k.depthNear),k.depthFar>0&&(qe=k.depthFar)),J.near=nt.near=K.near=le,J.far=nt.far=K.far=qe,(ct!==J.near||St!==J.far)&&(s.updateRenderState({depthNear:J.near,depthFar:J.far}),ct=J.near,St=J.far),K.layers.mask=Jt.layers.mask|2,nt.layers.mask=Jt.layers.mask|4,J.layers.mask=K.layers.mask|nt.layers.mask;const be=Jt.parent,Qe=J.cameras;me(J,be);for(let gi=0;gi<Qe.length;gi++)me(Qe[gi],be);Qe.length===2?qt(J,K,nt):J.projectionMatrix.copy(K.projectionMatrix),Ee(Jt,J,be)};function Ee(Jt,le,qe){qe===null?Jt.matrix.copy(le.matrixWorld):(Jt.matrix.copy(qe.matrixWorld),Jt.matrix.invert(),Jt.matrix.multiply(le.matrixWorld)),Jt.matrix.decompose(Jt.position,Jt.quaternion,Jt.scale),Jt.updateMatrixWorld(!0),Jt.projectionMatrix.copy(le.projectionMatrix),Jt.projectionMatrixInverse.copy(le.projectionMatrixInverse),Jt.isPerspectiveCamera&&(Jt.fov=_d*2*Math.atan(1/Jt.projectionMatrix.elements[5]),Jt.zoom=1)}this.getCamera=function(){return J},this.getFoveation=function(){if(!(b===null&&E===null))return p},this.setFoveation=function(Jt){p=Jt,b!==null&&(b.fixedFoveation=Jt),E!==null&&E.fixedFoveation!==void 0&&(E.fixedFoveation=Jt)},this.hasDepthSensing=function(){return k.texture!==null},this.getDepthSensingMesh=function(){return k.getMesh(J)};let Le=null;function ri(Jt,le){if(x=le.getViewerPose(m||c),D=le,x!==null){const qe=x.views;E!==null&&(t.setRenderTargetFramebuffer(V,E.framebuffer),t.setRenderTarget(V));let be=!1;qe.length!==J.cameras.length&&(J.cameras.length=0,be=!0);for(let gi=0;gi<qe.length;gi++){const bi=qe[gi];let Zi=null;if(E!==null)Zi=E.getViewport(bi);else{const $i=v.getViewSubImage(b,bi);Zi=$i.viewport,gi===0&&(t.setRenderTargetTextures(V,$i.colorTexture,b.ignoreDepthValues?void 0:$i.depthStencilTexture),t.setRenderTarget(V))}let Ei=q[gi];Ei===void 0&&(Ei=new hr,Ei.layers.enable(gi),Ei.viewport=new en,q[gi]=Ei),Ei.matrix.fromArray(bi.transform.matrix),Ei.matrix.decompose(Ei.position,Ei.quaternion,Ei.scale),Ei.projectionMatrix.fromArray(bi.projectionMatrix),Ei.projectionMatrixInverse.copy(Ei.projectionMatrix).invert(),Ei.viewport.set(Zi.x,Zi.y,Zi.width,Zi.height),gi===0&&(J.matrix.copy(Ei.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale)),be===!0&&J.cameras.push(Ei)}const Qe=s.enabledFeatures;if(Qe&&Qe.includes("depth-sensing")){const gi=v.getDepthInformation(qe[0]);gi&&gi.isValid&&gi.texture&&k.init(t,gi,s.renderState)}}for(let qe=0;qe<U.length;qe++){const be=B[qe],Qe=U[qe];be!==null&&Qe!==void 0&&Qe.update(be,le,m||c)}Le&&Le(Jt,le),le.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:le}),D=null}const Ni=new wA;Ni.setAnimationLoop(ri),this.setAnimationLoop=function(Jt){Le=Jt},this.dispose=function(){}}}const Nc=new lo,RU=new _i;function DU(n,t){function e(P,I){P.matrixAutoUpdate===!0&&P.updateMatrix(),I.value.copy(P.matrix)}function i(P,I){I.color.getRGB(P.fogColor.value,xA(n)),I.isFog?(P.fogNear.value=I.near,P.fogFar.value=I.far):I.isFogExp2&&(P.fogDensity.value=I.density)}function s(P,I,V,U,B){I.isMeshBasicMaterial||I.isMeshLambertMaterial?l(P,I):I.isMeshToonMaterial?(l(P,I),v(P,I)):I.isMeshPhongMaterial?(l(P,I),x(P,I)):I.isMeshStandardMaterial?(l(P,I),b(P,I),I.isMeshPhysicalMaterial&&E(P,I,B)):I.isMeshMatcapMaterial?(l(P,I),D(P,I)):I.isMeshDepthMaterial?l(P,I):I.isMeshDistanceMaterial?(l(P,I),k(P,I)):I.isMeshNormalMaterial?l(P,I):I.isLineBasicMaterial?(c(P,I),I.isLineDashedMaterial&&o(P,I)):I.isPointsMaterial?p(P,I,V,U):I.isSpriteMaterial?m(P,I):I.isShadowMaterial?(P.color.value.copy(I.color),P.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}function l(P,I){P.opacity.value=I.opacity,I.color&&P.diffuse.value.copy(I.color),I.emissive&&P.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(P.map.value=I.map,e(I.map,P.mapTransform)),I.alphaMap&&(P.alphaMap.value=I.alphaMap,e(I.alphaMap,P.alphaMapTransform)),I.bumpMap&&(P.bumpMap.value=I.bumpMap,e(I.bumpMap,P.bumpMapTransform),P.bumpScale.value=I.bumpScale,I.side===pr&&(P.bumpScale.value*=-1)),I.normalMap&&(P.normalMap.value=I.normalMap,e(I.normalMap,P.normalMapTransform),P.normalScale.value.copy(I.normalScale),I.side===pr&&P.normalScale.value.negate()),I.displacementMap&&(P.displacementMap.value=I.displacementMap,e(I.displacementMap,P.displacementMapTransform),P.displacementScale.value=I.displacementScale,P.displacementBias.value=I.displacementBias),I.emissiveMap&&(P.emissiveMap.value=I.emissiveMap,e(I.emissiveMap,P.emissiveMapTransform)),I.specularMap&&(P.specularMap.value=I.specularMap,e(I.specularMap,P.specularMapTransform)),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest);const V=t.get(I),U=V.envMap,B=V.envMapRotation;U&&(P.envMap.value=U,Nc.copy(B),Nc.x*=-1,Nc.y*=-1,Nc.z*=-1,U.isCubeTexture&&U.isRenderTargetTexture===!1&&(Nc.y*=-1,Nc.z*=-1),P.envMapRotation.value.setFromMatrix4(RU.makeRotationFromEuler(Nc)),P.flipEnvMap.value=U.isCubeTexture&&U.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=I.reflectivity,P.ior.value=I.ior,P.refractionRatio.value=I.refractionRatio),I.lightMap&&(P.lightMap.value=I.lightMap,P.lightMapIntensity.value=I.lightMapIntensity,e(I.lightMap,P.lightMapTransform)),I.aoMap&&(P.aoMap.value=I.aoMap,P.aoMapIntensity.value=I.aoMapIntensity,e(I.aoMap,P.aoMapTransform))}function c(P,I){P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,I.map&&(P.map.value=I.map,e(I.map,P.mapTransform))}function o(P,I){P.dashSize.value=I.dashSize,P.totalSize.value=I.dashSize+I.gapSize,P.scale.value=I.scale}function p(P,I,V,U){P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.size.value=I.size*V,P.scale.value=U*.5,I.map&&(P.map.value=I.map,e(I.map,P.uvTransform)),I.alphaMap&&(P.alphaMap.value=I.alphaMap,e(I.alphaMap,P.alphaMapTransform)),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest)}function m(P,I){P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.rotation.value=I.rotation,I.map&&(P.map.value=I.map,e(I.map,P.mapTransform)),I.alphaMap&&(P.alphaMap.value=I.alphaMap,e(I.alphaMap,P.alphaMapTransform)),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest)}function x(P,I){P.specular.value.copy(I.specular),P.shininess.value=Math.max(I.shininess,1e-4)}function v(P,I){I.gradientMap&&(P.gradientMap.value=I.gradientMap)}function b(P,I){P.metalness.value=I.metalness,I.metalnessMap&&(P.metalnessMap.value=I.metalnessMap,e(I.metalnessMap,P.metalnessMapTransform)),P.roughness.value=I.roughness,I.roughnessMap&&(P.roughnessMap.value=I.roughnessMap,e(I.roughnessMap,P.roughnessMapTransform)),I.envMap&&(P.envMapIntensity.value=I.envMapIntensity)}function E(P,I,V){P.ior.value=I.ior,I.sheen>0&&(P.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),P.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(P.sheenColorMap.value=I.sheenColorMap,e(I.sheenColorMap,P.sheenColorMapTransform)),I.sheenRoughnessMap&&(P.sheenRoughnessMap.value=I.sheenRoughnessMap,e(I.sheenRoughnessMap,P.sheenRoughnessMapTransform))),I.clearcoat>0&&(P.clearcoat.value=I.clearcoat,P.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(P.clearcoatMap.value=I.clearcoatMap,e(I.clearcoatMap,P.clearcoatMapTransform)),I.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap,e(I.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),I.clearcoatNormalMap&&(P.clearcoatNormalMap.value=I.clearcoatNormalMap,e(I.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),I.side===pr&&P.clearcoatNormalScale.value.negate())),I.dispersion>0&&(P.dispersion.value=I.dispersion),I.iridescence>0&&(P.iridescence.value=I.iridescence,P.iridescenceIOR.value=I.iridescenceIOR,P.iridescenceThicknessMinimum.value=I.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=I.iridescenceThicknessRange[1],I.iridescenceMap&&(P.iridescenceMap.value=I.iridescenceMap,e(I.iridescenceMap,P.iridescenceMapTransform)),I.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=I.iridescenceThicknessMap,e(I.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),I.transmission>0&&(P.transmission.value=I.transmission,P.transmissionSamplerMap.value=V.texture,P.transmissionSamplerSize.value.set(V.width,V.height),I.transmissionMap&&(P.transmissionMap.value=I.transmissionMap,e(I.transmissionMap,P.transmissionMapTransform)),P.thickness.value=I.thickness,I.thicknessMap&&(P.thicknessMap.value=I.thicknessMap,e(I.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=I.attenuationDistance,P.attenuationColor.value.copy(I.attenuationColor)),I.anisotropy>0&&(P.anisotropyVector.value.set(I.anisotropy*Math.cos(I.anisotropyRotation),I.anisotropy*Math.sin(I.anisotropyRotation)),I.anisotropyMap&&(P.anisotropyMap.value=I.anisotropyMap,e(I.anisotropyMap,P.anisotropyMapTransform))),P.specularIntensity.value=I.specularIntensity,P.specularColor.value.copy(I.specularColor),I.specularColorMap&&(P.specularColorMap.value=I.specularColorMap,e(I.specularColorMap,P.specularColorMapTransform)),I.specularIntensityMap&&(P.specularIntensityMap.value=I.specularIntensityMap,e(I.specularIntensityMap,P.specularIntensityMapTransform))}function D(P,I){I.matcap&&(P.matcap.value=I.matcap)}function k(P,I){const V=t.get(I).light;P.referencePosition.value.setFromMatrixPosition(V.matrixWorld),P.nearDistance.value=V.shadow.camera.near,P.farDistance.value=V.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function LU(n,t,e,i){let s={},l={},c=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function p(V,U){const B=U.program;i.uniformBlockBinding(V,B)}function m(V,U){let B=s[V.id];B===void 0&&(D(V),B=x(V),s[V.id]=B,V.addEventListener("dispose",P));const Z=U.program;i.updateUBOMapping(V,Z);const Y=t.render.frame;l[V.id]!==Y&&(b(V),l[V.id]=Y)}function x(V){const U=v();V.__bindingPointIndex=U;const B=n.createBuffer(),Z=V.__size,Y=V.usage;return n.bindBuffer(n.UNIFORM_BUFFER,B),n.bufferData(n.UNIFORM_BUFFER,Z,Y),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,U,B),B}function v(){for(let V=0;V<o;V++)if(c.indexOf(V)===-1)return c.push(V),V;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function b(V){const U=s[V.id],B=V.uniforms,Z=V.__cache;n.bindBuffer(n.UNIFORM_BUFFER,U);for(let Y=0,K=B.length;Y<K;Y++){const nt=Array.isArray(B[Y])?B[Y]:[B[Y]];for(let q=0,J=nt.length;q<J;q++){const ct=nt[q];if(E(ct,Y,q,Z)===!0){const St=ct.__offset,wt=Array.isArray(ct.value)?ct.value:[ct.value];let Pt=0;for(let Gt=0;Gt<wt.length;Gt++){const Nt=wt[Gt],Zt=k(Nt);typeof Nt=="number"||typeof Nt=="boolean"?(ct.__data[0]=Nt,n.bufferSubData(n.UNIFORM_BUFFER,St+Pt,ct.__data)):Nt.isMatrix3?(ct.__data[0]=Nt.elements[0],ct.__data[1]=Nt.elements[1],ct.__data[2]=Nt.elements[2],ct.__data[3]=0,ct.__data[4]=Nt.elements[3],ct.__data[5]=Nt.elements[4],ct.__data[6]=Nt.elements[5],ct.__data[7]=0,ct.__data[8]=Nt.elements[6],ct.__data[9]=Nt.elements[7],ct.__data[10]=Nt.elements[8],ct.__data[11]=0):(Nt.toArray(ct.__data,Pt),Pt+=Zt.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,St,ct.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function E(V,U,B,Z){const Y=V.value,K=U+"_"+B;if(Z[K]===void 0)return typeof Y=="number"||typeof Y=="boolean"?Z[K]=Y:Z[K]=Y.clone(),!0;{const nt=Z[K];if(typeof Y=="number"||typeof Y=="boolean"){if(nt!==Y)return Z[K]=Y,!0}else if(nt.equals(Y)===!1)return nt.copy(Y),!0}return!1}function D(V){const U=V.uniforms;let B=0;const Z=16;for(let K=0,nt=U.length;K<nt;K++){const q=Array.isArray(U[K])?U[K]:[U[K]];for(let J=0,ct=q.length;J<ct;J++){const St=q[J],wt=Array.isArray(St.value)?St.value:[St.value];for(let Pt=0,Gt=wt.length;Pt<Gt;Pt++){const Nt=wt[Pt],Zt=k(Nt),qt=B%Z,me=qt%Zt.boundary,Ee=qt+me;B+=me,Ee!==0&&Z-Ee<Zt.storage&&(B+=Z-Ee),St.__data=new Float32Array(Zt.storage/Float32Array.BYTES_PER_ELEMENT),St.__offset=B,B+=Zt.storage}}}const Y=B%Z;return Y>0&&(B+=Z-Y),V.__size=B,V.__cache={},this}function k(V){const U={boundary:0,storage:0};return typeof V=="number"||typeof V=="boolean"?(U.boundary=4,U.storage=4):V.isVector2?(U.boundary=8,U.storage=8):V.isVector3||V.isColor?(U.boundary=16,U.storage=12):V.isVector4?(U.boundary=16,U.storage=16):V.isMatrix3?(U.boundary=48,U.storage=48):V.isMatrix4?(U.boundary=64,U.storage=64):V.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",V),U}function P(V){const U=V.target;U.removeEventListener("dispose",P);const B=c.indexOf(U.__bindingPointIndex);c.splice(B,1),n.deleteBuffer(s[U.id]),delete s[U.id],delete l[U.id]}function I(){for(const V in s)n.deleteBuffer(s[V]);c=[],s={},l={}}return{bind:p,update:m,dispose:I}}class kU{constructor(t={}){const{canvas:e=wF(),context:i=null,depth:s=!0,stencil:l=!1,alpha:c=!1,antialias:o=!1,premultipliedAlpha:p=!0,preserveDrawingBuffer:m=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:v=!1,reverseDepthBuffer:b=!1}=t;this.isWebGLRenderer=!0;let E;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");E=i.getContextAttributes().alpha}else E=c;const D=new Uint32Array(4),k=new Int32Array(4);let P=null,I=null;const V=[],U=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ls,this.toneMapping=$l,this.toneMappingExposure=1;const B=this;let Z=!1,Y=0,K=0,nt=null,q=-1,J=null;const ct=new en,St=new en;let wt=null;const Pt=new vi(0);let Gt=0,Nt=e.width,Zt=e.height,qt=1,me=null,Ee=null;const Le=new en(0,0,Nt,Zt),ri=new en(0,0,Nt,Zt);let Ni=!1;const Jt=new _0;let le=!1,qe=!1;const be=new _i,Qe=new _i,gi=new _t,bi=new en,Zi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ei=!1;function $i(){return nt===null?qt:1}let zt=i;function jn(rt,At){return e.getContext(rt,At)}try{const rt={alpha:!0,depth:s,stencil:l,antialias:o,premultipliedAlpha:p,preserveDrawingBuffer:m,powerPreference:x,failIfMajorPerformanceCaveat:v};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${d0}`),e.addEventListener("webglcontextlost",se,!1),e.addEventListener("webglcontextrestored",lt,!1),e.addEventListener("webglcontextcreationerror",W,!1),zt===null){const At="webgl2";if(zt=jn(At,rt),zt===null)throw jn(At)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(rt){throw console.error("THREE.WebGLRenderer: "+rt.message),rt}let Ft,Ai,oi,ti,ke,mt,st,Ht,re,ae,ie,$e,Ut,Ie,yi,ue,Be,Yt,ge,ne,xi,ci,Re,It;function Me(){Ft=new NB(zt),Ft.init(),ci=new SU(zt,Ft),Ai=new LB(zt,Ft,t,ci),oi=new bU(zt,Ft),Ai.reverseDepthBuffer&&b&&oi.buffers.depth.setReversed(!0),ti=new GB(zt),ke=new aU,mt=new MU(zt,Ft,oi,ke,Ai,ci,ti),st=new FB(B),Ht=new BB(B),re=new ZF(zt),Re=new RB(zt,re),ae=new UB(zt,re,ti,Re),ie=new jB(zt,ae,re,ti),ge=new HB(zt,Ai,mt),ue=new kB(ke),$e=new rU(B,st,Ht,Ft,Ai,Re,ue),Ut=new DU(B,ke),Ie=new lU,yi=new pU(Ft),Yt=new IB(B,st,Ht,oi,ie,E,p),Be=new xU(B,ie,Ai),It=new LU(zt,ti,Ai,oi),ne=new DB(zt,Ft,ti),xi=new VB(zt,Ft,ti),ti.programs=$e.programs,B.capabilities=Ai,B.extensions=Ft,B.properties=ke,B.renderLists=Ie,B.shadowMap=Be,B.state=oi,B.info=ti}Me();const Kt=new IU(B,zt);this.xr=Kt,this.getContext=function(){return zt},this.getContextAttributes=function(){return zt.getContextAttributes()},this.forceContextLoss=function(){const rt=Ft.get("WEBGL_lose_context");rt&&rt.loseContext()},this.forceContextRestore=function(){const rt=Ft.get("WEBGL_lose_context");rt&&rt.restoreContext()},this.getPixelRatio=function(){return qt},this.setPixelRatio=function(rt){rt!==void 0&&(qt=rt,this.setSize(Nt,Zt,!1))},this.getSize=function(rt){return rt.set(Nt,Zt)},this.setSize=function(rt,At,Vt=!0){if(Kt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Nt=rt,Zt=At,e.width=Math.floor(rt*qt),e.height=Math.floor(At*qt),Vt===!0&&(e.style.width=rt+"px",e.style.height=At+"px"),this.setViewport(0,0,rt,At)},this.getDrawingBufferSize=function(rt){return rt.set(Nt*qt,Zt*qt).floor()},this.setDrawingBufferSize=function(rt,At,Vt){Nt=rt,Zt=At,qt=Vt,e.width=Math.floor(rt*Vt),e.height=Math.floor(At*Vt),this.setViewport(0,0,rt,At)},this.getCurrentViewport=function(rt){return rt.copy(ct)},this.getViewport=function(rt){return rt.copy(Le)},this.setViewport=function(rt,At,Vt,jt){rt.isVector4?Le.set(rt.x,rt.y,rt.z,rt.w):Le.set(rt,At,Vt,jt),oi.viewport(ct.copy(Le).multiplyScalar(qt).round())},this.getScissor=function(rt){return rt.copy(ri)},this.setScissor=function(rt,At,Vt,jt){rt.isVector4?ri.set(rt.x,rt.y,rt.z,rt.w):ri.set(rt,At,Vt,jt),oi.scissor(St.copy(ri).multiplyScalar(qt).round())},this.getScissorTest=function(){return Ni},this.setScissorTest=function(rt){oi.setScissorTest(Ni=rt)},this.setOpaqueSort=function(rt){me=rt},this.setTransparentSort=function(rt){Ee=rt},this.getClearColor=function(rt){return rt.copy(Yt.getClearColor())},this.setClearColor=function(){Yt.setClearColor.apply(Yt,arguments)},this.getClearAlpha=function(){return Yt.getClearAlpha()},this.setClearAlpha=function(){Yt.setClearAlpha.apply(Yt,arguments)},this.clear=function(rt=!0,At=!0,Vt=!0){let jt=0;if(rt){let Rt=!1;if(nt!==null){const pe=nt.texture.format;Rt=pe===i1||pe===e1||pe===p0}if(Rt){const pe=nt.texture.type,ce=pe===jo||pe===tc||pe===Bp||pe===fd||pe===Jb||pe===Qb,Ze=Yt.getClearColor(),Ye=Yt.getClearAlpha(),ei=Ze.r,li=Ze.g,Je=Ze.b;ce?(D[0]=ei,D[1]=li,D[2]=Je,D[3]=Ye,zt.clearBufferuiv(zt.COLOR,0,D)):(k[0]=ei,k[1]=li,k[2]=Je,k[3]=Ye,zt.clearBufferiv(zt.COLOR,0,k))}else jt|=zt.COLOR_BUFFER_BIT}At&&(jt|=zt.DEPTH_BUFFER_BIT),Vt&&(jt|=zt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),zt.clear(jt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",se,!1),e.removeEventListener("webglcontextrestored",lt,!1),e.removeEventListener("webglcontextcreationerror",W,!1),Ie.dispose(),yi.dispose(),ke.dispose(),st.dispose(),Ht.dispose(),ie.dispose(),Re.dispose(),It.dispose(),$e.dispose(),Kt.dispose(),Kt.removeEventListener("sessionstart",bt),Kt.removeEventListener("sessionend",Xt),te.stop()};function se(rt){rt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Z=!0}function lt(){console.log("THREE.WebGLRenderer: Context Restored."),Z=!1;const rt=ti.autoReset,At=Be.enabled,Vt=Be.autoUpdate,jt=Be.needsUpdate,Rt=Be.type;Me(),ti.autoReset=rt,Be.enabled=At,Be.autoUpdate=Vt,Be.needsUpdate=jt,Be.type=Rt}function W(rt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",rt.statusMessage)}function X(rt){const At=rt.target;At.removeEventListener("dispose",X),it(At)}function it(rt){ut(rt),ke.remove(rt)}function ut(rt){const At=ke.get(rt).programs;At!==void 0&&(At.forEach(function(Vt){$e.releaseProgram(Vt)}),rt.isShaderMaterial&&$e.releaseShaderCache(rt))}this.renderBufferDirect=function(rt,At,Vt,jt,Rt,pe){At===null&&(At=Zi);const ce=Rt.isMesh&&Rt.matrixWorld.determinant()<0,Ze=En(rt,At,Vt,jt,Rt);oi.setMaterial(jt,ce);let Ye=Vt.index,ei=1;if(jt.wireframe===!0){if(Ye=ae.getWireframeAttribute(Vt),Ye===void 0)return;ei=2}const li=Vt.drawRange,Je=Vt.attributes.position;let wi=li.start*ei,Ri=(li.start+li.count)*ei;pe!==null&&(wi=Math.max(wi,pe.start*ei),Ri=Math.min(Ri,(pe.start+pe.count)*ei)),Ye!==null?(wi=Math.max(wi,0),Ri=Math.min(Ri,Ye.count)):Je!=null&&(wi=Math.max(wi,0),Ri=Math.min(Ri,Je.count));const qi=Ri-wi;if(qi<0||qi===1/0)return;Re.setup(Rt,jt,Ze,Vt,Ye);let An,pi=ne;if(Ye!==null&&(An=re.get(Ye),pi=xi,pi.setIndex(An)),Rt.isMesh)jt.wireframe===!0?(oi.setLineWidth(jt.wireframeLinewidth*$i()),pi.setMode(zt.LINES)):pi.setMode(zt.TRIANGLES);else if(Rt.isLine){let Ke=jt.linewidth;Ke===void 0&&(Ke=1),oi.setLineWidth(Ke*$i()),Rt.isLineSegments?pi.setMode(zt.LINES):Rt.isLineLoop?pi.setMode(zt.LINE_LOOP):pi.setMode(zt.LINE_STRIP)}else Rt.isPoints?pi.setMode(zt.POINTS):Rt.isSprite&&pi.setMode(zt.TRIANGLES);if(Rt.isBatchedMesh)if(Rt._multiDrawInstances!==null)pi.renderMultiDrawInstances(Rt._multiDrawStarts,Rt._multiDrawCounts,Rt._multiDrawCount,Rt._multiDrawInstances);else if(Ft.get("WEBGL_multi_draw"))pi.renderMultiDraw(Rt._multiDrawStarts,Rt._multiDrawCounts,Rt._multiDrawCount);else{const Ke=Rt._multiDrawStarts,Dn=Rt._multiDrawCounts,ui=Rt._multiDrawCount,hs=Ye?re.get(Ye).bytesPerElement:1,Zn=ke.get(jt).currentProgram.getUniforms();for(let is=0;is<ui;is++)Zn.setValue(zt,"_gl_DrawID",is),pi.render(Ke[is]/hs,Dn[is])}else if(Rt.isInstancedMesh)pi.renderInstances(wi,qi,Rt.count);else if(Vt.isInstancedBufferGeometry){const Ke=Vt._maxInstanceCount!==void 0?Vt._maxInstanceCount:1/0,Dn=Math.min(Vt.instanceCount,Ke);pi.renderInstances(wi,qi,Dn)}else pi.render(wi,qi)};function xt(rt,At,Vt){rt.transparent===!0&&rt.side===Qr&&rt.forceSinglePass===!1?(rt.side=pr,rt.needsUpdate=!0,hi(rt,At,Vt),rt.side=Va,rt.needsUpdate=!0,hi(rt,At,Vt),rt.side=Qr):hi(rt,At,Vt)}this.compile=function(rt,At,Vt=null){Vt===null&&(Vt=rt),I=yi.get(Vt),I.init(At),U.push(I),Vt.traverseVisible(function(Rt){Rt.isLight&&Rt.layers.test(At.layers)&&(I.pushLight(Rt),Rt.castShadow&&I.pushShadow(Rt))}),rt!==Vt&&rt.traverseVisible(function(Rt){Rt.isLight&&Rt.layers.test(At.layers)&&(I.pushLight(Rt),Rt.castShadow&&I.pushShadow(Rt))}),I.setupLights();const jt=new Set;return rt.traverse(function(Rt){if(!(Rt.isMesh||Rt.isPoints||Rt.isLine||Rt.isSprite))return;const pe=Rt.material;if(pe)if(Array.isArray(pe))for(let ce=0;ce<pe.length;ce++){const Ze=pe[ce];xt(Ze,Vt,Rt),jt.add(Ze)}else xt(pe,Vt,Rt),jt.add(pe)}),U.pop(),I=null,jt},this.compileAsync=function(rt,At,Vt=null){const jt=this.compile(rt,At,Vt);return new Promise(Rt=>{function pe(){if(jt.forEach(function(ce){ke.get(ce).currentProgram.isReady()&&jt.delete(ce)}),jt.size===0){Rt(rt);return}setTimeout(pe,10)}Ft.get("KHR_parallel_shader_compile")!==null?pe():setTimeout(pe,10)})};let Et=null;function Dt(rt){Et&&Et(rt)}function bt(){te.stop()}function Xt(){te.start()}const te=new wA;te.setAnimationLoop(Dt),typeof self<"u"&&te.setContext(self),this.setAnimationLoop=function(rt){Et=rt,Kt.setAnimationLoop(rt),rt===null?te.stop():te.start()},Kt.addEventListener("sessionstart",bt),Kt.addEventListener("sessionend",Xt),this.render=function(rt,At){if(At!==void 0&&At.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Z===!0)return;if(rt.matrixWorldAutoUpdate===!0&&rt.updateMatrixWorld(),At.parent===null&&At.matrixWorldAutoUpdate===!0&&At.updateMatrixWorld(),Kt.enabled===!0&&Kt.isPresenting===!0&&(Kt.cameraAutoUpdate===!0&&Kt.updateCamera(At),At=Kt.getCamera()),rt.isScene===!0&&rt.onBeforeRender(B,rt,At,nt),I=yi.get(rt,U.length),I.init(At),U.push(I),Qe.multiplyMatrices(At.projectionMatrix,At.matrixWorldInverse),Jt.setFromProjectionMatrix(Qe),qe=this.localClippingEnabled,le=ue.init(this.clippingPlanes,qe),P=Ie.get(rt,V.length),P.init(),V.push(P),Kt.enabled===!0&&Kt.isPresenting===!0){const pe=B.xr.getDepthSensingMesh();pe!==null&&Wt(pe,At,-1/0,B.sortObjects)}Wt(rt,At,0,B.sortObjects),P.finish(),B.sortObjects===!0&&P.sort(me,Ee),Ei=Kt.enabled===!1||Kt.isPresenting===!1||Kt.hasDepthSensing()===!1,Ei&&Yt.addToRenderList(P,rt),this.info.render.frame++,le===!0&&ue.beginShadows();const Vt=I.state.shadowsArray;Be.render(Vt,rt,At),le===!0&&ue.endShadows(),this.info.autoReset===!0&&this.info.reset();const jt=P.opaque,Rt=P.transmissive;if(I.setupLights(),At.isArrayCamera){const pe=At.cameras;if(Rt.length>0)for(let ce=0,Ze=pe.length;ce<Ze;ce++){const Ye=pe[ce];He(jt,Rt,rt,Ye)}Ei&&Yt.render(rt);for(let ce=0,Ze=pe.length;ce<Ze;ce++){const Ye=pe[ce];fe(P,rt,Ye,Ye.viewport)}}else Rt.length>0&&He(jt,Rt,rt,At),Ei&&Yt.render(rt),fe(P,rt,At);nt!==null&&(mt.updateMultisampleRenderTarget(nt),mt.updateRenderTargetMipmap(nt)),rt.isScene===!0&&rt.onAfterRender(B,rt,At),Re.resetDefaultState(),q=-1,J=null,U.pop(),U.length>0?(I=U[U.length-1],le===!0&&ue.setGlobalState(B.clippingPlanes,I.state.camera)):I=null,V.pop(),V.length>0?P=V[V.length-1]:P=null};function Wt(rt,At,Vt,jt){if(rt.visible===!1)return;if(rt.layers.test(At.layers)){if(rt.isGroup)Vt=rt.renderOrder;else if(rt.isLOD)rt.autoUpdate===!0&&rt.update(At);else if(rt.isLight)I.pushLight(rt),rt.castShadow&&I.pushShadow(rt);else if(rt.isSprite){if(!rt.frustumCulled||Jt.intersectsSprite(rt)){jt&&bi.setFromMatrixPosition(rt.matrixWorld).applyMatrix4(Qe);const ce=ie.update(rt),Ze=rt.material;Ze.visible&&P.push(rt,ce,Ze,Vt,bi.z,null)}}else if((rt.isMesh||rt.isLine||rt.isPoints)&&(!rt.frustumCulled||Jt.intersectsObject(rt))){const ce=ie.update(rt),Ze=rt.material;if(jt&&(rt.boundingSphere!==void 0?(rt.boundingSphere===null&&rt.computeBoundingSphere(),bi.copy(rt.boundingSphere.center)):(ce.boundingSphere===null&&ce.computeBoundingSphere(),bi.copy(ce.boundingSphere.center)),bi.applyMatrix4(rt.matrixWorld).applyMatrix4(Qe)),Array.isArray(Ze)){const Ye=ce.groups;for(let ei=0,li=Ye.length;ei<li;ei++){const Je=Ye[ei],wi=Ze[Je.materialIndex];wi&&wi.visible&&P.push(rt,ce,wi,Vt,bi.z,Je)}}else Ze.visible&&P.push(rt,ce,Ze,Vt,bi.z,null)}}const pe=rt.children;for(let ce=0,Ze=pe.length;ce<Ze;ce++)Wt(pe[ce],At,Vt,jt)}function fe(rt,At,Vt,jt){const Rt=rt.opaque,pe=rt.transmissive,ce=rt.transparent;I.setupLightsView(Vt),le===!0&&ue.setGlobalState(B.clippingPlanes,Vt),jt&&oi.viewport(ct.copy(jt)),Rt.length>0&&Xe(Rt,At,Vt),pe.length>0&&Xe(pe,At,Vt),ce.length>0&&Xe(ce,At,Vt),oi.buffers.depth.setTest(!0),oi.buffers.depth.setMask(!0),oi.buffers.color.setMask(!0),oi.setPolygonOffset(!1)}function He(rt,At,Vt,jt){if((Vt.isScene===!0?Vt.overrideMaterial:null)!==null)return;I.state.transmissionRenderTarget[jt.id]===void 0&&(I.state.transmissionRenderTarget[jt.id]=new uh(1,1,{generateMipmaps:!0,type:Ft.has("EXT_color_buffer_half_float")||Ft.has("EXT_color_buffer_float")?am:jo,minFilter:No,samples:4,stencilBuffer:l,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ji.workingColorSpace}));const pe=I.state.transmissionRenderTarget[jt.id],ce=jt.viewport||ct;pe.setSize(ce.z,ce.w);const Ze=B.getRenderTarget();B.setRenderTarget(pe),B.getClearColor(Pt),Gt=B.getClearAlpha(),Gt<1&&B.setClearColor(16777215,.5),B.clear(),Ei&&Yt.render(Vt);const Ye=B.toneMapping;B.toneMapping=$l;const ei=jt.viewport;if(jt.viewport!==void 0&&(jt.viewport=void 0),I.setupLightsView(jt),le===!0&&ue.setGlobalState(B.clippingPlanes,jt),Xe(rt,Vt,jt),mt.updateMultisampleRenderTarget(pe),mt.updateRenderTargetMipmap(pe),Ft.has("WEBGL_multisampled_render_to_texture")===!1){let li=!1;for(let Je=0,wi=At.length;Je<wi;Je++){const Ri=At[Je],qi=Ri.object,An=Ri.geometry,pi=Ri.material,Ke=Ri.group;if(pi.side===Qr&&qi.layers.test(jt.layers)){const Dn=pi.side;pi.side=pr,pi.needsUpdate=!0,ki(qi,Vt,jt,An,pi,Ke),pi.side=Dn,pi.needsUpdate=!0,li=!0}}li===!0&&(mt.updateMultisampleRenderTarget(pe),mt.updateRenderTargetMipmap(pe))}B.setRenderTarget(Ze),B.setClearColor(Pt,Gt),ei!==void 0&&(jt.viewport=ei),B.toneMapping=Ye}function Xe(rt,At,Vt){const jt=At.isScene===!0?At.overrideMaterial:null;for(let Rt=0,pe=rt.length;Rt<pe;Rt++){const ce=rt[Rt],Ze=ce.object,Ye=ce.geometry,ei=jt===null?ce.material:jt,li=ce.group;Ze.layers.test(Vt.layers)&&ki(Ze,At,Vt,Ye,ei,li)}}function ki(rt,At,Vt,jt,Rt,pe){rt.onBeforeRender(B,At,Vt,jt,Rt,pe),rt.modelViewMatrix.multiplyMatrices(Vt.matrixWorldInverse,rt.matrixWorld),rt.normalMatrix.getNormalMatrix(rt.modelViewMatrix),Rt.onBeforeRender(B,At,Vt,jt,rt,pe),Rt.transparent===!0&&Rt.side===Qr&&Rt.forceSinglePass===!1?(Rt.side=pr,Rt.needsUpdate=!0,B.renderBufferDirect(Vt,At,jt,Rt,rt,pe),Rt.side=Va,Rt.needsUpdate=!0,B.renderBufferDirect(Vt,At,jt,Rt,rt,pe),Rt.side=Qr):B.renderBufferDirect(Vt,At,jt,Rt,rt,pe),rt.onAfterRender(B,At,Vt,jt,Rt,pe)}function hi(rt,At,Vt){At.isScene!==!0&&(At=Zi);const jt=ke.get(rt),Rt=I.state.lights,pe=I.state.shadowsArray,ce=Rt.state.version,Ze=$e.getParameters(rt,Rt.state,pe,At,Vt),Ye=$e.getProgramCacheKey(Ze);let ei=jt.programs;jt.environment=rt.isMeshStandardMaterial?At.environment:null,jt.fog=At.fog,jt.envMap=(rt.isMeshStandardMaterial?Ht:st).get(rt.envMap||jt.environment),jt.envMapRotation=jt.environment!==null&&rt.envMap===null?At.environmentRotation:rt.envMapRotation,ei===void 0&&(rt.addEventListener("dispose",X),ei=new Map,jt.programs=ei);let li=ei.get(Ye);if(li!==void 0){if(jt.currentProgram===li&&jt.lightsStateVersion===ce)return Ci(rt,Ze),li}else Ze.uniforms=$e.getUniforms(rt),rt.onBeforeCompile(Ze,B),li=$e.acquireProgram(Ze,Ye),ei.set(Ye,li),jt.uniforms=Ze.uniforms;const Je=jt.uniforms;return(!rt.isShaderMaterial&&!rt.isRawShaderMaterial||rt.clipping===!0)&&(Je.clippingPlanes=ue.uniform),Ci(rt,Ze),jt.needsLights=Si(rt),jt.lightsStateVersion=ce,jt.needsLights&&(Je.ambientLightColor.value=Rt.state.ambient,Je.lightProbe.value=Rt.state.probe,Je.directionalLights.value=Rt.state.directional,Je.directionalLightShadows.value=Rt.state.directionalShadow,Je.spotLights.value=Rt.state.spot,Je.spotLightShadows.value=Rt.state.spotShadow,Je.rectAreaLights.value=Rt.state.rectArea,Je.ltc_1.value=Rt.state.rectAreaLTC1,Je.ltc_2.value=Rt.state.rectAreaLTC2,Je.pointLights.value=Rt.state.point,Je.pointLightShadows.value=Rt.state.pointShadow,Je.hemisphereLights.value=Rt.state.hemi,Je.directionalShadowMap.value=Rt.state.directionalShadowMap,Je.directionalShadowMatrix.value=Rt.state.directionalShadowMatrix,Je.spotShadowMap.value=Rt.state.spotShadowMap,Je.spotLightMatrix.value=Rt.state.spotLightMatrix,Je.spotLightMap.value=Rt.state.spotLightMap,Je.pointShadowMap.value=Rt.state.pointShadowMap,Je.pointShadowMatrix.value=Rt.state.pointShadowMatrix),jt.currentProgram=li,jt.uniformsList=null,li}function Fi(rt){if(rt.uniformsList===null){const At=rt.currentProgram.getUniforms();rt.uniformsList=Ig.seqWithValue(At.seq,rt.uniforms)}return rt.uniformsList}function Ci(rt,At){const Vt=ke.get(rt);Vt.outputColorSpace=At.outputColorSpace,Vt.batching=At.batching,Vt.batchingColor=At.batchingColor,Vt.instancing=At.instancing,Vt.instancingColor=At.instancingColor,Vt.instancingMorph=At.instancingMorph,Vt.skinning=At.skinning,Vt.morphTargets=At.morphTargets,Vt.morphNormals=At.morphNormals,Vt.morphColors=At.morphColors,Vt.morphTargetsCount=At.morphTargetsCount,Vt.numClippingPlanes=At.numClippingPlanes,Vt.numIntersection=At.numClipIntersection,Vt.vertexAlphas=At.vertexAlphas,Vt.vertexTangents=At.vertexTangents,Vt.toneMapping=At.toneMapping}function En(rt,At,Vt,jt,Rt){At.isScene!==!0&&(At=Zi),mt.resetTextureUnits();const pe=At.fog,ce=jt.isMeshStandardMaterial?At.environment:null,Ze=nt===null?B.outputColorSpace:nt.isXRRenderTarget===!0?nt.texture.colorSpace:yr,Ye=(jt.isMeshStandardMaterial?Ht:st).get(jt.envMap||ce),ei=jt.vertexColors===!0&&!!Vt.attributes.color&&Vt.attributes.color.itemSize===4,li=!!Vt.attributes.tangent&&(!!jt.normalMap||jt.anisotropy>0),Je=!!Vt.morphAttributes.position,wi=!!Vt.morphAttributes.normal,Ri=!!Vt.morphAttributes.color;let qi=$l;jt.toneMapped&&(nt===null||nt.isXRRenderTarget===!0)&&(qi=B.toneMapping);const An=Vt.morphAttributes.position||Vt.morphAttributes.normal||Vt.morphAttributes.color,pi=An!==void 0?An.length:0,Ke=ke.get(jt),Dn=I.state.lights;if(le===!0&&(qe===!0||rt!==J)){const Ln=rt===J&&jt.id===q;ue.setState(jt,rt,Ln)}let ui=!1;jt.version===Ke.__version?(Ke.needsLights&&Ke.lightsStateVersion!==Dn.state.version||Ke.outputColorSpace!==Ze||Rt.isBatchedMesh&&Ke.batching===!1||!Rt.isBatchedMesh&&Ke.batching===!0||Rt.isBatchedMesh&&Ke.batchingColor===!0&&Rt.colorTexture===null||Rt.isBatchedMesh&&Ke.batchingColor===!1&&Rt.colorTexture!==null||Rt.isInstancedMesh&&Ke.instancing===!1||!Rt.isInstancedMesh&&Ke.instancing===!0||Rt.isSkinnedMesh&&Ke.skinning===!1||!Rt.isSkinnedMesh&&Ke.skinning===!0||Rt.isInstancedMesh&&Ke.instancingColor===!0&&Rt.instanceColor===null||Rt.isInstancedMesh&&Ke.instancingColor===!1&&Rt.instanceColor!==null||Rt.isInstancedMesh&&Ke.instancingMorph===!0&&Rt.morphTexture===null||Rt.isInstancedMesh&&Ke.instancingMorph===!1&&Rt.morphTexture!==null||Ke.envMap!==Ye||jt.fog===!0&&Ke.fog!==pe||Ke.numClippingPlanes!==void 0&&(Ke.numClippingPlanes!==ue.numPlanes||Ke.numIntersection!==ue.numIntersection)||Ke.vertexAlphas!==ei||Ke.vertexTangents!==li||Ke.morphTargets!==Je||Ke.morphNormals!==wi||Ke.morphColors!==Ri||Ke.toneMapping!==qi||Ke.morphTargetsCount!==pi)&&(ui=!0):(ui=!0,Ke.__version=jt.version);let hs=Ke.currentProgram;ui===!0&&(hs=hi(jt,At,Rt));let Zn=!1,is=!1,ns=!1;const on=hs.getUniforms(),Ts=Ke.uniforms;if(oi.useProgram(hs.program)&&(Zn=!0,is=!0,ns=!0),jt.id!==q&&(q=jt.id,is=!0),Zn||J!==rt){oi.buffers.depth.getReversed()?(be.copy(rt.projectionMatrix),SF(be),TF(be),on.setValue(zt,"projectionMatrix",be)):on.setValue(zt,"projectionMatrix",rt.projectionMatrix),on.setValue(zt,"viewMatrix",rt.matrixWorldInverse);const Pi=on.map.cameraPosition;Pi!==void 0&&Pi.setValue(zt,gi.setFromMatrixPosition(rt.matrixWorld)),Ai.logarithmicDepthBuffer&&on.setValue(zt,"logDepthBufFC",2/(Math.log(rt.far+1)/Math.LN2)),(jt.isMeshPhongMaterial||jt.isMeshToonMaterial||jt.isMeshLambertMaterial||jt.isMeshBasicMaterial||jt.isMeshStandardMaterial||jt.isShaderMaterial)&&on.setValue(zt,"isOrthographic",rt.isOrthographicCamera===!0),J!==rt&&(J=rt,is=!0,ns=!0)}if(Rt.isSkinnedMesh){on.setOptional(zt,Rt,"bindMatrix"),on.setOptional(zt,Rt,"bindMatrixInverse");const Ln=Rt.skeleton;Ln&&(Ln.boneTexture===null&&Ln.computeBoneTexture(),on.setValue(zt,"boneTexture",Ln.boneTexture,mt))}Rt.isBatchedMesh&&(on.setOptional(zt,Rt,"batchingTexture"),on.setValue(zt,"batchingTexture",Rt._matricesTexture,mt),on.setOptional(zt,Rt,"batchingIdTexture"),on.setValue(zt,"batchingIdTexture",Rt._indirectTexture,mt),on.setOptional(zt,Rt,"batchingColorTexture"),Rt._colorsTexture!==null&&on.setValue(zt,"batchingColorTexture",Rt._colorsTexture,mt));const Qs=Vt.morphAttributes;if((Qs.position!==void 0||Qs.normal!==void 0||Qs.color!==void 0)&&ge.update(Rt,Vt,hs),(is||Ke.receiveShadow!==Rt.receiveShadow)&&(Ke.receiveShadow=Rt.receiveShadow,on.setValue(zt,"receiveShadow",Rt.receiveShadow)),jt.isMeshGouraudMaterial&&jt.envMap!==null&&(Ts.envMap.value=Ye,Ts.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),jt.isMeshStandardMaterial&&jt.envMap===null&&At.environment!==null&&(Ts.envMapIntensity.value=At.environmentIntensity),is&&(on.setValue(zt,"toneMappingExposure",B.toneMappingExposure),Ke.needsLights&&yn(Ts,ns),pe&&jt.fog===!0&&Ut.refreshFogUniforms(Ts,pe),Ut.refreshMaterialUniforms(Ts,jt,qt,Zt,I.state.transmissionRenderTarget[rt.id]),Ig.upload(zt,Fi(Ke),Ts,mt)),jt.isShaderMaterial&&jt.uniformsNeedUpdate===!0&&(Ig.upload(zt,Fi(Ke),Ts,mt),jt.uniformsNeedUpdate=!1),jt.isSpriteMaterial&&on.setValue(zt,"center",Rt.center),on.setValue(zt,"modelViewMatrix",Rt.modelViewMatrix),on.setValue(zt,"normalMatrix",Rt.normalMatrix),on.setValue(zt,"modelMatrix",Rt.matrixWorld),jt.isShaderMaterial||jt.isRawShaderMaterial){const Ln=jt.uniformsGroups;for(let Pi=0,vr=Ln.length;Pi<vr;Pi++){const Yo=Ln[Pi];It.update(Yo,hs),It.bind(Yo,hs)}}return hs}function yn(rt,At){rt.ambientLightColor.needsUpdate=At,rt.lightProbe.needsUpdate=At,rt.directionalLights.needsUpdate=At,rt.directionalLightShadows.needsUpdate=At,rt.pointLights.needsUpdate=At,rt.pointLightShadows.needsUpdate=At,rt.spotLights.needsUpdate=At,rt.spotLightShadows.needsUpdate=At,rt.rectAreaLights.needsUpdate=At,rt.hemisphereLights.needsUpdate=At}function Si(rt){return rt.isMeshLambertMaterial||rt.isMeshToonMaterial||rt.isMeshPhongMaterial||rt.isMeshStandardMaterial||rt.isShadowMaterial||rt.isShaderMaterial&&rt.lights===!0}this.getActiveCubeFace=function(){return Y},this.getActiveMipmapLevel=function(){return K},this.getRenderTarget=function(){return nt},this.setRenderTargetTextures=function(rt,At,Vt){ke.get(rt.texture).__webglTexture=At,ke.get(rt.depthTexture).__webglTexture=Vt;const jt=ke.get(rt);jt.__hasExternalTextures=!0,jt.__autoAllocateDepthBuffer=Vt===void 0,jt.__autoAllocateDepthBuffer||Ft.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),jt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(rt,At){const Vt=ke.get(rt);Vt.__webglFramebuffer=At,Vt.__useDefaultFramebuffer=At===void 0},this.setRenderTarget=function(rt,At=0,Vt=0){nt=rt,Y=At,K=Vt;let jt=!0,Rt=null,pe=!1,ce=!1;if(rt){const Ye=ke.get(rt);if(Ye.__useDefaultFramebuffer!==void 0)oi.bindFramebuffer(zt.FRAMEBUFFER,null),jt=!1;else if(Ye.__webglFramebuffer===void 0)mt.setupRenderTarget(rt);else if(Ye.__hasExternalTextures)mt.rebindTextures(rt,ke.get(rt.texture).__webglTexture,ke.get(rt.depthTexture).__webglTexture);else if(rt.depthBuffer){const Je=rt.depthTexture;if(Ye.__boundDepthTexture!==Je){if(Je!==null&&ke.has(Je)&&(rt.width!==Je.image.width||rt.height!==Je.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");mt.setupDepthRenderbuffer(rt)}}const ei=rt.texture;(ei.isData3DTexture||ei.isDataArrayTexture||ei.isCompressedArrayTexture)&&(ce=!0);const li=ke.get(rt).__webglFramebuffer;rt.isWebGLCubeRenderTarget?(Array.isArray(li[At])?Rt=li[At][Vt]:Rt=li[At],pe=!0):rt.samples>0&&mt.useMultisampledRTT(rt)===!1?Rt=ke.get(rt).__webglMultisampledFramebuffer:Array.isArray(li)?Rt=li[Vt]:Rt=li,ct.copy(rt.viewport),St.copy(rt.scissor),wt=rt.scissorTest}else ct.copy(Le).multiplyScalar(qt).floor(),St.copy(ri).multiplyScalar(qt).floor(),wt=Ni;if(oi.bindFramebuffer(zt.FRAMEBUFFER,Rt)&&jt&&oi.drawBuffers(rt,Rt),oi.viewport(ct),oi.scissor(St),oi.setScissorTest(wt),pe){const Ye=ke.get(rt.texture);zt.framebufferTexture2D(zt.FRAMEBUFFER,zt.COLOR_ATTACHMENT0,zt.TEXTURE_CUBE_MAP_POSITIVE_X+At,Ye.__webglTexture,Vt)}else if(ce){const Ye=ke.get(rt.texture),ei=At||0;zt.framebufferTextureLayer(zt.FRAMEBUFFER,zt.COLOR_ATTACHMENT0,Ye.__webglTexture,Vt||0,ei)}q=-1},this.readRenderTargetPixels=function(rt,At,Vt,jt,Rt,pe,ce){if(!(rt&&rt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ze=ke.get(rt).__webglFramebuffer;if(rt.isWebGLCubeRenderTarget&&ce!==void 0&&(Ze=Ze[ce]),Ze){oi.bindFramebuffer(zt.FRAMEBUFFER,Ze);try{const Ye=rt.texture,ei=Ye.format,li=Ye.type;if(!Ai.textureFormatReadable(ei)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ai.textureTypeReadable(li)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}At>=0&&At<=rt.width-jt&&Vt>=0&&Vt<=rt.height-Rt&&zt.readPixels(At,Vt,jt,Rt,ci.convert(ei),ci.convert(li),pe)}finally{const Ye=nt!==null?ke.get(nt).__webglFramebuffer:null;oi.bindFramebuffer(zt.FRAMEBUFFER,Ye)}}},this.readRenderTargetPixelsAsync=async function(rt,At,Vt,jt,Rt,pe,ce){if(!(rt&&rt.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ze=ke.get(rt).__webglFramebuffer;if(rt.isWebGLCubeRenderTarget&&ce!==void 0&&(Ze=Ze[ce]),Ze){const Ye=rt.texture,ei=Ye.format,li=Ye.type;if(!Ai.textureFormatReadable(ei))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ai.textureTypeReadable(li))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(At>=0&&At<=rt.width-jt&&Vt>=0&&Vt<=rt.height-Rt){oi.bindFramebuffer(zt.FRAMEBUFFER,Ze);const Je=zt.createBuffer();zt.bindBuffer(zt.PIXEL_PACK_BUFFER,Je),zt.bufferData(zt.PIXEL_PACK_BUFFER,pe.byteLength,zt.STREAM_READ),zt.readPixels(At,Vt,jt,Rt,ci.convert(ei),ci.convert(li),0);const wi=nt!==null?ke.get(nt).__webglFramebuffer:null;oi.bindFramebuffer(zt.FRAMEBUFFER,wi);const Ri=zt.fenceSync(zt.SYNC_GPU_COMMANDS_COMPLETE,0);return zt.flush(),await MF(zt,Ri,4),zt.bindBuffer(zt.PIXEL_PACK_BUFFER,Je),zt.getBufferSubData(zt.PIXEL_PACK_BUFFER,0,pe),zt.deleteBuffer(Je),zt.deleteSync(Ri),pe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(rt,At=null,Vt=0){rt.isTexture!==!0&&(fp("WebGLRenderer: copyFramebufferToTexture function signature has changed."),At=arguments[0]||null,rt=arguments[1]);const jt=Math.pow(2,-Vt),Rt=Math.floor(rt.image.width*jt),pe=Math.floor(rt.image.height*jt),ce=At!==null?At.x:0,Ze=At!==null?At.y:0;mt.setTexture2D(rt,0),zt.copyTexSubImage2D(zt.TEXTURE_2D,Vt,0,0,ce,Ze,Rt,pe),oi.unbindTexture()},this.copyTextureToTexture=function(rt,At,Vt=null,jt=null,Rt=0){rt.isTexture!==!0&&(fp("WebGLRenderer: copyTextureToTexture function signature has changed."),jt=arguments[0]||null,rt=arguments[1],At=arguments[2],Rt=arguments[3]||0,Vt=null);let pe,ce,Ze,Ye,ei,li,Je,wi,Ri;const qi=rt.isCompressedTexture?rt.mipmaps[Rt]:rt.image;Vt!==null?(pe=Vt.max.x-Vt.min.x,ce=Vt.max.y-Vt.min.y,Ze=Vt.isBox3?Vt.max.z-Vt.min.z:1,Ye=Vt.min.x,ei=Vt.min.y,li=Vt.isBox3?Vt.min.z:0):(pe=qi.width,ce=qi.height,Ze=qi.depth||1,Ye=0,ei=0,li=0),jt!==null?(Je=jt.x,wi=jt.y,Ri=jt.z):(Je=0,wi=0,Ri=0);const An=ci.convert(At.format),pi=ci.convert(At.type);let Ke;At.isData3DTexture?(mt.setTexture3D(At,0),Ke=zt.TEXTURE_3D):At.isDataArrayTexture||At.isCompressedArrayTexture?(mt.setTexture2DArray(At,0),Ke=zt.TEXTURE_2D_ARRAY):(mt.setTexture2D(At,0),Ke=zt.TEXTURE_2D),zt.pixelStorei(zt.UNPACK_FLIP_Y_WEBGL,At.flipY),zt.pixelStorei(zt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,At.premultiplyAlpha),zt.pixelStorei(zt.UNPACK_ALIGNMENT,At.unpackAlignment);const Dn=zt.getParameter(zt.UNPACK_ROW_LENGTH),ui=zt.getParameter(zt.UNPACK_IMAGE_HEIGHT),hs=zt.getParameter(zt.UNPACK_SKIP_PIXELS),Zn=zt.getParameter(zt.UNPACK_SKIP_ROWS),is=zt.getParameter(zt.UNPACK_SKIP_IMAGES);zt.pixelStorei(zt.UNPACK_ROW_LENGTH,qi.width),zt.pixelStorei(zt.UNPACK_IMAGE_HEIGHT,qi.height),zt.pixelStorei(zt.UNPACK_SKIP_PIXELS,Ye),zt.pixelStorei(zt.UNPACK_SKIP_ROWS,ei),zt.pixelStorei(zt.UNPACK_SKIP_IMAGES,li);const ns=rt.isDataArrayTexture||rt.isData3DTexture,on=At.isDataArrayTexture||At.isData3DTexture;if(rt.isRenderTargetTexture||rt.isDepthTexture){const Ts=ke.get(rt),Qs=ke.get(At),Ln=ke.get(Ts.__renderTarget),Pi=ke.get(Qs.__renderTarget);oi.bindFramebuffer(zt.READ_FRAMEBUFFER,Ln.__webglFramebuffer),oi.bindFramebuffer(zt.DRAW_FRAMEBUFFER,Pi.__webglFramebuffer);for(let vr=0;vr<Ze;vr++)ns&&zt.framebufferTextureLayer(zt.READ_FRAMEBUFFER,zt.COLOR_ATTACHMENT0,ke.get(rt).__webglTexture,Rt,li+vr),rt.isDepthTexture?(on&&zt.framebufferTextureLayer(zt.DRAW_FRAMEBUFFER,zt.COLOR_ATTACHMENT0,ke.get(At).__webglTexture,Rt,Ri+vr),zt.blitFramebuffer(Ye,ei,pe,ce,Je,wi,pe,ce,zt.DEPTH_BUFFER_BIT,zt.NEAREST)):on?zt.copyTexSubImage3D(Ke,Rt,Je,wi,Ri+vr,Ye,ei,pe,ce):zt.copyTexSubImage2D(Ke,Rt,Je,wi,Ri+vr,Ye,ei,pe,ce);oi.bindFramebuffer(zt.READ_FRAMEBUFFER,null),oi.bindFramebuffer(zt.DRAW_FRAMEBUFFER,null)}else on?rt.isDataTexture||rt.isData3DTexture?zt.texSubImage3D(Ke,Rt,Je,wi,Ri,pe,ce,Ze,An,pi,qi.data):At.isCompressedArrayTexture?zt.compressedTexSubImage3D(Ke,Rt,Je,wi,Ri,pe,ce,Ze,An,qi.data):zt.texSubImage3D(Ke,Rt,Je,wi,Ri,pe,ce,Ze,An,pi,qi):rt.isDataTexture?zt.texSubImage2D(zt.TEXTURE_2D,Rt,Je,wi,pe,ce,An,pi,qi.data):rt.isCompressedTexture?zt.compressedTexSubImage2D(zt.TEXTURE_2D,Rt,Je,wi,qi.width,qi.height,An,qi.data):zt.texSubImage2D(zt.TEXTURE_2D,Rt,Je,wi,pe,ce,An,pi,qi);zt.pixelStorei(zt.UNPACK_ROW_LENGTH,Dn),zt.pixelStorei(zt.UNPACK_IMAGE_HEIGHT,ui),zt.pixelStorei(zt.UNPACK_SKIP_PIXELS,hs),zt.pixelStorei(zt.UNPACK_SKIP_ROWS,Zn),zt.pixelStorei(zt.UNPACK_SKIP_IMAGES,is),Rt===0&&At.generateMipmaps&&zt.generateMipmap(Ke),oi.unbindTexture()},this.copyTextureToTexture3D=function(rt,At,Vt=null,jt=null,Rt=0){return rt.isTexture!==!0&&(fp("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Vt=arguments[0]||null,jt=arguments[1]||null,rt=arguments[2],At=arguments[3],Rt=arguments[4]||0),fp('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(rt,At,Vt,jt,Rt)},this.initRenderTarget=function(rt){ke.get(rt).__webglFramebuffer===void 0&&mt.setupRenderTarget(rt)},this.initTexture=function(rt){rt.isCubeTexture?mt.setTextureCube(rt,0):rt.isData3DTexture?mt.setTexture3D(rt,0):rt.isDataArrayTexture||rt.isCompressedArrayTexture?mt.setTexture2DArray(rt,0):mt.setTexture2D(rt,0),oi.unbindTexture()},this.resetState=function(){Y=0,K=0,nt=null,oi.reset(),Re.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Uo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=ji._getDrawingBufferColorSpace(t),e.unpackColorSpace=ji._getUnpackColorSpace()}}class FU extends Un{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new lo,this.environmentIntensity=1,this.environmentRotation=new lo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class zU{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Jv,this.updateRanges=[],this.version=0,this.uuid=Ua()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,l=this.stride;s<l;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ua()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ua()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const rr=new _t;class l1{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)rr.fromBufferAttribute(this,e),rr.applyMatrix4(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)rr.fromBufferAttribute(this,e),rr.applyNormalMatrix(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)rr.fromBufferAttribute(this,e),rr.transformDirection(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=Ba(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=hn(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Ba(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Ba(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Ba(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Ba(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),s=hn(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,l){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),s=hn(s,this.array),l=hn(l,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=l,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[s+l])}return new $n(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new l1(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)e.push(this.data.array[s+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const $S=new _t,ZS=new en,YS=new en,OU=new _t,KS=new _i,B_=new _t,vx=new Ys,JS=new _i,bx=new _h;class BU extends os{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=tS,this.bindMatrix=new _i,this.bindMatrixInverse=new _i,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Nn),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,B_),this.boundingBox.expandByPoint(B_)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ys),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,B_),this.boundingSphere.expandByPoint(B_)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vx.copy(this.boundingSphere),vx.applyMatrix4(s),t.ray.intersectsSphere(vx)!==!1&&(JS.copy(s).invert(),bx.copy(t.ray).applyMatrix4(JS),!(this.boundingBox!==null&&bx.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,bx)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new en,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.fromBufferAttribute(e,i);const l=1/t.manhattanLength();l!==1/0?t.multiplyScalar(l):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===tS?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===jk?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,s=this.geometry;ZS.fromBufferAttribute(s.attributes.skinIndex,t),YS.fromBufferAttribute(s.attributes.skinWeight,t),$S.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let l=0;l<4;l++){const c=YS.getComponent(l);if(c!==0){const o=ZS.getComponent(l);KS.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),e.addScaledVector(OU.copy($S).applyMatrix4(KS),c)}}return e.applyMatrix4(this.bindMatrixInverse)}}class CA extends Un{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ep extends Ms{constructor(t=null,e=1,i=1,s,l,c,o,p,m=mr,x=mr,v,b){super(null,c,o,p,m,x,s,l,v,b),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const QS=new _i,NU=new _i;class c1{constructor(t=[],e=[]){this.uuid=Ua(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new _i)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new _i;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let l=0,c=t.length;l<c;l++){const o=t[l]?t[l].matrixWorld:NU;QS.multiplyMatrices(o,e[l]),QS.toArray(i,l*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new c1(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Ep(e,t,t,Lr,ia);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];if(s.name===t)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const l=t.bones[i];let c=e[l];c===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),c=new CA),this.bones.push(c),this.boneInverses.push(new _i().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,l=e.length;s<l;s++){const c=e[s];t.bones.push(c.uuid);const o=i[s];t.boneInverses.push(o.toArray())}return t}}class tb extends $n{constructor(t,e,i,s=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Su=new _i,tT=new _i,N_=[],eT=new Nn,UU=new _i,Wf=new os,qf=new Ys;class VU extends os{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new tb(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,UU)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Nn),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Su),eT.copy(t.boundingBox).applyMatrix4(Su),this.boundingBox.union(eT)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ys),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Su),qf.copy(t.boundingSphere).applyMatrix4(Su),this.boundingSphere.union(qf)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const i=e.morphTargetInfluences,s=this.morphTexture.source.data.data,l=i.length+1,c=t*l+1;for(let o=0;o<i.length;o++)i[o]=s[c+o]}raycast(t,e){const i=this.matrixWorld,s=this.count;if(Wf.geometry=this.geometry,Wf.material=this.material,Wf.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),qf.copy(this.boundingSphere),qf.applyMatrix4(i),t.ray.intersectsSphere(qf)!==!1))for(let l=0;l<s;l++){this.getMatrixAt(l,Su),tT.multiplyMatrices(i,Su),Wf.matrixWorld=tT,Wf.raycast(t,N_);for(let c=0,o=N_.length;c<o;c++){const p=N_[c];p.instanceId=l,p.object=this,e.push(p)}N_.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new tb(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const i=e.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new Ep(new Float32Array(s*this.count),s,this.count,t1,ia));const l=this.morphTexture.source.data.data;let c=0;for(let m=0;m<i.length;m++)c+=i[m];const o=this.geometry.morphTargetsRelative?1:1-c,p=s*t;l[p]=o,l.set(i,p+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function wx(n,t){return n-t}function GU(n,t){return n.z-t.z}function HU(n,t){return t.z-n.z}class jU{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,i,s){const l=this.pool,c=this.list;this.index>=l.length&&l.push({start:-1,count:-1,z:-1,index:-1});const o=l[this.index];c.push(o),this.index++,o.start=t,o.count=e,o.z=i,o.index=s}reset(){this.list.length=0,this.index=0}}const Cr=new _i,WU=new vi(1,1,1),Mx=new _0,U_=new Nn,Uc=new Ys,Xf=new _t,iT=new _t,qU=new _t,Sx=new jU,qs=new os,V_=[];function XU(n,t,e=0){const i=t.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==t.array.constructor){const s=n.count;for(let l=0;l<s;l++)for(let c=0;c<i;c++)t.setComponent(l+e,c,n.getComponent(l,c))}else t.array.set(n.array,e*i);t.needsUpdate=!0}function Vc(n,t){if(n.constructor!==t.constructor){const e=Math.min(n.length,t.length);for(let i=0;i<e;i++)t[i]=n[i]}else{const e=Math.min(n.length,t.length);t.set(new n.constructor(n.buffer,0,e))}}class $U extends os{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(t,e,i=e*2,s){super(new Br,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4),i=new Ep(e,t,t,Lr,ia);this._matricesTexture=i}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),i=new Ep(e,t,t,p0,tc);this._indirectTexture=i}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),i=new Ep(e,t,t,Lr,ia);i.colorSpace=ji.workingColorSpace,this._colorsTexture=i}_initializeGeometry(t){const e=this.geometry,i=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const l in t.attributes){const c=t.getAttribute(l),{array:o,itemSize:p,normalized:m}=c,x=new o.constructor(i*p),v=new $n(x,p,m);e.setAttribute(l,v)}if(t.getIndex()!==null){const l=i>65535?new Uint32Array(s):new Uint16Array(s);e.setIndex(new $n(l,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(!!t.getIndex()!=!!e.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in e.attributes){if(!t.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const s=t.getAttribute(i),l=e.getAttribute(i);if(s.itemSize!==l.itemSize||s.normalized!==l.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let i=0,s=e.length;i<s;i++){if(e[i].active===!1)continue;const l=e[i].geometryIndex;this.getMatrixAt(i,Cr),this.getBoundingBoxAt(l,U_).applyMatrix4(Cr),t.union(U_)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ys);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let i=0,s=e.length;i<s;i++){if(e[i].active===!1)continue;const l=e[i].geometryIndex;this.getMatrixAt(i,Cr),this.getBoundingSphereAt(l,Uc).applyMatrix4(Cr),t.union(Uc)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:t};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(wx),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=i):(s=this._instanceInfo.length,this._instanceInfo.push(i));const l=this._matricesTexture;Cr.identity().toArray(l.image.data,s*16),l.needsUpdate=!0;const c=this._colorsTexture;return c&&(WU.toArray(c.image.data,s*4),c.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(t,e=-1,i=-1){this._initializeGeometry(t),this._validateGeometry(t);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},l=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=e===-1?t.getAttribute("position").count:e;const c=t.getIndex();if(c!==null&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=i===-1?c.count:i),s.indexStart!==-1&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let p;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(wx),p=this._availableGeometryIds.shift(),l[p]=s):(p=this._geometryCount,this._geometryCount++,l.push(s)),this.setGeometryAt(p,t),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,p}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const i=this.geometry,s=i.getIndex()!==null,l=i.getIndex(),c=e.getIndex(),o=this._geometryInfo[t];if(s&&c.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const p=o.vertexStart,m=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const x in i.attributes){const v=e.getAttribute(x),b=i.getAttribute(x);XU(v,b,p);const E=v.itemSize;for(let D=v.count,k=m;D<k;D++){const P=p+D;for(let I=0;I<E;I++)b.setComponent(P,I,0)}b.needsUpdate=!0,b.addUpdateRange(p*E,m*E)}if(s){const x=o.indexStart,v=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let b=0;b<c.count;b++)l.setX(x+b,p+c.getX(b));for(let b=c.count,E=v;b<E;b++)l.setX(x+b,p);l.needsUpdate=!0,l.addUpdateRange(x,o.reservedIndexCount)}return o.start=s?o.indexStart:o.vertexStart,o.count=s?o.indexCount:o.vertexCount,o.boundingBox=null,e.boundingBox!==null&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,e.boundingSphere!==null&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||e[t].active===!1)return this;const i=this._instanceInfo;for(let s=0,l=i.length;s<l;s++)i[s].geometryIndex===t&&this.deleteInstance(s);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?this:(e[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this)}optimize(){let t=0,e=0;const i=this._geometryInfo,s=i.map((c,o)=>o).sort((c,o)=>i[c].vertexStart-i[o].vertexStart),l=this.geometry;for(let c=0,o=i.length;c<o;c++){const p=s[c],m=i[p];if(m.active!==!1){if(l.index!==null){if(m.indexStart!==e){const{indexStart:x,vertexStart:v,reservedIndexCount:b}=m,E=l.index,D=E.array,k=t-v;for(let P=x;P<x+b;P++)D[P]=D[P]+k;E.array.copyWithin(e,x,x+b),E.addUpdateRange(e,b),m.indexStart=e}e+=m.reservedIndexCount}if(m.vertexStart!==t){const{vertexStart:x,reservedVertexCount:v}=m,b=l.attributes;for(const E in b){const D=b[E],{array:k,itemSize:P}=D;k.copyWithin(t*P,x*P,(x+v)*P),D.addUpdateRange(t*P,v*P)}m.vertexStart=t}t+=m.reservedVertexCount,m.start=l.index?m.indexStart:m.vertexStart,this._nextIndexStart=l.index?m.indexStart+m.reservedIndexCount:0,this._nextVertexStart=m.vertexStart+m.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[t];if(s.boundingBox===null){const l=new Nn,c=i.index,o=i.attributes.position;for(let p=s.start,m=s.start+s.count;p<m;p++){let x=p;c&&(x=c.getX(x)),l.expandByPoint(Xf.fromBufferAttribute(o,x))}s.boundingBox=l}return e.copy(s.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[t];if(s.boundingSphere===null){const l=new Ys;this.getBoundingBoxAt(t,U_),U_.getCenter(l.center);const c=i.index,o=i.attributes.position;let p=0;for(let m=s.start,x=s.start+s.count;m<x;m++){let v=m;c&&(v=c.getX(v)),Xf.fromBufferAttribute(o,v),p=Math.max(p,l.center.distanceToSquared(Xf))}l.radius=Math.sqrt(p),s.boundingSphere=l}return e.copy(s.boundingSphere),e}setMatrixAt(t,e){const i=this._instanceInfo,s=this._matricesTexture,l=this._matricesTexture.image.data;return t>=i.length||i[t].active===!1?this:(e.toArray(l,t*16),s.needsUpdate=!0,this)}getMatrixAt(t,e){const i=this._instanceInfo,s=this._matricesTexture.image.data;return t>=i.length||i[t].active===!1?null:e.fromArray(s,t*16)}setColorAt(t,e){this._colorsTexture===null&&this._initColorsTexture();const i=this._colorsTexture,s=this._colorsTexture.image.data,l=this._instanceInfo;return t>=l.length||l[t].active===!1?this:(e.toArray(s,t*4),i.needsUpdate=!0,this)}getColorAt(t,e){const i=this._colorsTexture.image.data,s=this._instanceInfo;return t>=s.length||s[t].active===!1?null:e.fromArray(i,t*4)}setVisibleAt(t,e){const i=this._instanceInfo;return t>=i.length||i[t].active===!1||i[t].visible===e?this:(i[t].visible=e,this._visibilityChanged=!0,this)}getVisibleAt(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?!1:e[t].visible}setGeometryIdAt(t,e){const i=this._instanceInfo,s=this._geometryInfo;return t>=i.length||i[t].active===!1||e>=s.length||s[e].active===!1?null:(i[t].geometryIndex=e,this)}getGeometryIdAt(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?-1:e[t].geometryIndex}getGeometryRangeAt(t,e={}){if(t<0||t>=this._geometryCount)return null;const i=this._geometryInfo[t];return e.vertexStart=i.vertexStart,e.vertexCount=i.vertexCount,e.reservedVertexCount=i.reservedVertexCount,e.indexStart=i.indexStart,e.indexCount=i.indexCount,e.reservedIndexCount=i.reservedIndexCount,e.start=i.start,e.count=i.count,e}setInstanceCount(t){const e=this._availableInstanceIds,i=this._instanceInfo;for(e.sort(wx);e[e.length-1]===i.length;)i.pop(),e.pop();if(t<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const s=new Int32Array(t),l=new Int32Array(t);Vc(this._multiDrawCounts,s),Vc(this._multiDrawStarts,l),this._multiDrawCounts=s,this._multiDrawStarts=l,this._maxInstanceCount=t;const c=this._indirectTexture,o=this._matricesTexture,p=this._colorsTexture;c.dispose(),this._initIndirectTexture(),Vc(c.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Vc(o.image.data,this._matricesTexture.image.data),p&&(p.dispose(),this._initColorsTexture(),Vc(p.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const i=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...i.map(o=>o.vertexStart+o.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(p=>p.indexStart+p.reservedIndexCount))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const l=this.geometry;l.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Br,this._initializeGeometry(l));const c=this.geometry;l.index&&Vc(l.index.array,c.index.array);for(const o in l.attributes)Vc(l.attributes[o].array,c.attributes[o].array)}raycast(t,e){const i=this._instanceInfo,s=this._geometryInfo,l=this.matrixWorld,c=this.geometry;qs.material=this.material,qs.geometry.index=c.index,qs.geometry.attributes=c.attributes,qs.geometry.boundingBox===null&&(qs.geometry.boundingBox=new Nn),qs.geometry.boundingSphere===null&&(qs.geometry.boundingSphere=new Ys);for(let o=0,p=i.length;o<p;o++){if(!i[o].visible||!i[o].active)continue;const m=i[o].geometryIndex,x=s[m];qs.geometry.setDrawRange(x.start,x.count),this.getMatrixAt(o,qs.matrixWorld).premultiply(l),this.getBoundingBoxAt(m,qs.geometry.boundingBox),this.getBoundingSphereAt(m,qs.geometry.boundingSphere),qs.raycast(t,V_);for(let v=0,b=V_.length;v<b;v++){const E=V_[v];E.object=this,E.batchId=o,e.push(E)}V_.length=0}qs.material=null,qs.geometry.index=null,qs.geometry.attributes={},qs.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox!==null?e.boundingBox.clone():null,boundingSphere:e.boundingSphere!==null?e.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(e=>({...e})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,e,i,s,l){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const c=s.getIndex(),o=c===null?1:c.array.BYTES_PER_ELEMENT,p=this._instanceInfo,m=this._multiDrawStarts,x=this._multiDrawCounts,v=this._geometryInfo,b=this.perObjectFrustumCulled,E=this._indirectTexture,D=E.image.data;b&&(Cr.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),Mx.setFromProjectionMatrix(Cr,t.coordinateSystem));let k=0;if(this.sortObjects){Cr.copy(this.matrixWorld).invert(),Xf.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Cr),iT.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Cr);for(let V=0,U=p.length;V<U;V++)if(p[V].visible&&p[V].active){const B=p[V].geometryIndex;this.getMatrixAt(V,Cr),this.getBoundingSphereAt(B,Uc).applyMatrix4(Cr);let Z=!1;if(b&&(Z=!Mx.intersectsSphere(Uc)),!Z){const Y=v[B],K=qU.subVectors(Uc.center,Xf).dot(iT);Sx.push(Y.start,Y.count,K,V)}}const P=Sx.list,I=this.customSort;I===null?P.sort(l.transparent?HU:GU):I.call(this,P,i);for(let V=0,U=P.length;V<U;V++){const B=P[V];m[k]=B.start*o,x[k]=B.count,D[k]=B.index,k++}Sx.reset()}else for(let P=0,I=p.length;P<I;P++)if(p[P].visible&&p[P].active){const V=p[P].geometryIndex;let U=!1;if(b&&(this.getMatrixAt(P,Cr),this.getBoundingSphereAt(V,Uc).applyMatrix4(Cr),U=!Mx.intersectsSphere(Uc)),!U){const B=v[V];m[k]=B.start*o,x[k]=B.count,D[k]=P,k++}}E.needsUpdate=!0,this._multiDrawCount=k,this._visibilityChanged=!1}onBeforeShadow(t,e,i,s,l,c){this.onBeforeRender(t,null,s,l,c)}}class PA extends ro{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new vi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Wg=new _t,qg=new _t,nT=new _i,$f=new _h,G_=new Ys,Tx=new _t,sT=new _t;class h1 extends Un{constructor(t=new Br,e=new PA){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,l=e.count;s<l;s++)Wg.fromBufferAttribute(e,s-1),qg.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=Wg.distanceTo(qg);t.setAttribute("lineDistance",new na(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,l=t.params.Line.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),G_.copy(i.boundingSphere),G_.applyMatrix4(s),G_.radius+=l,t.ray.intersectsSphere(G_)===!1)return;nT.copy(s).invert(),$f.copy(t.ray).applyMatrix4(nT);const o=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=o*o,m=this.isLineSegments?2:1,x=i.index,b=i.attributes.position;if(x!==null){const E=Math.max(0,c.start),D=Math.min(x.count,c.start+c.count);for(let k=E,P=D-1;k<P;k+=m){const I=x.getX(k),V=x.getX(k+1),U=H_(this,t,$f,p,I,V);U&&e.push(U)}if(this.isLineLoop){const k=x.getX(D-1),P=x.getX(E),I=H_(this,t,$f,p,k,P);I&&e.push(I)}}else{const E=Math.max(0,c.start),D=Math.min(b.count,c.start+c.count);for(let k=E,P=D-1;k<P;k+=m){const I=H_(this,t,$f,p,k,k+1);I&&e.push(I)}if(this.isLineLoop){const k=H_(this,t,$f,p,D-1,E);k&&e.push(k)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,c=s.length;l<c;l++){const o=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=l}}}}}function H_(n,t,e,i,s,l){const c=n.geometry.attributes.position;if(Wg.fromBufferAttribute(c,s),qg.fromBufferAttribute(c,l),e.distanceSqToSegment(Wg,qg,Tx,sT)>i)return;Tx.applyMatrix4(n.matrixWorld);const p=t.ray.origin.distanceTo(Tx);if(!(p<t.near||p>t.far))return{distance:p,point:sT.clone().applyMatrix4(n.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:n}}const rT=new _t,aT=new _t;class IA extends h1{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let s=0,l=e.count;s<l;s+=2)rT.fromBufferAttribute(e,s),aT.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+rT.distanceTo(aT);t.setAttribute("lineDistance",new na(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ZU extends h1{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class RA extends ro{static get type(){return"PointsMaterial"}constructor(t){super(),this.isPointsMaterial=!0,this.color=new vi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const oT=new _i,eb=new _h,j_=new Ys,W_=new _t;class YU extends Un{constructor(t=new Br,e=new RA){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,l=t.params.Points.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),j_.copy(i.boundingSphere),j_.applyMatrix4(s),j_.radius+=l,t.ray.intersectsSphere(j_)===!1)return;oT.copy(s).invert(),eb.copy(t.ray).applyMatrix4(oT);const o=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=o*o,m=i.index,v=i.attributes.position;if(m!==null){const b=Math.max(0,c.start),E=Math.min(m.count,c.start+c.count);for(let D=b,k=E;D<k;D++){const P=m.getX(D);W_.fromBufferAttribute(v,P),lT(W_,P,p,s,t,e,this)}}else{const b=Math.max(0,c.start),E=Math.min(v.count,c.start+c.count);for(let D=b,k=E;D<k;D++)W_.fromBufferAttribute(v,D),lT(W_,D,p,s,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,c=s.length;l<c;l++){const o=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=l}}}}}function lT(n,t,e,i,s,l,c){const o=eb.distanceSqToPoint(n);if(o<e){const p=new _t;eb.closestPointToPoint(n,p),p.applyMatrix4(i);const m=s.ray.origin.distanceTo(p);if(m<s.near||m>s.far)return;l.push({distance:m,distanceToRay:Math.sqrt(o),point:p,index:t,face:null,faceIndex:null,barycoord:null,object:c})}}class u1 extends ro{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new vi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uA,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ho extends u1{static get type(){return"MeshPhysicalMaterial"}constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new si(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new vi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new vi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new vi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function q_(n,t,e){return!n||!e&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function KU(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function JU(n){function t(s,l){return n[s]-n[l]}const e=n.length,i=new Array(e);for(let s=0;s!==e;++s)i[s]=s;return i.sort(t),i}function cT(n,t,e){const i=n.length,s=new n.constructor(i);for(let l=0,c=0;c!==i;++l){const o=e[l]*t;for(let p=0;p!==t;++p)s[c++]=n[o+p]}return s}function DA(n,t,e,i){let s=1,l=n[0];for(;l!==void 0&&l[i]===void 0;)l=n[s++];if(l===void 0)return;let c=l[i];if(c!==void 0)if(Array.isArray(c))do c=l[i],c!==void 0&&(t.push(l.time),e.push.apply(e,c)),l=n[s++];while(l!==void 0);else if(c.toArray!==void 0)do c=l[i],c!==void 0&&(t.push(l.time),c.toArray(e,e.length)),l=n[s++];while(l!==void 0);else do c=l[i],c!==void 0&&(t.push(l.time),e.push(c)),l=n[s++];while(l!==void 0)}class lm{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],l=e[i-1];t:{e:{let c;i:{n:if(!(t<s)){for(let o=i+2;;){if(s===void 0){if(t<l)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(l=s,s=e[++i],t<s)break e}c=e.length;break i}if(!(t>=l)){const o=e[1];t<o&&(i=2,l=o);for(let p=i-2;;){if(l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===p)break;if(s=l,l=e[--i-1],t>=l)break e}c=i,i=0;break i}break t}for(;i<c;){const o=i+c>>>1;t<e[o]?c=o:i=o+1}if(s=e[i],l=e[i-1],l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,l,s)}return this.interpolate_(i,l,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,l=t*s;for(let c=0;c!==s;++c)e[c]=i[l+c];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class QU extends lm{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Vu,endingEnd:Vu}}intervalChanged_(t,e,i){const s=this.parameterPositions;let l=t-2,c=t+1,o=s[l],p=s[c];if(o===void 0)switch(this.getSettings_().endingStart){case Gu:l=t,o=2*e-i;break;case Hg:l=s.length-2,o=e+s[l]-s[l+1];break;default:l=t,o=i}if(p===void 0)switch(this.getSettings_().endingEnd){case Gu:c=t,p=2*i-e;break;case Hg:c=1,p=i+s[1]-s[0];break;default:c=t-1,p=e}const m=(i-e)*.5,x=this.valueSize;this._weightPrev=m/(e-o),this._weightNext=m/(p-i),this._offsetPrev=l*x,this._offsetNext=c*x}interpolate_(t,e,i,s){const l=this.resultBuffer,c=this.sampleValues,o=this.valueSize,p=t*o,m=p-o,x=this._offsetPrev,v=this._offsetNext,b=this._weightPrev,E=this._weightNext,D=(i-e)/(s-e),k=D*D,P=k*D,I=-b*P+2*b*k-b*D,V=(1+b)*P+(-1.5-2*b)*k+(-.5+b)*D+1,U=(-1-E)*P+(1.5+E)*k+.5*D,B=E*P-E*k;for(let Z=0;Z!==o;++Z)l[Z]=I*c[x+Z]+V*c[m+Z]+U*c[p+Z]+B*c[v+Z];return l}}class LA extends lm{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const l=this.resultBuffer,c=this.sampleValues,o=this.valueSize,p=t*o,m=p-o,x=(i-e)/(s-e),v=1-x;for(let b=0;b!==o;++b)l[b]=c[m+b]*v+c[p+b]*x;return l}}class t4 extends lm{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class uo{constructor(t,e,i,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=q_(e,this.TimeBufferType),this.values=q_(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:q_(t.times,Array),values:q_(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new t4(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LA(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new QU(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Np:e=this.InterpolantFactoryMethodDiscrete;break;case Up:e=this.InterpolantFactoryMethodLinear;break;case qy:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Np;case this.InterpolantFactoryMethodLinear:return Up;case this.InterpolantFactoryMethodSmooth:return qy}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let l=0,c=s-1;for(;l!==s&&i[l]<t;)++l;for(;c!==-1&&i[c]>e;)--c;if(++c,l!==0||c!==s){l>=c&&(c=Math.max(c,1),l=c-1);const o=this.getValueSize();this.times=i.slice(l,c),this.values=this.values.slice(l*o,c*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,l=i.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let c=null;for(let o=0;o!==l;o++){const p=i[o];if(typeof p=="number"&&isNaN(p)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,p),t=!1;break}if(c!==null&&c>p){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,p,c),t=!1;break}c=p}if(s!==void 0&&KU(s))for(let o=0,p=s.length;o!==p;++o){const m=s[o];if(isNaN(m)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,m),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===qy,l=t.length-1;let c=1;for(let o=1;o<l;++o){let p=!1;const m=t[o],x=t[o+1];if(m!==x&&(o!==1||m!==t[0]))if(s)p=!0;else{const v=o*i,b=v-i,E=v+i;for(let D=0;D!==i;++D){const k=e[v+D];if(k!==e[b+D]||k!==e[E+D]){p=!0;break}}}if(p){if(o!==c){t[c]=t[o];const v=o*i,b=c*i;for(let E=0;E!==i;++E)e[b+E]=e[v+E]}++c}}if(l>0){t[c]=t[l];for(let o=l*i,p=c*i,m=0;m!==i;++m)e[p+m]=e[o+m];++c}return c!==t.length?(this.times=t.slice(0,c),this.values=e.slice(0,c*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}uo.prototype.TimeBufferType=Float32Array;uo.prototype.ValueBufferType=Float32Array;uo.prototype.DefaultInterpolation=Up;class Rd extends uo{constructor(t,e,i){super(t,e,i)}}Rd.prototype.ValueTypeName="bool";Rd.prototype.ValueBufferType=Array;Rd.prototype.DefaultInterpolation=Np;Rd.prototype.InterpolantFactoryMethodLinear=void 0;Rd.prototype.InterpolantFactoryMethodSmooth=void 0;class kA extends uo{}kA.prototype.ValueTypeName="color";class yd extends uo{}yd.prototype.ValueTypeName="number";class e4 extends lm{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const l=this.resultBuffer,c=this.sampleValues,o=this.valueSize,p=(i-e)/(s-e);let m=t*o;for(let x=m+o;m!==x;m+=4)_r.slerpFlat(l,0,c,m-o,c,m,p);return l}}class xd extends uo{InterpolantFactoryMethodLinear(t){return new e4(this.times,this.values,this.getValueSize(),t)}}xd.prototype.ValueTypeName="quaternion";xd.prototype.InterpolantFactoryMethodSmooth=void 0;class Dd extends uo{constructor(t,e,i){super(t,e,i)}}Dd.prototype.ValueTypeName="string";Dd.prototype.ValueBufferType=Array;Dd.prototype.DefaultInterpolation=Np;Dd.prototype.InterpolantFactoryMethodLinear=void 0;Dd.prototype.InterpolantFactoryMethodSmooth=void 0;class vd extends uo{}vd.prototype.ValueTypeName="vector";class ib{constructor(t="",e=-1,i=[],s=n1){this.name=t,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=Ua(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,s=1/(t.fps||1);for(let c=0,o=i.length;c!==o;++c)e.push(n4(i[c]).scale(s));const l=new this(t.name,t.duration,e,t.blendMode);return l.uuid=t.uuid,l}static toJSON(t){const e=[],i=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let l=0,c=i.length;l!==c;++l)e.push(uo.toJSON(i[l]));return s}static CreateFromMorphTargetSequence(t,e,i,s){const l=e.length,c=[];for(let o=0;o<l;o++){let p=[],m=[];p.push((o+l-1)%l,o,(o+1)%l),m.push(0,1,0);const x=JU(p);p=cT(p,1,x),m=cT(m,1,x),!s&&p[0]===0&&(p.push(l),m.push(m[0])),c.push(new yd(".morphTargetInfluences["+e[o].name+"]",p,m).scale(1/i))}return new this(t,-1,c)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const s=t;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const s={},l=/^([\w-]*?)([\d]+)$/;for(let o=0,p=t.length;o<p;o++){const m=t[o],x=m.name.match(l);if(x&&x.length>1){const v=x[1];let b=s[v];b||(s[v]=b=[]),b.push(m)}}const c=[];for(const o in s)c.push(this.CreateFromMorphTargetSequence(o,s[o],e,i));return c}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(v,b,E,D,k){if(E.length!==0){const P=[],I=[];DA(E,P,I,D),P.length!==0&&k.push(new v(b,P,I))}},s=[],l=t.name||"default",c=t.fps||30,o=t.blendMode;let p=t.length||-1;const m=t.hierarchy||[];for(let v=0;v<m.length;v++){const b=m[v].keys;if(!(!b||b.length===0))if(b[0].morphTargets){const E={};let D;for(D=0;D<b.length;D++)if(b[D].morphTargets)for(let k=0;k<b[D].morphTargets.length;k++)E[b[D].morphTargets[k]]=-1;for(const k in E){const P=[],I=[];for(let V=0;V!==b[D].morphTargets.length;++V){const U=b[D];P.push(U.time),I.push(U.morphTarget===k?1:0)}s.push(new yd(".morphTargetInfluence["+k+"]",P,I))}p=E.length*c}else{const E=".bones["+e[v].name+"]";i(vd,E+".position",b,"pos",s),i(xd,E+".quaternion",b,"rot",s),i(vd,E+".scale",b,"scl",s)}}return s.length===0?null:new this(l,p,s,o)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,s=t.length;i!==s;++i){const l=this.tracks[i];e=Math.max(e,l.times[l.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function i4(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yd;case"vector":case"vector2":case"vector3":case"vector4":return vd;case"color":return kA;case"quaternion":return xd;case"bool":case"boolean":return Rd;case"string":return Dd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function n4(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=i4(n.type);if(n.times===void 0){const e=[],i=[];DA(n.keys,e,i,"value"),n.times=e,n.values=i}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Vl={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class s4{constructor(t,e,i){const s=this;let l=!1,c=0,o=0,p;const m=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(x){o++,l===!1&&s.onStart!==void 0&&s.onStart(x,c,o),l=!0},this.itemEnd=function(x){c++,s.onProgress!==void 0&&s.onProgress(x,c,o),c===o&&(l=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(x){s.onError!==void 0&&s.onError(x)},this.resolveURL=function(x){return p?p(x):x},this.setURLModifier=function(x){return p=x,this},this.addHandler=function(x,v){return m.push(x,v),this},this.removeHandler=function(x){const v=m.indexOf(x);return v!==-1&&m.splice(v,2),this},this.getHandler=function(x){for(let v=0,b=m.length;v<b;v+=2){const E=m[v],D=m[v+1];if(E.global&&(E.lastIndex=0),E.test(x))return D}return null}}}const r4=new s4;class Ld{constructor(t){this.manager=t!==void 0?t:r4,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,l){i.load(t,s,e,l)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ld.DEFAULT_MATERIAL_NAME="__DEFAULT";const Lo={};class a4 extends Error{constructor(t,e){super(t),this.response=e}}class FA extends Ld{constructor(t){super(t)}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const l=Vl.get(t);if(l!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(l),this.manager.itemEnd(t)},0),l;if(Lo[t]!==void 0){Lo[t].push({onLoad:e,onProgress:i,onError:s});return}Lo[t]=[],Lo[t].push({onLoad:e,onProgress:i,onError:s});const c=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,p=this.responseType;fetch(c).then(m=>{if(m.status===200||m.status===0){if(m.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||m.body===void 0||m.body.getReader===void 0)return m;const x=Lo[t],v=m.body.getReader(),b=m.headers.get("X-File-Size")||m.headers.get("Content-Length"),E=b?parseInt(b):0,D=E!==0;let k=0;const P=new ReadableStream({start(I){V();function V(){v.read().then(({done:U,value:B})=>{if(U)I.close();else{k+=B.byteLength;const Z=new ProgressEvent("progress",{lengthComputable:D,loaded:k,total:E});for(let Y=0,K=x.length;Y<K;Y++){const nt=x[Y];nt.onProgress&&nt.onProgress(Z)}I.enqueue(B),V()}},U=>{I.error(U)})}}});return new Response(P)}else throw new a4(`fetch for "${m.url}" responded with ${m.status}: ${m.statusText}`,m)}).then(m=>{switch(p){case"arraybuffer":return m.arrayBuffer();case"blob":return m.blob();case"document":return m.text().then(x=>new DOMParser().parseFromString(x,o));case"json":return m.json();default:if(o===void 0)return m.text();{const v=/charset="?([^;"\s]*)"?/i.exec(o),b=v&&v[1]?v[1].toLowerCase():void 0,E=new TextDecoder(b);return m.arrayBuffer().then(D=>E.decode(D))}}}).then(m=>{Vl.add(t,m);const x=Lo[t];delete Lo[t];for(let v=0,b=x.length;v<b;v++){const E=x[v];E.onLoad&&E.onLoad(m)}}).catch(m=>{const x=Lo[t];if(x===void 0)throw this.manager.itemError(t),m;delete Lo[t];for(let v=0,b=x.length;v<b;v++){const E=x[v];E.onError&&E.onError(m)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class o4 extends Ld{constructor(t){super(t)}load(t,e,i,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const l=this,c=Vl.get(t);if(c!==void 0)return l.manager.itemStart(t),setTimeout(function(){e&&e(c),l.manager.itemEnd(t)},0),c;const o=Vp("img");function p(){x(),Vl.add(t,this),e&&e(this),l.manager.itemEnd(t)}function m(v){x(),s&&s(v),l.manager.itemError(t),l.manager.itemEnd(t)}function x(){o.removeEventListener("load",p,!1),o.removeEventListener("error",m,!1)}return o.addEventListener("load",p,!1),o.addEventListener("error",m,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),l.manager.itemStart(t),o.src=t,o}}class l4 extends Ld{constructor(t){super(t)}load(t,e,i,s){const l=new Ms,c=new o4(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(t,function(o){l.image=o,l.needsUpdate=!0,e!==void 0&&e(l)},i,s),l}}class d1 extends Un{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new vi(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}const Ex=new _i,hT=new _t,uT=new _t;class f1{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new si(512,512),this.map=null,this.mapPass=null,this.matrix=new _i,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new _0,this._frameExtents=new si(1,1),this._viewportCount=1,this._viewports=[new en(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;hT.setFromMatrixPosition(t.matrixWorld),e.position.copy(hT),uT.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(uT),e.updateMatrixWorld(),Ex.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ex),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Ex)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class c4 extends f1{constructor(){super(new hr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=_d*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,l=t.distance||e.far;(i!==e.fov||s!==e.aspect||l!==e.far)&&(e.fov=i,e.aspect=s,e.far=l,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class h4 extends d1{constructor(t,e,i=0,s=Math.PI/3,l=0,c=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Un.DEFAULT_UP),this.updateMatrix(),this.target=new Un,this.distance=i,this.angle=s,this.penumbra=l,this.decay=c,this.map=null,this.shadow=new c4}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const dT=new _i,Zf=new _t,Ax=new _t;class u4 extends f1{constructor(){super(new hr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new si(4,2),this._viewportCount=6,this._viewports=[new en(2,1,1,1),new en(0,1,1,1),new en(3,1,1,1),new en(1,1,1,1),new en(3,0,1,1),new en(1,0,1,1)],this._cubeDirections=[new _t(1,0,0),new _t(-1,0,0),new _t(0,0,1),new _t(0,0,-1),new _t(0,1,0),new _t(0,-1,0)],this._cubeUps=[new _t(0,1,0),new _t(0,1,0),new _t(0,1,0),new _t(0,1,0),new _t(0,0,1),new _t(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,s=this.matrix,l=t.distance||i.far;l!==i.far&&(i.far=l,i.updateProjectionMatrix()),Zf.setFromMatrixPosition(t.matrixWorld),i.position.copy(Zf),Ax.copy(i.position),Ax.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Ax),i.updateMatrixWorld(),s.makeTranslation(-Zf.x,-Zf.y,-Zf.z),dT.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dT)}}class d4 extends d1{constructor(t,e,i=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new u4}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class f4 extends f1{constructor(){super(new a1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class p4 extends d1{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Un.DEFAULT_UP),this.updateMatrix(),this.target=new Un,this.shadow=new f4}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Ap{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let i=0,s=t.length;i<s;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class m4 extends Ld{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const l=this,c=Vl.get(t);if(c!==void 0){if(l.manager.itemStart(t),c.then){c.then(m=>{e&&e(m),l.manager.itemEnd(t)}).catch(m=>{s&&s(m)});return}return setTimeout(function(){e&&e(c),l.manager.itemEnd(t)},0),c}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const p=fetch(t,o).then(function(m){return m.blob()}).then(function(m){return createImageBitmap(m,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(m){return Vl.add(t,m),e&&e(m),l.manager.itemEnd(t),m}).catch(function(m){s&&s(m),Vl.remove(t),l.manager.itemError(t),l.manager.itemEnd(t)});Vl.add(t,p),l.manager.itemStart(t)}}class _4{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=fT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=fT();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function fT(){return performance.now()}class g4{constructor(t,e,i){this.binding=t,this.valueSize=i;let s,l,c;switch(e){case"quaternion":s=this._slerp,l=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,l=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,l=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=l,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,s=this.valueSize,l=t*s+s;let c=this.cumulativeWeight;if(c===0){for(let o=0;o!==s;++o)i[l+o]=i[o];c=e}else{c+=e;const o=e/c;this._mixBufferRegion(i,l,0,o,s)}this.cumulativeWeight=c}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,s,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,s=t*e+e,l=this.cumulativeWeight,c=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1){const p=e*this._origIndex;this._mixBufferRegion(i,s,p,1-l,e)}c>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*e,1,e);for(let p=e,m=e+e;p!==m;++p)if(i[p]!==i[p+e]){o.setValue(i,s);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,s=i*this._origIndex;t.getValue(e,s);for(let l=i,c=s;l!==c;++l)e[l]=e[s+l%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,s,l){if(s>=.5)for(let c=0;c!==l;++c)t[e+c]=t[i+c]}_slerp(t,e,i,s){_r.slerpFlat(t,e,t,e,t,i,s)}_slerpAdditive(t,e,i,s,l){const c=this._workIndex*l;_r.multiplyQuaternionsFlat(t,c,t,e,t,i),_r.slerpFlat(t,e,t,e,t,c,s)}_lerp(t,e,i,s,l){const c=1-s;for(let o=0;o!==l;++o){const p=e+o;t[p]=t[p]*c+t[i+o]*s}}_lerpAdditive(t,e,i,s,l){for(let c=0;c!==l;++c){const o=e+c;t[o]=t[o]+t[i+c]*s}}}const p1="\\[\\]\\.:\\/",y4=new RegExp("["+p1+"]","g"),m1="[^"+p1+"]",x4="[^"+p1.replace("\\.","")+"]",v4=/((?:WC+[\/:])*)/.source.replace("WC",m1),b4=/(WCOD+)?/.source.replace("WCOD",x4),w4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",m1),M4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",m1),S4=new RegExp("^"+v4+b4+w4+M4+"$"),T4=["material","materials","bones","map"];class E4{constructor(t,e,i){const s=i||an.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,l=i.length;s!==l;++s)i[s].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}class an{constructor(t,e,i){this.path=e,this.parsedPath=i||an.parseTrackName(e),this.node=an.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new an.Composite(t,e,i):new an(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(y4,"")}static parseTrackName(t){const e=S4.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const l=i.nodeName.substring(s+1);T4.indexOf(l)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=l)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){const i=function(l){for(let c=0;c<l.length;c++){const o=l[c];if(o.name===e||o.uuid===e)return o;const p=i(o.children);if(p)return p}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)t[e++]=i[s]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,s=e.propertyName;let l=e.propertyIndex;if(t||(t=an.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let m=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let x=0;x<t.length;x++)if(t[x].name===m){m=x;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(m!==void 0){if(t[m]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[m]}}const c=t[s];if(c===void 0){const m=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+m+"."+s+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let p=this.BindingType.Direct;if(l!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[l]!==void 0&&(l=t.morphTargetDictionary[l])}p=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=l}else c.fromArray!==void 0&&c.toArray!==void 0?(p=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(p=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=s;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}an.Composite=E4;an.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};an.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};an.prototype.GetterByBindingType=[an.prototype._getValue_direct,an.prototype._getValue_array,an.prototype._getValue_arrayElement,an.prototype._getValue_toArray];an.prototype.SetterByBindingTypeAndVersioning=[[an.prototype._setValue_direct,an.prototype._setValue_direct_setNeedsUpdate,an.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[an.prototype._setValue_array,an.prototype._setValue_array_setNeedsUpdate,an.prototype._setValue_array_setMatrixWorldNeedsUpdate],[an.prototype._setValue_arrayElement,an.prototype._setValue_arrayElement_setNeedsUpdate,an.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[an.prototype._setValue_fromArray,an.prototype._setValue_fromArray_setNeedsUpdate,an.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class A4{constructor(t,e,i=null,s=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=s;const l=e.tracks,c=l.length,o=new Array(c),p={endingStart:Vu,endingEnd:Vu};for(let m=0;m!==c;++m){const x=l[m].createInterpolant(null);o[m]=x,x.settings=p}this._interpolantSettings=p,this._interpolants=o,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=qk,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const s=this._clip.duration,l=t._clip.duration,c=l/s,o=s/l;t.warp(1,c,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const s=this._mixer,l=s.time,c=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const p=o.parameterPositions,m=o.sampleValues;return p[0]=l,p[1]=l+i,m[0]=t/c,m[1]=e/c,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,s){if(!this.enabled){this._updateWeight(t);return}const l=this._startTime;if(l!==null){const p=(t-l)*i;p<0||i===0?e=0:(this._startTime=null,e=i*p)}e*=this._updateTimeScale(t);const c=this._updateTime(e),o=this._updateWeight(t);if(o>0){const p=this._interpolants,m=this._propertyBindings;switch(this.blendMode){case $k:for(let x=0,v=p.length;x!==v;++x)p[x].evaluate(c),m[x].accumulateAdditive(o);break;case n1:default:for(let x=0,v=p.length;x!==v;++x)p[x].evaluate(c),m[x].accumulate(s,o)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(t)[0];e*=s,t>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(t)[0];e*=s,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let s=this.time+t,l=this._loopCount;const c=i===Xk;if(t===0)return l===-1?s:c&&(l&1)===1?e-s:s;if(i===Wk){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(s>=e)s=e;else if(s<0)s=0;else{this.time=s;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(l===-1&&(t>=0?(l=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),s>=e||s<0){const o=Math.floor(s/e);s-=e*o,l+=Math.abs(o);const p=this.repetitions-l;if(p<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(p===1){const m=t<0;this._setEndings(m,!m,c)}else this._setEndings(!1,!1,c);this._loopCount=l,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(c&&(l&1)===1)return e-s}return s}_setEndings(t,e,i){const s=this._interpolantSettings;i?(s.endingStart=Gu,s.endingEnd=Gu):(t?s.endingStart=this.zeroSlopeAtStart?Gu:Vu:s.endingStart=Hg,e?s.endingEnd=this.zeroSlopeAtEnd?Gu:Vu:s.endingEnd=Hg)}_scheduleFading(t,e,i){const s=this._mixer,l=s.time;let c=this._weightInterpolant;c===null&&(c=s._lendControlInterpolant(),this._weightInterpolant=c);const o=c.parameterPositions,p=c.sampleValues;return o[0]=l,p[0]=e,o[1]=l+t,p[1]=i,this}}const C4=new Float32Array(1);class P4 extends ac{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,s=t._clip.tracks,l=s.length,c=t._propertyBindings,o=t._interpolants,p=i.uuid,m=this._bindingsByRootAndName;let x=m[p];x===void 0&&(x={},m[p]=x);for(let v=0;v!==l;++v){const b=s[v],E=b.name;let D=x[E];if(D!==void 0)++D.referenceCount,c[v]=D;else{if(D=c[v],D!==void 0){D._cacheIndex===null&&(++D.referenceCount,this._addInactiveBinding(D,p,E));continue}const k=e&&e._propertyBindings[v].binding.parsedPath;D=new g4(an.create(i,E,k),b.ValueTypeName,b.getValueSize()),++D.referenceCount,this._addInactiveBinding(D,p,E),c[v]=D}o[v].resultBuffer=D.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const i=(t._localRoot||this._root).uuid,s=t._clip.uuid,l=this._actionsByClip[s];this._bindAction(t,l&&l.knownActions[0]),this._addInactiveAction(t,s,i)}const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const l=e[i];l.useCount++===0&&(this._lendBinding(l),l.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const l=e[i];--l.useCount===0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){const s=this._actions,l=this._actionsByClip;let c=l[e];if(c===void 0)c={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,l[e]=c;else{const o=c.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=s.length,s.push(t),c.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],s=t._cacheIndex;i._cacheIndex=s,e[s]=i,e.pop(),t._cacheIndex=null;const l=t._clip.uuid,c=this._actionsByClip,o=c[l],p=o.knownActions,m=p[p.length-1],x=t._byClipCacheIndex;m._byClipCacheIndex=x,p[x]=m,p.pop(),t._byClipCacheIndex=null;const v=o.actionByRoot,b=(t._localRoot||this._root).uuid;delete v[b],p.length===0&&delete c[l],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const l=e[i];--l.referenceCount===0&&this._removeInactiveBinding(l)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,s=this._nActiveActions++,l=e[s];t._cacheIndex=s,e[s]=t,l._cacheIndex=i,e[i]=l}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,s=--this._nActiveActions,l=e[s];t._cacheIndex=s,e[s]=t,l._cacheIndex=i,e[i]=l}_addInactiveBinding(t,e,i){const s=this._bindingsByRootAndName,l=this._bindings;let c=s[e];c===void 0&&(c={},s[e]=c),c[i]=t,t._cacheIndex=l.length,l.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,s=i.rootNode.uuid,l=i.path,c=this._bindingsByRootAndName,o=c[s],p=e[e.length-1],m=t._cacheIndex;p._cacheIndex=m,e[m]=p,e.pop(),delete o[l],Object.keys(o).length===0&&delete c[s]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,s=this._nActiveBindings++,l=e[s];t._cacheIndex=s,e[s]=t,l._cacheIndex=i,e[i]=l}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,s=--this._nActiveBindings,l=e[s];t._cacheIndex=s,e[s]=t,l._cacheIndex=i,e[i]=l}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return i===void 0&&(i=new LA(new Float32Array(2),new Float32Array(2),1,C4),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,s=--this._nActiveControlInterpolants,l=e[s];t.__cacheIndex=s,e[s]=t,l.__cacheIndex=i,e[i]=l}clipAction(t,e,i){const s=e||this._root,l=s.uuid;let c=typeof t=="string"?ib.findByName(s,t):t;const o=c!==null?c.uuid:t,p=this._actionsByClip[o];let m=null;if(i===void 0&&(c!==null?i=c.blendMode:i=n1),p!==void 0){const v=p.actionByRoot[l];if(v!==void 0&&v.blendMode===i)return v;m=p.knownActions[0],c===null&&(c=m._clip)}if(c===null)return null;const x=new A4(this,c,e,i);return this._bindAction(x,m),this._addInactiveAction(x,o,l),x}existingAction(t,e){const i=e||this._root,s=i.uuid,l=typeof t=="string"?ib.findByName(i,t):t,c=l?l.uuid:t,o=this._actionsByClip[c];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,s=this.time+=t,l=Math.sign(t),c=this._accuIndex^=1;for(let m=0;m!==i;++m)e[m]._update(s,t,l,c);const o=this._bindings,p=this._nActiveBindings;for(let m=0;m!==p;++m)o[m].apply(c);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,s=this._actionsByClip,l=s[i];if(l!==void 0){const c=l.knownActions;for(let o=0,p=c.length;o!==p;++o){const m=c[o];this._deactivateAction(m);const x=m._cacheIndex,v=e[e.length-1];m._cacheIndex=null,m._byClipCacheIndex=null,v._cacheIndex=x,e[x]=v,e.pop(),this._removeInactiveBindingsForAction(m)}delete s[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const c in i){const o=i[c].actionByRoot,p=o[e];p!==void 0&&(this._deactivateAction(p),this._removeInactiveAction(p))}const s=this._bindingsByRootAndName,l=s[e];if(l!==void 0)for(const c in l){const o=l[c];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,e){const i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const pT=new _i;class _1{constructor(t,e,i=0,s=1/0){this.ray=new _h(t,e),this.near=i,this.far=s,this.camera=null,this.layers=new r1,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return pT.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(pT),this}intersectObject(t,e=!0,i=[]){return nb(t,this,i,e),i.sort(mT),i}intersectObjects(t,e=!0,i=[]){for(let s=0,l=t.length;s<l;s++)nb(t[s],this,i,e);return i.sort(mT),i}}function mT(n,t){return n.distance-t.distance}function nb(n,t,e,i){let s=!0;if(n.layers.test(t.layers)&&n.raycast(t,e)===!1&&(s=!1),s===!0&&i===!0){const l=n.children;for(let c=0,o=l.length;c<o;c++)nb(l[c],t,e,!0)}}class _T{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(bs(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const gT=new _t,X_=new _t;class Ho{constructor(t=new _t,e=new _t){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){gT.subVectors(t,this.start),X_.subVectors(this.end,this.start);const i=X_.dot(X_);let l=X_.dot(gT)/i;return e&&(l=bs(l,0,1)),l}closestPointToPoint(t,e,i){const s=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class zA extends ac{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d0}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d0);const Cx={type:"change"},g1={type:"start"},y1={type:"end"},yT=1e-6,tn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},$_=new si,kl=new si,I4=new _t,Z_=new _t,Px=new _t,Tu=new _r,xT=new _t,Y_=new _t,Ix=new _t,K_=new _t;class R4 extends zA{constructor(t,e=null){super(t,e),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Ta.ROTATE,MIDDLE:Ta.DOLLY,RIGHT:Ta.PAN},this.state=tn.NONE,this.keyState=tn.NONE,this.target=new _t,this._lastPosition=new _t,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new _t,this._movePrev=new si,this._moveCurr=new si,this._lastAxis=new _t,this._zoomStart=new si,this._zoomEnd=new si,this._panStart=new si,this._panEnd=new si,this._pointers=[],this._pointerPositions={},this._onPointerMove=L4.bind(this),this._onPointerDown=D4.bind(this),this._onPointerUp=k4.bind(this),this._onPointerCancel=F4.bind(this),this._onContextMenu=G4.bind(this),this._onMouseWheel=V4.bind(this),this._onKeyDown=O4.bind(this),this._onKeyUp=z4.bind(this),this._onTouchStart=H4.bind(this),this._onTouchMove=j4.bind(this),this._onTouchEnd=W4.bind(this),this._onMouseDown=B4.bind(this),this._onMouseMove=N4.bind(this),this._onMouseUp=U4.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,e!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>yT&&(this.dispatchEvent(Cx),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>yT||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Cx),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=tn.NONE,this.keyState=tn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Cx),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(kl.copy(this._panEnd).sub(this._panStart),kl.lengthSq()){if(this.object.isOrthographicCamera){const t=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,e=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;kl.x*=t,kl.y*=e}kl.multiplyScalar(this._eye.length()*this.panSpeed),Z_.copy(this._eye).cross(this.object.up).setLength(kl.x),Z_.add(I4.copy(this.object.up).setLength(kl.y)),this.object.position.add(Z_),this.target.add(Z_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(kl.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){K_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let t=K_.length();t?(this._eye.copy(this.object.position).sub(this.target),xT.copy(this._eye).normalize(),Y_.copy(this.object.up).normalize(),Ix.crossVectors(Y_,xT).normalize(),Y_.setLength(this._moveCurr.y-this._movePrev.y),Ix.setLength(this._moveCurr.x-this._movePrev.x),K_.copy(Y_.add(Ix)),Px.crossVectors(K_,this._eye).normalize(),t*=this.rotateSpeed,Tu.setFromAxisAngle(Px,t),this._eye.applyQuaternion(Tu),this.object.up.applyQuaternion(Tu),this._lastAxis.copy(Px),this._lastAngle=t):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Tu.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Tu),this.object.up.applyQuaternion(Tu)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let t;this.state===tn.TOUCH_ZOOM_PAN?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=hh.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,t!==1&&t>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=hh.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(t,e){return $_.set((t-this.screen.left)/this.screen.width,(e-this.screen.top)/this.screen.height),$_}_getMouseOnCircle(t,e){return $_.set((t-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-e))/this.screen.width),$_}_addPointer(t){this._pointers.push(t)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId==t.pointerId){this._pointers.splice(e,1);return}}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new si,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[e.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function D4(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function L4(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function k4(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function F4(n){this._removePointer(n)}function z4(){this.enabled!==!1&&(this.keyState=tn.NONE,window.addEventListener("keydown",this._onKeyDown))}function O4(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===tn.NONE&&(n.code===this.keys[tn.ROTATE]&&!this.noRotate?this.keyState=tn.ROTATE:n.code===this.keys[tn.ZOOM]&&!this.noZoom?this.keyState=tn.ZOOM:n.code===this.keys[tn.PAN]&&!this.noPan&&(this.keyState=tn.PAN)))}function B4(n){let t;switch(n.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Ta.DOLLY:this.state=tn.ZOOM;break;case Ta.ROTATE:this.state=tn.ROTATE;break;case Ta.PAN:this.state=tn.PAN;break;default:this.state=tn.NONE}const e=this.keyState!==tn.NONE?this.keyState:this.state;e===tn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):e===tn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):e===tn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(g1)}function N4(n){const t=this.keyState!==tn.NONE?this.keyState:this.state;t===tn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):t===tn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):t===tn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function U4(){this.state=tn.NONE,this.dispatchEvent(y1)}function V4(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(g1),this.dispatchEvent(y1)}}function G4(n){this.enabled!==!1&&n.preventDefault()}function H4(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=tn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=tn.TOUCH_ZOOM_PAN;const t=this._pointers[0].pageX-this._pointers[1].pageX,e=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+e*e);const i=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(g1)}function j4(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const t=this._getSecondPointerPosition(n),e=n.pageX-t.x,i=n.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(e*e+i*i);const s=(n.pageX+t.x)/2,l=(n.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,l));break}}function W4(n){switch(this._pointers.length){case 0:this.state=tn.NONE;break;case 1:this.state=tn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=tn.TOUCH_ZOOM_PAN;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==n.pointerId){const e=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(y1)}const vT={type:"change"},x1={type:"start"},OA={type:"end"},J_=new _h,bT=new Ja,q4=Math.cos(70*hh.DEG2RAD),as=new _t,Pr=2*Math.PI,gn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Rx=1e-6;class X4 extends zA{constructor(t,e=null){super(t,e),this.state=gn.NONE,this.enabled=!0,this.target=new _t,this.cursor=new _t,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ta.ROTATE,MIDDLE:Ta.DOLLY,RIGHT:Ta.PAN},this.touches={ONE:Uu.ROTATE,TWO:Uu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new _t,this._lastQuaternion=new _r,this._lastTargetPosition=new _t,this._quat=new _r().setFromUnitVectors(t.up,new _t(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new _T,this._sphericalDelta=new _T,this._scale=1,this._panOffset=new _t,this._rotateStart=new si,this._rotateEnd=new si,this._rotateDelta=new si,this._panStart=new si,this._panEnd=new si,this._panDelta=new si,this._dollyStart=new si,this._dollyEnd=new si,this._dollyDelta=new si,this._dollyDirection=new _t,this._mouse=new si,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Z4.bind(this),this._onPointerDown=$4.bind(this),this._onPointerUp=Y4.bind(this),this._onContextMenu=n5.bind(this),this._onMouseWheel=Q4.bind(this),this._onKeyDown=t5.bind(this),this._onTouchStart=e5.bind(this),this._onTouchMove=i5.bind(this),this._onMouseDown=K4.bind(this),this._onMouseMove=J4.bind(this),this._interceptControlDown=s5.bind(this),this._interceptControlUp=r5.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(vT),this.update(),this.state=gn.NONE}update(t=null){const e=this.object.position;as.copy(e).sub(this.target),as.applyQuaternion(this._quat),this._spherical.setFromVector3(as),this.autoRotate&&this.state===gn.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(i)&&isFinite(s)&&(i<-Math.PI?i+=Pr:i>Math.PI&&(i-=Pr),s<-Math.PI?s+=Pr:s>Math.PI&&(s-=Pr),i<=s?this._spherical.theta=Math.max(i,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+s)/2?Math.max(i,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let l=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const c=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),l=c!=this._spherical.radius}if(as.setFromSpherical(this._spherical),as.applyQuaternion(this._quatInverse),e.copy(this.target).add(as),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let c=null;if(this.object.isPerspectiveCamera){const o=as.length();c=this._clampDistance(o*this._scale);const p=o-c;this.object.position.addScaledVector(this._dollyDirection,p),this.object.updateMatrixWorld(),l=!!p}else if(this.object.isOrthographicCamera){const o=new _t(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const p=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),l=p!==this.object.zoom;const m=new _t(this._mouse.x,this._mouse.y,0);m.unproject(this.object),this.object.position.sub(m).add(o),this.object.updateMatrixWorld(),c=as.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;c!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(c).add(this.object.position):(J_.origin.copy(this.object.position),J_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(J_.direction))<q4?this.object.lookAt(this.target):(bT.setFromNormalAndCoplanarPoint(this.object.up,this.target),J_.intersectPlane(bT,this.target))))}else if(this.object.isOrthographicCamera){const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),c!==this.object.zoom&&(this.object.updateProjectionMatrix(),l=!0)}return this._scale=1,this._performCursorZoom=!1,l||this._lastPosition.distanceToSquared(this.object.position)>Rx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Rx||this._lastTargetPosition.distanceToSquared(this.target)>Rx?(this.dispatchEvent(vT),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?Pr/60*this.autoRotateSpeed*t:Pr/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){as.setFromMatrixColumn(e,0),as.multiplyScalar(-t),this._panOffset.add(as)}_panUp(t,e){this.screenSpacePanning===!0?as.setFromMatrixColumn(e,1):(as.setFromMatrixColumn(e,0),as.crossVectors(this.object.up,as)),as.multiplyScalar(t),this._panOffset.add(as)}_pan(t,e){const i=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;as.copy(s).sub(this.target);let l=as.length();l*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*l/i.clientHeight,this.object.matrix),this._panUp(2*e*l/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),s=t-i.left,l=e-i.top,c=i.width,o=i.height;this._mouse.x=s/c*2-1,this._mouse.y=-(l/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(Pr*this._rotateDelta.x/e.clientHeight),this._rotateUp(Pr*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(Pr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(-Pr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(Pr*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(-Pr*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._rotateStart.set(i,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panStart.set(i,s)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,s=t.pageY-e.y,l=Math.sqrt(i*i+s*s);this._dollyStart.set(0,l)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),s=.5*(t.pageX+i.x),l=.5*(t.pageY+i.y);this._rotateEnd.set(s,l)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(Pr*this._rotateDelta.x/e.clientHeight),this._rotateUp(Pr*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panEnd.set(i,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,s=t.pageY-e.y,l=Math.sqrt(i*i+s*s);this._dollyEnd.set(0,l),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const c=(t.pageX+e.x)*.5,o=(t.pageY+e.y)*.5;this._updateZoomParameters(c,o)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new si,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,i={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function $4(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function Z4(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Y4(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(OA),this.state=gn.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function K4(n){let t;switch(n.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Ta.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=gn.DOLLY;break;case Ta.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=gn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=gn.ROTATE}break;case Ta.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=gn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=gn.PAN}break;default:this.state=gn.NONE}this.state!==gn.NONE&&this.dispatchEvent(x1)}function J4(n){switch(this.state){case gn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case gn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case gn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function Q4(n){this.enabled===!1||this.enableZoom===!1||this.state!==gn.NONE||(n.preventDefault(),this.dispatchEvent(x1),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(OA))}function t5(n){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(n)}function e5(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Uu.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=gn.TOUCH_ROTATE;break;case Uu.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=gn.TOUCH_PAN;break;default:this.state=gn.NONE}break;case 2:switch(this.touches.TWO){case Uu.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=gn.TOUCH_DOLLY_PAN;break;case Uu.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=gn.TOUCH_DOLLY_ROTATE;break;default:this.state=gn.NONE}break;default:this.state=gn.NONE}this.state!==gn.NONE&&this.dispatchEvent(x1)}function i5(n){switch(this._trackPointer(n),this.state){case gn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case gn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case gn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case gn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=gn.NONE}}function n5(n){this.enabled!==!1&&n.preventDefault()}function s5(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function r5(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function wT(n,t){if(t===Zk)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===Kv||t===hA){let e=n.getIndex();if(e===null){const c=[],o=n.getAttribute("position");if(o!==void 0){for(let p=0;p<o.count;p++)c.push(p);n.setIndex(c),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=e.count-2,s=[];if(t===Kv)for(let c=1;c<=i;c++)s.push(e.getX(0)),s.push(e.getX(c)),s.push(e.getX(c+1));else for(let c=0;c<i;c++)c%2===0?(s.push(e.getX(c)),s.push(e.getX(c+1)),s.push(e.getX(c+2))):(s.push(e.getX(c+2)),s.push(e.getX(c+1)),s.push(e.getX(c)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const l=n.clone();return l.setIndex(s),l.clearGroups(),l}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}class a5 extends Ld{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new u5(e)}),this.register(function(e){return new d5(e)}),this.register(function(e){return new b5(e)}),this.register(function(e){return new w5(e)}),this.register(function(e){return new M5(e)}),this.register(function(e){return new p5(e)}),this.register(function(e){return new m5(e)}),this.register(function(e){return new _5(e)}),this.register(function(e){return new g5(e)}),this.register(function(e){return new h5(e)}),this.register(function(e){return new y5(e)}),this.register(function(e){return new f5(e)}),this.register(function(e){return new v5(e)}),this.register(function(e){return new x5(e)}),this.register(function(e){return new l5(e)}),this.register(function(e){return new S5(e)}),this.register(function(e){return new T5(e)})}load(t,e,i,s){const l=this;let c;if(this.resourcePath!=="")c=this.resourcePath;else if(this.path!==""){const m=Ap.extractUrlBase(t);c=Ap.resolveURL(m,this.path)}else c=Ap.extractUrlBase(t);this.manager.itemStart(t);const o=function(m){s?s(m):console.error(m),l.manager.itemError(t),l.manager.itemEnd(t)},p=new FA(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(m){try{l.parse(m,c,function(x){e(x),l.manager.itemEnd(t)},o)}catch(x){o(x)}},i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let l;const c={},o={},p=new TextDecoder;if(typeof t=="string")l=JSON.parse(t);else if(t instanceof ArrayBuffer)if(p.decode(new Uint8Array(t,0,4))===BA){try{c[Vi.KHR_BINARY_GLTF]=new E5(t)}catch(v){s&&s(v);return}l=JSON.parse(c[Vi.KHR_BINARY_GLTF].content)}else l=JSON.parse(p.decode(t));else l=t;if(l.asset===void 0||l.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const m=new N5(l,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(let x=0;x<this.pluginCallbacks.length;x++){const v=this.pluginCallbacks[x](m);v.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[v.name]=v,c[v.name]=!0}if(l.extensionsUsed)for(let x=0;x<l.extensionsUsed.length;++x){const v=l.extensionsUsed[x],b=l.extensionsRequired||[];switch(v){case Vi.KHR_MATERIALS_UNLIT:c[v]=new c5;break;case Vi.KHR_DRACO_MESH_COMPRESSION:c[v]=new A5(l,this.dracoLoader);break;case Vi.KHR_TEXTURE_TRANSFORM:c[v]=new C5;break;case Vi.KHR_MESH_QUANTIZATION:c[v]=new P5;break;default:b.indexOf(v)>=0&&o[v]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+v+'".')}}m.setExtensions(c),m.setPlugins(o),m.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,l){i.parse(t,e,s,l)})}}function o5(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const Vi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class l5{constructor(t){this.parser=t,this.name=Vi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const l=e[i];l.extensions&&l.extensions[this.name]&&l.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,l.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const l=e.json,p=((l.extensions&&l.extensions[this.name]||{}).lights||[])[t];let m;const x=new vi(16777215);p.color!==void 0&&x.setRGB(p.color[0],p.color[1],p.color[2],yr);const v=p.range!==void 0?p.range:0;switch(p.type){case"directional":m=new p4(x),m.target.position.set(0,0,-1),m.add(m.target);break;case"point":m=new d4(x),m.distance=v;break;case"spot":m=new h4(x),m.distance=v,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,m.angle=p.spot.outerConeAngle,m.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,m.target.position.set(0,0,-1),m.add(m.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return m.position.set(0,0,0),m.decay=2,zo(m,p),p.intensity!==void 0&&(m.intensity=p.intensity),m.name=e.createUniqueName(p.name||"light_"+t),s=Promise.resolve(m),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,l=i.json.nodes[t],o=(l.extensions&&l.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(p){return i._getNodeRef(e.cache,o,p)})}}class c5{constructor(){this.name=Vi.KHR_MATERIALS_UNLIT}getMaterialType(){return io}extendParams(t,e,i){const s=[];t.color=new vi(1,1,1),t.opacity=1;const l=e.pbrMetallicRoughness;if(l){if(Array.isArray(l.baseColorFactor)){const c=l.baseColorFactor;t.color.setRGB(c[0],c[1],c[2],yr),t.opacity=c[3]}l.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",l.baseColorTexture,Ls))}return Promise.all(s)}}class h5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=s.extensions[this.name].emissiveStrength;return l!==void 0&&(e.emissiveIntensity=l),Promise.resolve()}}class u5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];if(c.clearcoatFactor!==void 0&&(e.clearcoat=c.clearcoatFactor),c.clearcoatTexture!==void 0&&l.push(i.assignTexture(e,"clearcoatMap",c.clearcoatTexture)),c.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=c.clearcoatRoughnessFactor),c.clearcoatRoughnessTexture!==void 0&&l.push(i.assignTexture(e,"clearcoatRoughnessMap",c.clearcoatRoughnessTexture)),c.clearcoatNormalTexture!==void 0&&(l.push(i.assignTexture(e,"clearcoatNormalMap",c.clearcoatNormalTexture)),c.clearcoatNormalTexture.scale!==void 0)){const o=c.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new si(o,o)}return Promise.all(l)}}class d5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_DISPERSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=s.extensions[this.name];return e.dispersion=l.dispersion!==void 0?l.dispersion:0,Promise.resolve()}}class f5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.iridescenceFactor!==void 0&&(e.iridescence=c.iridescenceFactor),c.iridescenceTexture!==void 0&&l.push(i.assignTexture(e,"iridescenceMap",c.iridescenceTexture)),c.iridescenceIor!==void 0&&(e.iridescenceIOR=c.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),c.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=c.iridescenceThicknessMaximum),c.iridescenceThicknessTexture!==void 0&&l.push(i.assignTexture(e,"iridescenceThicknessMap",c.iridescenceThicknessTexture)),Promise.all(l)}}class p5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[];e.sheenColor=new vi(0,0,0),e.sheenRoughness=0,e.sheen=1;const c=s.extensions[this.name];if(c.sheenColorFactor!==void 0){const o=c.sheenColorFactor;e.sheenColor.setRGB(o[0],o[1],o[2],yr)}return c.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=c.sheenRoughnessFactor),c.sheenColorTexture!==void 0&&l.push(i.assignTexture(e,"sheenColorMap",c.sheenColorTexture,Ls)),c.sheenRoughnessTexture!==void 0&&l.push(i.assignTexture(e,"sheenRoughnessMap",c.sheenRoughnessTexture)),Promise.all(l)}}class m5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.transmissionFactor!==void 0&&(e.transmission=c.transmissionFactor),c.transmissionTexture!==void 0&&l.push(i.assignTexture(e,"transmissionMap",c.transmissionTexture)),Promise.all(l)}}class _5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];e.thickness=c.thicknessFactor!==void 0?c.thicknessFactor:0,c.thicknessTexture!==void 0&&l.push(i.assignTexture(e,"thicknessMap",c.thicknessTexture)),e.attenuationDistance=c.attenuationDistance||1/0;const o=c.attenuationColor||[1,1,1];return e.attenuationColor=new vi().setRGB(o[0],o[1],o[2],yr),Promise.all(l)}}class g5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=s.extensions[this.name];return e.ior=l.ior!==void 0?l.ior:1.5,Promise.resolve()}}class y5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];e.specularIntensity=c.specularFactor!==void 0?c.specularFactor:1,c.specularTexture!==void 0&&l.push(i.assignTexture(e,"specularIntensityMap",c.specularTexture));const o=c.specularColorFactor||[1,1,1];return e.specularColor=new vi().setRGB(o[0],o[1],o[2],yr),c.specularColorTexture!==void 0&&l.push(i.assignTexture(e,"specularColorMap",c.specularColorTexture,Ls)),Promise.all(l)}}class x5{constructor(t){this.parser=t,this.name=Vi.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return e.bumpScale=c.bumpFactor!==void 0?c.bumpFactor:1,c.bumpTexture!==void 0&&l.push(i.assignTexture(e,"bumpMap",c.bumpTexture)),Promise.all(l)}}class v5{constructor(t){this.parser=t,this.name=Vi.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:ho}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.anisotropyStrength!==void 0&&(e.anisotropy=c.anisotropyStrength),c.anisotropyRotation!==void 0&&(e.anisotropyRotation=c.anisotropyRotation),c.anisotropyTexture!==void 0&&l.push(i.assignTexture(e,"anisotropyMap",c.anisotropyTexture)),Promise.all(l)}}class b5{constructor(t){this.parser=t,this.name=Vi.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const l=s.extensions[this.name],c=e.options.ktx2Loader;if(!c){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,l.source,c)}}class w5{constructor(t){this.parser=t,this.name=Vi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,l=s.textures[t];if(!l.extensions||!l.extensions[e])return null;const c=l.extensions[e],o=s.images[c.source];let p=i.textureLoader;if(o.uri){const m=i.options.manager.getHandler(o.uri);m!==null&&(p=m)}return this.detectSupport().then(function(m){if(m)return i.loadTextureImage(t,c.source,p);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class M5{constructor(t){this.parser=t,this.name=Vi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,l=s.textures[t];if(!l.extensions||!l.extensions[e])return null;const c=l.extensions[e],o=s.images[c.source];let p=i.textureLoader;if(o.uri){const m=i.options.manager.getHandler(o.uri);m!==null&&(p=m)}return this.detectSupport().then(function(m){if(m)return i.loadTextureImage(t,c.source,p);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class S5{constructor(t){this.name=Vi.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],l=this.parser.getDependency("buffer",s.buffer),c=this.parser.options.meshoptDecoder;if(!c||!c.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return l.then(function(o){const p=s.byteOffset||0,m=s.byteLength||0,x=s.count,v=s.byteStride,b=new Uint8Array(o,p,m);return c.decodeGltfBufferAsync?c.decodeGltfBufferAsync(x,v,b,s.mode,s.filter).then(function(E){return E.buffer}):c.ready.then(function(){const E=new ArrayBuffer(x*v);return c.decodeGltfBuffer(new Uint8Array(E),x,v,b,s.mode,s.filter),E})})}else return null}}class T5{constructor(t){this.name=Vi.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const m of s.primitives)if(m.mode!==ya.TRIANGLES&&m.mode!==ya.TRIANGLE_STRIP&&m.mode!==ya.TRIANGLE_FAN&&m.mode!==void 0)return null;const c=i.extensions[this.name].attributes,o=[],p={};for(const m in c)o.push(this.parser.getDependency("accessor",c[m]).then(x=>(p[m]=x,p[m])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(m=>{const x=m.pop(),v=x.isGroup?x.children:[x],b=m[0].count,E=[];for(const D of v){const k=new _i,P=new _t,I=new _r,V=new _t(1,1,1),U=new VU(D.geometry,D.material,b);for(let B=0;B<b;B++)p.TRANSLATION&&P.fromBufferAttribute(p.TRANSLATION,B),p.ROTATION&&I.fromBufferAttribute(p.ROTATION,B),p.SCALE&&V.fromBufferAttribute(p.SCALE,B),U.setMatrixAt(B,k.compose(P,I,V));for(const B in p)if(B==="_COLOR_0"){const Z=p[B];U.instanceColor=new tb(Z.array,Z.itemSize,Z.normalized)}else B!=="TRANSLATION"&&B!=="ROTATION"&&B!=="SCALE"&&D.geometry.setAttribute(B,p[B]);Un.prototype.copy.call(U,D),this.parser.assignFinalMaterial(U),E.push(U)}return x.isGroup?(x.clear(),x.add(...E),x):E[0]}))}}const BA="glTF",Yf=12,MT={JSON:1313821514,BIN:5130562};class E5{constructor(t){this.name=Vi.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Yf),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==BA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Yf,l=new DataView(t,Yf);let c=0;for(;c<s;){const o=l.getUint32(c,!0);c+=4;const p=l.getUint32(c,!0);if(c+=4,p===MT.JSON){const m=new Uint8Array(t,Yf+c,o);this.content=i.decode(m)}else if(p===MT.BIN){const m=Yf+c;this.body=t.slice(m,m+o)}c+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class A5{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Vi.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,l=t.extensions[this.name].bufferView,c=t.extensions[this.name].attributes,o={},p={},m={};for(const x in c){const v=sb[x]||x.toLowerCase();o[v]=c[x]}for(const x in t.attributes){const v=sb[x]||x.toLowerCase();if(c[x]!==void 0){const b=i.accessors[t.attributes[x]],E=ed[b.componentType];m[v]=E.name,p[v]=b.normalized===!0}}return e.getDependency("bufferView",l).then(function(x){return new Promise(function(v,b){s.decodeDracoFile(x,function(E){for(const D in E.attributes){const k=E.attributes[D],P=p[D];P!==void 0&&(k.normalized=P)}v(E)},o,m,yr,b)})})}}class C5{constructor(){this.name=Vi.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class P5{constructor(){this.name=Vi.KHR_MESH_QUANTIZATION}}class NA extends lm{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,l=t*s*3+s;for(let c=0;c!==s;c++)e[c]=i[l+c];return e}interpolate_(t,e,i,s){const l=this.resultBuffer,c=this.sampleValues,o=this.valueSize,p=o*2,m=o*3,x=s-e,v=(i-e)/x,b=v*v,E=b*v,D=t*m,k=D-m,P=-2*E+3*b,I=E-b,V=1-P,U=I-b+v;for(let B=0;B!==o;B++){const Z=c[k+B+o],Y=c[k+B+p]*x,K=c[D+B+o],nt=c[D+B]*x;l[B]=V*Z+U*Y+P*K+I*nt}return l}}const I5=new _r;class R5 extends NA{interpolate_(t,e,i,s){const l=super.interpolate_(t,e,i,s);return I5.fromArray(l).normalize().toArray(l),l}}const ya={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ed={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ST={9728:mr,9729:ea,9984:tA,9985:Sg,9986:dp,9987:No},TT={33071:Ul,33648:Gg,10497:dd},Dx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sb={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},D5={CUBICSPLINE:void 0,LINEAR:Up,STEP:Np},Lx={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function L5(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new u1({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Va})),n.DefaultMaterial}function Gc(n,t,e){for(const i in e.extensions)n[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function zo(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k5(n,t,e){let i=!1,s=!1,l=!1;for(let m=0,x=t.length;m<x;m++){const v=t[m];if(v.POSITION!==void 0&&(i=!0),v.NORMAL!==void 0&&(s=!0),v.COLOR_0!==void 0&&(l=!0),i&&s&&l)break}if(!i&&!s&&!l)return Promise.resolve(n);const c=[],o=[],p=[];for(let m=0,x=t.length;m<x;m++){const v=t[m];if(i){const b=v.POSITION!==void 0?e.getDependency("accessor",v.POSITION):n.attributes.position;c.push(b)}if(s){const b=v.NORMAL!==void 0?e.getDependency("accessor",v.NORMAL):n.attributes.normal;o.push(b)}if(l){const b=v.COLOR_0!==void 0?e.getDependency("accessor",v.COLOR_0):n.attributes.color;p.push(b)}}return Promise.all([Promise.all(c),Promise.all(o),Promise.all(p)]).then(function(m){const x=m[0],v=m[1],b=m[2];return i&&(n.morphAttributes.position=x),s&&(n.morphAttributes.normal=v),l&&(n.morphAttributes.color=b),n.morphTargetsRelative=!0,n})}function F5(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)n.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function z5(n){let t;const e=n.extensions&&n.extensions[Vi.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+kx(e.attributes):t=n.indices+":"+kx(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)t+=":"+kx(n.targets[i]);return t}function kx(n){let t="";const e=Object.keys(n).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+n[e[i]]+";";return t}function rb(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function O5(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const B5=new _i;class N5{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new o5,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,l=!1,c=-1;if(typeof navigator<"u"){const o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;const p=o.match(/Version\/(\d+)/);s=i&&p?parseInt(p[1],10):-1,l=o.indexOf("Firefox")>-1,c=l?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||l&&c<98?this.textureLoader=new l4(this.options.manager):this.textureLoader=new m4(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FA(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,l=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(c){return c._markDefs&&c._markDefs()}),Promise.all(this._invokeAll(function(c){return c.beforeRoot&&c.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(c){const o={scene:c[0][s.scene||0],scenes:c[0],animations:c[1],cameras:c[2],asset:s.asset,parser:i,userData:{}};return Gc(l,o,s),zo(o,s),Promise.all(i._invokeAll(function(p){return p.afterRoot&&p.afterRoot(o)})).then(function(){for(const p of o.scenes)p.updateMatrixWorld();t(o)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,l=e.length;s<l;s++){const c=e[s].joints;for(let o=0,p=c.length;o<p;o++)t[c[o]].isBone=!0}for(let s=0,l=t.length;s<l;s++){const c=t[s];c.mesh!==void 0&&(this._addNodeRef(this.meshCache,c.mesh),c.skin!==void 0&&(i[c.mesh].isSkinnedMesh=!0)),c.camera!==void 0&&this._addNodeRef(this.cameraCache,c.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),l=(c,o)=>{const p=this.associations.get(c);p!=null&&this.associations.set(o,p);for(const[m,x]of c.children.entries())l(x,o.children[m])};return l(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const l=t(e[s]);l&&i.push(l)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(l){return l.loadNode&&l.loadNode(e)});break;case"mesh":s=this._invokeOne(function(l){return l.loadMesh&&l.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(l){return l.loadBufferView&&l.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(l){return l.loadMaterial&&l.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(l){return l.loadTexture&&l.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(l){return l.loadAnimation&&l.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(l){return l!=this&&l.getDependency&&l.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(l,c){return i.getDependency(t,c)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[Vi.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(l,c){i.load(Ap.resolveURL(e.uri,s.path),l,void 0,function(){c(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,l=e.byteOffset||0;return i.slice(l,l+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const c=Dx[s.type],o=ed[s.componentType],p=s.normalized===!0,m=new o(s.count*c);return Promise.resolve(new $n(m,c,p))}const l=[];return s.bufferView!==void 0?l.push(this.getDependency("bufferView",s.bufferView)):l.push(null),s.sparse!==void 0&&(l.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(l).then(function(c){const o=c[0],p=Dx[s.type],m=ed[s.componentType],x=m.BYTES_PER_ELEMENT,v=x*p,b=s.byteOffset||0,E=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,D=s.normalized===!0;let k,P;if(E&&E!==v){const I=Math.floor(b/E),V="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+I+":"+s.count;let U=e.cache.get(V);U||(k=new m(o,I*E,s.count*E/x),U=new zU(k,E/x),e.cache.add(V,U)),P=new l1(U,p,b%E/x,D)}else o===null?k=new m(s.count*p):k=new m(o,b,s.count*p),P=new $n(k,p,D);if(s.sparse!==void 0){const I=Dx.SCALAR,V=ed[s.sparse.indices.componentType],U=s.sparse.indices.byteOffset||0,B=s.sparse.values.byteOffset||0,Z=new V(c[1],U,s.sparse.count*I),Y=new m(c[2],B,s.sparse.count*p);o!==null&&(P=new $n(P.array.slice(),P.itemSize,P.normalized)),P.normalized=!1;for(let K=0,nt=Z.length;K<nt;K++){const q=Z[K];if(P.setX(q,Y[K*p]),p>=2&&P.setY(q,Y[K*p+1]),p>=3&&P.setZ(q,Y[K*p+2]),p>=4&&P.setW(q,Y[K*p+3]),p>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}P.normalized=D}return P})}loadTexture(t){const e=this.json,i=this.options,l=e.textures[t].source,c=e.images[l];let o=this.textureLoader;if(c.uri){const p=i.manager.getHandler(c.uri);p!==null&&(o=p)}return this.loadTextureImage(t,l,o)}loadTextureImage(t,e,i){const s=this,l=this.json,c=l.textures[t],o=l.images[e],p=(o.uri||o.bufferView)+":"+c.sampler;if(this.textureCache[p])return this.textureCache[p];const m=this.loadImageSource(e,i).then(function(x){x.flipY=!1,x.name=c.name||o.name||"",x.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(x.name=o.uri);const b=(l.samplers||{})[c.sampler]||{};return x.magFilter=ST[b.magFilter]||ea,x.minFilter=ST[b.minFilter]||No,x.wrapS=TT[b.wrapS]||dd,x.wrapT=TT[b.wrapT]||dd,x.generateMipmaps=!x.isCompressedTexture&&x.minFilter!==mr&&x.minFilter!==ea,s.associations.set(x,{textures:t}),x}).catch(function(){return null});return this.textureCache[p]=m,m}loadImageSource(t,e){const i=this,s=this.json,l=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(v=>v.clone());const c=s.images[t],o=self.URL||self.webkitURL;let p=c.uri||"",m=!1;if(c.bufferView!==void 0)p=i.getDependency("bufferView",c.bufferView).then(function(v){m=!0;const b=new Blob([v],{type:c.mimeType});return p=o.createObjectURL(b),p});else if(c.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const x=Promise.resolve(p).then(function(v){return new Promise(function(b,E){let D=b;e.isImageBitmapLoader===!0&&(D=function(k){const P=new Ms(k);P.needsUpdate=!0,b(P)}),e.load(Ap.resolveURL(v,l.path),D,void 0,E)})}).then(function(v){return m===!0&&o.revokeObjectURL(p),zo(v,c),v.userData.mimeType=c.mimeType||O5(c.uri),v}).catch(function(v){throw console.error("THREE.GLTFLoader: Couldn't load texture",p),v});return this.sourceCache[t]=x,x}assignTexture(t,e,i,s){const l=this;return this.getDependency("texture",i.index).then(function(c){if(!c)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(c=c.clone(),c.channel=i.texCoord),l.extensions[Vi.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[Vi.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const p=l.associations.get(c);c=l.extensions[Vi.KHR_TEXTURE_TRANSFORM].extendTexture(c,o),l.associations.set(c,p)}}return s!==void 0&&(c.colorSpace=s),t[e]=c,c})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,l=e.attributes.color!==void 0,c=e.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+i.uuid;let p=this.cache.get(o);p||(p=new RA,ro.prototype.copy.call(p,i),p.color.copy(i.color),p.map=i.map,p.sizeAttenuation=!1,this.cache.add(o,p)),i=p}else if(t.isLine){const o="LineBasicMaterial:"+i.uuid;let p=this.cache.get(o);p||(p=new PA,ro.prototype.copy.call(p,i),p.color.copy(i.color),p.map=i.map,this.cache.add(o,p)),i=p}if(s||l||c){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),l&&(o+="vertex-colors:"),c&&(o+="flat-shading:");let p=this.cache.get(o);p||(p=i.clone(),l&&(p.vertexColors=!0),c&&(p.flatShading=!0),s&&(p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(o,p),this.associations.set(p,this.associations.get(i))),i=p}t.material=i}getMaterialType(){return u1}loadMaterial(t){const e=this,i=this.json,s=this.extensions,l=i.materials[t];let c;const o={},p=l.extensions||{},m=[];if(p[Vi.KHR_MATERIALS_UNLIT]){const v=s[Vi.KHR_MATERIALS_UNLIT];c=v.getMaterialType(),m.push(v.extendParams(o,l,e))}else{const v=l.pbrMetallicRoughness||{};if(o.color=new vi(1,1,1),o.opacity=1,Array.isArray(v.baseColorFactor)){const b=v.baseColorFactor;o.color.setRGB(b[0],b[1],b[2],yr),o.opacity=b[3]}v.baseColorTexture!==void 0&&m.push(e.assignTexture(o,"map",v.baseColorTexture,Ls)),o.metalness=v.metallicFactor!==void 0?v.metallicFactor:1,o.roughness=v.roughnessFactor!==void 0?v.roughnessFactor:1,v.metallicRoughnessTexture!==void 0&&(m.push(e.assignTexture(o,"metalnessMap",v.metallicRoughnessTexture)),m.push(e.assignTexture(o,"roughnessMap",v.metallicRoughnessTexture))),c=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(t)}),m.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(t,o)})))}l.doubleSided===!0&&(o.side=Qr);const x=l.alphaMode||Lx.OPAQUE;if(x===Lx.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,x===Lx.MASK&&(o.alphaTest=l.alphaCutoff!==void 0?l.alphaCutoff:.5)),l.normalTexture!==void 0&&c!==io&&(m.push(e.assignTexture(o,"normalMap",l.normalTexture)),o.normalScale=new si(1,1),l.normalTexture.scale!==void 0)){const v=l.normalTexture.scale;o.normalScale.set(v,v)}if(l.occlusionTexture!==void 0&&c!==io&&(m.push(e.assignTexture(o,"aoMap",l.occlusionTexture)),l.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=l.occlusionTexture.strength)),l.emissiveFactor!==void 0&&c!==io){const v=l.emissiveFactor;o.emissive=new vi().setRGB(v[0],v[1],v[2],yr)}return l.emissiveTexture!==void 0&&c!==io&&m.push(e.assignTexture(o,"emissiveMap",l.emissiveTexture,Ls)),Promise.all(m).then(function(){const v=new c(o);return l.name&&(v.name=l.name),zo(v,l),e.associations.set(v,{materials:t}),l.extensions&&Gc(s,v,l),v})}createUniqueName(t){const e=an.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function l(o){return i[Vi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,e).then(function(p){return ET(p,o,e)})}const c=[];for(let o=0,p=t.length;o<p;o++){const m=t[o],x=z5(m),v=s[x];if(v)c.push(v.promise);else{let b;m.extensions&&m.extensions[Vi.KHR_DRACO_MESH_COMPRESSION]?b=l(m):b=ET(new Br,m,e),s[x]={primitive:m,promise:b},c.push(b)}}return Promise.all(c)}loadMesh(t){const e=this,i=this.json,s=this.extensions,l=i.meshes[t],c=l.primitives,o=[];for(let p=0,m=c.length;p<m;p++){const x=c[p].material===void 0?L5(this.cache):this.getDependency("material",c[p].material);o.push(x)}return o.push(e.loadGeometries(c)),Promise.all(o).then(function(p){const m=p.slice(0,p.length-1),x=p[p.length-1],v=[];for(let E=0,D=x.length;E<D;E++){const k=x[E],P=c[E];let I;const V=m[E];if(P.mode===ya.TRIANGLES||P.mode===ya.TRIANGLE_STRIP||P.mode===ya.TRIANGLE_FAN||P.mode===void 0)I=l.isSkinnedMesh===!0?new BU(k,V):new os(k,V),I.isSkinnedMesh===!0&&I.normalizeSkinWeights(),P.mode===ya.TRIANGLE_STRIP?I.geometry=wT(I.geometry,hA):P.mode===ya.TRIANGLE_FAN&&(I.geometry=wT(I.geometry,Kv));else if(P.mode===ya.LINES)I=new IA(k,V);else if(P.mode===ya.LINE_STRIP)I=new h1(k,V);else if(P.mode===ya.LINE_LOOP)I=new ZU(k,V);else if(P.mode===ya.POINTS)I=new YU(k,V);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);Object.keys(I.geometry.morphAttributes).length>0&&F5(I,l),I.name=e.createUniqueName(l.name||"mesh_"+t),zo(I,l),P.extensions&&Gc(s,I,P),e.assignFinalMaterial(I),v.push(I)}for(let E=0,D=v.length;E<D;E++)e.associations.set(v[E],{meshes:t,primitives:E});if(v.length===1)return l.extensions&&Gc(s,v[0],l),v[0];const b=new eh;l.extensions&&Gc(s,b,l),e.associations.set(b,{meshes:t});for(let E=0,D=v.length;E<D;E++)b.add(v[E]);return b})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new hr(hh.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new a1(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),zo(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,l=e.joints.length;s<l;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const l=s.pop(),c=s,o=[],p=[];for(let m=0,x=c.length;m<x;m++){const v=c[m];if(v){o.push(v);const b=new _i;l!==null&&b.fromArray(l.array,m*16),p.push(b)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[m])}return new c1(o,p)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],l=s.name?s.name:"animation_"+t,c=[],o=[],p=[],m=[],x=[];for(let v=0,b=s.channels.length;v<b;v++){const E=s.channels[v],D=s.samplers[E.sampler],k=E.target,P=k.node,I=s.parameters!==void 0?s.parameters[D.input]:D.input,V=s.parameters!==void 0?s.parameters[D.output]:D.output;k.node!==void 0&&(c.push(this.getDependency("node",P)),o.push(this.getDependency("accessor",I)),p.push(this.getDependency("accessor",V)),m.push(D),x.push(k))}return Promise.all([Promise.all(c),Promise.all(o),Promise.all(p),Promise.all(m),Promise.all(x)]).then(function(v){const b=v[0],E=v[1],D=v[2],k=v[3],P=v[4],I=[];for(let V=0,U=b.length;V<U;V++){const B=b[V],Z=E[V],Y=D[V],K=k[V],nt=P[V];if(B===void 0)continue;B.updateMatrix&&B.updateMatrix();const q=i._createAnimationTracks(B,Z,Y,K,nt);if(q)for(let J=0;J<q.length;J++)I.push(q[J])}return new ib(l,void 0,I)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(l){const c=i._getNodeRef(i.meshCache,s.mesh,l);return s.weights!==void 0&&c.traverse(function(o){if(o.isMesh)for(let p=0,m=s.weights.length;p<m;p++)o.morphTargetInfluences[p]=s.weights[p]}),c})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],l=i._loadNodeShallow(t),c=[],o=s.children||[];for(let m=0,x=o.length;m<x;m++)c.push(i.getDependency("node",o[m]));const p=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([l,Promise.all(c),p]).then(function(m){const x=m[0],v=m[1],b=m[2];b!==null&&x.traverse(function(E){E.isSkinnedMesh&&E.bind(b,B5)});for(let E=0,D=v.length;E<D;E++)x.add(v[E]);return x})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const l=e.nodes[t],c=l.name?s.createUniqueName(l.name):"",o=[],p=s._invokeOne(function(m){return m.createNodeMesh&&m.createNodeMesh(t)});return p&&o.push(p),l.camera!==void 0&&o.push(s.getDependency("camera",l.camera).then(function(m){return s._getNodeRef(s.cameraCache,l.camera,m)})),s._invokeAll(function(m){return m.createNodeAttachment&&m.createNodeAttachment(t)}).forEach(function(m){o.push(m)}),this.nodeCache[t]=Promise.all(o).then(function(m){let x;if(l.isBone===!0?x=new CA:m.length>1?x=new eh:m.length===1?x=m[0]:x=new Un,x!==m[0])for(let v=0,b=m.length;v<b;v++)x.add(m[v]);if(l.name&&(x.userData.name=l.name,x.name=c),zo(x,l),l.extensions&&Gc(i,x,l),l.matrix!==void 0){const v=new _i;v.fromArray(l.matrix),x.applyMatrix4(v)}else l.translation!==void 0&&x.position.fromArray(l.translation),l.rotation!==void 0&&x.quaternion.fromArray(l.rotation),l.scale!==void 0&&x.scale.fromArray(l.scale);return s.associations.has(x)||s.associations.set(x,{}),s.associations.get(x).nodes=t,x}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,l=new eh;i.name&&(l.name=s.createUniqueName(i.name)),zo(l,i),i.extensions&&Gc(e,l,i);const c=i.nodes||[],o=[];for(let p=0,m=c.length;p<m;p++)o.push(s.getDependency("node",c[p]));return Promise.all(o).then(function(p){for(let x=0,v=p.length;x<v;x++)l.add(p[x]);const m=x=>{const v=new Map;for(const[b,E]of s.associations)(b instanceof ro||b instanceof Ms)&&v.set(b,E);return x.traverse(b=>{const E=s.associations.get(b);E!=null&&v.set(b,E)}),v};return s.associations=m(l),l})}_createAnimationTracks(t,e,i,s,l){const c=[],o=t.name?t.name:t.uuid,p=[];Fl[l.path]===Fl.weights?t.traverse(function(b){b.morphTargetInfluences&&p.push(b.name?b.name:b.uuid)}):p.push(o);let m;switch(Fl[l.path]){case Fl.weights:m=yd;break;case Fl.rotation:m=xd;break;case Fl.position:case Fl.scale:m=vd;break;default:switch(i.itemSize){case 1:m=yd;break;case 2:case 3:default:m=vd;break}break}const x=s.interpolation!==void 0?D5[s.interpolation]:Up,v=this._getArrayFromAccessor(i);for(let b=0,E=p.length;b<E;b++){const D=new m(p[b]+"."+Fl[l.path],e.array,v,x);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(D),c.push(D)}return c}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const i=rb(e.constructor),s=new Float32Array(e.length);for(let l=0,c=e.length;l<c;l++)s[l]=e[l]*i;e=s}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){const s=this instanceof xd?R5:NA;return new s(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function U5(n,t,e){const i=t.attributes,s=new Nn;if(i.POSITION!==void 0){const o=e.json.accessors[i.POSITION],p=o.min,m=o.max;if(p!==void 0&&m!==void 0){if(s.set(new _t(p[0],p[1],p[2]),new _t(m[0],m[1],m[2])),o.normalized){const x=rb(ed[o.componentType]);s.min.multiplyScalar(x),s.max.multiplyScalar(x)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const l=t.targets;if(l!==void 0){const o=new _t,p=new _t;for(let m=0,x=l.length;m<x;m++){const v=l[m];if(v.POSITION!==void 0){const b=e.json.accessors[v.POSITION],E=b.min,D=b.max;if(E!==void 0&&D!==void 0){if(p.setX(Math.max(Math.abs(E[0]),Math.abs(D[0]))),p.setY(Math.max(Math.abs(E[1]),Math.abs(D[1]))),p.setZ(Math.max(Math.abs(E[2]),Math.abs(D[2]))),b.normalized){const k=rb(ed[b.componentType]);p.multiplyScalar(k)}o.max(p)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}n.boundingBox=s;const c=new Ys;s.getCenter(c.center),c.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=c}function ET(n,t,e){const i=t.attributes,s=[];function l(c,o){return e.getDependency("accessor",c).then(function(p){n.setAttribute(o,p)})}for(const c in i){const o=sb[c]||c.toLowerCase();o in n.attributes||s.push(l(i[c],o))}if(t.indices!==void 0&&!n.index){const c=e.getDependency("accessor",t.indices).then(function(o){n.setIndex(o)});s.push(c)}return ji.workingColorSpace!==yr&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ji.workingColorSpace}" not supported.`),zo(n,t),U5(n,t,e),Promise.all(s).then(function(){return t.targets!==void 0?k5(n,t.targets,e):n})}const V5={showMapViewer:!1,showOperationGuide:!1,isFarView:!1,isModelAnimation:"idle",isCameraAnimating:!1,isFullScreen:!1},l0=class l0{constructor(t){ni(this,"state");ni(this,"listeners",new Map);this.state=new Proxy(t,{set:(e,i,s)=>(e[i]!==s&&(e[i]=s,this.notify(i,s)),!0)})}static getInstance(t,e){return this.instances.has(t)||this.instances.set(t,new l0(e)),this.instances.get(t)}get(t){return this.state[t]}set(t,e){this.state[t]!==e&&(this.state[t]=e)}subscribe(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}unsubscribe(t,e){this.listeners.has(t)&&this.listeners.set(t,this.listeners.get(t).filter(i=>i!==e))}notify(t,e){this.listeners.has(t)&&this.listeners.get(t).forEach(i=>i(e))}};ni(l0,"instances",new Map);let ab=l0;const bn=ab.getInstance("AppStates",V5),AT={arrowup:"w",arrowleft:"a",arrowdown:"s",arrowright:"d"};class G5{constructor(){ni(this,"keyState",{});this.initializeKeys(),this.addEventListeners()}initializeKeys(){Object.values(AT).forEach(t=>{if(!document.getElementById(`key-${t}`))throw new Error(`Key element "key-${t}" not found.`)})}addEventListeners(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){const e=this.normalizeKey(t.key);e&&(this.keyState[e]=!0,this.setKeyActive(e,!0),this.handleSpecialKeys(t.key))}handleKeyUp(t){const e=this.normalizeKey(t.key);e&&(this.keyState[e]=!1,this.setKeyActive(e,!1))}handleSpecialKeys(t){switch(t){case"q":if(bn.get("isFarView"))return;bn.set("showMapViewer",!bn.get("showMapViewer"));break;case"Escape":bn.set("showMapViewer",!1),bn.set("isFarView",!1);break}}normalizeKey(t){const e=t.toLowerCase();return AT[e]||e}setKeyActive(t,e){const i=document.getElementById(`key-${t}`);i&&i.classList.toggle("active",e)}isKeyPressed(t){return!!this.keyState[t.toLowerCase()]}}class H5{constructor(t,e=35){ni(this,"joystickBall");ni(this,"joystickCenterX",0);ni(this,"joystickCenterY",0);ni(this,"joystickLimit");ni(this,"joystickId");ni(this,"touchX",0);ni(this,"touchY",0);ni(this,"keyManager");const i=document.getElementById(t);if(!i)throw new Error(`Joystick element with ID "${t}" not found.`);this.joystickBall=i,this.joystickLimit=e,this.joystickId=t,this.keyManager=new G5,this.init()}init(){this.updateJoystickCenter(),this.addEventListeners(),window.addEventListener("resize",()=>this.updateJoystickCenter())}updateJoystickCenter(){const t=this.joystickBall.getBoundingClientRect();this.joystickCenterX=t.left+this.joystickBall.clientWidth/2,this.joystickCenterY=t.top+this.joystickBall.clientHeight/2}addEventListeners(){this.joystickBall.addEventListener("touchmove",t=>this.dragMove(t)),this.joystickBall.addEventListener("touchend",()=>this.dragLeave())}dragMove(t){t.preventDefault();const e=t.touches[0].pageX,i=t.touches[0].pageY;this.touchX=Math.min(Math.max(e-this.joystickCenterX,-this.joystickLimit),this.joystickLimit),this.touchY=Math.min(Math.max(i-this.joystickCenterY,-this.joystickLimit),this.joystickLimit),this.updateJoystickBall()}dragLeave(){this.touchX=0,this.touchY=0,this.updateJoystickBall()}updateJoystickBall(){const t=this.keyManager.isKeyPressed("a")?-this.joystickLimit:this.keyManager.isKeyPressed("d")?this.joystickLimit:0,e=this.keyManager.isKeyPressed("w")?-this.joystickLimit:this.keyManager.isKeyPressed("s")?this.joystickLimit:0;let i=this.touchX+t,s=this.touchY+e;if(Math.sqrt(i*i+s*s)>this.joystickLimit){const o=Math.atan2(s,i);i=Math.cos(o)*this.joystickLimit,s=Math.sin(o)*this.joystickLimit}const c=document.getElementById(this.joystickId);c.style.transform=`translate(${i}px, ${s}px)`}getDirection(){const t=this.keyManager.isKeyPressed("a")?-this.joystickLimit:this.keyManager.isKeyPressed("d")?this.joystickLimit:0,e=this.keyManager.isKeyPressed("w")?-this.joystickLimit:this.keyManager.isKeyPressed("s")?this.joystickLimit:0,i=this.touchX+t,s=this.touchY+e;return Math.sqrt(i**2+s**2)===0?{x:0,y:0}:{x:i/this.joystickLimit,y:-s/this.joystickLimit}}}var UA={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(n,t){(function(e,i){n.exports=i()})(up,function(){var e={},i={};function s(c,o,p){if(i[c]=p,c==="index"){var m="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",x={};return i.shared(x),i.index(e,x),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([m],{type:"text/javascript"}))),e}}s("shared",["exports"],function(c){function o(h,a,u,f){return new(u||(u=Promise))(function(y,S){function T(z){try{R(f.next(z))}catch(O){S(O)}}function A(z){try{R(f.throw(z))}catch(O){S(O)}}function R(z){var O;z.done?y(z.value):(O=z.value,O instanceof u?O:new u(function(G){G(O)})).then(T,A)}R((f=f.apply(h,a||[])).next())})}function p(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var m=x;function x(h,a){this.x=h,this.y=a}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,a){return this.clone()._rotateAround(h,a)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var a=h.x-this.x,u=h.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult:function(h){var a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var a=Math.cos(h),u=Math.sin(h),f=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=f,this},_rotateAround:function(h,a){var u=Math.cos(h),f=Math.sin(h),y=a.y+f*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-f*(this.y-a.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(h){return h instanceof x?h:Array.isArray(h)?new x(h[0],h[1]):h};var v=p(m),b=E;function E(h,a,u,f){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=a,this.p2x=u,this.p2y=f}E.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,a){if(a===void 0&&(a=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,f=0;f<8;f++){var y=this.sampleCurveX(u)-h;if(Math.abs(y)<a)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=y/S}var T=0,A=1;for(u=h,f=0;f<20&&(y=this.sampleCurveX(u),!(Math.abs(y-h)<a));f++)h>y?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(h,a){return this.sampleCurveY(this.solveCurveX(h,a))}};var D=p(b);let k,P;function I(){return k==null&&(k=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),k}function V(){if(P==null&&(P=!1,I())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let f=0;f<5*5;f++){const y=4*f;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(f%5,Math.floor(f/5),1,1)}const u=a.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&u[f]!==f){P=!0;break}}}return P||!1}function U(h,a,u,f){const y=new D(h,a,u,f);return S=>y.solve(S)}const B=U(.25,.1,.25,1);function Z(h,a,u){return Math.min(u,Math.max(a,h))}function Y(h,a,u){const f=u-a,y=((h-a)%f+f)%f+a;return y===a?u:y}function K(h,...a){for(const u of a)for(const f in u)h[f]=u[f];return h}let nt=1;function q(h,a,u){const f={};for(const y in h)f[y]=a.call(this,h[y],y,h);return f}function J(h,a,u){const f={};for(const y in h)a.call(this,h[y],y,h)&&(f[y]=h[y]);return f}function ct(h){return Array.isArray(h)?h.map(ct):typeof h=="object"&&h?q(h,ct):h}const St={};function wt(h){St[h]||(typeof console<"u"&&console.warn(h),St[h]=!0)}function Pt(h,a,u){return(u.y-h.y)*(a.x-h.x)>(a.y-h.y)*(u.x-h.x)}function Gt(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Nt=null;function Zt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function me(h,a,u,f,y){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(h,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const A=T.startsWith("BGR"),R=new Uint8ClampedArray(f*y*4);if(yield S.copyTo(R,function(z,O,G,$,Q){const et=4*Math.max(-O,0),at=(Math.max(0,G)-G)*$*4+et,ft=4*$,gt=Math.max(0,O),Ot=Math.max(0,G);return{rect:{x:gt,y:Ot,width:Math.min(z.width,O+$)-gt,height:Math.min(z.height,G+Q)-Ot},layout:[{offset:at,stride:ft}]}}(h,a,u,f,y)),A)for(let z=0;z<R.length;z+=4){const O=R[z];R[z]=R[z+2],R[z+2]=O}return R}finally{S.close()}})}let Ee,Le;const ri="AbortError";function Ni(){return new Error(ri)}const Jt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function le(h){return Jt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const qe="global-dispatcher";class be extends Error{constructor(a,u,f,y){super(`AJAXError: ${u} (${a}): ${f}`),this.status=a,this.statusText=u,this.url=f,this.body=y}}const Qe=()=>Gt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,gi=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const f=le(h.url);if(f)return f(h,a);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:qe},a)}if(!(/^file:/.test(u=h.url)||/^file:/.test(Qe())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,y){return o(this,void 0,void 0,function*(){const S=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Qe(),signal:y.signal});f.type!=="json"||S.headers.has("Accept")||S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const z=yield T.blob();throw new be(T.status,T.statusText,f.url,z)}let A;A=f.type==="arrayBuffer"||f.type==="image"?T.arrayBuffer():f.type==="json"?T.json():T.text();const R=yield A;if(y.signal.aborted)throw Ni();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(h,a);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:qe},a)}var u;return function(f,y){return new Promise((S,T)=>{var A;const R=new XMLHttpRequest;R.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(R.responseType="arraybuffer");for(const z in f.headers)R.setRequestHeader(z,f.headers[z]);f.type==="json"&&(R.responseType="text",!((A=f.headers)===null||A===void 0)&&A.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=f.credentials==="include",R.onerror=()=>{T(new Error(R.statusText))},R.onload=()=>{if(!y.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let z=R.response;if(f.type==="json")try{z=JSON.parse(R.response)}catch(O){return void T(O)}S({data:z,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const z=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});T(new be(R.status,R.statusText,f.url,z))}},y.signal.addEventListener("abort",()=>{R.abort(),T(Ni())}),R.send(f.body)})}(h,a)};function bi(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function Zi(h,a,u){u[h]&&u[h].indexOf(a)!==-1||(u[h]=u[h]||[],u[h].push(a))}function Ei(h,a,u){if(u&&u[h]){const f=u[h].indexOf(a);f!==-1&&u[h].splice(f,1)}}class $i{constructor(a,u={}){K(this,u),this.type=a}}class zt extends $i{constructor(a,u={}){super("error",K({error:a},u))}}class jn{on(a,u){return this._listeners=this._listeners||{},Zi(a,u,this._listeners),this}off(a,u){return Ei(a,u,this._listeners),Ei(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Zi(a,u,this._oneTimeListeners),this):new Promise(f=>this.once(a,f))}fire(a,u){typeof a=="string"&&(a=new $i(a,u||{}));const f=a.type;if(this.listens(f)){a.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of y)A.call(this,a);const S=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of S)Ei(f,A,this._oneTimeListeners),A.call(this,a);const T=this._eventedParent;T&&(K(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof zt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var Ft={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function oi(h,a){const u={};for(const f in h)f!=="ref"&&(u[f]=h[f]);return Ai.forEach(f=>{f in a&&(u[f]=a[f])}),u}function ti(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let u=0;u<h.length;u++)if(!ti(h[u],a[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const u in h)if(!ti(h[u],a[u]))return!1;return!0}return h===a}function ke(h,a){h.push(a)}function mt(h,a,u){ke(u,{command:"addSource",args:[h,a[h]]})}function st(h,a,u){ke(a,{command:"removeSource",args:[h]}),u[h]=!0}function Ht(h,a,u,f){st(h,u,f),mt(h,a,u)}function re(h,a,u){let f;for(f in h[u])if(Object.prototype.hasOwnProperty.call(h[u],f)&&f!=="data"&&!ti(h[u][f],a[u][f]))return!1;for(f in a[u])if(Object.prototype.hasOwnProperty.call(a[u],f)&&f!=="data"&&!ti(h[u][f],a[u][f]))return!1;return!0}function ae(h,a,u,f,y,S){h=h||{},a=a||{};for(const T in h)Object.prototype.hasOwnProperty.call(h,T)&&(ti(h[T],a[T])||u.push({command:S,args:[f,T,a[T],y]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(h,T)&&(ti(h[T],a[T])||u.push({command:S,args:[f,T,a[T],y]}))}function ie(h){return h.id}function $e(h,a){return h[a.id]=a,h}class Ut{constructor(a,u,f,y){this.message=(a?`${a}: `:"")+f,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ie(h,...a){for(const u of a)for(const f in u)h[f]=u[f];return h}class yi extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class ue{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[f,y]of u)this.bindings[f]=y}concat(a){return new ue(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Be={kind:"null"},Yt={kind:"number"},ge={kind:"string"},ne={kind:"boolean"},xi={kind:"color"},ci={kind:"object"},Re={kind:"value"},It={kind:"collator"},Me={kind:"formatted"},Kt={kind:"padding"},se={kind:"resolvedImage"},lt={kind:"variableAnchorOffsetCollection"};function W(h,a){return{kind:"array",itemType:h,N:a}}function X(h){if(h.kind==="array"){const a=X(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const it=[Be,Yt,ge,ne,xi,Me,ci,W(Re),Kt,se,lt];function ut(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!ut(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const u of it)if(!ut(u,a))return null}}return`Expected ${X(h)} but found ${X(a)} instead.`}function xt(h,a){return a.some(u=>u.kind===h.kind)}function Et(h,a){return a.some(u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h)}function Dt(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const bt=.96422,Xt=.82521,te=4/29,Wt=6/29,fe=3*Wt*Wt,He=Wt*Wt*Wt,Xe=Math.PI/180,ki=180/Math.PI;function hi(h){return(h%=360)<0&&(h+=360),h}function Fi([h,a,u,f]){let y,S;const T=En((.2225045*(h=Ci(h))+.7168786*(a=Ci(a))+.0606169*(u=Ci(u)))/1);h===a&&a===u?y=S=T:(y=En((.4360747*h+.3850649*a+.1430804*u)/bt),S=En((.0139322*h+.0971045*a+.7141733*u)/Xt));const A=116*T-16;return[A<0?0:A,500*(y-T),200*(T-S),f]}function Ci(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function En(h){return h>He?Math.pow(h,1/3):h/fe+te}function yn([h,a,u,f]){let y=(h+16)/116,S=isNaN(a)?y:y+a/500,T=isNaN(u)?y:y-u/200;return y=1*rt(y),S=bt*rt(S),T=Xt*rt(T),[Si(3.1338561*S-1.6168667*y-.4906146*T),Si(-.9787684*S+1.9161415*y+.033454*T),Si(.0719453*S-.2289914*y+1.4052427*T),f]}function Si(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function rt(h){return h>Wt?h*h*h:fe*(h-te)}function At(h){return parseInt(h.padEnd(2,h),16)/255}function Vt(h,a){return jt(a?h/100:h,0,1)}function jt(h,a,u){return Math.min(Math.max(a,h),u)}function Rt(h){return!h.some(Number.isNaN)}const pe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ce{constructor(a,u,f,y=1,S=!0){this.r=a,this.g=u,this.b=f,this.a=y,S||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,f,y]))}static parse(a){if(a instanceof ce)return a;if(typeof a!="string")return;const u=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=pe[f];if(y){const[T,A,R]=y;return[T/255,A/255,R/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const T=f.length<6?1:2;let A=1;return[At(f.slice(A,A+=T)),At(f.slice(A,A+=T)),At(f.slice(A,A+=T)),At(f.slice(A,A+T)||"ff")]}if(f.startsWith("rgb")){const T=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[A,R,z,O,G,$,Q,et,at,ft,gt,Ot]=T,Tt=[O||" ",Q||" ",ft].join("");if(Tt==="  "||Tt==="  /"||Tt===",,"||Tt===",,,"){const kt=[z,$,at].join(""),$t=kt==="%%%"?100:kt===""?255:0;if($t){const oe=[jt(+R/$t,0,1),jt(+G/$t,0,1),jt(+et/$t,0,1),gt?Vt(+gt,Ot):1];if(Rt(oe))return oe}}return}}const S=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,A,R,z,O,G,$,Q,et]=S,at=[R||" ",O||" ",$].join("");if(at==="  "||at==="  /"||at===",,"||at===",,,"){const ft=[+A,jt(+z,0,100),jt(+G,0,100),Q?Vt(+Q,et):1];if(Rt(ft))return function([gt,Ot,Tt,kt]){function $t(oe){const Ae=(oe+gt/30)%12,ii=Ot*Math.min(Tt,1-Tt);return Tt-ii*Math.max(-1,Math.min(Ae-3,9-Ae,1))}return gt=hi(gt),Ot/=100,Tt/=100,[$t(0),$t(8),$t(4),kt]}(ft)}}}(a);return u?new ce(...u,!1):void 0}get rgb(){const{r:a,g:u,b:f,a:y}=this,S=y||1/0;return this.overwriteGetter("rgb",[a/S,u/S,f/S,y])}get hcl(){return this.overwriteGetter("hcl",function(a){const[u,f,y,S]=Fi(a),T=Math.sqrt(f*f+y*y);return[Math.round(1e4*T)?hi(Math.atan2(y,f)*ki):NaN,T,u,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Fi(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,f,y]=this.rgb;return`rgba(${[a,u,f].map(S=>Math.round(255*S)).join(",")},${y})`}}ce.black=new ce(0,0,0,1),ce.white=new ce(1,1,1,1),ce.transparent=new ce(0,0,0,0),ce.red=new ce(1,0,0,1);class Ze{constructor(a,u,f){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ye{constructor(a,u,f,y,S){this.text=a,this.image=u,this.scale=f,this.fontStack=y,this.textColor=S}}class ei{constructor(a){this.sections=a}static fromString(a){return new ei([new Ye(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof ei?a:ei.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class li{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof li)return a;if(typeof a=="number")return new li([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new li(a)}}toString(){return JSON.stringify(this.values)}}const Je=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class wi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof wi)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const f=a[u],y=a[u+1];if(typeof f!="string"||!Je.has(f)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new wi(a)}}toString(){return JSON.stringify(this.values)}}class Ri{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Ri({name:a,available:!1}):null}}function qi(h,a,u,f){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[h,a,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[h,a,u,f]:[h,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function An(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof ce||h instanceof Ze||h instanceof ei||h instanceof li||h instanceof wi||h instanceof Ri)return!0;if(Array.isArray(h)){for(const a of h)if(!An(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!An(h[a]))return!1;return!0}return!1}function pi(h){if(h===null)return Be;if(typeof h=="string")return ge;if(typeof h=="boolean")return ne;if(typeof h=="number")return Yt;if(h instanceof ce)return xi;if(h instanceof Ze)return It;if(h instanceof ei)return Me;if(h instanceof li)return Kt;if(h instanceof wi)return lt;if(h instanceof Ri)return se;if(Array.isArray(h)){const a=h.length;let u;for(const f of h){const y=pi(f);if(u){if(u===y)continue;u=Re;break}u=y}return W(u||Re,a)}return ci}function Ke(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof ce||h instanceof ei||h instanceof li||h instanceof wi||h instanceof Ri?h.toString():JSON.stringify(h)}class Dn{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!An(a[1]))return u.error("invalid value");const f=a[1];let y=pi(f);const S=u.expectedType;return y.kind!=="array"||y.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(y=S),new Dn(y,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ui{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const hs={string:ge,number:Yt,boolean:ne,object:ci};class Zn{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let f,y=1;const S=a[0];if(S==="array"){let A,R;if(a.length>2){const z=a[1];if(typeof z!="string"||!(z in hs)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=hs[z],y++}else A=Re;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=a[2],y++}f=W(A,R)}else{if(!hs[S])throw new Error(`Types doesn't contain name = ${S}`);f=hs[S]}const T=[];for(;y<a.length;y++){const A=u.parse(a[y],y,Re);if(!A)return null;T.push(A)}return new Zn(f,T)}evaluate(a){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(a);if(!ut(this.type,pi(f)))return f;if(u===this.args.length-1)throw new ui(`Expected value to be of type ${X(this.type)}, but found ${X(pi(f))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const is={"to-boolean":ne,"to-color":xi,"to-number":Yt,"to-string":ge};class ns{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const f=a[0];if(!is[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=is[f],S=[];for(let T=1;T<a.length;T++){const A=u.parse(a[T],T,Re);if(!A)return null;S.push(A)}return new ns(y,S)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,f;for(const y of this.args){if(u=y.evaluate(a),f=null,u instanceof ce)return u;if(typeof u=="string"){const S=a.parseColor(u);if(S)return S}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:qi(u[0],u[1],u[2],u[3]),!f))return new ce(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ui(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(a);const y=li.parse(u);if(y)return y}throw new ui(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(a);const y=wi.parse(u);if(y)return y}throw new ui(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new ui(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return ei.fromString(Ke(this.args[0].evaluate(a)));case"resolvedImage":return Ri.fromString(Ke(this.args[0].evaluate(a)));default:return Ke(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const on=["Unknown","Point","LineString","Polygon"];class Ts{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?on[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=ce.parse(a)),u}}class Qs{constructor(a,u,f=[],y,S=new ue,T=[]){this.registry=a,this.path=f,this.key=f.map(A=>`[${A}]`).join(""),this.scope=S,this.errors=T,this.expectedType=y,this._isConstant=u}parse(a,u,f,y,S={}){return u?this.concat(u,f,y)._parse(a,S):this._parse(a,S)}_parse(a,u){function f(y,S,T){return T==="assert"?new Zn(S,[y]):T==="coerce"?new ns(S,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[y];if(S){let T=S.parse(a,this);if(!T)return null;if(this.expectedType){const A=this.expectedType,R=T.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||R.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(A.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(A,R))return null}else T=f(T,A,u.typeAnnotation||"coerce");else T=f(T,A,u.typeAnnotation||"coerce");else T=f(T,A,u.typeAnnotation||"coerce");else T=f(T,A,u.typeAnnotation||"assert")}if(!(T instanceof Dn)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const A=new Ts;try{T=new Dn(T.type,T.evaluate(A))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,f){const y=typeof a=="number"?this.path.concat(a):this.path,S=f?this.scope.concat(f):this.scope;return new Qs(this.registry,this._isConstant,y,u||null,S,this.errors)}error(a,...u){const f=`${this.key}${u.map(y=>`[${y}]`).join("")}`;this.errors.push(new yi(f,a))}checkSubtype(a,u){const f=ut(a,u);return f&&this.error(f),f}}class Ln{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const f=[];for(let S=1;S<a.length-1;S+=2){const T=a[S];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",S);const A=u.parse(a[S+1],S+1);if(!A)return null;f.push([T,A])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,f);return y?new Ln(f,y):null}outputDefined(){return this.result.outputDefined()}}class Pi{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=a[1];return u.scope.has(f)?new Pi(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class vr{constructor(a,u,f){this.type=a,this.index=u,this.input=f}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Yt),y=u.parse(a[2],2,W(u.expectedType||Re));return f&&y?new vr(y.type.itemType,f,y):null}evaluate(a){const u=this.index.evaluate(a),f=this.input.evaluate(a);if(u<0)throw new ui(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new ui(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new ui(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Yo{constructor(a,u){this.type=ne,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Re),y=u.parse(a[2],2,Re);return f&&y?xt(f.type,[ne,ge,Yt,Be,Re])?new Yo(f,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(f.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!f)return!1;if(!Et(u,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${X(pi(u))} instead.`);if(!Et(f,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${X(pi(f))} instead.`);return f.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Ko{constructor(a,u,f){this.type=Yt,this.needle=a,this.haystack=u,this.fromIndex=f}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Re),y=u.parse(a[2],2,Re);if(!f||!y)return null;if(!xt(f.type,[ne,ge,Yt,Be,Re]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(f.type)} instead`);if(a.length===4){const S=u.parse(a[3],3,Yt);return S?new Ko(f,y,S):null}return new Ko(f,y)}evaluate(a){const u=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!Et(u,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${X(pi(u))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(a)),Et(f,["string"])){const S=f.indexOf(u,y);return S===-1?-1:[...f.slice(0,S)].length}if(Et(f,["array"]))return f.indexOf(u,y);throw new ui(`Expected second argument to be of type array or string, but found ${X(pi(f))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class zd{constructor(a,u,f,y,S,T){this.inputType=a,this.type=u,this.input=f,this.cases=y,this.outputs=S,this.otherwise=T}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let f,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const S={},T=[];for(let z=2;z<a.length-1;z+=2){let O=a[z];const G=a[z+1];Array.isArray(O)||(O=[O]);const $=u.concat(z);if(O.length===0)return $.error("Expected at least one branch label.");for(const et of O){if(typeof et!="number"&&typeof et!="string")return $.error("Branch labels must be numbers or strings.");if(typeof et=="number"&&Math.abs(et)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof et=="number"&&Math.floor(et)!==et)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,pi(et)))return null}else f=pi(et);if(S[String(et)]!==void 0)return $.error("Branch labels must be unique.");S[String(et)]=T.length}const Q=u.parse(G,z,y);if(!Q)return null;y=y||Q.type,T.push(Q)}const A=u.parse(a[1],1,Re);if(!A)return null;const R=u.parse(a[a.length-1],a.length-1,y);return R?A.type.kind!=="value"&&u.concat(1).checkSubtype(f,A.type)?null:new zd(f,y,A,S,T,R):null}evaluate(a){const u=this.input.evaluate(a);return(pi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class yh{constructor(a,u,f){this.type=a,this.branches=u,this.otherwise=f}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const y=[];for(let T=1;T<a.length-1;T+=2){const A=u.parse(a[T],T,ne);if(!A)return null;const R=u.parse(a[T+1],T+1,f);if(!R)return null;y.push([A,R]),f=f||R.type}const S=u.parse(a[a.length-1],a.length-1,f);if(!S)return null;if(!f)throw new Error("Can't infer output type");return new yh(f,y,S)}evaluate(a){for(const[u,f]of this.branches)if(u.evaluate(a))return f.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,f]of this.branches)a(u),a(f);a(this.otherwise)}outputDefined(){return this.branches.every(([a,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class lc{constructor(a,u,f,y){this.type=a,this.input=u,this.beginIndex=f,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Re),y=u.parse(a[2],2,Yt);if(!f||!y)return null;if(!xt(f.type,[W(Re),ge,Re]))return u.error(`Expected first argument to be of type array or string, but found ${X(f.type)} instead`);if(a.length===4){const S=u.parse(a[3],3,Yt);return S?new lc(f.type,f,y,S):null}return new lc(f.type,f,y)}evaluate(a){const u=this.input.evaluate(a),f=this.beginIndex.evaluate(a);let y;if(this.endIndex&&(y=this.endIndex.evaluate(a)),Et(u,["string"]))return[...u].slice(f,y).join("");if(Et(u,["array"]))return u.slice(f,y);throw new ui(`Expected first argument to be of type array or string, but found ${X(pi(u))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function xh(h,a){const u=h.length-1;let f,y,S=0,T=u,A=0;for(;S<=T;)if(A=Math.floor((S+T)/2),f=h[A],y=h[A+1],f<=a){if(A===u||a<y)return A;S=A+1}else{if(!(f>a))throw new ui("Input is not a number.");T=A-1}return 0}class Jo{constructor(a,u,f){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,S]of f)this.labels.push(y),this.outputs.push(S)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(a[1],1,Yt);if(!f)return null;const y=[];let S=null;u.expectedType&&u.expectedType.kind!=="value"&&(S=u.expectedType);for(let T=1;T<a.length;T+=2){const A=T===1?-1/0:a[T],R=a[T+1],z=T,O=T+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const G=u.parse(R,O,S);if(!G)return null;S=S||G.type,y.push([A,G])}return new Jo(S,f,y)}evaluate(a){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return f[0].evaluate(a);const S=u.length;return y>=u[S-1]?f[S-1].evaluate(a):f[xh(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function pm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var P0=mm;function mm(h,a,u,f){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=a,this.p2x=u,this.p2y=f}mm.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,a){if(a===void 0&&(a=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,f=0;f<8;f++){var y=this.sampleCurveX(u)-h;if(Math.abs(y)<a)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=y/S}var T=0,A=1;for(u=h,f=0;f<20&&(y=this.sampleCurveX(u),!(Math.abs(y-h)<a));f++)h>y?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(h,a){return this.sampleCurveY(this.solveCurveX(h,a))}};var I0=pm(P0);function fo(h,a,u){return h+u*(a-h)}function cc(h,a,u){return h.map((f,y)=>fo(f,a[y],u))}const zs={number:fo,color:function(h,a,u,f="rgb"){switch(f){case"rgb":{const[y,S,T,A]=cc(h.rgb,a.rgb,u);return new ce(y,S,T,A,!1)}case"hcl":{const[y,S,T,A]=h.hcl,[R,z,O,G]=a.hcl;let $,Q;if(isNaN(y)||isNaN(R))isNaN(y)?isNaN(R)?$=NaN:($=R,T!==1&&T!==0||(Q=z)):($=y,O!==1&&O!==0||(Q=S));else{let Ot=R-y;R>y&&Ot>180?Ot-=360:R<y&&y-R>180&&(Ot+=360),$=y+u*Ot}const[et,at,ft,gt]=function([Ot,Tt,kt,$t]){return Ot=isNaN(Ot)?0:Ot*Xe,yn([kt,Math.cos(Ot)*Tt,Math.sin(Ot)*Tt,$t])}([$,Q??fo(S,z,u),fo(T,O,u),fo(A,G,u)]);return new ce(et,at,ft,gt,!1)}case"lab":{const[y,S,T,A]=yn(cc(h.lab,a.lab,u));return new ce(y,S,T,A,!1)}}},array:cc,padding:function(h,a,u){return new li(cc(h.values,a.values,u))},variableAnchorOffsetCollection:function(h,a,u){const f=h.values,y=a.values;if(f.length!==y.length)throw new ui(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${a.toString()}`);const S=[];for(let T=0;T<f.length;T+=2){if(f[T]!==y[T])throw new ui(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${f[T]}, to[${T}]: ${y[T]}`);S.push(f[T]);const[A,R]=f[T+1],[z,O]=y[T+1];S.push([fo(A,z,u),fo(R,O,u)])}return new wi(S)}};class Os{constructor(a,u,f,y,S){this.type=a,this.operator=u,this.interpolation=f,this.input=y,this.labels=[],this.outputs=[];for(const[T,A]of S)this.labels.push(T),this.outputs.push(A)}static interpolationFactor(a,u,f,y){let S=0;if(a.name==="exponential")S=vh(u,a.base,f,y);else if(a.name==="linear")S=vh(u,1,f,y);else if(a.name==="cubic-bezier"){const T=a.controlPoints;S=new I0(T[0],T[1],T[2],T[3]).solve(vh(u,1,f,y))}return S}static parse(a,u){let[f,y,S,...T]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const z=y[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:z}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const z=y.slice(1);if(z.length!==4||z.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:z}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(S=u.parse(S,2,Yt),!S)return null;const A=[];let R=null;f==="interpolate-hcl"||f==="interpolate-lab"?R=xi:u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType);for(let z=0;z<T.length;z+=2){const O=T[z],G=T[z+1],$=z+3,Q=z+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(A.length&&A[A.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const et=u.parse(G,Q,R);if(!et)return null;R=R||et.type,A.push([O,et])}return Dt(R,Yt)||Dt(R,xi)||Dt(R,Kt)||Dt(R,lt)||Dt(R,W(Yt))?new Os(R,f,y,S,A):u.error(`Type ${X(R)} is not interpolatable.`)}evaluate(a){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return f[0].evaluate(a);const S=u.length;if(y>=u[S-1])return f[S-1].evaluate(a);const T=xh(u,y),A=Os.interpolationFactor(this.interpolation,y,u[T],u[T+1]),R=f[T].evaluate(a),z=f[T+1].evaluate(a);switch(this.operator){case"interpolate":return zs[this.type.kind](R,z,A);case"interpolate-hcl":return zs.color(R,z,A,"hcl");case"interpolate-lab":return zs.color(R,z,A,"lab")}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function vh(h,a,u,f){const y=f-u,S=h-u;return y===0?0:a===1?S/y:(Math.pow(a,S)-1)/(Math.pow(a,y)-1)}class bh{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expectected at least one argument.");let f=null;const y=u.expectedType;y&&y.kind!=="value"&&(f=y);const S=[];for(const A of a.slice(1)){const R=u.parse(A,1+S.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,S.push(R)}if(!f)throw new Error("No output type");const T=y&&S.some(A=>ut(y,A.type));return new bh(T?Re:f,S)}evaluate(a){let u,f=null,y=0;for(const S of this.args)if(y++,f=S.evaluate(a),f&&f instanceof Ri&&!f.available&&(u||(u=f.name),f=null,y===this.args.length&&(f=u)),f!==null)break;return f}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}function wh(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function _m(h,a,u,f){return f.compare(a,u)===0}function Qo(h,a,u){const f=h!=="=="&&h!=="!=";return class VA{constructor(S,T,A){this.type=ne,this.lhs=S,this.rhs=T,this.collator=A,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const A=S[0];let R=T.parse(S[1],1,Re);if(!R)return null;if(!wh(A,R.type))return T.concat(1).error(`"${A}" comparisons are not supported for type '${X(R.type)}'.`);let z=T.parse(S[2],2,Re);if(!z)return null;if(!wh(A,z.type))return T.concat(2).error(`"${A}" comparisons are not supported for type '${X(z.type)}'.`);if(R.type.kind!==z.type.kind&&R.type.kind!=="value"&&z.type.kind!=="value")return T.error(`Cannot compare types '${X(R.type)}' and '${X(z.type)}'.`);f&&(R.type.kind==="value"&&z.type.kind!=="value"?R=new Zn(z.type,[R]):R.type.kind!=="value"&&z.type.kind==="value"&&(z=new Zn(R.type,[z])));let O=null;if(S.length===4){if(R.type.kind!=="string"&&z.type.kind!=="string"&&R.type.kind!=="value"&&z.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(O=T.parse(S[3],3,It),!O)return null}return new VA(R,z,O)}evaluate(S){const T=this.lhs.evaluate(S),A=this.rhs.evaluate(S);if(f&&this.hasUntypedArgument){const R=pi(T),z=pi(A);if(R.kind!==z.kind||R.kind!=="string"&&R.kind!=="number")throw new ui(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${R.kind}, ${z.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const R=pi(T),z=pi(A);if(R.kind!=="string"||z.kind!=="string")return a(S,T,A)}return this.collator?u(S,T,A,this.collator.evaluate(S)):a(S,T,A)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const R0=Qo("==",function(h,a,u){return a===u},_m),gm=Qo("!=",function(h,a,u){return a!==u},function(h,a,u,f){return!_m(0,a,u,f)}),ym=Qo("<",function(h,a,u){return a<u},function(h,a,u,f){return f.compare(a,u)<0}),D0=Qo(">",function(h,a,u){return a>u},function(h,a,u,f){return f.compare(a,u)>0}),L0=Qo("<=",function(h,a,u){return a<=u},function(h,a,u,f){return f.compare(a,u)<=0}),xm=Qo(">=",function(h,a,u){return a>=u},function(h,a,u,f){return f.compare(a,u)>=0});class hc{constructor(a,u,f){this.type=It,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const f=a[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const y=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,ne);if(!y)return null;const S=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,ne);if(!S)return null;let T=null;return f.locale&&(T=u.parse(f.locale,1,ge),!T)?null:new hc(y,S,T)}evaluate(a){return new Ze(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class Od{constructor(a,u,f,y,S){this.type=ge,this.number=a,this.locale=u,this.currency=f,this.minFractionDigits=y,this.maxFractionDigits=S}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const f=u.parse(a[1],1,Yt);if(!f)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let S=null;if(y.locale&&(S=u.parse(y.locale,1,ge),!S))return null;let T=null;if(y.currency&&(T=u.parse(y.currency,1,ge),!T))return null;let A=null;if(y["min-fraction-digits"]&&(A=u.parse(y["min-fraction-digits"],1,Yt),!A))return null;let R=null;return y["max-fraction-digits"]&&(R=u.parse(y["max-fraction-digits"],1,Yt),!R)?null:new Od(f,S,T,A,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Mh{constructor(a){this.type=Me,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const f=a[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const y=[];let S=!1;for(let T=1;T<=a.length-1;++T){const A=a[T];if(S&&typeof A=="object"&&!Array.isArray(A)){S=!1;let R=null;if(A["font-scale"]&&(R=u.parse(A["font-scale"],1,Yt),!R))return null;let z=null;if(A["text-font"]&&(z=u.parse(A["text-font"],1,W(ge)),!z))return null;let O=null;if(A["text-color"]&&(O=u.parse(A["text-color"],1,xi),!O))return null;const G=y[y.length-1];G.scale=R,G.font=z,G.textColor=O}else{const R=u.parse(a[T],1,Re);if(!R)return null;const z=R.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,y.push({content:R,scale:null,font:null,textColor:null})}}return new Mh(y)}evaluate(a){return new ei(this.sections.map(u=>{const f=u.content.evaluate(a);return pi(f)===se?new Ye("",f,null,null,null):new Ye(Ke(f),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor)}outputDefined(){return!1}}class Bd{constructor(a){this.type=se,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const f=u.parse(a[1],1,ge);return f?new Bd(f):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),f=Ri.fromString(u);return f&&a.availableImages&&(f.available=a.availableImages.indexOf(u)>-1),f}eachChild(a){a(this.input)}outputDefined(){return!1}}class Nd{constructor(a){this.type=Yt,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const f=u.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${X(f.type)} instead.`):new Nd(f):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new ui(`Expected value to be of type string or array, but found ${X(pi(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const la=8192;function k0(h,a){const u=(180+h[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*la),Math.round(f*y*la)]}function Ud(h,a){const u=Math.pow(2,a.z);return[(y=(h[0]/la+a.x)/u,360*y-180),(f=(h[1]/la+a.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,y}function po(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function Ha(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function Xi(h,a,u){const f=h[0]-a[0],y=h[1]-a[1],S=h[0]-u[0],T=h[1]-u[1];return f*T-S*y==0&&f*S<=0&&y*T<=0}function Sh(h,a,u,f){return(y=[f[0]-u[0],f[1]-u[1]])[0]*(S=[a[0]-h[0],a[1]-h[1]])[1]-y[1]*S[0]!=0&&!(!bm(h,a,u,f)||!bm(u,f,h,a));var y,S}function F0(h,a,u){for(const f of u)for(let y=0;y<f.length-1;++y)if(Sh(h,a,f[y],f[y+1]))return!0;return!1}function tl(h,a,u=!1){let f=!1;for(const A of a)for(let R=0;R<A.length-1;R++){if(Xi(h,A[R],A[R+1]))return u;(S=A[R])[1]>(y=h)[1]!=(T=A[R+1])[1]>y[1]&&y[0]<(T[0]-S[0])*(y[1]-S[1])/(T[1]-S[1])+S[0]&&(f=!f)}var y,S,T;return f}function z0(h,a){for(const u of a)if(tl(h,u))return!0;return!1}function vm(h,a){for(const u of h)if(!tl(u,a))return!1;for(let u=0;u<h.length-1;++u)if(F0(h[u],h[u+1],a))return!1;return!0}function O0(h,a){for(const u of a)if(vm(h,u))return!0;return!1}function bm(h,a,u,f){const y=f[0]-u[0],S=f[1]-u[1],T=(h[0]-u[0])*S-y*(h[1]-u[1]),A=(a[0]-u[0])*S-y*(a[1]-u[1]);return T>0&&A<0||T<0&&A>0}function Vd(h,a,u){const f=[];for(let y=0;y<h.length;y++){const S=[];for(let T=0;T<h[y].length;T++){const A=k0(h[y][T],u);po(a,A),S.push(A)}f.push(S)}return f}function wm(h,a,u){const f=[];for(let y=0;y<h.length;y++){const S=Vd(h[y],a,u);f.push(S)}return f}function Mm(h,a,u,f){if(h[0]<u[0]||h[0]>u[2]){const y=.5*f;let S=h[0]-u[0]>y?-f:u[0]-h[0]>y?f:0;S===0&&(S=h[0]-u[2]>y?-f:u[2]-h[0]>y?f:0),h[0]+=S}po(a,h)}function Sm(h,a,u,f){const y=Math.pow(2,f.z)*la,S=[f.x*la,f.y*la],T=[];for(const A of h)for(const R of A){const z=[R.x+S[0],R.y+S[1]];Mm(z,a,u,y),T.push(z)}return T}function Tm(h,a,u,f){const y=Math.pow(2,f.z)*la,S=[f.x*la,f.y*la],T=[];for(const R of h){const z=[];for(const O of R){const G=[O.x+S[0],O.y+S[1]];po(a,G),z.push(G)}T.push(z)}if(a[2]-a[0]<=y/2){(A=a)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const R of T)for(const z of R)Mm(z,a,u,y)}var A;return T}class mo{constructor(a,u){this.type=ne,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(An(a[1])){const f=a[1];if(f.type==="FeatureCollection"){const y=[];for(const S of f.features){const{type:T,coordinates:A}=S.geometry;T==="Polygon"&&y.push(A),T==="MultiPolygon"&&y.push(...A)}if(y.length)return new mo(f,{type:"MultiPolygon",coordinates:y})}else if(f.type==="Feature"){const y=f.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new mo(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new mo(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const A=Vd(f.coordinates,S,T),R=Sm(u.geometry(),y,S,T);if(!Ha(y,S))return!1;for(const z of R)if(!tl(z,A))return!1}if(f.type==="MultiPolygon"){const A=wm(f.coordinates,S,T),R=Sm(u.geometry(),y,S,T);if(!Ha(y,S))return!1;for(const z of R)if(!z0(z,A))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const A=Vd(f.coordinates,S,T),R=Tm(u.geometry(),y,S,T);if(!Ha(y,S))return!1;for(const z of R)if(!vm(z,A))return!1}if(f.type==="MultiPolygon"){const A=wm(f.coordinates,S,T),R=Tm(u.geometry(),y,S,T);if(!Ha(y,S))return!1;for(const z of R)if(!O0(z,A))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Em=class{constructor(h=[],a=(u,f)=>u<f?-1:u>f?1:0){if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:u}=this,f=a[h];for(;h>0;){const y=h-1>>1,S=a[y];if(u(f,S)>=0)break;a[h]=S,h=y}a[h]=f}_down(h){const{data:a,compare:u}=this,f=this.length>>1,y=a[h];for(;h<f;){let S=1+(h<<1);const T=S+1;if(T<this.length&&u(a[T],a[S])<0&&(S=T),u(a[S],y)>=0)break;a[h]=a[S],h=S}a[h]=y}};function B0(h,a,u,f,y){Am(h,a,u,f||h.length-1,y||N0)}function Am(h,a,u,f,y){for(;f>u;){if(f-u>600){var S=f-u+1,T=a-u+1,A=Math.log(S),R=.5*Math.exp(2*A/3),z=.5*Math.sqrt(A*R*(S-R)/S)*(T-S/2<0?-1:1);Am(h,a,Math.max(u,Math.floor(a-T*R/S+z)),Math.min(f,Math.floor(a+(S-T)*R/S+z)),y)}var O=h[a],G=u,$=f;for(uc(h,u,a),y(h[f],O)>0&&uc(h,u,f);G<$;){for(uc(h,G,$),G++,$--;y(h[G],O)<0;)G++;for(;y(h[$],O)>0;)$--}y(h[u],O)===0?uc(h,u,$):uc(h,++$,f),$<=a&&(u=$+1),a<=$&&(f=$-1)}}function uc(h,a,u){var f=h[a];h[a]=h[u],h[u]=f}function N0(h,a){return h<a?-1:h>a?1:0}function Th(h,a){if(h.length<=1)return[h];const u=[];let f,y;for(const S of h){const T=V0(S);T!==0&&(S.area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(f&&u.push(f),f=[S]):f.push(S))}if(f&&u.push(f),a>1)for(let S=0;S<u.length;S++)u[S].length<=a||(B0(u[S],a,1,u[S].length-1,U0),u[S]=u[S].slice(0,a));return u}function U0(h,a){return a.area-h.area}function V0(h){let a=0;for(let u,f,y=0,S=h.length,T=S-1;y<S;T=y++)u=h[y],f=h[T],a+=(f.x-u.x)*(u.y+f.y);return a}const Cm=1/298.257223563,Pm=Cm*(2-Cm),Im=Math.PI/180;class Gd{constructor(a){const u=6378.137*Im*1e3,f=Math.cos(a*Im),y=1/(1-Pm*(1-f*f)),S=Math.sqrt(y);this.kx=u*S*f,this.ky=u*S*y*(1-Pm)}distance(a,u){const f=this.wrap(a[0]-u[0])*this.kx,y=(a[1]-u[1])*this.ky;return Math.sqrt(f*f+y*y)}pointOnLine(a,u){let f,y,S,T,A=1/0;for(let R=0;R<a.length-1;R++){let z=a[R][0],O=a[R][1],G=this.wrap(a[R+1][0]-z)*this.kx,$=(a[R+1][1]-O)*this.ky,Q=0;G===0&&$===0||(Q=(this.wrap(u[0]-z)*this.kx*G+(u[1]-O)*this.ky*$)/(G*G+$*$),Q>1?(z=a[R+1][0],O=a[R+1][1]):Q>0&&(z+=G/this.kx*Q,O+=$/this.ky*Q)),G=this.wrap(u[0]-z)*this.kx,$=(u[1]-O)*this.ky;const et=G*G+$*$;et<A&&(A=et,f=z,y=O,S=R,T=Q)}return{point:[f,y],index:S,t:Math.max(0,Math.min(1,T))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function Rm(h,a){return a[0]-h[0]}function Eh(h){return h[1]-h[0]+1}function Ca(h,a){return h[1]>=h[0]&&h[1]<a}function Hd(h,a){if(h[0]>h[1])return[null,null];const u=Eh(h);if(a){if(u===2)return[h,null];const y=Math.floor(u/2);return[[h[0],h[0]+y],[h[0]+y,h[1]]]}if(u===1)return[h,null];const f=Math.floor(u/2)-1;return[[h[0],h[0]+f],[h[0]+f+1,h[1]]]}function jd(h,a){if(!Ca(a,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let f=a[0];f<=a[1];++f)po(u,h[f]);return u}function Wd(h){const a=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const f of u)po(a,f);return a}function Ah(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function qd(h,a,u){if(!Ah(h)||!Ah(a))return NaN;let f=0,y=0;return h[2]<a[0]&&(f=a[0]-h[2]),h[0]>a[2]&&(f=h[0]-a[2]),h[1]>a[3]&&(y=h[1]-a[3]),h[3]<a[1]&&(y=a[1]-h[3]),u.distance([0,0],[f,y])}function _o(h,a,u){const f=u.pointOnLine(a,h);return u.distance(h,f.point)}function Xd(h,a,u,f,y){const S=Math.min(_o(h,[u,f],y),_o(a,[u,f],y)),T=Math.min(_o(u,[h,a],y),_o(f,[h,a],y));return Math.min(S,T)}function G0(h,a,u,f,y){if(!Ca(a,h.length)||!Ca(f,u.length))return 1/0;let S=1/0;for(let T=a[0];T<a[1];++T){const A=h[T],R=h[T+1];for(let z=f[0];z<f[1];++z){const O=u[z],G=u[z+1];if(Sh(A,R,O,G))return 0;S=Math.min(S,Xd(A,R,O,G,y))}}return S}function Cn(h,a,u,f,y){if(!Ca(a,h.length)||!Ca(f,u.length))return NaN;let S=1/0;for(let T=a[0];T<=a[1];++T)for(let A=f[0];A<=f[1];++A)if(S=Math.min(S,y.distance(h[T],u[A])),S===0)return S;return S}function H0(h,a,u){if(tl(h,a,!0))return 0;let f=1/0;for(const y of a){const S=y[0],T=y[y.length-1];if(S!==T&&(f=Math.min(f,_o(h,[T,S],u)),f===0))return f;const A=u.pointOnLine(y,h);if(f=Math.min(f,u.distance(h,A.point)),f===0)return f}return f}function Ii(h,a,u,f){if(!Ca(a,h.length))return NaN;for(let S=a[0];S<=a[1];++S)if(tl(h[S],u,!0))return 0;let y=1/0;for(let S=a[0];S<a[1];++S){const T=h[S],A=h[S+1];for(const R of u)for(let z=0,O=R.length,G=O-1;z<O;G=z++){const $=R[G],Q=R[z];if(Sh(T,A,$,Q))return 0;y=Math.min(y,Xd(T,A,$,Q,f))}}return y}function Ch(h,a){for(const u of h)for(const f of u)if(tl(f,a,!0))return!0;return!1}function ln(h,a,u,f=1/0){const y=Wd(h),S=Wd(a);if(f!==1/0&&qd(y,S,u)>=f)return f;if(Ha(y,S)){if(Ch(h,a))return 0}else if(Ch(a,h))return 0;let T=1/0;for(const A of h)for(let R=0,z=A.length,O=z-1;R<z;O=R++){const G=A[O],$=A[R];for(const Q of a)for(let et=0,at=Q.length,ft=at-1;et<at;ft=et++){const gt=Q[ft],Ot=Q[et];if(Sh(G,$,gt,Ot))return 0;T=Math.min(T,Xd(G,$,gt,Ot,u))}}return T}function Yi(h,a,u,f,y,S){if(!S)return;const T=qd(jd(f,S),y,u);T<a&&h.push([T,S,[0,0]])}function go(h,a,u,f,y,S,T){if(!S||!T)return;const A=qd(jd(f,S),jd(y,T),u);A<a&&h.push([A,S,T])}function dc(h,a,u,f,y=1/0){let S=Math.min(f.distance(h[0],u[0][0]),y);if(S===0)return S;const T=new Em([[0,[0,h.length-1],[0,0]]],Rm),A=Wd(u);for(;T.length>0;){const R=T.pop();if(R[0]>=S)continue;const z=R[1],O=a?50:100;if(Eh(z)<=O){if(!Ca(z,h.length))return NaN;if(a){const G=Ii(h,z,u,f);if(isNaN(G)||G===0)return G;S=Math.min(S,G)}else for(let G=z[0];G<=z[1];++G){const $=H0(h[G],u,f);if(S=Math.min(S,$),S===0)return 0}}else{const G=Hd(z,a);Yi(T,S,f,h,A,G[0]),Yi(T,S,f,h,A,G[1])}}return S}function fc(h,a,u,f,y,S=1/0){let T=Math.min(S,y.distance(h[0],u[0]));if(T===0)return T;const A=new Em([[0,[0,h.length-1],[0,u.length-1]]],Rm);for(;A.length>0;){const R=A.pop();if(R[0]>=T)continue;const z=R[1],O=R[2],G=a?50:100,$=f?50:100;if(Eh(z)<=G&&Eh(O)<=$){if(!Ca(z,h.length)&&Ca(O,u.length))return NaN;let Q;if(a&&f)Q=G0(h,z,u,O,y),T=Math.min(T,Q);else if(a&&!f){const et=h.slice(z[0],z[1]+1);for(let at=O[0];at<=O[1];++at)if(Q=_o(u[at],et,y),T=Math.min(T,Q),T===0)return T}else if(!a&&f){const et=u.slice(O[0],O[1]+1);for(let at=z[0];at<=z[1];++at)if(Q=_o(h[at],et,y),T=Math.min(T,Q),T===0)return T}else Q=Cn(h,z,u,O,y),T=Math.min(T,Q)}else{const Q=Hd(z,a),et=Hd(O,f);go(A,T,y,h,u,Q[0],et[0]),go(A,T,y,h,u,Q[0],et[1]),go(A,T,y,h,u,Q[1],et[0]),go(A,T,y,h,u,Q[1],et[1])}}return T}function $d(h){return h.type==="MultiPolygon"?h.coordinates.map(a=>({type:"Polygon",coordinates:a})):h.type==="MultiLineString"?h.coordinates.map(a=>({type:"LineString",coordinates:a})):h.type==="MultiPoint"?h.coordinates.map(a=>({type:"Point",coordinates:a})):[h]}class yo{constructor(a,u){this.type=Yt,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(An(a[1])){const f=a[1];if(f.type==="FeatureCollection")return new yo(f,f.features.map(y=>$d(y.geometry)).flat());if(f.type==="Feature")return new yo(f,$d(f.geometry));if("type"in f&&"coordinates"in f)return new yo(f,$d(f))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,f){const y=u.geometry(),S=y.flat().map(R=>Ud([R.x,R.y],u.canonical));if(y.length===0)return NaN;const T=new Gd(S[0][1]);let A=1/0;for(const R of f){switch(R.type){case"Point":A=Math.min(A,fc(S,!1,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,fc(S,!1,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,dc(S,!1,R.coordinates,T,A))}if(A===0)return A}return A}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,f){const y=u.geometry(),S=y.flat().map(R=>Ud([R.x,R.y],u.canonical));if(y.length===0)return NaN;const T=new Gd(S[0][1]);let A=1/0;for(const R of f){switch(R.type){case"Point":A=Math.min(A,fc(S,!0,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,fc(S,!0,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,dc(S,!0,R.coordinates,T,A))}if(A===0)return A}return A}(a,this.geometries);if(a.geometryType()==="Polygon")return function(u,f){const y=u.geometry();if(y.length===0||y[0].length===0)return NaN;const S=Th(y,0).map(R=>R.map(z=>z.map(O=>Ud([O.x,O.y],u.canonical)))),T=new Gd(S[0][0][0][1]);let A=1/0;for(const R of f)for(const z of S){switch(R.type){case"Point":A=Math.min(A,dc([R.coordinates],!1,z,T,A));break;case"LineString":A=Math.min(A,dc(R.coordinates,!0,z,T,A));break;case"Polygon":A=Math.min(A,ln(z,R.coordinates,T,A))}if(A===0)return A}return A}(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const el={"==":R0,"!=":gm,">":D0,"<":ym,">=":xm,"<=":L0,array:Zn,at:vr,boolean:Zn,case:yh,coalesce:bh,collator:hc,format:Mh,image:Bd,in:Yo,"index-of":Ko,interpolate:Os,"interpolate-hcl":Os,"interpolate-lab":Os,length:Nd,let:Ln,literal:Dn,match:zd,number:Zn,"number-format":Od,object:Zn,slice:lc,step:Jo,string:Zn,"to-boolean":ns,"to-color":ns,"to-number":ns,"to-string":ns,var:Pi,within:mo,distance:yo};class br{constructor(a,u,f,y){this.name=a,this.type=u,this._evaluate=f,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const f=a[0],y=br.definitions[f];if(!y)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,A=T.filter(([z])=>!Array.isArray(z)||z.length===a.length-1);let R=null;for(const[z,O]of A){R=new Qs(u.registry,pc,u.path,null,u.scope);const G=[];let $=!1;for(let Q=1;Q<a.length;Q++){const et=a[Q],at=Array.isArray(z)?z[Q-1]:z.type,ft=R.parse(et,1+G.length,at);if(!ft){$=!0;break}G.push(ft)}if(!$)if(Array.isArray(z)&&z.length!==G.length)R.error(`Expected ${z.length} arguments, but found ${G.length} instead.`);else{for(let Q=0;Q<G.length;Q++){const et=Array.isArray(z)?z[Q]:z.type,at=G[Q];R.concat(Q+1).checkSubtype(et,at.type)}if(R.errors.length===0)return new br(f,S,O,G)}}if(A.length===1)u.errors.push(...R.errors);else{const z=(A.length?A:T).map(([G])=>{return $=G,Array.isArray($)?`(${$.map(X).join(", ")})`:`(${X($.type)}...)`;var $}).join(" | "),O=[];for(let G=1;G<a.length;G++){const $=u.parse(a[G],1+O.length);if(!$)return null;O.push(X($.type))}u.error(`Expected arguments of type ${z}, but found (${O.join(", ")}) instead.`)}return null}static register(a,u){br.definitions=u;for(const f in u)a[f]=br}}function Zd(h,[a,u,f,y]){a=a.evaluate(h),u=u.evaluate(h),f=f.evaluate(h);const S=y?y.evaluate(h):1,T=qi(a,u,f,S);if(T)throw new ui(T);return new ce(a/255,u/255,f/255,S,!1)}function Yd(h,a){return h in a}function Kd(h,a){const u=a[h];return u===void 0?null:u}function xo(h){return{type:h}}function pc(h){if(h instanceof Pi)return pc(h.boundExpression);if(h instanceof br&&h.name==="error"||h instanceof hc||h instanceof mo||h instanceof yo)return!1;const a=h instanceof ns||h instanceof Zn;let u=!0;return h.eachChild(f=>{u=a?u&&pc(f):u&&f instanceof Dn}),!!u&&mc(h)&&_c(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function mc(h){if(h instanceof br&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof mo||h instanceof yo)return!1;let a=!0;return h.eachChild(u=>{a&&!mc(u)&&(a=!1)}),a}function il(h){if(h instanceof br&&h.name==="feature-state")return!1;let a=!0;return h.eachChild(u=>{a&&!il(u)&&(a=!1)}),a}function _c(h,a){if(h instanceof br&&a.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild(f=>{u&&!_c(f,a)&&(u=!1)}),u}function Ph(h){return{result:"success",value:h}}function nl(h){return{result:"error",value:h}}function sl(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function Dm(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Jd(h){return!!h.expression&&h.expression.interpolated}function Gi(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Ih(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function j0(h){return h}function Lm(h,a){const u=a.type==="color",f=h.stops&&typeof h.stops[0][0]=="object",y=f||!(f||h.property!==void 0),S=h.type||(Jd(a)?"exponential":"interval");if(u||a.type==="padding"){const O=u?ce.parse:li.parse;(h=Ie({},h)).stops&&(h.stops=h.stops.map(G=>[G[0],O(G[1])])),h.default=O(h.default?h.default:a.default)}if(h.colorSpace&&(T=h.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var T;let A,R,z;if(S==="exponential")A=Fm;else if(S==="interval")A=Rh;else if(S==="categorical"){A=km,R=Object.create(null);for(const O of h.stops)R[O[0]]=O[1];z=typeof h.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);A=zm}if(f){const O={},G=[];for(let et=0;et<h.stops.length;et++){const at=h.stops[et],ft=at[0].zoom;O[ft]===void 0&&(O[ft]={zoom:ft,type:h.type,property:h.property,default:h.default,stops:[]},G.push(ft)),O[ft].stops.push([at[0].value,at[1]])}const $=[];for(const et of G)$.push([O[et].zoom,Lm(O[et],a)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:Os.interpolationFactor.bind(void 0,Q),zoomStops:$.map(et=>et[0]),evaluate:({zoom:et},at)=>Fm({stops:$,base:h.base},a,et).evaluate(et,at)}}if(y){const O=S==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Os.interpolationFactor.bind(void 0,O),zoomStops:h.stops.map(G=>G[0]),evaluate:({zoom:G})=>A(h,a,G,R,z)}}return{kind:"source",evaluate(O,G){const $=G&&G.properties?G.properties[h.property]:void 0;return $===void 0?rl(h.default,a.default):A(h,a,$,R,z)}}}function rl(h,a,u){return h!==void 0?h:a!==void 0?a:u!==void 0?u:void 0}function km(h,a,u,f,y){return rl(typeof u===y?f[u]:void 0,h.default,a.default)}function Rh(h,a,u){if(Gi(u)!=="number")return rl(h.default,a.default);const f=h.stops.length;if(f===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[f-1][0])return h.stops[f-1][1];const y=xh(h.stops.map(S=>S[0]),u);return h.stops[y][1]}function Fm(h,a,u){const f=h.base!==void 0?h.base:1;if(Gi(u)!=="number")return rl(h.default,a.default);const y=h.stops.length;if(y===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[y-1][0])return h.stops[y-1][1];const S=xh(h.stops.map(O=>O[0]),u),T=function(O,G,$,Q){const et=Q-$,at=O-$;return et===0?0:G===1?at/et:(Math.pow(G,at)-1)/(Math.pow(G,et)-1)}(u,f,h.stops[S][0],h.stops[S+1][0]),A=h.stops[S][1],R=h.stops[S+1][1],z=zs[a.type]||j0;return typeof A.evaluate=="function"?{evaluate(...O){const G=A.evaluate.apply(void 0,O),$=R.evaluate.apply(void 0,O);if(G!==void 0&&$!==void 0)return z(G,$,T,h.colorSpace)}}:z(A,R,T,h.colorSpace)}function zm(h,a,u){switch(a.type){case"color":u=ce.parse(u);break;case"formatted":u=ei.fromString(u.toString());break;case"resolvedImage":u=Ri.fromString(u.toString());break;case"padding":u=li.parse(u);break;default:Gi(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return rl(u,h.default,a.default)}br.register(el,{error:[{kind:"error"},[ge],(h,[a])=>{throw new ui(a.evaluate(h))}],typeof:[ge,[Re],(h,[a])=>X(pi(a.evaluate(h)))],"to-rgba":[W(Yt,4),[xi],(h,[a])=>{const[u,f,y,S]=a.evaluate(h).rgb;return[255*u,255*f,255*y,S]}],rgb:[xi,[Yt,Yt,Yt],Zd],rgba:[xi,[Yt,Yt,Yt,Yt],Zd],has:{type:ne,overloads:[[[ge],(h,[a])=>Yd(a.evaluate(h),h.properties())],[[ge,ci],(h,[a,u])=>Yd(a.evaluate(h),u.evaluate(h))]]},get:{type:Re,overloads:[[[ge],(h,[a])=>Kd(a.evaluate(h),h.properties())],[[ge,ci],(h,[a,u])=>Kd(a.evaluate(h),u.evaluate(h))]]},"feature-state":[Re,[ge],(h,[a])=>Kd(a.evaluate(h),h.featureState||{})],properties:[ci,[],h=>h.properties()],"geometry-type":[ge,[],h=>h.geometryType()],id:[Re,[],h=>h.id()],zoom:[Yt,[],h=>h.globals.zoom],"heatmap-density":[Yt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Yt,[],h=>h.globals.lineProgress||0],accumulated:[Re,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Yt,xo(Yt),(h,a)=>{let u=0;for(const f of a)u+=f.evaluate(h);return u}],"*":[Yt,xo(Yt),(h,a)=>{let u=1;for(const f of a)u*=f.evaluate(h);return u}],"-":{type:Yt,overloads:[[[Yt,Yt],(h,[a,u])=>a.evaluate(h)-u.evaluate(h)],[[Yt],(h,[a])=>-a.evaluate(h)]]},"/":[Yt,[Yt,Yt],(h,[a,u])=>a.evaluate(h)/u.evaluate(h)],"%":[Yt,[Yt,Yt],(h,[a,u])=>a.evaluate(h)%u.evaluate(h)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(h,[a,u])=>Math.pow(a.evaluate(h),u.evaluate(h))],sqrt:[Yt,[Yt],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[Yt,[Yt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[Yt,[Yt],(h,[a])=>Math.log(a.evaluate(h))],log2:[Yt,[Yt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[Yt,[Yt],(h,[a])=>Math.sin(a.evaluate(h))],cos:[Yt,[Yt],(h,[a])=>Math.cos(a.evaluate(h))],tan:[Yt,[Yt],(h,[a])=>Math.tan(a.evaluate(h))],asin:[Yt,[Yt],(h,[a])=>Math.asin(a.evaluate(h))],acos:[Yt,[Yt],(h,[a])=>Math.acos(a.evaluate(h))],atan:[Yt,[Yt],(h,[a])=>Math.atan(a.evaluate(h))],min:[Yt,xo(Yt),(h,a)=>Math.min(...a.map(u=>u.evaluate(h)))],max:[Yt,xo(Yt),(h,a)=>Math.max(...a.map(u=>u.evaluate(h)))],abs:[Yt,[Yt],(h,[a])=>Math.abs(a.evaluate(h))],round:[Yt,[Yt],(h,[a])=>{const u=a.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[Yt,[Yt],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[Yt,[Yt],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[ne,[ge,Re],(h,[a,u])=>h.properties()[a.value]===u.value],"filter-id-==":[ne,[Re],(h,[a])=>h.id()===a.value],"filter-type-==":[ne,[ge],(h,[a])=>h.geometryType()===a.value],"filter-<":[ne,[ge,Re],(h,[a,u])=>{const f=h.properties()[a.value],y=u.value;return typeof f==typeof y&&f<y}],"filter-id-<":[ne,[Re],(h,[a])=>{const u=h.id(),f=a.value;return typeof u==typeof f&&u<f}],"filter->":[ne,[ge,Re],(h,[a,u])=>{const f=h.properties()[a.value],y=u.value;return typeof f==typeof y&&f>y}],"filter-id->":[ne,[Re],(h,[a])=>{const u=h.id(),f=a.value;return typeof u==typeof f&&u>f}],"filter-<=":[ne,[ge,Re],(h,[a,u])=>{const f=h.properties()[a.value],y=u.value;return typeof f==typeof y&&f<=y}],"filter-id-<=":[ne,[Re],(h,[a])=>{const u=h.id(),f=a.value;return typeof u==typeof f&&u<=f}],"filter->=":[ne,[ge,Re],(h,[a,u])=>{const f=h.properties()[a.value],y=u.value;return typeof f==typeof y&&f>=y}],"filter-id->=":[ne,[Re],(h,[a])=>{const u=h.id(),f=a.value;return typeof u==typeof f&&u>=f}],"filter-has":[ne,[Re],(h,[a])=>a.value in h.properties()],"filter-has-id":[ne,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[ne,[W(ge)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[ne,[W(Re)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[ne,[ge,W(Re)],(h,[a,u])=>u.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[ne,[ge,W(Re)],(h,[a,u])=>function(f,y,S,T){for(;S<=T;){const A=S+T>>1;if(y[A]===f)return!0;y[A]>f?T=A-1:S=A+1}return!1}(h.properties()[a.value],u.value,0,u.value.length-1)],all:{type:ne,overloads:[[[ne,ne],(h,[a,u])=>a.evaluate(h)&&u.evaluate(h)],[xo(ne),(h,a)=>{for(const u of a)if(!u.evaluate(h))return!1;return!0}]]},any:{type:ne,overloads:[[[ne,ne],(h,[a,u])=>a.evaluate(h)||u.evaluate(h)],[xo(ne),(h,a)=>{for(const u of a)if(u.evaluate(h))return!0;return!1}]]},"!":[ne,[ne],(h,[a])=>!a.evaluate(h)],"is-supported-script":[ne,[ge],(h,[a])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(a.evaluate(h))}],upcase:[ge,[ge],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[ge,[ge],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[ge,xo(Re),(h,a)=>a.map(u=>Ke(u.evaluate(h))).join("")],"resolved-locale":[ge,[It],(h,[a])=>a.evaluate(h).resolvedLocale()]});class Dh{constructor(a,u){var f;this.expression=a,this._warningHistory={},this._evaluator=new Ts,this._defaultValue=u?(f=u).type==="color"&&Ih(f.default)?new ce(0,0,0,0):f.type==="color"?ce.parse(f.default)||null:f.type==="padding"?li.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?wi.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(a,u,f,y,S,T){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,u,f,y,S,T){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new ui(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Lh(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in el}function al(h,a){const u=new Qs(el,pc,[],a?function(y){const S={color:xi,string:ge,number:Yt,enum:ge,boolean:ne,formatted:Me,padding:Kt,resolvedImage:se,variableAnchorOffsetCollection:lt};return y.type==="array"?W(S[y.value]||Re,y.length):S[y.type]}(a):void 0),f=u.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ph(new Dh(f,a)):nl(u.errors)}class ol{constructor(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!il(u.expression)}evaluateWithoutErrorHandling(a,u,f,y,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,f,y,S,T)}evaluate(a,u,f,y,S,T){return this._styleExpression.evaluate(a,u,f,y,S,T)}}class ll{constructor(a,u,f,y){this.kind=a,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!il(u.expression),this.interpolationType=y}evaluateWithoutErrorHandling(a,u,f,y,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,f,y,S,T)}evaluate(a,u,f,y,S,T){return this._styleExpression.evaluate(a,u,f,y,S,T)}interpolationFactor(a,u,f){return this.interpolationType?Os.interpolationFactor(this.interpolationType,a,u,f):0}}function Qd(h,a){const u=al(h,a);if(u.result==="error")return u;const f=u.value.expression,y=mc(f);if(!y&&!sl(a))return nl([new yi("","data expressions not supported")]);const S=_c(f,["zoom"]);if(!S&&!Dm(a))return nl([new yi("","zoom expressions not supported")]);const T=gc(f);return T||S?T instanceof yi?nl([T]):T instanceof Os&&!Jd(a)?nl([new yi("",'"interpolate" expressions cannot be used with this property')]):Ph(T?new ll(y?"camera":"composite",u.value,T.labels,T instanceof Os?T.interpolation:void 0):new ol(y?"constant":"source",u.value)):nl([new yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cl{constructor(a,u){this._parameters=a,this._specification=u,Ie(this,Lm(this._parameters,this._specification))}static deserialize(a){return new cl(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function gc(h){let a=null;if(h instanceof Ln)a=gc(h.result);else if(h instanceof bh){for(const u of h.args)if(a=gc(u),a)break}else(h instanceof Jo||h instanceof Os)&&h.input instanceof br&&h.input.name==="zoom"&&(a=h);return a instanceof yi||h.eachChild(u=>{const f=gc(u);f instanceof yi?a=f:!a&&f?a=new yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&f&&a!==f&&(a=new yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function kh(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!kh(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Fh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function tf(h){if(h==null)return{filter:()=>!0,needGeometry:!1};kh(h)||(h=zh(h));const a=al(h,Fh);if(a.result==="error")throw new Error(a.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,y)=>a.value.evaluate(u,f,{},y),needGeometry:Om(h)}}function W0(h,a){return h<a?-1:h>a?1:0}function Om(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(Om(h[a]))return!0;return!1}function zh(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?ef(h[1],h[2],"=="):a==="!="?us(ef(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?ef(h[1],h[2],a):a==="any"?(u=h.slice(1),["any"].concat(u.map(zh))):a==="all"?["all"].concat(h.slice(1).map(zh)):a==="none"?["all"].concat(h.slice(1).map(zh).map(us)):a==="in"?yc(h[1],h.slice(2)):a==="!in"?us(yc(h[1],h.slice(2))):a==="has"?xc(h[1]):a!=="!has"||us(xc(h[1]));var u}function ef(h,a,u){switch(h){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,h,a]}}function yc(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(u=>typeof u!=typeof a[0])?["filter-in-large",h,["literal",a.sort(W0)]]:["filter-in-small",h,["literal",a]]}}function xc(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function us(h){return["!",h]}function vo(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let y="[";for(const S of h)y+=`${vo(S)},`;return`${y}]`}const u=Object.keys(h).sort();let f="{";for(let y=0;y<u.length;y++)f+=`${JSON.stringify(u[y])}:${vo(h[u[y]])},`;return`${f}}`}function Bm(h){let a="";for(const u of Ai)a+=`/${vo(h[u])}`;return a}function Nm(h){const a=h.value;return a?[new Ut(h.key,a,"constants have been deprecated as of v8")]:[]}function Pn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Vr(h){if(Array.isArray(h))return h.map(Vr);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const u in h)a[u]=Vr(h[u]);return a}return Pn(h)}function tr(h){const a=h.key,u=h.value,f=h.valueSpec||{},y=h.objectElementValidators||{},S=h.style,T=h.styleSpec,A=h.validateSpec;let R=[];const z=Gi(u);if(z!=="object")return[new Ut(a,u,`object expected, ${z} found`)];for(const O in u){const G=O.split(".")[0],$=f[G]||f["*"];let Q;if(y[G])Q=y[G];else if(f[G])Q=A;else if(y["*"])Q=y["*"];else{if(!f["*"]){R.push(new Ut(a,u[O],`unknown property "${O}"`));continue}Q=A}R=R.concat(Q({key:(a&&`${a}.`)+O,value:u[O],valueSpec:$,style:S,styleSpec:T,object:u,objectKey:O,validateSpec:A},u))}for(const O in f)y[O]||f[O].required&&f[O].default===void 0&&u[O]===void 0&&R.push(new Ut(a,u,`missing required property "${O}"`));return R}function vc(h){const a=h.value,u=h.valueSpec,f=h.style,y=h.styleSpec,S=h.key,T=h.arrayElementValidator||h.validateSpec;if(Gi(a)!=="array")return[new Ut(S,a,`array expected, ${Gi(a)} found`)];if(u.length&&a.length!==u.length)return[new Ut(S,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new Ut(S,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let A={type:u.value,values:u.values};y.$version<7&&(A.function=u.function),Gi(u.value)==="object"&&(A=u.value);let R=[];for(let z=0;z<a.length;z++)R=R.concat(T({array:a,arrayIndex:z,value:a[z],valueSpec:A,validateSpec:h.validateSpec,style:f,styleSpec:y,key:`${S}[${z}]`}));return R}function nf(h){const a=h.key,u=h.value,f=h.valueSpec;let y=Gi(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Ut(a,u,`number expected, ${y} found`)]:"minimum"in f&&u<f.minimum?[new Ut(a,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new Ut(a,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Oh(h){const a=h.valueSpec,u=Pn(h.value.type);let f,y,S,T={};const A=u!=="categorical"&&h.value.property===void 0,R=!A,z=Gi(h.value.stops)==="array"&&Gi(h.value.stops[0])==="array"&&Gi(h.value.stops[0][0])==="object",O=tr({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Q){if(u==="identity")return[new Ut(Q.key,Q.value,'identity function may not have a "stops" property')];let et=[];const at=Q.value;return et=et.concat(vc({key:Q.key,value:at,valueSpec:Q.valueSpec,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:G})),Gi(at)==="array"&&at.length===0&&et.push(new Ut(Q.key,at,"array must have at least one stop")),et},default:function(Q){return Q.validateSpec({key:Q.key,value:Q.value,valueSpec:a,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec})}}});return u==="identity"&&A&&O.push(new Ut(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||O.push(new Ut(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Jd(h.valueSpec)&&O.push(new Ut(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(R&&!sl(h.valueSpec)?O.push(new Ut(h.key,h.value,"property functions not supported")):A&&!Dm(h.valueSpec)&&O.push(new Ut(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!z||h.value.property!==void 0||O.push(new Ut(h.key,h.value,'"property" property is required')),O;function G(Q){let et=[];const at=Q.value,ft=Q.key;if(Gi(at)!=="array")return[new Ut(ft,at,`array expected, ${Gi(at)} found`)];if(at.length!==2)return[new Ut(ft,at,`array length 2 expected, length ${at.length} found`)];if(z){if(Gi(at[0])!=="object")return[new Ut(ft,at,`object expected, ${Gi(at[0])} found`)];if(at[0].zoom===void 0)return[new Ut(ft,at,"object stop key must have zoom")];if(at[0].value===void 0)return[new Ut(ft,at,"object stop key must have value")];if(S&&S>Pn(at[0].zoom))return[new Ut(ft,at[0].zoom,"stop zoom values must appear in ascending order")];Pn(at[0].zoom)!==S&&(S=Pn(at[0].zoom),y=void 0,T={}),et=et.concat(tr({key:`${ft}[0]`,value:at[0],valueSpec:{zoom:{}},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:nf,value:$}}))}else et=et.concat($({key:`${ft}[0]`,value:at[0]},at));return Lh(Vr(at[1]))?et.concat([new Ut(`${ft}[1]`,at[1],"expressions are not allowed in function stops.")]):et.concat(Q.validateSpec({key:`${ft}[1]`,value:at[1],valueSpec:a,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec}))}function $(Q,et){const at=Gi(Q.value),ft=Pn(Q.value),gt=Q.value!==null?Q.value:et;if(f){if(at!==f)return[new Ut(Q.key,gt,`${at} stop domain type must match previous stop domain type ${f}`)]}else f=at;if(at!=="number"&&at!=="string"&&at!=="boolean")return[new Ut(Q.key,gt,"stop domain value must be a number, string, or boolean")];if(at!=="number"&&u!=="categorical"){let Ot=`number expected, ${at} found`;return sl(a)&&u===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut(Q.key,gt,Ot)]}return u!=="categorical"||at!=="number"||isFinite(ft)&&Math.floor(ft)===ft?u!=="categorical"&&at==="number"&&y!==void 0&&ft<y?[new Ut(Q.key,gt,"stop domain values must appear in ascending order")]:(y=ft,u==="categorical"&&ft in T?[new Ut(Q.key,gt,"stop domain values must be unique")]:(T[ft]=!0,[])):[new Ut(Q.key,gt,`integer expected, found ${ft}`)]}}function hl(h){const a=(h.expressionContext==="property"?Qd:al)(Vr(h.value),h.valueSpec);if(a.result==="error")return a.value.map(f=>new Ut(`${h.key}${f.key}`,h.value,f.message));const u=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new Ut(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!il(u))return[new Ut(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!il(u))return[new Ut(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!_c(u,["zoom","feature-state"]))return[new Ut(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!mc(u))return[new Ut(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pa(h){const a=h.key,u=h.value,f=h.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(Pn(u))===-1&&y.push(new Ut(a,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Pn(u))===-1&&y.push(new Ut(a,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function sf(h){return kh(Vr(h.value))?hl(Ie({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Bh(h)}function Bh(h){const a=h.value,u=h.key;if(Gi(a)!=="array")return[new Ut(u,a,`array expected, ${Gi(a)} found`)];const f=h.styleSpec;let y,S=[];if(a.length<1)return[new Ut(u,a,"filter array must have at least 1 element")];switch(S=S.concat(Pa({key:`${u}[0]`,value:a[0],valueSpec:f.filter_operator})),Pn(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Pn(a[1])==="$type"&&S.push(new Ut(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&S.push(new Ut(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=Gi(a[1]),y!=="string"&&S.push(new Ut(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let T=2;T<a.length;T++)y=Gi(a[T]),Pn(a[1])==="$type"?S=S.concat(Pa({key:`${u}[${T}]`,value:a[T],valueSpec:f.geometry_type})):y!=="string"&&y!=="number"&&y!=="boolean"&&S.push(new Ut(`${u}[${T}]`,a[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)S=S.concat(Bh({key:`${u}[${T}]`,value:a[T],styleSpec:h.styleSpec}));break;case"has":case"!has":y=Gi(a[1]),a.length!==2?S.push(new Ut(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&S.push(new Ut(`${u}[1]`,a[1],`string expected, ${y} found`))}return S}function rf(h,a){const u=h.key,f=h.validateSpec,y=h.style,S=h.styleSpec,T=h.value,A=h.objectKey,R=S[`${a}_${h.layerType}`];if(!R)return[];const z=A.match(/^(.*)-transition$/);if(a==="paint"&&z&&R[z[1]]&&R[z[1]].transition)return f({key:u,value:T,valueSpec:S.transition,style:y,styleSpec:S});const O=h.valueSpec||R[A];if(!O)return[new Ut(u,T,`unknown property "${A}"`)];let G;if(Gi(T)==="string"&&sl(O)&&!O.tokens&&(G=/^{([^}]+)}$/.exec(T)))return[new Ut(u,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const $=[];return h.layerType==="symbol"&&(A==="text-field"&&y&&!y.glyphs&&$.push(new Ut(u,T,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Ih(Vr(T))&&Pn(T.type)==="identity"&&$.push(new Ut(u,T,'"text-font" does not support identity functions'))),$.concat(f({key:h.key,value:T,valueSpec:O,style:y,styleSpec:S,expressionContext:"property",propertyType:a,propertyKey:A}))}function Nh(h){return rf(h,"paint")}function af(h){return rf(h,"layout")}function of(h){let a=[];const u=h.value,f=h.key,y=h.style,S=h.styleSpec;u.type||u.ref||a.push(new Ut(f,u,'either "type" or "ref" is required'));let T=Pn(u.type);const A=Pn(u.ref);if(u.id){const R=Pn(u.id);for(let z=0;z<h.arrayIndex;z++){const O=y.layers[z];Pn(O.id)===R&&a.push(new Ut(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&a.push(new Ut(f,u[z],`"${z}" is prohibited for ref layers`))}),y.layers.forEach(z=>{Pn(z.id)===A&&(R=z)}),R?R.ref?a.push(new Ut(f,u.ref,"ref cannot reference another ref layer")):T=Pn(R.type):a.push(new Ut(f,u.ref,`ref layer "${A}" not found`))}else if(T!=="background")if(u.source){const R=y.sources&&y.sources[u.source],z=R&&Pn(R.type);R?z==="vector"&&T==="raster"?a.push(new Ut(f,u.source,`layer "${u.id}" requires a raster source`)):z!=="raster-dem"&&T==="hillshade"?a.push(new Ut(f,u.source,`layer "${u.id}" requires a raster-dem source`)):z==="raster"&&T!=="raster"?a.push(new Ut(f,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&T!=="hillshade"?a.push(new Ut(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||z==="geojson"&&R.lineMetrics||a.push(new Ut(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new Ut(f,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new Ut(f,u.source,`source "${u.source}" not found`))}else a.push(new Ut(f,u,'missing required property "source"'));return a=a.concat(tr({key:f,value:u,valueSpec:S.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${f}.type`,value:u.type,valueSpec:S.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:sf,layout:R=>tr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":z=>af(Ie({layerType:T},z))}}),paint:R=>tr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":z=>Nh(Ie({layerType:T},z))}})}})),a}function bo(h){const a=h.value,u=h.key,f=Gi(a);return f!=="string"?[new Ut(u,a,`string expected, ${f} found`)]:[]}const Uh={promoteId:function({key:h,value:a}){if(Gi(a)==="string")return bo({key:h,value:a});{const u=[];for(const f in a)u.push(...bo({key:`${h}.${f}`,value:a[f]}));return u}}};function bc(h){const a=h.value,u=h.key,f=h.styleSpec,y=h.style,S=h.validateSpec;if(!a.type)return[new Ut(u,a,'"type" is required')];const T=Pn(a.type);let A;switch(T){case"vector":case"raster":return A=tr({key:u,value:a,valueSpec:f[`source_${T.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Uh,validateSpec:S}),A;case"raster-dem":return A=function(R){var z;const O=(z=R.sourceName)!==null&&z!==void 0?z:"",G=R.value,$=R.styleSpec,Q=$.source_raster_dem,et=R.style;let at=[];const ft=Gi(G);if(G===void 0)return at;if(ft!=="object")return at.push(new Ut("source_raster_dem",G,`object expected, ${ft} found`)),at;const gt=Pn(G.encoding)==="custom",Ot=["redFactor","greenFactor","blueFactor","baseShift"],Tt=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const kt in G)!gt&&Ot.includes(kt)?at.push(new Ut(kt,G[kt],`In "${O}": "${kt}" is only valid when "encoding" is set to "custom". ${Tt} encoding found`)):Q[kt]?at=at.concat(R.validateSpec({key:kt,value:G[kt],valueSpec:Q[kt],validateSpec:R.validateSpec,style:et,styleSpec:$})):at.push(new Ut(kt,G[kt],`unknown property "${kt}"`));return at}({sourceName:u,value:a,style:h.style,styleSpec:f,validateSpec:S}),A;case"geojson":if(A=tr({key:u,value:a,valueSpec:f.source_geojson,style:y,styleSpec:f,validateSpec:S,objectElementValidators:Uh}),a.cluster)for(const R in a.clusterProperties){const[z,O]=a.clusterProperties[R],G=typeof z=="string"?[z,["accumulated"],["get",R]]:z;A.push(...hl({key:`${u}.${R}.map`,value:O,expressionContext:"cluster-map"})),A.push(...hl({key:`${u}.${R}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return A;case"video":return tr({key:u,value:a,valueSpec:f.source_video,style:y,validateSpec:S,styleSpec:f});case"image":return tr({key:u,value:a,valueSpec:f.source_image,style:y,validateSpec:S,styleSpec:f});case"canvas":return[new Ut(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pa({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function lf(h){const a=h.value,u=h.styleSpec,f=u.light,y=h.style;let S=[];const T=Gi(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new Ut("light",a,`object expected, ${T} found`)]),S;for(const A in a){const R=A.match(/^(.*)-transition$/);S=S.concat(R&&f[R[1]]&&f[R[1]].transition?h.validateSpec({key:A,value:a[A],valueSpec:u.transition,validateSpec:h.validateSpec,style:y,styleSpec:u}):f[A]?h.validateSpec({key:A,value:a[A],valueSpec:f[A],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Ut(A,a[A],`unknown property "${A}"`)])}return S}function cf(h){const a=h.value,u=h.styleSpec,f=u.sky,y=h.style,S=Gi(a);if(a===void 0)return[];if(S!=="object")return[new Ut("sky",a,`object expected, ${S} found`)];let T=[];for(const A in a)T=T.concat(f[A]?h.validateSpec({key:A,value:a[A],valueSpec:f[A],style:y,styleSpec:u}):[new Ut(A,a[A],`unknown property "${A}"`)]);return T}function hf(h){const a=h.value,u=h.styleSpec,f=u.terrain,y=h.style;let S=[];const T=Gi(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new Ut("terrain",a,`object expected, ${T} found`)]),S;for(const A in a)S=S.concat(f[A]?h.validateSpec({key:A,value:a[A],valueSpec:f[A],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Ut(A,a[A],`unknown property "${A}"`)]);return S}function uf(h){let a=[];const u=h.value,f=h.key;if(Array.isArray(u)){const y=[],S=[];for(const T in u)u[T].id&&y.includes(u[T].id)&&a.push(new Ut(f,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),y.push(u[T].id),u[T].url&&S.includes(u[T].url)&&a.push(new Ut(f,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),S.push(u[T].url),a=a.concat(tr({key:`${f}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return bo({key:f,value:u})}const Vh={"*":()=>[],array:vc,boolean:function(h){const a=h.value,u=h.key,f=Gi(a);return f!=="boolean"?[new Ut(u,a,`boolean expected, ${f} found`)]:[]},number:nf,color:function(h){const a=h.key,u=h.value,f=Gi(u);return f!=="string"?[new Ut(a,u,`color expected, ${f} found`)]:ce.parse(String(u))?[]:[new Ut(a,u,`color expected, "${u}" found`)]},constants:Nm,enum:Pa,filter:sf,function:Oh,layer:of,object:tr,source:bc,light:lf,sky:cf,terrain:hf,projection:function(h){const a=h.value,u=h.styleSpec,f=u.projection,y=h.style,S=Gi(a);if(a===void 0)return[];if(S!=="object")return[new Ut("projection",a,`object expected, ${S} found`)];let T=[];for(const A in a)T=T.concat(f[A]?h.validateSpec({key:A,value:a[A],valueSpec:f[A],style:y,styleSpec:u}):[new Ut(A,a[A],`unknown property "${A}"`)]);return T},string:bo,formatted:function(h){return bo(h).length===0?[]:hl(h)},resolvedImage:function(h){return bo(h).length===0?[]:hl(h)},padding:function(h){const a=h.key,u=h.value;if(Gi(u)==="array"){if(u.length<1||u.length>4)return[new Ut(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let y=[];for(let S=0;S<u.length;S++)y=y.concat(h.validateSpec({key:`${a}[${S}]`,value:u[S],validateSpec:h.validateSpec,valueSpec:f}));return y}return nf({key:a,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const a=h.key,u=h.value,f=Gi(u),y=h.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new Ut(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<u.length;T+=2)S=S.concat(Pa({key:`${a}[${T}]`,value:u[T],valueSpec:y.layout_symbol["text-anchor"]})),S=S.concat(vc({key:`${a}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:y}));return S},sprite:uf};function wc(h){const a=h.value,u=h.valueSpec,f=h.styleSpec;return h.validateSpec=wc,u.expression&&Ih(Pn(a))?Oh(h):u.expression&&Lh(Vr(a))?hl(h):u.type&&Vh[u.type]?Vh[u.type](h):tr(Ie({},h,{valueSpec:u.type?f[u.type]:u}))}function Um(h){const a=h.value,u=h.key,f=bo(h);return f.length||(a.indexOf("{fontstack}")===-1&&f.push(new Ut(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&f.push(new Ut(u,a,'"glyphs" url must include a "{range}" token'))),f}function wr(h,a=Ft){let u=[];return u=u.concat(wc({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:wc,objectElementValidators:{glyphs:Um,"*":()=>[]}})),h.constants&&(u=u.concat(Nm({key:"constants",value:h.constants}))),df(u)}function ca(h){return function(a){return h({...a,validateSpec:wc})}}function df(h){return[].concat(h).sort((a,u)=>a.line-u.line)}function Gr(h){return function(...a){return df(h.apply(this,a))}}wr.source=Gr(ca(bc)),wr.sprite=Gr(ca(uf)),wr.glyphs=Gr(ca(Um)),wr.light=Gr(ca(lf)),wr.sky=Gr(ca(cf)),wr.terrain=Gr(ca(hf)),wr.layer=Gr(ca(of)),wr.filter=Gr(ca(sf)),wr.paintProperty=Gr(ca(Nh)),wr.layoutProperty=Gr(ca(af));const wo=wr,q0=wo.light,X0=wo.sky,Vm=wo.paintProperty,Gm=wo.layoutProperty;function ff(h,a){let u=!1;if(a&&a.length)for(const f of a)h.fire(new zt(new Error(f.message))),u=!0;return u}class ul{constructor(a,u,f){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(u=T[1])+2*(f=T[2]);for(let R=0;R<this.d*this.d;R++){const z=T[3+R],O=T[3+R+1];y.push(z===O?null:T.subarray(z,O))}const A=T[3+y.length+1];this.keys=T.subarray(T[3+y.length],A),this.bboxes=T.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=f,this.scale=u/a,this.uid=0;const S=f/u*a;this.min=-S,this.max=a+S}insert(a,u,f,y,S){this._forEachCell(u,f,y,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,f,y,S,T){this.cells[S].push(T)}query(a,u,f,y,S){const T=this.min,A=this.max;if(a<=T&&u<=T&&A<=f&&A<=y&&!S)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,u,f,y,this._queryCell,R,{},S),R}}_queryCell(a,u,f,y,S,T,A,R){const z=this.cells[S];if(z!==null){const O=this.keys,G=this.bboxes;for(let $=0;$<z.length;$++){const Q=z[$];if(A[Q]===void 0){const et=4*Q;(R?R(G[et+0],G[et+1],G[et+2],G[et+3]):a<=G[et+2]&&u<=G[et+3]&&f>=G[et+0]&&y>=G[et+1])?(A[Q]=!0,T.push(O[Q])):A[Q]=!1}}}}_forEachCell(a,u,f,y,S,T,A,R){const z=this._convertToCellCoord(a),O=this._convertToCellCoord(u),G=this._convertToCellCoord(f),$=this._convertToCellCoord(y);for(let Q=z;Q<=G;Q++)for(let et=O;et<=$;et++){const at=this.d*et+Q;if((!R||R(this._convertFromCellCoord(Q),this._convertFromCellCoord(et),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(et+1)))&&S.call(this,a,u,f,y,at,T,A,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let f=0;for(let T=0;T<this.cells.length;T++)f+=this.cells[T].length;const y=new Int32Array(u+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let S=u;for(let T=0;T<a.length;T++){const A=a[T];y[3+T]=S,y.set(A,S),S+=A.length}return y[3+a.length]=S,y.set(this.keys,S),S+=this.keys.length,y[3+a.length+1]=S,y.set(this.bboxes,S),S+=this.bboxes.length,y.buffer}static serialize(a,u){const f=a.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(a){return new ul(a.buffer)}}const Mr={};function De(h,a,u={}){if(Mr[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),Mr[h]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}De("Object",Object),De("TransferableGridIndex",ul),De("Color",ce),De("Error",Error),De("AJAXError",be),De("ResolvedImage",Ri),De("StylePropertyFunction",cl),De("StyleExpression",Dh,{omit:["_evaluator"]}),De("ZoomDependentExpression",ll),De("ZoomConstantExpression",ol),De("CompoundExpression",br,{omit:["_evaluate"]});for(const h in el)el[h]._classRegistryKey||De(`Expression_${h}`,el[h]);function Gh(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function pf(h){return h.$name||h.constructor._classRegistryKey}function Hm(h){return!function(a){if(a===null||typeof a!="object")return!1;const u=pf(a);return!(!u||u==="Object")}(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||Gh(h)||Zt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function dl(h,a){if(Hm(h))return(Gh(h)||Zt(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const S=[];for(const T of h)S.push(dl(T,a));return S}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=pf(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!Mr[u])throw new Error(`${u} is not registered.`);const{klass:f}=Mr[u],y=f.serialize?f.serialize(h,a):{};if(f.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in h){if(!h.hasOwnProperty(S)||Mr[u].omit.indexOf(S)>=0)continue;const T=h[S];y[S]=Mr[u].shallow.indexOf(S)>=0?T:dl(T,a)}h instanceof Error&&(y.message=h.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(y.$name=u),y}function fl(h){if(Hm(h))return h;if(Array.isArray(h))return h.map(fl);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=pf(h)||"Object";if(!Mr[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=Mr[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(h);const f=Object.create(u.prototype);for(const y of Object.keys(h)){if(y==="$name")continue;const S=h[y];f[y]=Mr[a].shallow.indexOf(y)>=0?S:fl(S)}return f}class mf{constructor(){this.first=!0}update(a,u){const f=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=f,!0))}}const zi={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function _f(h){for(const a of h)if(yf(a.charCodeAt(0)))return!0;return!1}function $0(h){for(const a of h)if(!pl(a.charCodeAt(0)))return!1;return!0}function gf(h){const a=h.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(a.join("|"),"u")}const Z0=gf(["Arab","Dupl","Mong","Ougr","Syrc"]);function pl(h){return!Z0.test(String.fromCodePoint(h))}const jm=gf(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function yf(h){return!(h!==746&&h!==747&&(h<4352||!(zi["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||zi["CJK Compatibility"](h)||zi["CJK Strokes"](h)||!(!zi["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||zi["Enclosed CJK Letters and Months"](h)||zi["Ideographic Description Characters"](h)||zi.Kanbun(h)||zi.Katakana(h)&&h!==12540||!(!zi["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!zi["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||zi["Vertical Forms"](h)||zi["Yijing Hexagram Symbols"](h)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(h))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(h))||jm.test(String.fromCodePoint(h)))))}function Wm(h){return!(yf(h)||function(a){return!!(zi["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||zi["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||zi["Letterlike Symbols"](a)||zi["Number Forms"](a)||zi["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||zi["Control Pictures"](a)&&a!==9251||zi["Optical Character Recognition"](a)||zi["Enclosed Alphanumerics"](a)||zi["Geometric Shapes"](a)||zi["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||zi["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||zi["CJK Symbols and Punctuation"](a)||zi.Katakana(a)||zi["Private Use Area"](a)||zi["CJK Compatibility Forms"](a)||zi["Small Form Variants"](a)||zi["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(h))}const Y0=gf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xf(h){return Y0.test(String.fromCodePoint(h))}function K0(h,a){return!(!a&&xf(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||zi.Khmer(h))}function J0(h){for(const a of h)if(xf(a.charCodeAt(0)))return!0;return!1}const er=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class un{constructor(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mf,this.transition={})}isSupportedScript(a){return function(u,f){for(const y of u)if(!K0(y.charCodeAt(0),f))return!1;return!0}(a,er.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),f=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class ml{constructor(a,u){this.property=a,this.value=u,this.expression=function(f,y){if(Ih(f))return new cl(f,y);if(Lh(f)){const S=Qd(f,y);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=f;return y.type==="color"&&typeof f=="string"?S=ce.parse(f):y.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(S=wi.parse(f)):S=li.parse(f),{kind:"constant",evaluate:()=>S}}}(u===void 0?a.specification.default:u,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,u,f){return this.property.possiblyEvaluate(this,a,u,f)}}class Hh{constructor(a){this.property=a,this.value=new ml(a,void 0)}transitioned(a,u){return new qm(this.property,this.value,u,K({},a.transition,this.transition),a.now)}untransitioned(){return new qm(this.property,this.value,null,{},0)}}class jh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return ct(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Hh(this._values[a].property)),this._values[a].value=new ml(this._values[a].property,u===null?void 0:ct(u))}getTransition(a){return ct(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Hh(this._values[a].property)),this._values[a].transition=ct(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(a[u]=f);const y=this.getTransition(u);y!==void 0&&(a[`${u}-transition`]=y)}return a}transitioned(a,u){const f=new Mc(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].transitioned(a,u._values[y]);return f}untransitioned(){const a=new Mc(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class qm{constructor(a,u,f,y,S){this.property=a,this.value=u,this.begin=S+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=f)}possiblyEvaluate(a,u,f){const y=a.now||0,S=this.value.possiblyEvaluate(a,u,f),T=this.prior;if(T){if(y>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(y<this.begin)return T.possiblyEvaluate(a,u,f);{const A=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,u,f),S,function(R){if(R<=0)return 0;if(R>=1)return 1;const z=R*R,O=z*R;return 4*(R<.5?O:3*(R-z)+O-.75)}(A))}}return S}}class Mc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,f){const y=new Tc(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,u,f);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Sc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ct(this._values[a].value)}setValue(a,u){this._values[a]=new ml(this._values[a].property,u===null?void 0:ct(u))}serialize(){const a={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(a[u]=f)}return a}possiblyEvaluate(a,u,f){const y=new Tc(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,u,f);return y}}class ha{constructor(a,u,f){this.property=a,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,f,y){return this.property.evaluate(this.value,this.parameters,a,u,f,y)}}class Tc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Ue{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,f){const y=zs[this.specification.type];return y?y(a,u,f):a}}class ai{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,f,y){return new ha(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},f,y)}:a.expression,u)}interpolate(a,u,f){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new ha(this,{kind:"constant",value:void 0},a.parameters);const y=zs[this.specification.type];if(y){const S=y(a.value.value,u.value.value,f);return new ha(this,{kind:"constant",value:S},a.parameters)}return a}evaluate(a,u,f,y,S,T){return a.kind==="constant"?a.value:a.evaluate(u,f,y,S,T)}}class Wh extends ai{possiblyEvaluate(a,u,f,y){if(a.value===void 0)return new ha(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const S=a.expression.evaluate(u,null,{},f,y),T=a.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,A=this._calculate(T,T,T,u);return new ha(this,{kind:"constant",value:A},u)}if(a.expression.kind==="camera"){const S=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new ha(this,{kind:"constant",value:S},u)}return new ha(this,a.expression,u)}evaluate(a,u,f,y,S,T){if(a.kind==="source"){const A=a.evaluate(u,f,y,S,T);return this._calculate(A,A,A,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},f,y),a.evaluate({zoom:Math.floor(u.zoom)},f,y),a.evaluate({zoom:Math.floor(u.zoom)+1},f,y),u):a.value}_calculate(a,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:f,to:u}}interpolate(a){return a}}class qh{constructor(a){this.specification=a}possiblyEvaluate(a,u,f,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const S=a.expression.evaluate(u,null,{},f,y);return this._calculate(S,S,S,u)}return this._calculate(a.expression.evaluate(new un(Math.floor(u.zoom-1),u)),a.expression.evaluate(new un(Math.floor(u.zoom),u)),a.expression.evaluate(new un(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:f,to:u}}interpolate(a){return a}}class vf{constructor(a){this.specification=a}possiblyEvaluate(a,u,f,y){return!!a.expression.evaluate(u,null,{},f,y)}interpolate(){return!1}}class M{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const f=a[u];f.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new ml(f,void 0),S=this.defaultTransitionablePropertyValues[u]=new Hh(f);this.defaultTransitioningPropertyValues[u]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}De("DataDrivenProperty",ai),De("DataConstantProperty",Ue),De("CrossFadedDataDrivenProperty",Wh),De("CrossFadedProperty",qh),De("ColorRampProperty",vf);const r="-transition";class d extends jn{constructor(a,u){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),u.layout&&(this._unevaluatedLayout=new Sc(u.layout)),u.paint)){this._transitionablePaint=new jh(u.paint);for(const f in a.paint)this.setPaintProperty(f,a.paint[f],{validate:!1});for(const f in a.layout)this.setLayoutProperty(f,a.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tc(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,u,f={}){u!=null&&this._validate(Gm,`layers.${this.id}.layout.${a}`,a,u,f)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,u):this.visibility=u)}getPaintProperty(a){return a.endsWith(r)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,f={}){if(u!=null&&this._validate(Vm,`layers.${this.id}.paint.${a}`,a,u,f))return!1;if(a.endsWith(r))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],S=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),A=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(a,A,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,f){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),J(a,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(a,u,f,y,S={}){return(!S||S.validate!==!1)&&ff(this,a.call(wo,{key:u,layerType:this.type,objectKey:f,value:y,styleSpec:Ft,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof ha&&sl(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class g{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function C(h,a=1){let u=0,f=0;return{members:h.map(y=>{const S=_[y.type].BYTES_PER_ELEMENT,T=u=L(u,Math.max(a,S)),A=y.components||1;return f=Math.max(f,S),u+=S*A,{name:y.name,type:y.type,components:A,offset:T}}),size:L(u,Math.max(f,a)),alignment:a}}function L(h,a){return Math.ceil(h/a)*a}class F extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=f,a}}F.prototype.bytesPerElement=4,De("StructArrayLayout2i4",F);class N extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const S=3*a;return this.int16[S+0]=u,this.int16[S+1]=f,this.int16[S+2]=y,a}}N.prototype.bytesPerElement=6,De("StructArrayLayout3i6",N);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,u,f,y)}emplace(a,u,f,y,S){const T=4*a;return this.int16[T+0]=u,this.int16[T+1]=f,this.int16[T+2]=y,this.int16[T+3]=S,a}}H.prototype.bytesPerElement=8,De("StructArrayLayout4i8",H);class j extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,f,y,S,T)}emplace(a,u,f,y,S,T,A){const R=6*a;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=y,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=A,a}}j.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",j);class tt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,f,y,S,T)}emplace(a,u,f,y,S,T,A){const R=4*a,z=8*a;return this.int16[R+0]=u,this.int16[R+1]=f,this.uint8[z+4]=y,this.uint8[z+5]=S,this.uint8[z+6]=T,this.uint8[z+7]=A,a}}tt.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",tt);class ot extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=f,a}}ot.prototype.bytesPerElement=8,De("StructArrayLayout2f8",ot);class ht extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T,A,R,z,O){const G=this.length;return this.resize(G+1),this.emplace(G,a,u,f,y,S,T,A,R,z,O)}emplace(a,u,f,y,S,T,A,R,z,O,G){const $=10*a;return this.uint16[$+0]=u,this.uint16[$+1]=f,this.uint16[$+2]=y,this.uint16[$+3]=S,this.uint16[$+4]=T,this.uint16[$+5]=A,this.uint16[$+6]=R,this.uint16[$+7]=z,this.uint16[$+8]=O,this.uint16[$+9]=G,a}}ht.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",ht);class pt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T,A,R,z,O,G,$){const Q=this.length;return this.resize(Q+1),this.emplace(Q,a,u,f,y,S,T,A,R,z,O,G,$)}emplace(a,u,f,y,S,T,A,R,z,O,G,$,Q){const et=12*a;return this.int16[et+0]=u,this.int16[et+1]=f,this.int16[et+2]=y,this.int16[et+3]=S,this.uint16[et+4]=T,this.uint16[et+5]=A,this.uint16[et+6]=R,this.uint16[et+7]=z,this.int16[et+8]=O,this.int16[et+9]=G,this.int16[et+10]=$,this.int16[et+11]=Q,a}}pt.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",pt);class yt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const S=3*a;return this.float32[S+0]=u,this.float32[S+1]=f,this.float32[S+2]=y,a}}yt.prototype.bytesPerElement=12,De("StructArrayLayout3f12",yt);class vt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}vt.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",vt);class Mt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T,A,R,z){const O=this.length;return this.resize(O+1),this.emplace(O,a,u,f,y,S,T,A,R,z)}emplace(a,u,f,y,S,T,A,R,z,O){const G=10*a,$=5*a;return this.int16[G+0]=u,this.int16[G+1]=f,this.int16[G+2]=y,this.int16[G+3]=S,this.int16[G+4]=T,this.int16[G+5]=A,this.uint32[$+3]=R,this.uint16[G+8]=z,this.uint16[G+9]=O,a}}Mt.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",Mt);class dt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,f,y,S,T)}emplace(a,u,f,y,S,T,A){const R=6*a;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=y,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=A,a}}dt.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",dt);class Ct extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,f,y,S)}emplace(a,u,f,y,S,T){const A=4*a,R=8*a;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=y,this.int16[R+6]=S,this.int16[R+7]=T,a}}Ct.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",Ct);class Lt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,f,y,S,T)}emplace(a,u,f,y,S,T,A){const R=16*a,z=4*a,O=8*a;return this.uint8[R+0]=u,this.uint8[R+1]=f,this.float32[z+1]=y,this.float32[z+2]=S,this.int16[O+6]=T,this.int16[O+7]=A,a}}Lt.prototype.bytesPerElement=16,De("StructArrayLayout2ub2f2i16",Lt);class Bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const S=3*a;return this.uint16[S+0]=u,this.uint16[S+1]=f,this.uint16[S+2]=y,a}}Bt.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",Bt);class ee extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt)}emplace(a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt,Ot){const Tt=24*a,kt=12*a,$t=48*a;return this.int16[Tt+0]=u,this.int16[Tt+1]=f,this.uint16[Tt+2]=y,this.uint16[Tt+3]=S,this.uint32[kt+2]=T,this.uint32[kt+3]=A,this.uint32[kt+4]=R,this.uint16[Tt+10]=z,this.uint16[Tt+11]=O,this.uint16[Tt+12]=G,this.float32[kt+7]=$,this.float32[kt+8]=Q,this.uint8[$t+36]=et,this.uint8[$t+37]=at,this.uint8[$t+38]=ft,this.uint32[kt+10]=gt,this.int16[Tt+22]=Ot,a}}ee.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ee);class he extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt,Ot,Tt,kt,$t,oe,Ae,ii,Se,ve,je,Fe){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt,Ot,Tt,kt,$t,oe,Ae,ii,Se,ve,je,Fe)}emplace(a,u,f,y,S,T,A,R,z,O,G,$,Q,et,at,ft,gt,Ot,Tt,kt,$t,oe,Ae,ii,Se,ve,je,Fe,Pe){const Qt=32*a,We=16*a;return this.int16[Qt+0]=u,this.int16[Qt+1]=f,this.int16[Qt+2]=y,this.int16[Qt+3]=S,this.int16[Qt+4]=T,this.int16[Qt+5]=A,this.int16[Qt+6]=R,this.int16[Qt+7]=z,this.uint16[Qt+8]=O,this.uint16[Qt+9]=G,this.uint16[Qt+10]=$,this.uint16[Qt+11]=Q,this.uint16[Qt+12]=et,this.uint16[Qt+13]=at,this.uint16[Qt+14]=ft,this.uint16[Qt+15]=gt,this.uint16[Qt+16]=Ot,this.uint16[Qt+17]=Tt,this.uint16[Qt+18]=kt,this.uint16[Qt+19]=$t,this.uint16[Qt+20]=oe,this.uint16[Qt+21]=Ae,this.uint16[Qt+22]=ii,this.uint32[We+12]=Se,this.float32[We+13]=ve,this.float32[We+14]=je,this.uint16[Qt+30]=Fe,this.uint16[Qt+31]=Pe,a}}he.prototype.bytesPerElement=64,De("StructArrayLayout8i15ui1ul2f2ui64",he);class we extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}we.prototype.bytesPerElement=4,De("StructArrayLayout1f4",we);class Ce extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const S=3*a;return this.uint16[6*a+0]=u,this.float32[S+1]=f,this.float32[S+2]=y,a}}Ce.prototype.bytesPerElement=12,De("StructArrayLayout1ui2f12",Ce);class ye extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const S=4*a;return this.uint32[2*a+0]=u,this.uint16[S+2]=f,this.uint16[S+3]=y,a}}ye.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",ye);class _e extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=f,a}}_e.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",_e);class Ve extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}Ve.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",Ve);class mi extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,u,f,y)}emplace(a,u,f,y,S){const T=4*a;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=y,this.float32[T+3]=S,a}}mi.prototype.bytesPerElement=16,De("StructArrayLayout4f16",mi);class xe extends g{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}xe.prototype.size=20;class Te extends Mt{get(a){return new xe(this,a)}}De("CollisionBoxArray",Te);class di extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}di.prototype.size=48;class dn extends ee{get(a){return new di(this,a)}}De("PlacedSymbolArray",dn);class Ti extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ti.prototype.size=64;class Di extends he{get(a){return new Ti(this,a)}}De("SymbolInstanceArray",Di);class fn extends we{getoffsetX(a){return this.float32[1*a+0]}}De("GlyphOffsetArray",fn);class ds extends N{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}De("SymbolLineVertexArray",ds);class Hr extends g{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hr.prototype.size=12;class pn extends Ce{get(a){return new Hr(this,a)}}De("TextAnchorOffsetArray",pn);class Bs extends g{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Bs.prototype.size=8;class Es extends ye{get(a){return new Bs(this,a)}}De("FeatureIndexArray",Es);class fs extends F{}class As extends F{}class ua extends F{}class _l extends j{}class Xh extends tt{}class gl extends ot{}class Sr extends ht{}class $h extends pt{}class bf extends yt{}class Tr extends vt{}class Er extends dt{}class ja extends Lt{}class jr extends Bt{}class ss extends _e{}const ps=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:ir}=ps;class Oi{constructor(a=[]){this.segments=a}prepareSegment(a,u,f,y){let S=this.segments[this.segments.length-1];return a>Oi.MAX_VERTEX_ARRAY_LENGTH&&wt(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!S||S.vertexLength+a>Oi.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==y)&&(S={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},y!==void 0&&(S.sortKey=y),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,f,y){return new Oi([{vertexOffset:a,primitiveOffset:u,vertexLength:f,primitiveLength:y,vaos:{},sortKey:0}])}}function Mo(h,a){return 256*(h=Z(Math.floor(h),0,255))+Z(Math.floor(a),0,255)}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",Oi);const yl=C([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xl={exports:{}},Xm={exports:{}};Xm.exports=function(h,a){var u,f,y,S,T,A,R,z;for(f=h.length-(u=3&h.length),y=a,T=3432918353,A=461845907,z=0;z<f;)R=255&h.charCodeAt(z)|(255&h.charCodeAt(++z))<<8|(255&h.charCodeAt(++z))<<16|(255&h.charCodeAt(++z))<<24,++z,y=27492+(65535&(S=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&h.charCodeAt(z+2))<<16;case 2:R^=(255&h.charCodeAt(z+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&h.charCodeAt(z)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295}return y^=h.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var Q0=Xm.exports,$m={exports:{}};$m.exports=function(h,a){for(var u,f=h.length,y=a^f,S=0;f>=4;)u=1540483477*(65535&(u=255&h.charCodeAt(S)|(255&h.charCodeAt(++S))<<8|(255&h.charCodeAt(++S))<<16|(255&h.charCodeAt(++S))<<24))+((1540483477*(u>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++S;switch(f){case 3:y^=(255&h.charCodeAt(S+2))<<16;case 2:y^=(255&h.charCodeAt(S+1))<<8;case 1:y=1540483477*(65535&(y^=255&h.charCodeAt(S)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Wa=Q0,Zm=$m.exports;xl.exports=Wa,xl.exports.murmur3=Wa,xl.exports.murmur2=Zm;var Zh=p(xl.exports);class Ec{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,f,y){this.ids.push(Yh(a)),this.positions.push(u,f,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Yh(a);let f=0,y=this.ids.length-1;for(;f<y;){const T=f+y>>1;this.ids[T]>=u?y=T:f=T+1}const S=[];for(;this.ids[f]===u;)S.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return S}static serialize(a,u){const f=new Float64Array(a.ids),y=new Uint32Array(a.positions);return Kh(f,y,0,f.length-1),u&&u.push(f.buffer,y.buffer),{ids:f,positions:y}}static deserialize(a){const u=new Ec;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function Yh(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Zh(String(h))}function Kh(h,a,u,f){for(;u<f;){const y=h[u+f>>1];let S=u-1,T=f+1;for(;;){do S++;while(h[S]<y);do T--;while(h[T]>y);if(S>=T)break;vl(h,S,T),vl(a,3*S,3*T),vl(a,3*S+1,3*T+1),vl(a,3*S+2,3*T+2)}T-u<f-T?(Kh(h,a,u,T),u=T+1):(Kh(h,a,T+1,f),f=T)}}function vl(h,a,u){const f=h[a];h[a]=h[u],h[u]=f}De("FeaturePositionMap",Ec);class Ac{constructor(a,u){this.gl=a.gl,this.location=u}}class Ym extends Ac{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class q1 extends Ac{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class X1 extends Ac{constructor(a,u){super(a,u),this.current=ce.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const nC=new Float32Array(16);function ty(h){return[Mo(255*h.r,255*h.g),Mo(255*h.b,255*h.a)]}class wf{constructor(a,u,f){this.value=a,this.uniformNames=u.map(y=>`u_${y}`),this.type=f}setUniform(a,u,f){a.set(f.constantOr(this.value))}getBinding(a,u,f){return this.type==="color"?new X1(a,u):new Ym(a,u)}}class Jh{constructor(a,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setUniform(a,u,f,y){const S=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&a.set(S)}getBinding(a,u,f){return f.substr(0,9)==="u_pattern"?new q1(a,u):new Ym(a,u)}}class So{constructor(a,u,f,y){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(S=>({name:`a_${S}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(a,u,f,y,S){const T=this.paintVertexArray.length,A=this.expression.evaluate(new un(0),u,{},y,[],S);this.paintVertexArray.resize(a),this._setPaintValue(T,a,A)}updatePaintArray(a,u,f,y){const S=this.expression.evaluate({zoom:0},f,y);this._setPaintValue(a,u,S)}_setPaintValue(a,u,f){if(this.type==="color"){const y=ty(f);for(let S=a;S<u;S++)this.paintVertexArray.emplace(S,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ia{constructor(a,u,f,y,S,T){this.expression=a,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=y,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(a,u,f,y,S){const T=this.expression.evaluate(new un(this.zoom),u,{},y,[],S),A=this.expression.evaluate(new un(this.zoom+1),u,{},y,[],S),R=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(R,a,T,A)}updatePaintArray(a,u,f,y){const S=this.expression.evaluate({zoom:this.zoom},f,y),T=this.expression.evaluate({zoom:this.zoom+1},f,y);this._setPaintValue(a,u,S,T)}_setPaintValue(a,u,f,y){if(this.type==="color"){const S=ty(f),T=ty(y);for(let A=a;A<u;A++)this.paintVertexArray.emplace(A,S[0],S[1],T[0],T[1])}else{for(let S=a;S<u;S++)this.paintVertexArray.emplace(S,f,y);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=Z(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,f){return new Ym(a,u)}}class bl{constructor(a,u,f,y,S,T){this.expression=a,this.type=u,this.useIntegerZoom=f,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(a,u,f){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(a,u,f,y,S){this._setPaintValues(a,u,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(a,u,f,y){if(!y||!f)return;const{min:S,mid:T,max:A}=f,R=y[S],z=y[T],O=y[A];if(R&&z&&O)for(let G=a;G<u;G++)this.zoomInPaintVertexArray.emplace(G,z.tl[0],z.tl[1],z.br[0],z.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],z.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,z.tl[0],z.tl[1],z.br[0],z.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],z.pixelRatio,O.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,yl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,yl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $1{constructor(a,u,f){this.binders={},this._buffers=[];const y=[];for(const S in a.paint._values){if(!f(S))continue;const T=a.paint.get(S);if(!(T instanceof ha&&sl(T.property.specification)))continue;const A=sC(S,a.type),R=T.value,z=T.property.specification.type,O=T.property.useIntegerZoom,G=T.property.specification["property-type"],$=G==="cross-faded"||G==="cross-faded-data-driven";if(R.kind==="constant")this.binders[S]=$?new Jh(R.value,A):new wf(R.value,A,z),y.push(`/u_${S}`);else if(R.kind==="source"||$){const Q=Z1(S,z,"source");this.binders[S]=$?new bl(R,z,O,u,Q,a.id):new So(R,A,z,Q),y.push(`/a_${S}`)}else{const Q=Z1(S,z,"composite");this.binders[S]=new Ia(R,A,z,O,u,Q),y.push(`/z_${S}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof So||u instanceof Ia?u.maxValue:0}populatePaintArrays(a,u,f,y,S){for(const T in this.binders){const A=this.binders[T];(A instanceof So||A instanceof Ia||A instanceof bl)&&A.populatePaintArray(a,u,f,y,S)}}setConstantPatternPositions(a,u){for(const f in this.binders){const y=this.binders[f];y instanceof Jh&&y.setConstantPatternPositions(a,u)}}updatePaintArrays(a,u,f,y,S){let T=!1;for(const A in a){const R=u.getPositions(A);for(const z of R){const O=f.feature(z.index);for(const G in this.binders){const $=this.binders[G];if(($ instanceof So||$ instanceof Ia||$ instanceof bl)&&$.expression.isStateDependent===!0){const Q=y.paint.get(G);$.expression=Q.value,$.updatePaintArray(z.start,z.end,O,a[A],S),T=!0}}}}return T}defines(){const a=[];for(const u in this.binders){const f=this.binders[u];(f instanceof wf||f instanceof Jh)&&a.push(...f.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof So||f instanceof Ia)for(let y=0;y<f.paintVertexAttributes.length;y++)a.push(f.paintVertexAttributes[y].name);else if(f instanceof bl)for(let y=0;y<yl.members.length;y++)a.push(yl.members[y].name)}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof wf||f instanceof Jh||f instanceof Ia)for(const y of f.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const f=[];for(const y in this.binders){const S=this.binders[y];if(S instanceof wf||S instanceof Jh||S instanceof Ia){for(const T of S.uniformNames)if(u[T]){const A=S.getBinding(a,u[T],T);f.push({name:T,property:y,binding:A})}}}return f}setUniforms(a,u,f,y){for(const{name:S,property:T,binding:A}of u)this.binders[T].setUniform(A,y,f.get(T),S)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(a&&f instanceof bl){const y=a.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(f instanceof So||f instanceof Ia)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(a){for(const u in this.binders){const f=this.binders[u];(f instanceof So||f instanceof Ia||f instanceof bl)&&f.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof So||u instanceof Ia||u instanceof bl)&&u.destroy()}}}class Cc{constructor(a,u,f=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new $1(y,u,f);this.needsUpload=!1,this._featureMap=new Ec,this._bufferOffset=0}populatePaintArrays(a,u,f,y,S,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,u,y,S,T);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,f,y){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,u,S,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function sC(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function Z1(h,a,u){const f={color:{source:ot,composite:mi},number:{source:we,composite:ot}},y=function(S){return{"line-pattern":{source:Sr,composite:Sr},"fill-pattern":{source:Sr,composite:Sr},"fill-extrusion-pattern":{source:Sr,composite:Sr}}[S]}(h);return y&&y[u]||f[a][u]}De("ConstantBinder",wf),De("CrossFadedConstantBinder",Jh),De("SourceExpressionBinder",So),De("CrossFadedCompositeBinder",bl),De("CompositeExpressionBinder",Ia),De("ProgramConfiguration",$1,{omit:["_buffers"]}),De("ProgramConfigurationSet",Cc);const Vn=8192,ey=Math.pow(2,14)-1,Y1=-ey-1;function Pc(h){const a=Vn/h.extent,u=h.loadGeometry();for(let f=0;f<u.length;f++){const y=u[f];for(let S=0;S<y.length;S++){const T=y[S],A=Math.round(T.x*a),R=Math.round(T.y*a);T.x=Z(A,Y1,ey),T.y=Z(R,Y1,ey),(A<T.x||A>T.x+1||R<T.y||R>T.y+1)&&wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Ic(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?Pc(h):[]}}function Km(h,a,u,f,y){h.emplaceBack(2*a+(f+1)/2,2*u+(y+1)/2)}class iy{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new As,this.indexArray=new jr,this.segments=new Oi,this.programConfigurations=new Cc(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){const y=this.layers[0],S=[];let T=null,A=!1;y.type==="circle"&&(T=y.layout.get("circle-sort-key"),A=!T.isConstant());for(const{feature:R,id:z,index:O,sourceLayerIndex:G}of a){const $=this.layers[0]._featureFilter.needGeometry,Q=Ic(R,$);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),Q,f))continue;const et=A?T.evaluate(Q,{},f):void 0,at={id:z,properties:R.properties,type:R.type,sourceLayerIndex:G,index:O,geometry:$?Q.geometry:Pc(R),patterns:{},sortKey:et};S.push(at)}A&&S.sort((R,z)=>R.sortKey-z.sortKey);for(const R of S){const{geometry:z,index:O,sourceLayerIndex:G}=R,$=a[O].feature;this.addFeature(R,z,O,f),u.featureIndex.insert($,z,O,G,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ir),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,f,y){for(const S of u)for(const T of S){const A=T.x,R=T.y;if(A<0||A>=Vn||R<0||R>=Vn)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),O=z.vertexLength;Km(this.layoutVertexArray,A,R,-1,-1),Km(this.layoutVertexArray,A,R,1,-1),Km(this.layoutVertexArray,A,R,1,1),Km(this.layoutVertexArray,A,R,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},y)}}function K1(h,a){for(let u=0;u<h.length;u++)if(Qh(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(Qh(h,a[u]))return!0;return!!ny(h,a)}function rC(h,a,u){return!!Qh(h,a)||!!sy(a,h,u)}function J1(h,a){if(h.length===1)return tw(a,h[0]);for(let u=0;u<a.length;u++){const f=a[u];for(let y=0;y<f.length;y++)if(Qh(h,f[y]))return!0}for(let u=0;u<h.length;u++)if(tw(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(ny(h,a[u]))return!0;return!1}function aC(h,a,u){if(h.length>1){if(ny(h,a))return!0;for(let f=0;f<a.length;f++)if(sy(a[f],h,u))return!0}for(let f=0;f<h.length;f++)if(sy(h[f],a,u))return!0;return!1}function ny(h,a){if(h.length===0||a.length===0)return!1;for(let u=0;u<h.length-1;u++){const f=h[u],y=h[u+1];for(let S=0;S<a.length-1;S++)if(oC(f,y,a[S],a[S+1]))return!0}return!1}function oC(h,a,u,f){return Pt(h,u,f)!==Pt(a,u,f)&&Pt(h,a,u)!==Pt(h,a,f)}function sy(h,a,u){const f=u*u;if(a.length===1)return h.distSqr(a[0])<f;for(let y=1;y<a.length;y++)if(Q1(h,a[y-1],a[y])<f)return!0;return!1}function Q1(h,a,u){const f=a.distSqr(u);if(f===0)return h.distSqr(a);const y=((h.x-a.x)*(u.x-a.x)+(h.y-a.y)*(u.y-a.y))/f;return h.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function tw(h,a){let u,f,y,S=!1;for(let T=0;T<h.length;T++){u=h[T];for(let A=0,R=u.length-1;A<u.length;R=A++)f=u[A],y=u[R],f.y>a.y!=y.y>a.y&&a.x<(y.x-f.x)*(a.y-f.y)/(y.y-f.y)+f.x&&(S=!S)}return S}function Qh(h,a){let u=!1;for(let f=0,y=h.length-1;f<h.length;y=f++){const S=h[f],T=h[y];S.y>a.y!=T.y>a.y&&a.x<(T.x-S.x)*(a.y-S.y)/(T.y-S.y)+S.x&&(u=!u)}return u}function lC(h,a,u){const f=u[0],y=u[2];if(h.x<f.x&&a.x<f.x||h.x>y.x&&a.x>y.x||h.y<f.y&&a.y<f.y||h.y>y.y&&a.y>y.y)return!1;const S=Pt(h,a,u[0]);return S!==Pt(h,a,u[1])||S!==Pt(h,a,u[2])||S!==Pt(h,a,u[3])}function Mf(h,a,u){const f=a.paint.get(h).value;return f.kind==="constant"?f.value:u.programConfigurations.get(a.id).getMaxValue(h)}function Jm(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Qm(h,a,u,f,y){if(!a[0]&&!a[1])return h;const S=v.convert(a)._mult(y);u==="viewport"&&S._rotate(-f);const T=[];for(let A=0;A<h.length;A++)T.push(h[A].sub(S));return T}let ew,iw;De("CircleBucket",iy,{omit:["layers"]});var cC={get paint(){return iw=iw||new M({"circle-radius":new ai(Ft.paint_circle["circle-radius"]),"circle-color":new ai(Ft.paint_circle["circle-color"]),"circle-blur":new ai(Ft.paint_circle["circle-blur"]),"circle-opacity":new ai(Ft.paint_circle["circle-opacity"]),"circle-translate":new Ue(Ft.paint_circle["circle-translate"]),"circle-translate-anchor":new Ue(Ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ue(Ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ue(Ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ai(Ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ai(Ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ai(Ft.paint_circle["circle-stroke-opacity"])})},get layout(){return ew=ew||new M({"circle-sort-key":new ai(Ft.layout_circle["circle-sort-key"])})}},Ns=1e-6,tu=typeof Float32Array<"u"?Float32Array:Array;function ry(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function nw(h,a,u){var f=a[0],y=a[1],S=a[2],T=a[3],A=a[4],R=a[5],z=a[6],O=a[7],G=a[8],$=a[9],Q=a[10],et=a[11],at=a[12],ft=a[13],gt=a[14],Ot=a[15],Tt=u[0],kt=u[1],$t=u[2],oe=u[3];return h[0]=Tt*f+kt*A+$t*G+oe*at,h[1]=Tt*y+kt*R+$t*$+oe*ft,h[2]=Tt*S+kt*z+$t*Q+oe*gt,h[3]=Tt*T+kt*O+$t*et+oe*Ot,h[4]=(Tt=u[4])*f+(kt=u[5])*A+($t=u[6])*G+(oe=u[7])*at,h[5]=Tt*y+kt*R+$t*$+oe*ft,h[6]=Tt*S+kt*z+$t*Q+oe*gt,h[7]=Tt*T+kt*O+$t*et+oe*Ot,h[8]=(Tt=u[8])*f+(kt=u[9])*A+($t=u[10])*G+(oe=u[11])*at,h[9]=Tt*y+kt*R+$t*$+oe*ft,h[10]=Tt*S+kt*z+$t*Q+oe*gt,h[11]=Tt*T+kt*O+$t*et+oe*Ot,h[12]=(Tt=u[12])*f+(kt=u[13])*A+($t=u[14])*G+(oe=u[15])*at,h[13]=Tt*y+kt*R+$t*$+oe*ft,h[14]=Tt*S+kt*z+$t*Q+oe*gt,h[15]=Tt*T+kt*O+$t*et+oe*Ot,h}Math.hypot||(Math.hypot=function(){for(var h=0,a=arguments.length;a--;)h+=arguments[a]*arguments[a];return Math.sqrt(h)});var Sf,hC=nw;function t_(h,a,u){var f=a[0],y=a[1],S=a[2],T=a[3];return h[0]=u[0]*f+u[4]*y+u[8]*S+u[12]*T,h[1]=u[1]*f+u[5]*y+u[9]*S+u[13]*T,h[2]=u[2]*f+u[6]*y+u[10]*S+u[14]*T,h[3]=u[3]*f+u[7]*y+u[11]*S+u[15]*T,h}Sf=new tu(4),tu!=Float32Array&&(Sf[0]=0,Sf[1]=0,Sf[2]=0,Sf[3]=0);class uC extends d{constructor(a){super(a,cC)}createBucket(a){return new iy(a)}queryRadius(a){const u=a;return Mf("circle-radius",this,u)+Mf("circle-stroke-width",this,u)+Jm(this.paint.get("circle-translate"))}queryIntersectsFeature(a,u,f,y,S,T,A,R){const z=Qm(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,A),O=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),G=this.paint.get("circle-pitch-alignment")==="map",$=G?z:function(et,at){return et.map(ft=>sw(ft,at))}(z,R),Q=G?O*A:O;for(const et of y)for(const at of et){const ft=G?at:sw(at,R);let gt=Q;const Ot=t_([],[at.x,at.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?gt*=Ot[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(gt*=T.cameraToCenterDistance/Ot[3]),rC($,ft,gt))return!0}return!1}}function sw(h,a){const u=t_([],[h.x,h.y,0,1],a);return new v(u[0]/u[3],u[1]/u[3])}class rw extends iy{}let aw;De("HeatmapBucket",rw,{omit:["layers"]});var dC={get paint(){return aw=aw||new M({"heatmap-radius":new ai(Ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ai(Ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ue(Ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vf(Ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ue(Ft.paint_heatmap["heatmap-opacity"])})}};function ay(h,{width:a,height:u},f,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*f)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*f}`)}else y=new Uint8Array(a*u*f);return h.width=a,h.height=u,h.data=y,h}function ow(h,{width:a,height:u},f){if(a===h.width&&u===h.height)return;const y=ay({},{width:a,height:u},f);oy(h,y,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,a),height:Math.min(h.height,u)},f),h.width=a,h.height=u,h.data=y.data}function oy(h,a,u,f,y,S){if(y.width===0||y.height===0)return a;if(y.width>h.width||y.height>h.height||u.x>h.width-y.width||u.y>h.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||f.x>a.width-y.width||f.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=h.data,A=a.data;if(T===A)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<y.height;R++){const z=((u.y+R)*h.width+u.x)*S,O=((f.y+R)*a.width+f.x)*S;for(let G=0;G<y.width*S;G++)A[O+G]=T[z+G]}return a}class Tf{constructor(a,u){ay(this,a,1,u)}resize(a){ow(this,a,1)}clone(){return new Tf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,f,y,S){oy(a,u,f,y,S,1)}}class Wr{constructor(a,u){ay(this,a,4,u)}resize(a){ow(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Wr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,f,y,S){oy(a,u,f,y,S,4)}}function lw(h){const a={},u=h.resolution||256,f=h.clips?h.clips.length:1,y=h.image||new Wr({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const S=(T,A,R)=>{a[h.evaluationKey]=R;const z=h.expression.evaluate(a);y.data[T+A+0]=Math.floor(255*z.r/z.a),y.data[T+A+1]=Math.floor(255*z.g/z.a),y.data[T+A+2]=Math.floor(255*z.b/z.a),y.data[T+A+3]=Math.floor(255*z.a)};if(h.clips)for(let T=0,A=0;T<f;++T,A+=4*u)for(let R=0,z=0;R<u;R++,z+=4){const O=R/(u-1),{start:G,end:$}=h.clips[T];S(A,z,G*(1-O)+$*O)}else for(let T=0,A=0;T<u;T++,A+=4)S(0,A,T/(u-1));return y}De("AlphaImage",Tf),De("RGBAImage",Wr);const ly="big-fb";class fC extends d{createBucket(a){return new rw(a)}constructor(a){super(a,dC),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ly)&&this.heatmapFbos.delete(ly)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let cw;var pC={get paint(){return cw=cw||new M({"hillshade-illumination-direction":new Ue(Ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ue(Ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ue(Ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ue(Ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ue(Ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ue(Ft.paint_hillshade["hillshade-accent-color"])})}};class mC extends d{constructor(a){super(a,pC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const _C=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:gC}=_C;function hw(h,a,u=2){const f=a&&a.length,y=f?a[0]*u:h.length;let S=uw(h,0,y,u,!0);const T=[];if(!S||S.next===S.prev)return T;let A,R,z;if(f&&(S=function(O,G,$,Q){const et=[];for(let at=0,ft=G.length;at<ft;at++){const gt=uw(O,G[at]*Q,at<ft-1?G[at+1]*Q:O.length,Q,!1);gt===gt.next&&(gt.steiner=!0),et.push(TC(gt))}et.sort(wC);for(let at=0;at<et.length;at++)$=MC(et[at],$);return $}(h,a,S,u)),h.length>80*u){A=1/0,R=1/0;let O=-1/0,G=-1/0;for(let $=u;$<y;$+=u){const Q=h[$],et=h[$+1];Q<A&&(A=Q),et<R&&(R=et),Q>O&&(O=Q),et>G&&(G=et)}z=Math.max(O-A,G-R),z=z!==0?32767/z:0}return Ef(S,T,u,A,R,z,0),T}function uw(h,a,u,f,y){let S;if(y===function(T,A,R,z){let O=0;for(let G=A,$=R-z;G<R;G+=z)O+=(T[$]-T[G])*(T[G+1]+T[$+1]),$=G;return O}(h,a,u,f)>0)for(let T=a;T<u;T+=f)S=pw(T/f|0,h[T],h[T+1],S);else for(let T=u-f;T>=a;T-=f)S=pw(T/f|0,h[T],h[T+1],S);return S&&e_(S,S.next)&&(Cf(S),S=S.next),S}function Rc(h,a){if(!h)return h;a||(a=h);let u,f=h;do if(u=!1,f.steiner||!e_(f,f.next)&&kn(f.prev,f,f.next)!==0)f=f.next;else{if(Cf(f),f=a=f.prev,f===f.next)break;u=!0}while(u||f!==a);return a}function Ef(h,a,u,f,y,S,T){if(!h)return;!T&&S&&function(R,z,O,G){let $=R;do $.z===0&&($.z=cy($.x,$.y,z,O,G)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(Q){let et,at=1;do{let ft,gt=Q;Q=null;let Ot=null;for(et=0;gt;){et++;let Tt=gt,kt=0;for(let oe=0;oe<at&&(kt++,Tt=Tt.nextZ,Tt);oe++);let $t=at;for(;kt>0||$t>0&&Tt;)kt!==0&&($t===0||!Tt||gt.z<=Tt.z)?(ft=gt,gt=gt.nextZ,kt--):(ft=Tt,Tt=Tt.nextZ,$t--),Ot?Ot.nextZ=ft:Q=ft,ft.prevZ=Ot,Ot=ft;gt=Tt}Ot.nextZ=null,at*=2}while(et>1)}($)}(h,f,y,S);let A=h;for(;h.prev!==h.next;){const R=h.prev,z=h.next;if(S?xC(h,f,y,S):yC(h))a.push(R.i,h.i,z.i),Cf(h),h=z.next,A=z.next;else if((h=z)===A){T?T===1?Ef(h=vC(Rc(h),a),a,u,f,y,S,2):T===2&&bC(h,a,u,f,y,S):Ef(Rc(h),a,u,f,y,S,1);break}}}function yC(h){const a=h.prev,u=h,f=h.next;if(kn(a,u,f)>=0)return!1;const y=a.x,S=u.x,T=f.x,A=a.y,R=u.y,z=f.y,O=y<S?y<T?y:T:S<T?S:T,G=A<R?A<z?A:z:R<z?R:z,$=y>S?y>T?y:T:S>T?S:T,Q=A>R?A>z?A:z:R>z?R:z;let et=f.next;for(;et!==a;){if(et.x>=O&&et.x<=$&&et.y>=G&&et.y<=Q&&eu(y,A,S,R,T,z,et.x,et.y)&&kn(et.prev,et,et.next)>=0)return!1;et=et.next}return!0}function xC(h,a,u,f){const y=h.prev,S=h,T=h.next;if(kn(y,S,T)>=0)return!1;const A=y.x,R=S.x,z=T.x,O=y.y,G=S.y,$=T.y,Q=A<R?A<z?A:z:R<z?R:z,et=O<G?O<$?O:$:G<$?G:$,at=A>R?A>z?A:z:R>z?R:z,ft=O>G?O>$?O:$:G>$?G:$,gt=cy(Q,et,a,u,f),Ot=cy(at,ft,a,u,f);let Tt=h.prevZ,kt=h.nextZ;for(;Tt&&Tt.z>=gt&&kt&&kt.z<=Ot;){if(Tt.x>=Q&&Tt.x<=at&&Tt.y>=et&&Tt.y<=ft&&Tt!==y&&Tt!==T&&eu(A,O,R,G,z,$,Tt.x,Tt.y)&&kn(Tt.prev,Tt,Tt.next)>=0||(Tt=Tt.prevZ,kt.x>=Q&&kt.x<=at&&kt.y>=et&&kt.y<=ft&&kt!==y&&kt!==T&&eu(A,O,R,G,z,$,kt.x,kt.y)&&kn(kt.prev,kt,kt.next)>=0))return!1;kt=kt.nextZ}for(;Tt&&Tt.z>=gt;){if(Tt.x>=Q&&Tt.x<=at&&Tt.y>=et&&Tt.y<=ft&&Tt!==y&&Tt!==T&&eu(A,O,R,G,z,$,Tt.x,Tt.y)&&kn(Tt.prev,Tt,Tt.next)>=0)return!1;Tt=Tt.prevZ}for(;kt&&kt.z<=Ot;){if(kt.x>=Q&&kt.x<=at&&kt.y>=et&&kt.y<=ft&&kt!==y&&kt!==T&&eu(A,O,R,G,z,$,kt.x,kt.y)&&kn(kt.prev,kt,kt.next)>=0)return!1;kt=kt.nextZ}return!0}function vC(h,a){let u=h;do{const f=u.prev,y=u.next.next;!e_(f,y)&&dw(f,u,u.next,y)&&Af(f,y)&&Af(y,f)&&(a.push(f.i,u.i,y.i),Cf(u),Cf(u.next),u=h=y),u=u.next}while(u!==h);return Rc(u)}function bC(h,a,u,f,y,S){let T=h;do{let A=T.next.next;for(;A!==T.prev;){if(T.i!==A.i&&EC(T,A)){let R=fw(T,A);return T=Rc(T,T.next),R=Rc(R,R.next),Ef(T,a,u,f,y,S,0),void Ef(R,a,u,f,y,S,0)}A=A.next}T=T.next}while(T!==h)}function wC(h,a){return h.x-a.x}function MC(h,a){const u=function(y,S){let T=S;const A=y.x,R=y.y;let z,O=-1/0;do{if(R<=T.y&&R>=T.next.y&&T.next.y!==T.y){const at=T.x+(R-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(at<=A&&at>O&&(O=at,z=T.x<T.next.x?T:T.next,at===A))return z}T=T.next}while(T!==S);if(!z)return null;const G=z,$=z.x,Q=z.y;let et=1/0;T=z;do{if(A>=T.x&&T.x>=$&&A!==T.x&&eu(R<Q?A:O,R,$,Q,R<Q?O:A,R,T.x,T.y)){const at=Math.abs(R-T.y)/(A-T.x);Af(T,y)&&(at<et||at===et&&(T.x>z.x||T.x===z.x&&SC(z,T)))&&(z=T,et=at)}T=T.next}while(T!==G);return z}(h,a);if(!u)return a;const f=fw(u,h);return Rc(f,f.next),Rc(u,u.next)}function SC(h,a){return kn(h.prev,h,a.prev)<0&&kn(a.next,h,h.next)<0}function cy(h,a,u,f,y){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*y|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-f)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function TC(h){let a=h,u=h;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==h);return u}function eu(h,a,u,f,y,S,T,A){return(y-T)*(a-A)>=(h-T)*(S-A)&&(h-T)*(f-A)>=(u-T)*(a-A)&&(u-T)*(S-A)>=(y-T)*(f-A)}function EC(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!function(u,f){let y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==f.i&&y.next.i!==f.i&&dw(y,y.next,u,f))return!0;y=y.next}while(y!==u);return!1}(h,a)&&(Af(h,a)&&Af(a,h)&&function(u,f){let y=u,S=!1;const T=(u.x+f.x)/2,A=(u.y+f.y)/2;do y.y>A!=y.next.y>A&&y.next.y!==y.y&&T<(y.next.x-y.x)*(A-y.y)/(y.next.y-y.y)+y.x&&(S=!S),y=y.next;while(y!==u);return S}(h,a)&&(kn(h.prev,h,a.prev)||kn(h,a.prev,a))||e_(h,a)&&kn(h.prev,h,h.next)>0&&kn(a.prev,a,a.next)>0)}function kn(h,a,u){return(a.y-h.y)*(u.x-a.x)-(a.x-h.x)*(u.y-a.y)}function e_(h,a){return h.x===a.x&&h.y===a.y}function dw(h,a,u,f){const y=n_(kn(h,a,u)),S=n_(kn(h,a,f)),T=n_(kn(u,f,h)),A=n_(kn(u,f,a));return y!==S&&T!==A||!(y!==0||!i_(h,u,a))||!(S!==0||!i_(h,f,a))||!(T!==0||!i_(u,h,f))||!(A!==0||!i_(u,a,f))}function i_(h,a,u){return a.x<=Math.max(h.x,u.x)&&a.x>=Math.min(h.x,u.x)&&a.y<=Math.max(h.y,u.y)&&a.y>=Math.min(h.y,u.y)}function n_(h){return h>0?1:h<0?-1:0}function Af(h,a){return kn(h.prev,h,h.next)<0?kn(h,a,h.next)>=0&&kn(h,h.prev,a)>=0:kn(h,a,h.prev)<0||kn(h,h.next,a)<0}function fw(h,a){const u=hy(h.i,h.x,h.y),f=hy(a.i,a.x,a.y),y=h.next,S=a.prev;return h.next=a,a.prev=h,u.next=y,y.prev=u,f.next=u,u.prev=f,S.next=f,f.prev=S,f}function pw(h,a,u,f){const y=hy(h,a,u);return f?(y.next=f.next,y.prev=f,f.next.prev=y,f.next=y):(y.prev=y,y.next=y),y}function Cf(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function hy(h,a,u){return{i:h,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function uy(h,a,u){const f=u.patternDependencies;let y=!1;for(const S of a){const T=S.paint.get(`${h}-pattern`);T.isConstant()||(y=!0);const A=T.constantOr(null);A&&(y=!0,f[A.to]=!0,f[A.from]=!0)}return y}function dy(h,a,u,f,y){const S=y.patternDependencies;for(const T of a){const A=T.paint.get(`${h}-pattern`).value;if(A.kind!=="constant"){let R=A.evaluate({zoom:f-1},u,{},y.availableImages),z=A.evaluate({zoom:f},u,{},y.availableImages),O=A.evaluate({zoom:f+1},u,{},y.availableImages);R=R&&R.name?R.name:R,z=z&&z.name?z.name:z,O=O&&O.name?O.name:O,S[R]=!0,S[z]=!0,S[O]=!0,u.patterns[T.id]={min:R,mid:z,max:O}}}return u}class fy{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ua,this.indexArray=new jr,this.indexArray2=new ss,this.programConfigurations=new Cc(a.layers,a.zoom),this.segments=new Oi,this.segments2=new Oi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.hasPattern=uy("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),S=!y.isConstant(),T=[];for(const{feature:A,id:R,index:z,sourceLayerIndex:O}of a){const G=this.layers[0]._featureFilter.needGeometry,$=Ic(A,G);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),$,f))continue;const Q=S?y.evaluate($,{},f,u.availableImages):void 0,et={id:R,properties:A.properties,type:A.type,sourceLayerIndex:O,index:z,geometry:G?$.geometry:Pc(A),patterns:{},sortKey:Q};T.push(et)}S&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:z,sourceLayerIndex:O}=A;if(this.hasPattern){const G=dy("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,z,f,{});u.featureIndex.insert(a[z].feature,R,z,O,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}addFeatures(a,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,gC),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,f,y,S){for(const T of Th(u,500)){let A=0;for(const Q of T)A+=Q.length;const R=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),z=R.vertexLength,O=[],G=[];for(const Q of T){if(Q.length===0)continue;Q!==T[0]&&G.push(O.length/2);const et=this.segments2.prepareSegment(Q.length,this.layoutVertexArray,this.indexArray2),at=et.vertexLength;this.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),this.indexArray2.emplaceBack(at+Q.length-1,at),O.push(Q[0].x),O.push(Q[0].y);for(let ft=1;ft<Q.length;ft++)this.layoutVertexArray.emplaceBack(Q[ft].x,Q[ft].y),this.indexArray2.emplaceBack(at+ft-1,at+ft),O.push(Q[ft].x),O.push(Q[ft].y);et.vertexLength+=Q.length,et.primitiveLength+=Q.length}const $=hw(O,G);for(let Q=0;Q<$.length;Q+=3)this.indexArray.emplaceBack(z+$[Q],z+$[Q+1],z+$[Q+2]);R.vertexLength+=A,R.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}}let mw,_w;De("FillBucket",fy,{omit:["layers","patternFeatures"]});var AC={get paint(){return _w=_w||new M({"fill-antialias":new Ue(Ft.paint_fill["fill-antialias"]),"fill-opacity":new ai(Ft.paint_fill["fill-opacity"]),"fill-color":new ai(Ft.paint_fill["fill-color"]),"fill-outline-color":new ai(Ft.paint_fill["fill-outline-color"]),"fill-translate":new Ue(Ft.paint_fill["fill-translate"]),"fill-translate-anchor":new Ue(Ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wh(Ft.paint_fill["fill-pattern"])})},get layout(){return mw=mw||new M({"fill-sort-key":new ai(Ft.layout_fill["fill-sort-key"])})}};class CC extends d{constructor(a){super(a,AC)}recalculate(a,u){super.recalculate(a,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new fy(a)}queryRadius(){return Jm(this.paint.get("fill-translate"))}queryIntersectsFeature(a,u,f,y,S,T,A){return J1(Qm(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,A),y)}isTileClipped(){return!0}}const PC=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),IC=C([{name:"a_centroid",components:2,type:"Int16"}],4),{members:RC}=PC;var wl={},DC=m,gw=iu;function iu(h,a,u,f,y){this.properties={},this.extent=u,this.type=0,this._pbf=h,this._geometry=-1,this._keys=f,this._values=y,h.readFields(LC,this,a)}function LC(h,a,u){h==1?a.id=u.readVarint():h==2?function(f,y){for(var S=f.readVarint()+f.pos;f.pos<S;){var T=y._keys[f.readVarint()],A=y._values[f.readVarint()];y.properties[T]=A}}(u,a):h==3?a.type=u.readVarint():h==4&&(a._geometry=u.pos)}function kC(h){for(var a,u,f=0,y=0,S=h.length,T=S-1;y<S;T=y++)f+=((u=h[T]).x-(a=h[y]).x)*(a.y+u.y);return f}iu.types=["Unknown","Point","LineString","Polygon"],iu.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var a,u=h.readVarint()+h.pos,f=1,y=0,S=0,T=0,A=[];h.pos<u;){if(y<=0){var R=h.readVarint();f=7&R,y=R>>3}if(y--,f===1||f===2)S+=h.readSVarint(),T+=h.readSVarint(),f===1&&(a&&A.push(a),a=[]),a.push(new DC(S,T));else{if(f!==7)throw new Error("unknown command "+f);a&&a.push(a[0].clone())}}return a&&A.push(a),A},iu.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var a=h.readVarint()+h.pos,u=1,f=0,y=0,S=0,T=1/0,A=-1/0,R=1/0,z=-1/0;h.pos<a;){if(f<=0){var O=h.readVarint();u=7&O,f=O>>3}if(f--,u===1||u===2)(y+=h.readSVarint())<T&&(T=y),y>A&&(A=y),(S+=h.readSVarint())<R&&(R=S),S>z&&(z=S);else if(u!==7)throw new Error("unknown command "+u)}return[T,R,A,z]},iu.prototype.toGeoJSON=function(h,a,u){var f,y,S=this.extent*Math.pow(2,u),T=this.extent*h,A=this.extent*a,R=this.loadGeometry(),z=iu.types[this.type];function O(Q){for(var et=0;et<Q.length;et++){var at=Q[et];Q[et]=[360*(at.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(at.y+A)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(f=0;f<R.length;f++)G[f]=R[f][0];O(R=G);break;case 2:for(f=0;f<R.length;f++)O(R[f]);break;case 3:for(R=function(Q){var et=Q.length;if(et<=1)return[Q];for(var at,ft,gt=[],Ot=0;Ot<et;Ot++){var Tt=kC(Q[Ot]);Tt!==0&&(ft===void 0&&(ft=Tt<0),ft===Tt<0?(at&&gt.push(at),at=[Q[Ot]]):at.push(Q[Ot]))}return at&&gt.push(at),gt}(R),f=0;f<R.length;f++)for(y=0;y<R[f].length;y++)O(R[f][y])}R.length===1?R=R[0]:z="Multi"+z;var $={type:"Feature",geometry:{type:z,coordinates:R},properties:this.properties};return"id"in this&&($.id=this.id),$};var FC=gw,yw=xw;function xw(h,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(zC,this,a),this.length=this._features.length}function zC(h,a,u){h===15?a.version=u.readVarint():h===1?a.name=u.readString():h===5?a.extent=u.readVarint():h===2?a._features.push(u.pos):h===3?a._keys.push(u.readString()):h===4&&a._values.push(function(f){for(var y=null,S=f.readVarint()+f.pos;f.pos<S;){var T=f.readVarint()>>3;y=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}return y}(u))}xw.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var a=this._pbf.readVarint()+this._pbf.pos;return new FC(this._pbf,a,this.extent,this._keys,this._values)};var OC=yw;function BC(h,a,u){if(h===3){var f=new OC(u,u.readVarint()+u.pos);f.length&&(a[f.name]=f)}}wl.VectorTile=function(h,a){this.layers=h.readFields(BC,{},a)},wl.VectorTileFeature=gw,wl.VectorTileLayer=yw;const NC=wl.VectorTileFeature.types,py=Math.pow(2,13);function Pf(h,a,u,f,y,S,T,A){h.emplaceBack(a,u,2*Math.floor(f*py)+T,y*py*2,S*py*2,Math.round(A))}class my{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new _l,this.centroidVertexArray=new fs,this.indexArray=new jr,this.programConfigurations=new Cc(a.layers,a.zoom),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.features=[],this.hasPattern=uy("fill-extrusion",this.layers,u);for(const{feature:y,id:S,index:T,sourceLayerIndex:A}of a){const R=this.layers[0]._featureFilter.needGeometry,z=Ic(y,R);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),z,f))continue;const O={id:S,sourceLayerIndex:A,index:T,geometry:R?z.geometry:Pc(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(dy("fill-extrusion",this.layers,O,this.zoom,u)):this.addFeature(O,O.geometry,T,f,{}),u.featureIndex.insert(y,O.geometry,T,A,this.index,!0)}}addFeatures(a,u,f){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,u,f)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,RC),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,IC.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,f,y,S){for(const T of Th(u,500)){const A={x:0,y:0,vertexCount:0};let R=0;for(const et of T)R+=et.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const et of T){if(et.length===0||VC(et))continue;let at=0;for(let ft=0;ft<et.length;ft++){const gt=et[ft];if(ft>=1){const Ot=et[ft-1];if(!UC(gt,Ot)){z.vertexLength+4>Oi.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Tt=gt.sub(Ot)._perp()._unit(),kt=Ot.dist(gt);at+kt>32768&&(at=0),Pf(this.layoutVertexArray,gt.x,gt.y,Tt.x,Tt.y,0,0,at),Pf(this.layoutVertexArray,gt.x,gt.y,Tt.x,Tt.y,0,1,at),A.x+=2*gt.x,A.y+=2*gt.y,A.vertexCount+=2,at+=kt,Pf(this.layoutVertexArray,Ot.x,Ot.y,Tt.x,Tt.y,0,0,at),Pf(this.layoutVertexArray,Ot.x,Ot.y,Tt.x,Tt.y,0,1,at),A.x+=2*Ot.x,A.y+=2*Ot.y,A.vertexCount+=2;const $t=z.vertexLength;this.indexArray.emplaceBack($t,$t+2,$t+1),this.indexArray.emplaceBack($t+1,$t+2,$t+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+R>Oi.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),NC[a.type]!=="Polygon")continue;const O=[],G=[],$=z.vertexLength;for(const et of T)if(et.length!==0){et!==T[0]&&G.push(O.length/2);for(let at=0;at<et.length;at++){const ft=et[at];Pf(this.layoutVertexArray,ft.x,ft.y,0,0,1,1,0),A.x+=ft.x,A.y+=ft.y,A.vertexCount+=1,O.push(ft.x),O.push(ft.y)}}const Q=hw(O,G);for(let et=0;et<Q.length;et+=3)this.indexArray.emplaceBack($+Q[et],$+Q[et+2],$+Q[et+1]);z.primitiveLength+=Q.length/3,z.vertexLength+=R;for(let et=0;et<A.vertexCount;et++){const at=Math.floor(A.x/A.vertexCount),ft=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(at,ft)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}}function UC(h,a){return h.x===a.x&&(h.x<0||h.x>Vn)||h.y===a.y&&(h.y<0||h.y>Vn)}function VC(h){return h.every(a=>a.x<0)||h.every(a=>a.x>Vn)||h.every(a=>a.y<0)||h.every(a=>a.y>Vn)}let vw;De("FillExtrusionBucket",my,{omit:["layers","features"]});var GC={get paint(){return vw=vw||new M({"fill-extrusion-opacity":new Ue(Ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ai(Ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ue(Ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ue(Ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wh(Ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ai(Ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ai(Ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ue(Ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class HC extends d{constructor(a){super(a,GC)}createBucket(a){return new my(a)}queryRadius(){return Jm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,u,f,y,S,T,A,R){const z=Qm(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,A),O=this.paint.get("fill-extrusion-height").evaluate(u,f),G=this.paint.get("fill-extrusion-base").evaluate(u,f),$=function(et,at,ft,gt){const Ot=[];for(const Tt of et){const kt=[Tt.x,Tt.y,0,1];t_(kt,kt,at),Ot.push(new v(kt[0]/kt[3],kt[1]/kt[3]))}return Ot}(z,R),Q=function(et,at,ft,gt){const Ot=[],Tt=[],kt=gt[8]*at,$t=gt[9]*at,oe=gt[10]*at,Ae=gt[11]*at,ii=gt[8]*ft,Se=gt[9]*ft,ve=gt[10]*ft,je=gt[11]*ft;for(const Fe of et){const Pe=[],Qt=[];for(const We of Fe){const Ge=We.x,fi=We.y,nn=gt[0]*Ge+gt[4]*fi+gt[12],Ji=gt[1]*Ge+gt[5]*fi+gt[13],Yn=gt[2]*Ge+gt[6]*fi+gt[14],da=gt[3]*Ge+gt[7]*fi+gt[15],_s=Yn+oe,Kn=da+Ae,Us=nn+ii,Vs=Ji+Se,Gs=Yn+ve,In=da+je,Jn=new v((nn+kt)/Kn,(Ji+$t)/Kn);Jn.z=_s/Kn,Pe.push(Jn);const Cs=new v(Us/In,Vs/In);Cs.z=Gs/In,Qt.push(Cs)}Ot.push(Pe),Tt.push(Qt)}return[Ot,Tt]}(y,G,O,R);return function(et,at,ft){let gt=1/0;J1(ft,at)&&(gt=bw(ft,at[0]));for(let Ot=0;Ot<at.length;Ot++){const Tt=at[Ot],kt=et[Ot];for(let $t=0;$t<Tt.length-1;$t++){const oe=Tt[$t],Ae=[oe,Tt[$t+1],kt[$t+1],kt[$t],oe];K1(ft,Ae)&&(gt=Math.min(gt,bw(ft,Ae)))}}return gt!==1/0&&gt}(Q[0],Q[1],$)}}function If(h,a){return h.x*a.x+h.y*a.y}function bw(h,a){if(h.length===1){let u=0;const f=a[u++];let y;for(;!y||f.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const S=a[u],T=h[0],A=y.sub(f),R=S.sub(f),z=T.sub(f),O=If(A,A),G=If(A,R),$=If(R,R),Q=If(z,A),et=If(z,R),at=O*$-G*G,ft=($*Q-G*et)/at,gt=(O*et-G*Q)/at,Ot=f.z*(1-ft-gt)+y.z*ft+S.z*gt;if(isFinite(Ot))return Ot}return 1/0}{let u=1/0;for(const f of a)u=Math.min(u,f.z);return u}}const jC=C([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:WC}=jC,qC=C([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:XC}=qC,$C=wl.VectorTileFeature.types,ZC=Math.cos(Math.PI/180*37.5),ww=Math.pow(2,14)/.5;class _y{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Xh,this.layoutVertexArray2=new gl,this.indexArray=new jr,this.programConfigurations=new Cc(a.layers,a.zoom),this.segments=new Oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.hasPattern=uy("line",this.layers,u);const y=this.layers[0].layout.get("line-sort-key"),S=!y.isConstant(),T=[];for(const{feature:A,id:R,index:z,sourceLayerIndex:O}of a){const G=this.layers[0]._featureFilter.needGeometry,$=Ic(A,G);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),$,f))continue;const Q=S?y.evaluate($,{},f):void 0,et={id:R,properties:A.properties,type:A.type,sourceLayerIndex:O,index:z,geometry:G?$.geometry:Pc(A),patterns:{},sortKey:Q};T.push(et)}S&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:z,sourceLayerIndex:O}=A;if(this.hasPattern){const G=dy("line",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,z,f,{});u.featureIndex.insert(a[z].feature,R,z,O,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}addFeatures(a,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,XC)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,WC),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,f,y,S){const T=this.layers[0].layout,A=T.get("line-join").evaluate(a,{}),R=T.get("line-cap"),z=T.get("line-miter-limit"),O=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const G of u)this.addLine(G,a,A,R,z,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}addLine(a,u,f,y,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let gt=0;gt<a.length-1;gt++)this.totalDistance+=a[gt].dist(a[gt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=$C[u.type]==="Polygon";let R=a.length;for(;R>=2&&a[R-1].equals(a[R-2]);)R--;let z=0;for(;z<R-1&&a[z].equals(a[z+1]);)z++;if(R<(A?3:2))return;f==="bevel"&&(S=1.05);const O=this.overscaling<=16?15*Vn/(512*this.overscaling):0,G=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let $,Q,et,at,ft;this.e1=this.e2=-1,A&&($=a[R-2],ft=a[z].sub($)._unit()._perp());for(let gt=z;gt<R;gt++){if(et=gt===R-1?A?a[z+1]:void 0:a[gt+1],et&&a[gt].equals(et))continue;ft&&(at=ft),$&&(Q=$),$=a[gt],ft=et?et.sub($)._unit()._perp():at,at=at||ft;let Ot=at.add(ft);Ot.x===0&&Ot.y===0||Ot._unit();const Tt=at.x*ft.x+at.y*ft.y,kt=Ot.x*ft.x+Ot.y*ft.y,$t=kt!==0?1/kt:1/0,oe=2*Math.sqrt(2-2*kt),Ae=kt<ZC&&Q&&et,ii=at.x*ft.y-at.y*ft.x>0;if(Ae&&gt>z){const je=$.dist(Q);if(je>2*O){const Fe=$.sub($.sub(Q)._mult(O/je)._round());this.updateDistance(Q,Fe),this.addCurrentVertex(Fe,at,0,0,G),Q=Fe}}const Se=Q&&et;let ve=Se?f:A?"butt":y;if(Se&&ve==="round"&&($t<T?ve="miter":$t<=2&&(ve="fakeround")),ve==="miter"&&$t>S&&(ve="bevel"),ve==="bevel"&&($t>2&&(ve="flipbevel"),$t<S&&(ve="miter")),Q&&this.updateDistance(Q,$),ve==="miter")Ot._mult($t),this.addCurrentVertex($,Ot,0,0,G);else if(ve==="flipbevel"){if($t>100)Ot=ft.mult(-1);else{const je=$t*at.add(ft).mag()/at.sub(ft).mag();Ot._perp()._mult(je*(ii?-1:1))}this.addCurrentVertex($,Ot,0,0,G),this.addCurrentVertex($,Ot.mult(-1),0,0,G)}else if(ve==="bevel"||ve==="fakeround"){const je=-Math.sqrt($t*$t-1),Fe=ii?je:0,Pe=ii?0:je;if(Q&&this.addCurrentVertex($,at,Fe,Pe,G),ve==="fakeround"){const Qt=Math.round(180*oe/Math.PI/20);for(let We=1;We<Qt;We++){let Ge=We/Qt;if(Ge!==.5){const nn=Ge-.5;Ge+=Ge*nn*(Ge-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*nn*nn+(.848013+Tt*(.215638*Tt-1.06021)))}const fi=ft.sub(at)._mult(Ge)._add(at)._unit()._mult(ii?-1:1);this.addHalfVertex($,fi.x,fi.y,!1,ii,0,G)}}et&&this.addCurrentVertex($,ft,-Fe,-Pe,G)}else if(ve==="butt")this.addCurrentVertex($,Ot,0,0,G);else if(ve==="square"){const je=Q?1:-1;this.addCurrentVertex($,Ot,je,je,G)}else ve==="round"&&(Q&&(this.addCurrentVertex($,at,0,0,G),this.addCurrentVertex($,at,1,1,G,!0)),et&&(this.addCurrentVertex($,ft,-1,-1,G,!0),this.addCurrentVertex($,ft,0,0,G)));if(Ae&&gt<R-1){const je=$.dist(et);if(je>2*O){const Fe=$.add(et.sub($)._mult(O/je)._round());this.updateDistance($,Fe),this.addCurrentVertex(Fe,ft,0,0,G),$=Fe}}}}addCurrentVertex(a,u,f,y,S,T=!1){const A=u.y*y-u.x,R=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*f,u.y-u.x*f,T,!1,f,S),this.addHalfVertex(a,A,R,T,!0,-y,S),this.distance>ww/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,f,y,S,T))}addHalfVertex({x:a,y:u},f,y,S,T,A,R){const z=.5*(this.lineClips?this.scaledDistance*(ww-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(S?1:0),(u<<1)+(T?1:0),Math.round(63*f)+128,Math.round(63*y)+128,1+(A===0?0:A<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),R.primitiveLength++),T?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}}let Mw,Sw;De("LineBucket",_y,{omit:["layers","patternFeatures"]});var Tw={get paint(){return Sw=Sw||new M({"line-opacity":new ai(Ft.paint_line["line-opacity"]),"line-color":new ai(Ft.paint_line["line-color"]),"line-translate":new Ue(Ft.paint_line["line-translate"]),"line-translate-anchor":new Ue(Ft.paint_line["line-translate-anchor"]),"line-width":new ai(Ft.paint_line["line-width"]),"line-gap-width":new ai(Ft.paint_line["line-gap-width"]),"line-offset":new ai(Ft.paint_line["line-offset"]),"line-blur":new ai(Ft.paint_line["line-blur"]),"line-dasharray":new qh(Ft.paint_line["line-dasharray"]),"line-pattern":new Wh(Ft.paint_line["line-pattern"]),"line-gradient":new vf(Ft.paint_line["line-gradient"])})},get layout(){return Mw=Mw||new M({"line-cap":new Ue(Ft.layout_line["line-cap"]),"line-join":new ai(Ft.layout_line["line-join"]),"line-miter-limit":new Ue(Ft.layout_line["line-miter-limit"]),"line-round-limit":new Ue(Ft.layout_line["line-round-limit"]),"line-sort-key":new ai(Ft.layout_line["line-sort-key"])})}};class YC extends ai{possiblyEvaluate(a,u){return u=new un(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,f,y){return u=K({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,f,y)}}let s_;class KC extends d{constructor(a){super(a,Tw),this.gradientVersion=0,s_||(s_=new YC(Tw.paint.properties["line-width"].specification),s_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Jo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=s_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new _y(a)}queryRadius(a){const u=a,f=Ew(Mf("line-width",this,u),Mf("line-gap-width",this,u)),y=Mf("line-offset",this,u);return f/2+Math.abs(y)+Jm(this.paint.get("line-translate"))}queryIntersectsFeature(a,u,f,y,S,T,A){const R=Qm(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,A),z=A/2*Ew(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),O=this.paint.get("line-offset").evaluate(u,f);return O&&(y=function(G,$){const Q=[];for(let et=0;et<G.length;et++){const at=G[et],ft=[];for(let gt=0;gt<at.length;gt++){const Ot=at[gt-1],Tt=at[gt],kt=at[gt+1],$t=gt===0?new v(0,0):Tt.sub(Ot)._unit()._perp(),oe=gt===at.length-1?new v(0,0):kt.sub(Tt)._unit()._perp(),Ae=$t._add(oe)._unit(),ii=Ae.x*oe.x+Ae.y*oe.y;ii!==0&&Ae._mult(1/ii),ft.push(Ae._mult($)._add(Tt))}Q.push(ft)}return Q}(y,O*A)),function(G,$,Q){for(let et=0;et<$.length;et++){const at=$[et];if(G.length>=3){for(let ft=0;ft<at.length;ft++)if(Qh(G,at[ft]))return!0}if(aC(G,at,Q))return!0}return!1}(R,y,z)}isTileClipped(){return!0}}function Ew(h,a){return a>0?a+2*h:h}const JC=C([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),QC=C([{name:"a_projected_pos",components:3,type:"Float32"}],4);C([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tP=C([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);C([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Aw=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eP=C([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iP(h,a,u){return h.sections.forEach(f=>{f.text=function(y,S,T){const A=S.layout.get("text-transform").evaluate(T,{});return A==="uppercase"?y=y.toLocaleUpperCase():A==="lowercase"&&(y=y.toLocaleLowerCase()),er.applyArabicShaping&&(y=er.applyArabicShaping(y)),y}(f.text,a,u)}),h}C([{name:"triangle",components:3,type:"Uint16"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),C([{type:"Float32",name:"offsetX"}]),C([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),C([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Wn=24,Cw=Ki,Pw=function(h,a,u,f,y){var S,T,A=8*y-f-1,R=(1<<A)-1,z=R>>1,O=-7,G=y-1,$=-1,Q=h[a+G];for(G+=$,S=Q&(1<<-O)-1,Q>>=-O,O+=A;O>0;S=256*S+h[a+G],G+=$,O-=8);for(T=S&(1<<-O)-1,S>>=-O,O+=f;O>0;T=256*T+h[a+G],G+=$,O-=8);if(S===0)S=1-z;else{if(S===R)return T?NaN:1/0*(Q?-1:1);T+=Math.pow(2,f),S-=z}return(Q?-1:1)*T*Math.pow(2,S-f)},Iw=function(h,a,u,f,y,S){var T,A,R,z=8*S-y-1,O=(1<<z)-1,G=O>>1,$=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,Q=0,et=1,at=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(A=isNaN(a)?1:0,T=O):(T=Math.floor(Math.log(a)/Math.LN2),a*(R=Math.pow(2,-T))<1&&(T--,R*=2),(a+=T+G>=1?$/R:$*Math.pow(2,1-G))*R>=2&&(T++,R/=2),T+G>=O?(A=0,T=O):T+G>=1?(A=(a*R-1)*Math.pow(2,y),T+=G):(A=a*Math.pow(2,G-1)*Math.pow(2,y),T=0));y>=8;h[u+Q]=255&A,Q+=et,A/=256,y-=8);for(T=T<<y|A,z+=y;z>0;h[u+Q]=255&T,Q+=et,T/=256,z-=8);h[u+Q-et]|=128*at};function Ki(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Ki.Varint=0,Ki.Fixed64=1,Ki.Bytes=2,Ki.Fixed32=5;var gy=4294967296,Rw=1/gy,Dw=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function To(h){return h.type===Ki.Bytes?h.readVarint()+h.pos:h.pos+1}function nu(h,a,u){return u?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function Lw(h,a,u){var f=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(f);for(var y=u.pos-1;y>=h;y--)u.buf[y+f]=u.buf[y]}function nP(h,a){for(var u=0;u<h.length;u++)a.writeVarint(h[u])}function sP(h,a){for(var u=0;u<h.length;u++)a.writeSVarint(h[u])}function rP(h,a){for(var u=0;u<h.length;u++)a.writeFloat(h[u])}function aP(h,a){for(var u=0;u<h.length;u++)a.writeDouble(h[u])}function oP(h,a){for(var u=0;u<h.length;u++)a.writeBoolean(h[u])}function lP(h,a){for(var u=0;u<h.length;u++)a.writeFixed32(h[u])}function cP(h,a){for(var u=0;u<h.length;u++)a.writeSFixed32(h[u])}function hP(h,a){for(var u=0;u<h.length;u++)a.writeFixed64(h[u])}function uP(h,a){for(var u=0;u<h.length;u++)a.writeSFixed64(h[u])}function r_(h,a){return(h[a]|h[a+1]<<8|h[a+2]<<16)+16777216*h[a+3]}function su(h,a,u){h[u]=a,h[u+1]=a>>>8,h[u+2]=a>>>16,h[u+3]=a>>>24}function kw(h,a){return(h[a]|h[a+1]<<8|h[a+2]<<16)+(h[a+3]<<24)}Ki.prototype={destroy:function(){this.buf=null},readFields:function(h,a,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),y=f>>3,S=this.pos;this.type=7&f,h(y,a,this),this.pos===S&&this.skip(f)}return a},readMessage:function(h,a){return this.readFields(h,a,this.readVarint()+this.pos)},readFixed32:function(){var h=r_(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=kw(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=r_(this.buf,this.pos)+r_(this.buf,this.pos+4)*gy;return this.pos+=8,h},readSFixed64:function(){var h=r_(this.buf,this.pos)+kw(this.buf,this.pos+4)*gy;return this.pos+=8,h},readFloat:function(){var h=Pw(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=Pw(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var a,u,f=this.buf;return a=127&(u=f[this.pos++]),u<128?a:(a|=(127&(u=f[this.pos++]))<<7,u<128?a:(a|=(127&(u=f[this.pos++]))<<14,u<128?a:(a|=(127&(u=f[this.pos++]))<<21,u<128?a:function(y,S,T){var A,R,z=T.buf;if(A=(112&(R=z[T.pos++]))>>4,R<128||(A|=(127&(R=z[T.pos++]))<<3,R<128)||(A|=(127&(R=z[T.pos++]))<<10,R<128)||(A|=(127&(R=z[T.pos++]))<<17,R<128)||(A|=(127&(R=z[T.pos++]))<<24,R<128)||(A|=(1&(R=z[T.pos++]))<<31,R<128))return nu(y,A,S);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(u=f[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,a=this.pos;return this.pos=h,h-a>=12&&Dw?function(u,f,y){return Dw.decode(u.subarray(f,y))}(this.buf,a,h):function(u,f,y){for(var S="",T=f;T<y;){var A,R,z,O=u[T],G=null,$=O>239?4:O>223?3:O>191?2:1;if(T+$>y)break;$===1?O<128&&(G=O):$===2?(192&(A=u[T+1]))==128&&(G=(31&O)<<6|63&A)<=127&&(G=null):$===3?(R=u[T+2],(192&(A=u[T+1]))==128&&(192&R)==128&&((G=(15&O)<<12|(63&A)<<6|63&R)<=2047||G>=55296&&G<=57343)&&(G=null)):$===4&&(R=u[T+2],z=u[T+3],(192&(A=u[T+1]))==128&&(192&R)==128&&(192&z)==128&&((G=(15&O)<<18|(63&A)<<12|(63&R)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,$=1):G>65535&&(G-=65536,S+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),S+=String.fromCharCode(G),T+=$}return S}(this.buf,a,h)},readBytes:function(){var h=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,h);return this.pos=h,a},readPackedVarint:function(h,a){if(this.type!==Ki.Bytes)return h.push(this.readVarint(a));var u=To(this);for(h=h||[];this.pos<u;)h.push(this.readVarint(a));return h},readPackedSVarint:function(h){if(this.type!==Ki.Bytes)return h.push(this.readSVarint());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Ki.Bytes)return h.push(this.readBoolean());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Ki.Bytes)return h.push(this.readFloat());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Ki.Bytes)return h.push(this.readDouble());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Ki.Bytes)return h.push(this.readFixed32());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Ki.Bytes)return h.push(this.readSFixed32());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Ki.Bytes)return h.push(this.readFixed64());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Ki.Bytes)return h.push(this.readSFixed64());var a=To(this);for(h=h||[];this.pos<a;)h.push(this.readSFixed64());return h},skip:function(h){var a=7&h;if(a===Ki.Varint)for(;this.buf[this.pos++]>127;);else if(a===Ki.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Ki.Fixed32)this.pos+=4;else{if(a!==Ki.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(h,a){this.writeVarint(h<<3|a)},realloc:function(h){for(var a=this.length||16;a<this.pos+h;)a*=2;if(a!==this.length){var u=new Uint8Array(a);u.set(this.buf),this.buf=u,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),su(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),su(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),su(this.buf,-1&h,this.pos),su(this.buf,Math.floor(h*Rw),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),su(this.buf,-1&h,this.pos),su(this.buf,Math.floor(h*Rw),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(a,u){var f,y;if(a>=0?(f=a%4294967296|0,y=a/4294967296|0):(y=~(-a/4294967296),4294967295^(f=~(-a%4294967296))?f=f+1|0:(f=0,y=y+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(S,T,A){A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,S>>>=7,A.buf[A.pos++]=127&S|128,A.buf[A.pos]=127&(S>>>=7)}(f,0,u),function(S,T){var A=(7&S)<<4;T.buf[T.pos++]|=A|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(y,u)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var a=this.pos;this.pos=function(f,y,S){for(var T,A,R=0;R<y.length;R++){if((T=y.charCodeAt(R))>55295&&T<57344){if(!A){T>56319||R+1===y.length?(f[S++]=239,f[S++]=191,f[S++]=189):A=T;continue}if(T<56320){f[S++]=239,f[S++]=191,f[S++]=189,A=T;continue}T=A-55296<<10|T-56320|65536,A=null}else A&&(f[S++]=239,f[S++]=191,f[S++]=189,A=null);T<128?f[S++]=T:(T<2048?f[S++]=T>>6|192:(T<65536?f[S++]=T>>12|224:(f[S++]=T>>18|240,f[S++]=T>>12&63|128),f[S++]=T>>6&63|128),f[S++]=63&T|128)}return S}(this.buf,h,this.pos);var u=this.pos-a;u>=128&&Lw(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeFloat:function(h){this.realloc(4),Iw(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Iw(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var a=h.length;this.writeVarint(a),this.realloc(a);for(var u=0;u<a;u++)this.buf[this.pos++]=h[u]},writeRawMessage:function(h,a){this.pos++;var u=this.pos;h(a,this);var f=this.pos-u;f>=128&&Lw(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(h,a,u){this.writeTag(h,Ki.Bytes),this.writeRawMessage(a,u)},writePackedVarint:function(h,a){a.length&&this.writeMessage(h,nP,a)},writePackedSVarint:function(h,a){a.length&&this.writeMessage(h,sP,a)},writePackedBoolean:function(h,a){a.length&&this.writeMessage(h,oP,a)},writePackedFloat:function(h,a){a.length&&this.writeMessage(h,rP,a)},writePackedDouble:function(h,a){a.length&&this.writeMessage(h,aP,a)},writePackedFixed32:function(h,a){a.length&&this.writeMessage(h,lP,a)},writePackedSFixed32:function(h,a){a.length&&this.writeMessage(h,cP,a)},writePackedFixed64:function(h,a){a.length&&this.writeMessage(h,hP,a)},writePackedSFixed64:function(h,a){a.length&&this.writeMessage(h,uP,a)},writeBytesField:function(h,a){this.writeTag(h,Ki.Bytes),this.writeBytes(a)},writeFixed32Field:function(h,a){this.writeTag(h,Ki.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(h,a){this.writeTag(h,Ki.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(h,a){this.writeTag(h,Ki.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(h,a){this.writeTag(h,Ki.Fixed64),this.writeSFixed64(a)},writeVarintField:function(h,a){this.writeTag(h,Ki.Varint),this.writeVarint(a)},writeSVarintField:function(h,a){this.writeTag(h,Ki.Varint),this.writeSVarint(a)},writeStringField:function(h,a){this.writeTag(h,Ki.Bytes),this.writeString(a)},writeFloatField:function(h,a){this.writeTag(h,Ki.Fixed32),this.writeFloat(a)},writeDoubleField:function(h,a){this.writeTag(h,Ki.Fixed64),this.writeDouble(a)},writeBooleanField:function(h,a){this.writeVarintField(h,!!a)}};var yy=p(Cw);const xy=3;function dP(h,a,u){h===1&&u.readMessage(fP,a)}function fP(h,a,u){if(h===3){const{id:f,bitmap:y,width:S,height:T,left:A,top:R,advance:z}=u.readMessage(pP,{});a.push({id:f,bitmap:new Tf({width:S+2*xy,height:T+2*xy},y),metrics:{width:S,height:T,left:A,top:R,advance:z}})}}function pP(h,a,u){h===1?a.id=u.readVarint():h===2?a.bitmap=u.readBytes():h===3?a.width=u.readVarint():h===4?a.height=u.readVarint():h===5?a.left=u.readSVarint():h===6?a.top=u.readSVarint():h===7&&(a.advance=u.readVarint())}const Fw=xy;function zw(h){let a=0,u=0;for(const T of h)a+=T.w*T.h,u=Math.max(u,T.w);h.sort((T,A)=>A.h-T.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,S=0;for(const T of h)for(let A=f.length-1;A>=0;A--){const R=f[A];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,S=Math.max(S,T.y+T.h),y=Math.max(y,T.x+T.w),T.w===R.w&&T.h===R.h){const z=f.pop();A<f.length&&(f[A]=z)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(f.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:y,h:S,fill:a/(y*S)||0}}const nr=1;class vy{constructor(a,{pixelRatio:u,version:f,stretchX:y,stretchY:S,content:T,textFitWidth:A,textFitHeight:R}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=S,this.content=T,this.version=f,this.textFitWidth=A,this.textFitHeight=R}get tl(){return[this.paddedRect.x+nr,this.paddedRect.y+nr]}get br(){return[this.paddedRect.x+this.paddedRect.w-nr,this.paddedRect.y+this.paddedRect.h-nr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*nr)/this.pixelRatio,(this.paddedRect.h-2*nr)/this.pixelRatio]}}class Ow{constructor(a,u){const f={},y={};this.haveRenderCallbacks=[];const S=[];this.addImages(a,f,S),this.addImages(u,y,S);const{w:T,h:A}=zw(S),R=new Wr({width:T||1,height:A||1});for(const z in a){const O=a[z],G=f[z].paddedRect;Wr.copy(O.data,R,{x:0,y:0},{x:G.x+nr,y:G.y+nr},O.data)}for(const z in u){const O=u[z],G=y[z].paddedRect,$=G.x+nr,Q=G.y+nr,et=O.data.width,at=O.data.height;Wr.copy(O.data,R,{x:0,y:0},{x:$,y:Q},O.data),Wr.copy(O.data,R,{x:0,y:at-1},{x:$,y:Q-1},{width:et,height:1}),Wr.copy(O.data,R,{x:0,y:0},{x:$,y:Q+at},{width:et,height:1}),Wr.copy(O.data,R,{x:et-1,y:0},{x:$-1,y:Q},{width:1,height:at}),Wr.copy(O.data,R,{x:0,y:0},{x:$+et,y:Q},{width:1,height:at})}this.image=R,this.iconPositions=f,this.patternPositions=y}addImages(a,u,f){for(const y in a){const S=a[y],T={x:0,y:0,w:S.data.width+2*nr,h:S.data.height+2*nr};f.push(T),u[y]=new vy(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in a.updatedImages)this.patchUpdatedImage(this.iconPositions[f],a.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],a.getImage(f),u)}patchUpdatedImage(a,u,f){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,S]=a.tl;f.update(u.data,void 0,{x:y,y:S})}}var Ml;De("ImagePosition",vy),De("ImageAtlas",Ow),c.ah=void 0,(Ml=c.ah||(c.ah={}))[Ml.none=0]="none",Ml[Ml.horizontal=1]="horizontal",Ml[Ml.vertical=2]="vertical",Ml[Ml.horizontalOnly=3]="horizontalOnly";const Df=-17;class Lf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,u){const f=new Lf;return f.scale=a||1,f.fontStack=u,f}static forImage(a){const u=new Lf;return u.imageName=a,u}}class ru{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,u){const f=new ru;for(let y=0;y<a.sections.length;y++){const S=a.sections[y];S.image?f.addImageSection(S):f.addTextSection(S,u)}return f}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let u="";for(let f=0;f<a.length;f++){const y=a.charCodeAt(f+1)||null,S=a.charCodeAt(f-1)||null;u+=y&&Wm(y)&&!Rf[a[f+1]]||S&&Wm(S)&&!Rf[a[f-1]]||!Rf[a[f]]?a[f]:Rf[a[f]]}return u}(this.text)}trim(){let a=0;for(let f=0;f<this.text.length&&o_[this.text.charCodeAt(f)];f++)a++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=a&&o_[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(a,u),this.sectionIndex=this.sectionIndex.slice(a,u)}substring(a,u){const f=new ru;return f.text=this.text.substring(a,u),f.sectionIndex=this.sectionIndex.slice(a,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,u)=>Math.max(a,this.sections[u].scale),0)}addTextSection(a,u){this.text+=a.text,this.sections.push(Lf.forText(a.scale,a.fontStack||u));const f=this.sections.length-1;for(let y=0;y<a.text.length;++y)this.sectionIndex.push(f)}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void wt("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Lf.forImage(u)),this.sectionIndex.push(this.sections.length-1)):wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function a_(h,a,u,f,y,S,T,A,R,z,O,G,$,Q,et){const at=ru.fromFeature(h,y);let ft;G===c.ah.vertical&&at.verticalizePunctuation();const{processBidirectionalText:gt,processStyledBidirectionalText:Ot}=er;if(gt&&at.sections.length===1){ft=[];const $t=gt(at.toString(),by(at,z,S,a,f,Q));for(const oe of $t){const Ae=new ru;Ae.text=oe,Ae.sections=at.sections;for(let ii=0;ii<oe.length;ii++)Ae.sectionIndex.push(0);ft.push(Ae)}}else if(Ot){ft=[];const $t=Ot(at.text,at.sectionIndex,by(at,z,S,a,f,Q));for(const oe of $t){const Ae=new ru;Ae.text=oe[0],Ae.sectionIndex=oe[1],Ae.sections=at.sections,ft.push(Ae)}}else ft=function($t,oe){const Ae=[],ii=$t.text;let Se=0;for(const ve of oe)Ae.push($t.substring(Se,ve)),Se=ve;return Se<ii.length&&Ae.push($t.substring(Se,ii.length)),Ae}(at,by(at,z,S,a,f,Q));const Tt=[],kt={positionedLines:Tt,text:at.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function($t,oe,Ae,ii,Se,ve,je,Fe,Pe,Qt,We,Ge){let fi=0,nn=Df,Ji=0,Yn=0;const da=Fe==="right"?1:Fe==="left"?0:.5;let _s=0;for(const In of Se){In.trim();const Jn=In.getMaxScale(),Cs=(Jn-1)*Wn,gs={positionedGlyphs:[],lineOffset:0};$t.positionedLines[_s]=gs;const Hs=gs.positionedGlyphs;let ys=0;if(!In.length()){nn+=ve,++_s;continue}for(let sr=0;sr<In.length();sr++){const Hi=In.getSection(sr),cn=In.getSectionIndex(sr),mn=In.getCharCode(sr);let Ar=0,Mn=null,cu=null,Xa=null,$a=Wn;const fa=!(Pe===c.ah.horizontal||!We&&!yf(mn)||We&&(o_[mn]||(Kn=mn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Kn)))));if(Hi.imageName){const $r=ii[Hi.imageName];if(!$r)continue;Xa=Hi.imageName,$t.iconsInText=$t.iconsInText||!0,cu=$r.paddedRect;const rs=$r.displaySize;Hi.scale=Hi.scale*Wn/Ge,Mn={width:rs[0],height:rs[1],left:nr,top:-Fw,advance:fa?rs[1]:rs[0]},Ar=Cs+(Wn-rs[1]*Hi.scale),$a=Mn.advance;const Eo=fa?rs[0]*Hi.scale-Wn*Jn:rs[1]*Hi.scale-Wn*Jn;Eo>0&&Eo>ys&&(ys=Eo)}else{const $r=Ae[Hi.fontStack],rs=$r&&$r[mn];if(rs&&rs.rect)cu=rs.rect,Mn=rs.metrics;else{const Eo=oe[Hi.fontStack],Nf=Eo&&Eo[mn];if(!Nf)continue;Mn=Nf.metrics}Ar=(Jn-Hi.scale)*Wn}fa?($t.verticalizable=!0,Hs.push({glyph:mn,imageName:Xa,x:fi,y:nn+Ar,vertical:fa,scale:Hi.scale,fontStack:Hi.fontStack,sectionIndex:cn,metrics:Mn,rect:cu}),fi+=$a*Hi.scale+Qt):(Hs.push({glyph:mn,imageName:Xa,x:fi,y:nn+Ar,vertical:fa,scale:Hi.scale,fontStack:Hi.fontStack,sectionIndex:cn,metrics:Mn,rect:cu}),fi+=Mn.advance*Hi.scale+Qt)}Hs.length!==0&&(Ji=Math.max(fi-Qt,Ji),yP(Hs,0,Hs.length-1,da,ys)),fi=0;const Xr=ve*Jn+ys;gs.lineOffset=Math.max(ys,Cs),nn+=Xr,Yn=Math.max(Xr,Yn),++_s}var Kn;const Us=nn-Df,{horizontalAlign:Vs,verticalAlign:Gs}=wy(je);(function(In,Jn,Cs,gs,Hs,ys,Xr,sr,Hi){const cn=(Jn-Cs)*Hs;let mn=0;mn=ys!==Xr?-sr*gs-Df:(-gs*Hi+.5)*Xr;for(const Ar of In)for(const Mn of Ar.positionedGlyphs)Mn.x+=cn,Mn.y+=mn})($t.positionedLines,da,Vs,Gs,Ji,Yn,ve,Us,Se.length),$t.top+=-Gs*Us,$t.bottom=$t.top+Us,$t.left+=-Vs*Ji,$t.right=$t.left+Ji}(kt,a,u,f,ft,T,A,R,G,z,$,et),!function($t){for(const oe of $t)if(oe.positionedGlyphs.length!==0)return!1;return!0}(Tt)&&kt}const o_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mP={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_P={40:!0};function Bw(h,a,u,f,y,S){if(a.imageName){const T=f[a.imageName];return T?T.displaySize[0]*a.scale*Wn/S+y:0}{const T=u[a.fontStack],A=T&&T[h];return A?A.metrics.advance*a.scale+y:0}}function Nw(h,a,u,f){const y=Math.pow(h-a,2);return f?h<a?y/2:2*y:y+Math.abs(u)*u}function gP(h,a,u){let f=0;return h===10&&(f-=1e4),u&&(f+=150),h!==40&&h!==65288||(f+=50),a!==41&&a!==65289||(f+=50),f}function Uw(h,a,u,f,y,S){let T=null,A=Nw(a,u,y,S);for(const R of f){const z=Nw(a-R.x,u,y,S)+R.badness;z<=A&&(T=R,A=z)}return{index:h,x:a,priorBreak:T,badness:A}}function Vw(h){return h?Vw(h.priorBreak).concat(h.index):[]}function by(h,a,u,f,y,S){if(!h)return[];const T=[],A=function(G,$,Q,et,at,ft){let gt=0;for(let Ot=0;Ot<G.length();Ot++){const Tt=G.getSection(Ot);gt+=Bw(G.getCharCode(Ot),Tt,et,at,$,ft)}return gt/Math.max(1,Math.ceil(gt/Q))}(h,a,u,f,y,S),R=h.text.indexOf("")>=0;let z=0;for(let G=0;G<h.length();G++){const $=h.getSection(G),Q=h.getCharCode(G);if(o_[Q]||(z+=Bw(Q,$,f,y,a,S)),G<h.length()-1){const et=!((O=Q)<11904)&&(!!zi["CJK Compatibility Forms"](O)||!!zi["CJK Compatibility"](O)||!!zi["CJK Strokes"](O)||!!zi["CJK Symbols and Punctuation"](O)||!!zi["Enclosed CJK Letters and Months"](O)||!!zi["Halfwidth and Fullwidth Forms"](O)||!!zi["Ideographic Description Characters"](O)||!!zi["Vertical Forms"](O)||jm.test(String.fromCodePoint(O)));(mP[Q]||et||$.imageName||G!==h.length()-2&&_P[h.getCharCode(G+1)])&&T.push(Uw(G+1,z,A,T,gP(Q,h.getCharCode(G+1),et&&R),!1))}}var O;return Vw(Uw(h.length(),z,A,T,0,!0))}function wy(h){let a=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function yP(h,a,u,f,y){if(!f&&!y)return;const S=h[u],T=(h[u].x+S.metrics.advance*S.scale)*f;for(let A=a;A<=u;A++)h[A].x-=T,h[A].y+=y}function xP(h,a,u){const{horizontalAlign:f,verticalAlign:y}=wy(u),S=a[0]-h.displaySize[0]*f,T=a[1]-h.displaySize[1]*y;return{image:h,top:T,bottom:T+h.displaySize[1],left:S,right:S+h.displaySize[0]}}function Gw(h){var a,u;let f=h.left,y=h.top,S=h.right-f,T=h.bottom-y;const A=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",R=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",z=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(R==="proportional"){if(A==="stretchOnly"&&S/T<z||A==="proportional"){const O=Math.ceil(T*z);f*=O/S,S=O}}else if(A==="proportional"&&R==="stretchOnly"&&z!==0&&S/T>z){const O=Math.ceil(S/z);y*=O/T,T=O}return{x1:f,y1:y,x2:f+S,y2:y+T}}function Hw(h,a,u,f,y,S){const T=h.image;let A;if(T.content){const ft=T.content,gt=T.pixelRatio||1;A=[ft[0]/gt,ft[1]/gt,T.displaySize[0]-ft[2]/gt,T.displaySize[1]-ft[3]/gt]}const R=a.left*S,z=a.right*S;let O,G,$,Q;u==="width"||u==="both"?(Q=y[0]+R-f[3],G=y[0]+z+f[1]):(Q=y[0]+(R+z-T.displaySize[0])/2,G=Q+T.displaySize[0]);const et=a.top*S,at=a.bottom*S;return u==="height"||u==="both"?(O=y[1]+et-f[0],$=y[1]+at+f[2]):(O=y[1]+(et+at-T.displaySize[1])/2,$=O+T.displaySize[1]),{image:T,top:O,right:G,bottom:$,left:Q,collisionPadding:A}}const kf=255,qa=128,Sl=kf*qa;function jw(h,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new un(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=u;let S=0;for(;S<f.length&&f[S]<=h;)S++;S=Math.max(0,S-1);let T=S;for(;T<f.length&&f[T]<h+1;)T++;T=Math.min(f.length-1,T);const A=f[S],R=f[T];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:R,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:R,minSize:u.evaluate(new un(A)),maxSize:u.evaluate(new un(R)),interpolationType:y}}}function My(h,a,u){let f="never";const y=h.get(a);return y?f=y:h.get(u)&&(f="always"),f}const vP=wl.VectorTileFeature.types,bP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function l_(h,a,u,f,y,S,T,A,R,z,O,G,$){const Q=A?Math.min(Sl,Math.round(A[0])):0,et=A?Math.min(Sl,Math.round(A[1])):0;h.emplaceBack(a,u,Math.round(32*f),Math.round(32*y),S,T,(Q<<1)+(R?1:0),et,16*z,16*O,256*G,256*$)}function Sy(h,a,u){h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u)}function wP(h){for(const a of h.sections)if(J0(a.text))return!0;return!1}class Ty{constructor(a){this.layoutVertexArray=new $h,this.indexArray=new jr,this.programConfigurations=a,this.segments=new Oi,this.dynamicLayoutVertexArray=new bf,this.opacityVertexArray=new Tr,this.hasVisibleVertices=!1,this.placedSymbolArray=new dn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,f,y){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,JC.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,QC.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,bP,!0),this.opacityVertexBuffer.itemSize=1),(f||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",Ty);class Ey{constructor(a,u,f){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Oi,this.collisionVertexArray=new ja}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,tP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",Ey);class au{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(T=>T.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ry([]),this.placementViewportMatrix=ry([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jw(this.zoom,u["text-size"]),this.iconSizeData=jw(this.zoom,u["icon-size"]);const f=this.layers[0].layout,y=f.get("symbol-sort-key"),S=f.get("symbol-z-order");this.canOverlap=My(f,"text-overlap","text-allow-overlap")!=="never"||My(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(T=>c.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=a.sourceID}createArrays(){this.text=new Ty(new Cc(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new Ty(new Cc(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new fn,this.lineVertexArray=new ds,this.symbolInstances=new Di,this.textAnchorOffsets=new pn}calculateGlyphDependencies(a,u,f,y,S){for(let T=0;T<a.length;T++)if(u[a.charCodeAt(T)]=!0,(f||y)&&S){const A=Rf[a.charAt(T)];A&&(u[A.charCodeAt(0)]=!0)}}populate(a,u,f){const y=this.layers[0],S=y.layout,T=S.get("text-font"),A=S.get("text-field"),R=S.get("icon-image"),z=(A.value.kind!=="constant"||A.value.value instanceof ei&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),O=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,G=S.get("symbol-sort-key");if(this.features=[],!z&&!O)return;const $=u.iconDependencies,Q=u.glyphDependencies,et=u.availableImages,at=new un(this.zoom);for(const{feature:ft,id:gt,index:Ot,sourceLayerIndex:Tt}of a){const kt=y._featureFilter.needGeometry,$t=Ic(ft,kt);if(!y._featureFilter.filter(at,$t,f))continue;let oe,Ae;if(kt||($t.geometry=Pc(ft)),z){const Se=y.getValueAndResolveTokens("text-field",$t,f,et),ve=ei.factory(Se),je=this.hasRTLText=this.hasRTLText||wP(ve);(!je||er.getRTLTextPluginStatus()==="unavailable"||je&&er.isParsed())&&(oe=iP(ve,y,$t))}if(O){const Se=y.getValueAndResolveTokens("icon-image",$t,f,et);Ae=Se instanceof Ri?Se:Ri.fromString(Se)}if(!oe&&!Ae)continue;const ii=this.sortFeaturesByKey?G.evaluate($t,{},f):void 0;if(this.features.push({id:gt,text:oe,icon:Ae,index:Ot,sourceLayerIndex:Tt,geometry:$t.geometry,properties:ft.properties,type:vP[ft.type],sortKey:ii}),Ae&&($[Ae.name]=!0),oe){const Se=T.evaluate($t,{},f).join(","),ve=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const je of oe.sections)if(je.image)$[je.image.name]=!0;else{const Fe=_f(oe.toString()),Pe=je.fontStack||Se,Qt=Q[Pe]=Q[Pe]||{};this.calculateGlyphDependencies(je.text,Qt,ve,this.allowVerticalPlacement,Fe)}}}S.get("symbol-placement")==="line"&&(this.features=function(ft){const gt={},Ot={},Tt=[];let kt=0;function $t(Se){Tt.push(ft[Se]),kt++}function oe(Se,ve,je){const Fe=Ot[Se];return delete Ot[Se],Ot[ve]=Fe,Tt[Fe].geometry[0].pop(),Tt[Fe].geometry[0]=Tt[Fe].geometry[0].concat(je[0]),Fe}function Ae(Se,ve,je){const Fe=gt[ve];return delete gt[ve],gt[Se]=Fe,Tt[Fe].geometry[0].shift(),Tt[Fe].geometry[0]=je[0].concat(Tt[Fe].geometry[0]),Fe}function ii(Se,ve,je){const Fe=je?ve[0][ve[0].length-1]:ve[0][0];return`${Se}:${Fe.x}:${Fe.y}`}for(let Se=0;Se<ft.length;Se++){const ve=ft[Se],je=ve.geometry,Fe=ve.text?ve.text.toString():null;if(!Fe){$t(Se);continue}const Pe=ii(Fe,je),Qt=ii(Fe,je,!0);if(Pe in Ot&&Qt in gt&&Ot[Pe]!==gt[Qt]){const We=Ae(Pe,Qt,je),Ge=oe(Pe,Qt,Tt[We].geometry);delete gt[Pe],delete Ot[Qt],Ot[ii(Fe,Tt[Ge].geometry,!0)]=Ge,Tt[We].geometry=null}else Pe in Ot?oe(Pe,Qt,je):Qt in gt?Ae(Pe,Qt,je):($t(Se),gt[Pe]=kt-1,Ot[Qt]=kt-1)}return Tt.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ft,gt)=>ft.sortKey-gt.sortKey)}update(a,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const f=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),S=a.dist(u[a.segment]);const T={};for(let A=a.segment+1;A<u.length;A++)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:y},A<u.length-1&&(y+=u[A+1].dist(u[A]));for(let A=a.segment||0;A>=0;A--)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:S},A>0&&(S+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const R=T[A];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(a,u,f,y,S,T,A,R,z,O,G,$){const Q=a.indexArray,et=a.layoutVertexArray,at=a.segments.prepareSegment(4*u.length,et,Q,this.canOverlap?T.sortKey:void 0),ft=this.glyphOffsetArray.length,gt=at.vertexLength,Ot=this.allowVerticalPlacement&&A===c.ah.vertical?Math.PI/2:0,Tt=T.text&&T.text.sections;for(let kt=0;kt<u.length;kt++){const{tl:$t,tr:oe,bl:Ae,br:ii,tex:Se,pixelOffsetTL:ve,pixelOffsetBR:je,minFontScaleX:Fe,minFontScaleY:Pe,glyphOffset:Qt,isSDF:We,sectionIndex:Ge}=u[kt],fi=at.vertexLength,nn=Qt[1];l_(et,R.x,R.y,$t.x,nn+$t.y,Se.x,Se.y,f,We,ve.x,ve.y,Fe,Pe),l_(et,R.x,R.y,oe.x,nn+oe.y,Se.x+Se.w,Se.y,f,We,je.x,ve.y,Fe,Pe),l_(et,R.x,R.y,Ae.x,nn+Ae.y,Se.x,Se.y+Se.h,f,We,ve.x,je.y,Fe,Pe),l_(et,R.x,R.y,ii.x,nn+ii.y,Se.x+Se.w,Se.y+Se.h,f,We,je.x,je.y,Fe,Pe),Sy(a.dynamicLayoutVertexArray,R,Ot),Q.emplaceBack(fi,fi+1,fi+2),Q.emplaceBack(fi+1,fi+2,fi+3),at.vertexLength+=4,at.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qt[0]),kt!==u.length-1&&Ge===u[kt+1].sectionIndex||a.programConfigurations.populatePaintArrays(et.length,T,T.index,{},$,Tt&&Tt[Ge])}a.placedSymbolArray.emplaceBack(R.x,R.y,ft,this.glyphOffsetArray.length-ft,gt,z,O,R.segment,f?f[0]:0,f?f[1]:0,y[0],y[1],A,0,!1,0,G)}_addCollisionDebugVertex(a,u,f,y,S,T){return u.emplaceBack(0,0),a.emplaceBack(f.x,f.y,y,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,u,f,y,S,T,A){const R=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),z=R.vertexLength,O=S.layoutVertexArray,G=S.collisionVertexArray,$=A.anchorX,Q=A.anchorY;this._addCollisionDebugVertex(O,G,T,$,Q,new v(a,u)),this._addCollisionDebugVertex(O,G,T,$,Q,new v(f,u)),this._addCollisionDebugVertex(O,G,T,$,Q,new v(f,y)),this._addCollisionDebugVertex(O,G,T,$,Q,new v(a,y)),R.vertexLength+=4;const et=S.indexArray;et.emplaceBack(z,z+1),et.emplaceBack(z+1,z+2),et.emplaceBack(z+2,z+3),et.emplaceBack(z+3,z),R.primitiveLength+=4}addDebugCollisionBoxes(a,u,f,y){for(let S=a;S<u;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ey(Er,Aw.members,ss),this.iconCollisionBox=new Ey(Er,Aw.members,ss);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,f,y,S,T,A,R,z){const O={};for(let G=u;G<f;G++){const $=a.get(G);O.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.textFeatureIndex=$.featureIndex;break}for(let G=y;G<S;G++){const $=a.get(G);O.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalTextFeatureIndex=$.featureIndex;break}for(let G=T;G<A;G++){const $=a.get(G);O.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.iconFeatureIndex=$.featureIndex;break}for(let G=R;G<z;G++){const $=a.get(G);O.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalIconFeatureIndex=$.featureIndex;break}return O}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const f=a.placedSymbolArray.get(u),y=f.vertexStartIndex+4*f.numGlyphs;for(let S=f.vertexStartIndex;S<y;S+=4)a.indexArray.emplaceBack(S,S+1,S+2),a.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),f=Math.cos(a),y=[],S=[],T=[];for(let A=0;A<this.symbolInstances.length;++A){T.push(A);const R=this.symbolInstances.get(A);y.push(0|Math.round(u*R.anchorX+f*R.anchorY)),S.push(R.featureIndex)}return T.sort((A,R)=>y[A]-y[R]||S[R]-S[A]),T}addToSortKeyRanges(a,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((y,S,T)=>{y>=0&&T.indexOf(y)===S&&this.addIndicesForPlacedSymbol(this.text,y)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ww,qw;De("SymbolBucket",au,{omit:["layers","collisionBoxArray","features","compareText"]}),au.MAX_GLYPHS=65535,au.addDynamicAttributes=Sy;var Ay={get paint(){return qw=qw||new M({"icon-opacity":new ai(Ft.paint_symbol["icon-opacity"]),"icon-color":new ai(Ft.paint_symbol["icon-color"]),"icon-halo-color":new ai(Ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new ai(Ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ai(Ft.paint_symbol["icon-halo-blur"]),"icon-translate":new Ue(Ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ue(Ft.paint_symbol["icon-translate-anchor"]),"text-opacity":new ai(Ft.paint_symbol["text-opacity"]),"text-color":new ai(Ft.paint_symbol["text-color"],{runtimeType:xi,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new ai(Ft.paint_symbol["text-halo-color"]),"text-halo-width":new ai(Ft.paint_symbol["text-halo-width"]),"text-halo-blur":new ai(Ft.paint_symbol["text-halo-blur"]),"text-translate":new Ue(Ft.paint_symbol["text-translate"]),"text-translate-anchor":new Ue(Ft.paint_symbol["text-translate-anchor"])})},get layout(){return Ww=Ww||new M({"symbol-placement":new Ue(Ft.layout_symbol["symbol-placement"]),"symbol-spacing":new Ue(Ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ue(Ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ai(Ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ue(Ft.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ue(Ft.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ue(Ft.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ue(Ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ue(Ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ue(Ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new ai(Ft.layout_symbol["icon-size"]),"icon-text-fit":new Ue(Ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ue(Ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new ai(Ft.layout_symbol["icon-image"]),"icon-rotate":new ai(Ft.layout_symbol["icon-rotate"]),"icon-padding":new ai(Ft.layout_symbol["icon-padding"]),"icon-keep-upright":new Ue(Ft.layout_symbol["icon-keep-upright"]),"icon-offset":new ai(Ft.layout_symbol["icon-offset"]),"icon-anchor":new ai(Ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ue(Ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ue(Ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ue(Ft.layout_symbol["text-rotation-alignment"]),"text-field":new ai(Ft.layout_symbol["text-field"]),"text-font":new ai(Ft.layout_symbol["text-font"]),"text-size":new ai(Ft.layout_symbol["text-size"]),"text-max-width":new ai(Ft.layout_symbol["text-max-width"]),"text-line-height":new Ue(Ft.layout_symbol["text-line-height"]),"text-letter-spacing":new ai(Ft.layout_symbol["text-letter-spacing"]),"text-justify":new ai(Ft.layout_symbol["text-justify"]),"text-radial-offset":new ai(Ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ue(Ft.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ai(Ft.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ai(Ft.layout_symbol["text-anchor"]),"text-max-angle":new Ue(Ft.layout_symbol["text-max-angle"]),"text-writing-mode":new Ue(Ft.layout_symbol["text-writing-mode"]),"text-rotate":new ai(Ft.layout_symbol["text-rotate"]),"text-padding":new Ue(Ft.layout_symbol["text-padding"]),"text-keep-upright":new Ue(Ft.layout_symbol["text-keep-upright"]),"text-transform":new ai(Ft.layout_symbol["text-transform"]),"text-offset":new ai(Ft.layout_symbol["text-offset"]),"text-allow-overlap":new Ue(Ft.layout_symbol["text-allow-overlap"]),"text-overlap":new Ue(Ft.layout_symbol["text-overlap"]),"text-ignore-placement":new Ue(Ft.layout_symbol["text-ignore-placement"]),"text-optional":new Ue(Ft.layout_symbol["text-optional"])})}};class Xw{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Be,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",Xw,{omit:["defaultValue"]});class c_ extends d{constructor(a){super(a,Ay)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const y=[];for(const S of f)y.indexOf(S)<0&&y.push(S);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,f,y){const S=this.layout.get(a).evaluate(u,{},f,y),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||Lh(T.value)||!S?S:function(A,R){return R.replace(/{([^{}]+)}/g,(z,O)=>A&&O in A?String(A[O]):"")}(u.properties,S)}createBucket(a){return new au(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of Ay.paint.overridableProperties){if(!c_.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),f=new Xw(u),y=new Dh(f,u.property.specification);let S=null;S=u.value.kind==="constant"||u.value.kind==="source"?new ol("source",y):new ll("composite",y,u.value.zoomStops),this.paint._values[a]=new ha(u.property,S,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&c_.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const f=a.get("text-field"),y=Ay.paint.properties[u];let S=!1;const T=A=>{for(const R of A)if(y.overrides&&y.overrides.hasOverride(R))return void(S=!0)};if(f.value.kind==="constant"&&f.value.value instanceof ei)T(f.value.value.sections);else if(f.value.kind==="source"){const A=z=>{S||(z instanceof Dn&&pi(z.value)===Me?T(z.value.sections):z instanceof Mh?T(z.sections):z.eachChild(A))},R=f.value;R._styleExpression&&A(R._styleExpression.expression)}return S}}let $w;var MP={get paint(){return $w=$w||new M({"background-color":new Ue(Ft.paint_background["background-color"]),"background-pattern":new qh(Ft.paint_background["background-pattern"]),"background-opacity":new Ue(Ft.paint_background["background-opacity"])})}};class SP extends d{constructor(a){super(a,MP)}}let Zw;var TP={get paint(){return Zw=Zw||new M({"raster-opacity":new Ue(Ft.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ue(Ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ue(Ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ue(Ft.paint_raster["raster-brightness-max"]),"raster-saturation":new Ue(Ft.paint_raster["raster-saturation"]),"raster-contrast":new Ue(Ft.paint_raster["raster-contrast"]),"raster-resampling":new Ue(Ft.paint_raster["raster-resampling"]),"raster-fade-duration":new Ue(Ft.paint_raster["raster-fade-duration"])})}};class EP extends d{constructor(a){super(a,TP)}}class AP extends d{constructor(a){super(a,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class CP{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Cy=63710088e-1;class Tl{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tl(Y(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,f=this.lat*u,y=a.lat*u,S=Math.sin(f)*Math.sin(y)+Math.cos(f)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return Cy*Math.acos(Math.min(S,1))}static convert(a){if(a instanceof Tl)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Tl(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Tl(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Yw=2*Math.PI*Cy;function Kw(h){return Yw*Math.cos(h*Math.PI/180)}function Jw(h){return(180+h)/360}function Qw(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function tM(h,a){return h/Kw(a)}function Py(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Ff{constructor(a,u,f=0){this.x=+a,this.y=+u,this.z=+f}static fromLngLat(a,u=0){const f=Tl.convert(a);return new Ff(Jw(f.lng),Qw(f.lat),tM(u,f.lat))}toLngLat(){return new Tl(360*this.x-180,Py(this.y))}toAltitude(){return this.z*Kw(Py(this.y))}meterInMercatorCoordinateUnits(){return 1/Yw*(a=Py(this.y),1/Math.cos(a*Math.PI/180));var a}}function eM(h,a,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[h*f-2*Math.PI*6378137/2,a*f-2*Math.PI*6378137/2]}class Iy{constructor(a,u,f){if(!function(y,S,T){return!(y<0||y>25||T<0||T>=Math.pow(2,y)||S<0||S>=Math.pow(2,y))}(a,u,f))throw new Error(`x=${u}, y=${f}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=f,this.key=zf(0,a,a,u,f)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,f){const y=(T=this.y,A=this.z,R=eM(256*(S=this.x),256*(T=Math.pow(2,A)-T-1),A),z=eM(256*(S+1),256*(T+1),A),R[0]+","+R[1]+","+z[0]+","+z[1]);var S,T,A,R,z;const O=function(G,$,Q){let et,at="";for(let ft=G;ft>0;ft--)et=1<<ft-1,at+=($&et?1:0)+(Q&et?2:0);return at}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new v((a.x*u-this.x)*Vn,(a.y*u-this.y)*Vn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iM{constructor(a,u){this.wrap=a,this.canonical=u,this.key=zf(a,u.z,u.z,u.x,u.y)}}class qr{constructor(a,u,f,y,S){if(a<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${f}`);this.overscaledZ=a,this.wrap=u,this.canonical=new Iy(f,+y,+S),this.key=zf(u,a,f,y,S)}clone(){return new qr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new qr(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qr(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?zf(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):zf(this.wrap*+u,a,a,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new qr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,y=2*this.canonical.y;return[new qr(u,this.wrap,u,f,y),new qr(u,this.wrap,u,f+1,y),new qr(u,this.wrap,u,f,y+1),new qr(u,this.wrap,u,f+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new qr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new qr(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iM(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new Ff(a.x-this.wrap,a.y))}}function zf(h,a,u,f,y){(h*=2)<0&&(h=-1*h-1);const S=1<<u;return(S*S*h+S*y+f).toString(36)+u.toString(36)+a.toString(36)}De("CanonicalTileID",Iy),De("OverscaledTileID",qr,{omit:["posMatrix"]});class nM{constructor(a,u,f,y=1,S=1,T=1,A=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void wt(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=S,this.blueFactor=T,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<R;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(R,z)]=this.data[this._idx(R-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,R)]=this.data[this._idx(z,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<R;z++)for(let O=0;O<R;O++){const G=this.get(z,O);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(a,u){const f=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(f[y],f[y+1],f[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)}unpack(a,u,f){return a*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Wr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,S=u*this.dim+this.dim,T=f*this.dim,A=f*this.dim+this.dim;switch(u){case-1:y=S-1;break;case 1:S=y+1}switch(f){case-1:T=A-1;break;case 1:A=T+1}const R=-u*this.dim,z=-f*this.dim;for(let O=T;O<A;O++)for(let G=y;G<S;G++)this.data[this._idx(G,O)]=a.data[this._idx(G+R,O+z)]}}De("DEMData",nM);class sM{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const f=a[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class rM{constructor(a,u,f,y,S){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=f,a._y=y,this.properties=a.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a}}class aM{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new ul(Vn,16,0),this.grid3D=new ul(Vn,16,0),this.featureIndexArray=new Es,this.promoteId=u}insert(a,u,f,y,S,T){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,y,S);const R=T?this.grid3D:this.grid;for(let z=0;z<u.length;z++){const O=u[z],G=[1/0,1/0,-1/0,-1/0];for(let $=0;$<O.length;$++){const Q=O[$];G[0]=Math.min(G[0],Q.x),G[1]=Math.min(G[1],Q.y),G[2]=Math.max(G[2],Q.x),G[3]=Math.max(G[3],Q.y)}G[0]<Vn&&G[1]<Vn&&G[2]>=0&&G[3]>=0&&R.insert(A,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wl.VectorTile(new yy(this.rawTileData)).layers,this.sourceLayerCoder=new sM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,u,f,y){this.loadVTLayers();const S=a.params||{},T=Vn/a.tileSize/a.scale,A=tf(S.filter),R=a.queryGeometry,z=a.queryPadding*T,O=lM(R),G=this.grid.query(O.minX-z,O.minY-z,O.maxX+z,O.maxY+z),$=lM(a.cameraQueryGeometry),Q=this.grid3D.query($.minX-z,$.minY-z,$.maxX+z,$.maxY+z,(ft,gt,Ot,Tt)=>function(kt,$t,oe,Ae,ii){for(const ve of kt)if($t<=ve.x&&oe<=ve.y&&Ae>=ve.x&&ii>=ve.y)return!0;const Se=[new v($t,oe),new v($t,ii),new v(Ae,ii),new v(Ae,oe)];if(kt.length>2){for(const ve of Se)if(Qh(kt,ve))return!0}for(let ve=0;ve<kt.length-1;ve++)if(lC(kt[ve],kt[ve+1],Se))return!0;return!1}(a.cameraQueryGeometry,ft-z,gt-z,Ot+z,Tt+z));for(const ft of Q)G.push(ft);G.sort(PP);const et={};let at;for(let ft=0;ft<G.length;ft++){const gt=G[ft];if(gt===at)continue;at=gt;const Ot=this.featureIndexArray.get(gt);let Tt=null;this.loadMatchingFeature(et,Ot.bucketIndex,Ot.sourceLayerIndex,Ot.featureIndex,A,S.layers,S.availableImages,u,f,y,(kt,$t,oe)=>(Tt||(Tt=Pc(kt)),$t.queryIntersectsFeature(R,kt,oe,Tt,this.z,a.transform,T,a.pixelPosMatrix)))}return et}loadMatchingFeature(a,u,f,y,S,T,A,R,z,O,G){const $=this.bucketLayerIDs[u];if(T&&!function(ft,gt){for(let Ot=0;Ot<ft.length;Ot++)if(gt.indexOf(ft[Ot])>=0)return!0;return!1}(T,$))return;const Q=this.sourceLayerCoder.decode(f),et=this.vtLayers[Q].feature(y);if(S.needGeometry){const ft=Ic(et,!0);if(!S.filter(new un(this.tileID.overscaledZ),ft,this.tileID.canonical))return}else if(!S.filter(new un(this.tileID.overscaledZ),et))return;const at=this.getId(et,Q);for(let ft=0;ft<$.length;ft++){const gt=$[ft];if(T&&T.indexOf(gt)<0)continue;const Ot=R[gt];if(!Ot)continue;let Tt={};at&&O&&(Tt=O.getState(Ot.sourceLayer||"_geojsonTileLayer",at));const kt=K({},z[gt]);kt.paint=oM(kt.paint,Ot.paint,et,Tt,A),kt.layout=oM(kt.layout,Ot.layout,et,Tt,A);const $t=!G||G(et,Ot,Tt);if(!$t)continue;const oe=new rM(et,this.z,this.x,this.y,at);oe.layer=kt;let Ae=a[gt];Ae===void 0&&(Ae=a[gt]=[]),Ae.push({featureIndex:y,feature:oe,intersectionZ:$t})}}lookupSymbolFeatures(a,u,f,y,S,T,A,R){const z={};this.loadVTLayers();const O=tf(S);for(const G of a)this.loadMatchingFeature(z,f,y,G,O,T,A,R,u);return z}hasLayer(a){for(const u of this.bucketLayerIDs)for(const f of u)if(a===f)return!0;return!1}getId(a,u){let f=a.id;return this.promoteId&&(f=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function oM(h,a,u,f,y){return q(h,(S,T)=>{const A=a instanceof Tc?a.get(T):null;return A&&A.evaluate?A.evaluate(u,f,y):A})}function lM(h){let a=1/0,u=1/0,f=-1/0,y=-1/0;for(const S of h)a=Math.min(a,S.x),u=Math.min(u,S.y),f=Math.max(f,S.x),y=Math.max(y,S.y);return{minX:a,minY:u,maxX:f,maxY:y}}function PP(h,a){return a-h}function cM(h,a,u,f,y){const S=[];for(let T=0;T<h.length;T++){const A=h[T];let R;for(let z=0;z<A.length-1;z++){let O=A[z],G=A[z+1];O.x<a&&G.x<a||(O.x<a?O=new v(a,O.y+(a-O.x)/(G.x-O.x)*(G.y-O.y))._round():G.x<a&&(G=new v(a,O.y+(a-O.x)/(G.x-O.x)*(G.y-O.y))._round()),O.y<u&&G.y<u||(O.y<u?O=new v(O.x+(u-O.y)/(G.y-O.y)*(G.x-O.x),u)._round():G.y<u&&(G=new v(O.x+(u-O.y)/(G.y-O.y)*(G.x-O.x),u)._round()),O.x>=f&&G.x>=f||(O.x>=f?O=new v(f,O.y+(f-O.x)/(G.x-O.x)*(G.y-O.y))._round():G.x>=f&&(G=new v(f,O.y+(f-O.x)/(G.x-O.x)*(G.y-O.y))._round()),O.y>=y&&G.y>=y||(O.y>=y?O=new v(O.x+(y-O.y)/(G.y-O.y)*(G.x-O.x),y)._round():G.y>=y&&(G=new v(O.x+(y-O.y)/(G.y-O.y)*(G.x-O.x),y)._round()),R&&O.equals(R[R.length-1])||(R=[O],S.push(R)),R.push(G)))))}}return S}De("FeatureIndex",aM,{omit:["rawTileData","sourceLayerCoder"]});class El extends v{constructor(a,u,f,y){super(a,u),this.angle=f,y!==void 0&&(this.segment=y)}clone(){return new El(this.x,this.y,this.angle,this.segment)}}function hM(h,a,u,f,y){if(a.segment===void 0||u===0)return!0;let S=a,T=a.segment+1,A=0;for(;A>-u/2;){if(T--,T<0)return!1;A-=h[T].dist(S),S=h[T]}A+=h[T].dist(h[T+1]),T++;const R=[];let z=0;for(;A<u/2;){const O=h[T],G=h[T+1];if(!G)return!1;let $=h[T-1].angleTo(O)-O.angleTo(G);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:A,angleDelta:$}),z+=$;A-R[0].distance>f;)z-=R.shift().angleDelta;if(z>y)return!1;T++,A+=O.dist(G)}return!0}function uM(h){let a=0;for(let u=0;u<h.length-1;u++)a+=h[u].dist(h[u+1]);return a}function dM(h,a,u){return h?.6*a*u:0}function fM(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function IP(h,a,u,f,y,S){const T=dM(u,y,S),A=fM(u,f)*S;let R=0;const z=uM(h)/2;for(let O=0;O<h.length-1;O++){const G=h[O],$=h[O+1],Q=G.dist($);if(R+Q>z){const et=(z-R)/Q,at=zs.number(G.x,$.x,et),ft=zs.number(G.y,$.y,et),gt=new El(at,ft,$.angleTo(G),O);return gt._round(),!T||hM(h,gt,A,T,a)?gt:void 0}R+=Q}}function RP(h,a,u,f,y,S,T,A,R){const z=dM(f,S,T),O=fM(f,y),G=O*T,$=h[0].x===0||h[0].x===R||h[0].y===0||h[0].y===R;return a-G<a/4&&(a=G+a/4),pM(h,$?a/2*A%a:(O/2+2*S)*T*A%a,a,z,u,G,$,!1,R)}function pM(h,a,u,f,y,S,T,A,R){const z=S/2,O=uM(h);let G=0,$=a-u,Q=[];for(let et=0;et<h.length-1;et++){const at=h[et],ft=h[et+1],gt=at.dist(ft),Ot=ft.angleTo(at);for(;$+u<G+gt;){$+=u;const Tt=($-G)/gt,kt=zs.number(at.x,ft.x,Tt),$t=zs.number(at.y,ft.y,Tt);if(kt>=0&&kt<R&&$t>=0&&$t<R&&$-z>=0&&$+z<=O){const oe=new El(kt,$t,Ot,et);oe._round(),f&&!hM(h,oe,S,f,y)||Q.push(oe)}}G+=gt}return A||Q.length||T||(Q=pM(h,G/2,u,f,y,S,T,!0,R)),Q}De("Anchor",El);const ou=nr;function mM(h,a,u,f){const y=[],S=h.image,T=S.pixelRatio,A=S.paddedRect.w-2*ou,R=S.paddedRect.h-2*ou;let z={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const O=S.stretchX||[[0,A]],G=S.stretchY||[[0,R]],$=(Qt,We)=>Qt+We[1]-We[0],Q=O.reduce($,0),et=G.reduce($,0),at=A-Q,ft=R-et;let gt=0,Ot=Q,Tt=0,kt=et,$t=0,oe=at,Ae=0,ii=ft;if(S.content&&f){const Qt=S.content,We=Qt[2]-Qt[0],Ge=Qt[3]-Qt[1];(S.textFitWidth||S.textFitHeight)&&(z=Gw(h)),gt=h_(O,0,Qt[0]),Tt=h_(G,0,Qt[1]),Ot=h_(O,Qt[0],Qt[2]),kt=h_(G,Qt[1],Qt[3]),$t=Qt[0]-gt,Ae=Qt[1]-Tt,oe=We-Ot,ii=Ge-kt}const Se=z.x1,ve=z.y1,je=z.x2-Se,Fe=z.y2-ve,Pe=(Qt,We,Ge,fi)=>{const nn=u_(Qt.stretch-gt,Ot,je,Se),Ji=d_(Qt.fixed-$t,oe,Qt.stretch,Q),Yn=u_(We.stretch-Tt,kt,Fe,ve),da=d_(We.fixed-Ae,ii,We.stretch,et),_s=u_(Ge.stretch-gt,Ot,je,Se),Kn=d_(Ge.fixed-$t,oe,Ge.stretch,Q),Us=u_(fi.stretch-Tt,kt,Fe,ve),Vs=d_(fi.fixed-Ae,ii,fi.stretch,et),Gs=new v(nn,Yn),In=new v(_s,Yn),Jn=new v(_s,Us),Cs=new v(nn,Us),gs=new v(Ji/T,da/T),Hs=new v(Kn/T,Vs/T),ys=a*Math.PI/180;if(ys){const Hi=Math.sin(ys),cn=Math.cos(ys),mn=[cn,-Hi,Hi,cn];Gs._matMult(mn),In._matMult(mn),Cs._matMult(mn),Jn._matMult(mn)}const Xr=Qt.stretch+Qt.fixed,sr=We.stretch+We.fixed;return{tl:Gs,tr:In,bl:Cs,br:Jn,tex:{x:S.paddedRect.x+ou+Xr,y:S.paddedRect.y+ou+sr,w:Ge.stretch+Ge.fixed-Xr,h:fi.stretch+fi.fixed-sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gs,pixelOffsetBR:Hs,minFontScaleX:oe/T/je,minFontScaleY:ii/T/Fe,isSDF:u}};if(f&&(S.stretchX||S.stretchY)){const Qt=_M(O,at,Q),We=_M(G,ft,et);for(let Ge=0;Ge<Qt.length-1;Ge++){const fi=Qt[Ge],nn=Qt[Ge+1];for(let Ji=0;Ji<We.length-1;Ji++)y.push(Pe(fi,We[Ji],nn,We[Ji+1]))}}else y.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:R+1}));return y}function h_(h,a,u){let f=0;for(const y of h)f+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return f}function _M(h,a,u){const f=[{fixed:-ou,stretch:0}];for(const[y,S]of h){const T=f[f.length-1];f.push({fixed:y-T.stretch,stretch:T.stretch}),f.push({fixed:y-T.stretch,stretch:T.stretch+(S-y)})}return f.push({fixed:a+ou,stretch:u}),f}function u_(h,a,u,f){return h/a*u+f}function d_(h,a,u,f){return h-a*u/f}class f_{constructor(a,u,f,y,S,T,A,R,z,O){var G;if(this.boxStartIndex=a.length,z){let $=T.top,Q=T.bottom;const et=T.collisionPadding;et&&($-=et[1],Q+=et[3]);let at=Q-$;at>0&&(at=Math.max(10,at),this.circleDiameter=at)}else{const $=!((G=T.image)===null||G===void 0)&&G.content&&(T.image.textFitWidth||T.image.textFitHeight)?Gw(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};$.y1=$.y1*A-R[0],$.y2=$.y2*A+R[2],$.x1=$.x1*A-R[3],$.x2=$.x2*A+R[1];const Q=T.collisionPadding;if(Q&&($.x1-=Q[0]*A,$.y1-=Q[1]*A,$.x2+=Q[2]*A,$.y2+=Q[3]*A),O){const et=new v($.x1,$.y1),at=new v($.x2,$.y1),ft=new v($.x1,$.y2),gt=new v($.x2,$.y2),Ot=O*Math.PI/180;et._rotate(Ot),at._rotate(Ot),ft._rotate(Ot),gt._rotate(Ot),$.x1=Math.min(et.x,at.x,ft.x,gt.x),$.x2=Math.max(et.x,at.x,ft.x,gt.x),$.y1=Math.min(et.y,at.y,ft.y,gt.y),$.y2=Math.max(et.y,at.y,ft.y,gt.y)}a.emplaceBack(u.x,u.y,$.x1,$.y1,$.x2,$.y2,f,y,S)}this.boxEndIndex=a.length}}class DP{constructor(a=[],u=(f,y)=>f<y?-1:f>y?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:f}=this,y=u[a];for(;a>0;){const S=a-1>>1,T=u[S];if(f(y,T)>=0)break;u[a]=T,a=S}u[a]=y}_down(a){const{data:u,compare:f}=this,y=this.length>>1,S=u[a];for(;a<y;){let T=1+(a<<1);const A=T+1;if(A<this.length&&f(u[A],u[T])<0&&(T=A),f(u[T],S)>=0)break;u[a]=u[T],a=T}u[a]=S}}function LP(h,a=1,u=!1){let f=1/0,y=1/0,S=-1/0,T=-1/0;const A=h[0];for(let Q=0;Q<A.length;Q++){const et=A[Q];(!Q||et.x<f)&&(f=et.x),(!Q||et.y<y)&&(y=et.y),(!Q||et.x>S)&&(S=et.x),(!Q||et.y>T)&&(T=et.y)}const R=Math.min(S-f,T-y);let z=R/2;const O=new DP([],kP);if(R===0)return new v(f,y);for(let Q=f;Q<S;Q+=R)for(let et=y;et<T;et+=R)O.push(new lu(Q+z,et+z,z,h));let G=function(Q){let et=0,at=0,ft=0;const gt=Q[0];for(let Ot=0,Tt=gt.length,kt=Tt-1;Ot<Tt;kt=Ot++){const $t=gt[Ot],oe=gt[kt],Ae=$t.x*oe.y-oe.x*$t.y;at+=($t.x+oe.x)*Ae,ft+=($t.y+oe.y)*Ae,et+=3*Ae}return new lu(at/et,ft/et,0,Q)}(h),$=O.length;for(;O.length;){const Q=O.pop();(Q.d>G.d||!G.d)&&(G=Q,u&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,$)),Q.max-G.d<=a||(z=Q.h/2,O.push(new lu(Q.p.x-z,Q.p.y-z,z,h)),O.push(new lu(Q.p.x+z,Q.p.y-z,z,h)),O.push(new lu(Q.p.x-z,Q.p.y+z,z,h)),O.push(new lu(Q.p.x+z,Q.p.y+z,z,h)),$+=4)}return u&&(console.log(`num probes: ${$}`),console.log(`best distance: ${G.d}`)),G.p}function kP(h,a){return a.max-h.max}function lu(h,a,u,f){this.p=new v(h,a),this.h=u,this.d=function(y,S){let T=!1,A=1/0;for(let R=0;R<S.length;R++){const z=S[R];for(let O=0,G=z.length,$=G-1;O<G;$=O++){const Q=z[O],et=z[$];Q.y>y.y!=et.y>y.y&&y.x<(et.x-Q.x)*(y.y-Q.y)/(et.y-Q.y)+Q.x&&(T=!T),A=Math.min(A,Q1(y,Q,et))}}return(T?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var ms;c.aq=void 0,(ms=c.aq||(c.aq={}))[ms.center=1]="center",ms[ms.left=2]="left",ms[ms.right=3]="right",ms[ms.top=4]="top",ms[ms.bottom=5]="bottom",ms[ms["top-left"]=6]="top-left",ms[ms["top-right"]=7]="top-right",ms[ms["bottom-left"]=8]="bottom-left",ms[ms["bottom-right"]=9]="bottom-right";const Al=7,Ry=Number.POSITIVE_INFINITY;function gM(h,a){return a[1]!==Ry?function(u,f,y){let S=0,T=0;switch(f=Math.abs(f),y=Math.abs(y),u){case"top-right":case"top-left":case"top":T=y-Al;break;case"bottom-right":case"bottom-left":case"bottom":T=-y+Al}switch(u){case"top-right":case"bottom-right":case"right":S=-f;break;case"top-left":case"bottom-left":case"left":S=f}return[S,T]}(h,a[0],a[1]):function(u,f){let y=0,S=0;f<0&&(f=0);const T=f/Math.SQRT2;switch(u){case"top-right":case"top-left":S=T-Al;break;case"bottom-right":case"bottom-left":S=-T+Al;break;case"bottom":S=-f+Al;break;case"top":S=f-Al}switch(u){case"top-right":case"bottom-right":y=-T;break;case"top-left":case"bottom-left":y=T;break;case"left":y=f;break;case"right":y=-f}return[y,S]}(h,a[0])}function yM(h,a,u){var f;const y=h.layout,S=(f=y.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(a,{},u);if(S){const A=S.values,R=[];for(let z=0;z<A.length;z+=2){const O=R[z]=A[z],G=A[z+1].map($=>$*Wn);O.startsWith("top")?G[1]-=Al:O.startsWith("bottom")&&(G[1]+=Al),R[z+1]=G}return new wi(R)}const T=y.get("text-variable-anchor");if(T){let A;A=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*Wn,Ry]:y.get("text-offset").evaluate(a,{},u).map(z=>z*Wn);const R=[];for(const z of T)R.push(z,gM(z,A));return new wi(R)}return null}function Dy(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FP(h,a,u,f,y,S,T,A,R,z,O){let G=S.textMaxSize.evaluate(a,{});G===void 0&&(G=T);const $=h.layers[0].layout,Q=$.get("icon-offset").evaluate(a,{},O),et=vM(u.horizontal),at=T/24,ft=h.tilePixelRatio*at,gt=h.tilePixelRatio*G/24,Ot=h.tilePixelRatio*A,Tt=h.tilePixelRatio*$.get("symbol-spacing"),kt=$.get("text-padding")*h.tilePixelRatio,$t=function(Qt,We,Ge,fi=1){const nn=Qt.get("icon-padding").evaluate(We,{},Ge),Ji=nn&&nn.values;return[Ji[0]*fi,Ji[1]*fi,Ji[2]*fi,Ji[3]*fi]}($,a,O,h.tilePixelRatio),oe=$.get("text-max-angle")/180*Math.PI,Ae=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",ii=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Se=$.get("symbol-placement"),ve=Tt/2,je=$.get("icon-text-fit");let Fe;f&&je!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(Fe=Hw(f,u.vertical,je,$.get("icon-text-fit-padding"),Q,at)),et&&(f=Hw(f,et,je,$.get("icon-text-fit-padding"),Q,at)));const Pe=(Qt,We)=>{We.x<0||We.x>=Vn||We.y<0||We.y>=Vn||function(Ge,fi,nn,Ji,Yn,da,_s,Kn,Us,Vs,Gs,In,Jn,Cs,gs,Hs,ys,Xr,sr,Hi,cn,mn,Ar,Mn,cu){const Xa=Ge.addToLineVertexArray(fi,nn);let $a,fa,$r,rs,Eo=0,Nf=0,SM=0,TM=0,Uy=-1,Vy=-1;const Ao={};let EM=Zh("");if(Ge.allowVerticalPlacement&&Ji.vertical){const Ps=Kn.layout.get("text-rotate").evaluate(cn,{},Mn)+90;$r=new f_(Us,fi,Vs,Gs,In,Ji.vertical,Jn,Cs,gs,Ps),_s&&(rs=new f_(Us,fi,Vs,Gs,In,_s,ys,Xr,gs,Ps))}if(Yn){const Ps=Kn.layout.get("icon-rotate").evaluate(cn,{}),Zr=Kn.layout.get("icon-text-fit")!=="none",Dc=mM(Yn,Ps,Ar,Zr),Da=_s?mM(_s,Ps,Ar,Zr):void 0;fa=new f_(Us,fi,Vs,Gs,In,Yn,ys,Xr,!1,Ps),Eo=4*Dc.length;const Lc=Ge.iconSizeData;let Za=null;Lc.kind==="source"?(Za=[qa*Kn.layout.get("icon-size").evaluate(cn,{})],Za[0]>Sl&&wt(`${Ge.layerIds[0]}: Value for "icon-size" is >= ${kf}. Reduce your "icon-size".`)):Lc.kind==="composite"&&(Za=[qa*mn.compositeIconSizes[0].evaluate(cn,{},Mn),qa*mn.compositeIconSizes[1].evaluate(cn,{},Mn)],(Za[0]>Sl||Za[1]>Sl)&&wt(`${Ge.layerIds[0]}: Value for "icon-size" is >= ${kf}. Reduce your "icon-size".`)),Ge.addSymbols(Ge.icon,Dc,Za,Hi,sr,cn,c.ah.none,fi,Xa.lineStartIndex,Xa.lineLength,-1,Mn),Uy=Ge.icon.placedSymbolArray.length-1,Da&&(Nf=4*Da.length,Ge.addSymbols(Ge.icon,Da,Za,Hi,sr,cn,c.ah.vertical,fi,Xa.lineStartIndex,Xa.lineLength,-1,Mn),Vy=Ge.icon.placedSymbolArray.length-1)}const AM=Object.keys(Ji.horizontal);for(const Ps of AM){const Zr=Ji.horizontal[Ps];if(!$a){EM=Zh(Zr.text);const Da=Kn.layout.get("text-rotate").evaluate(cn,{},Mn);$a=new f_(Us,fi,Vs,Gs,In,Zr,Jn,Cs,gs,Da)}const Dc=Zr.positionedLines.length===1;if(SM+=xM(Ge,fi,Zr,da,Kn,gs,cn,Hs,Xa,Ji.vertical?c.ah.horizontal:c.ah.horizontalOnly,Dc?AM:[Ps],Ao,Uy,mn,Mn),Dc)break}Ji.vertical&&(TM+=xM(Ge,fi,Ji.vertical,da,Kn,gs,cn,Hs,Xa,c.ah.vertical,["vertical"],Ao,Vy,mn,Mn));const BP=$a?$a.boxStartIndex:Ge.collisionBoxArray.length,NP=$a?$a.boxEndIndex:Ge.collisionBoxArray.length,UP=$r?$r.boxStartIndex:Ge.collisionBoxArray.length,VP=$r?$r.boxEndIndex:Ge.collisionBoxArray.length,GP=fa?fa.boxStartIndex:Ge.collisionBoxArray.length,HP=fa?fa.boxEndIndex:Ge.collisionBoxArray.length,jP=rs?rs.boxStartIndex:Ge.collisionBoxArray.length,WP=rs?rs.boxEndIndex:Ge.collisionBoxArray.length;let Ra=-1;const m_=(Ps,Zr)=>Ps&&Ps.circleDiameter?Math.max(Ps.circleDiameter,Zr):Zr;Ra=m_($a,Ra),Ra=m_($r,Ra),Ra=m_(fa,Ra),Ra=m_(rs,Ra);const CM=Ra>-1?1:0;CM&&(Ra*=cu/Wn),Ge.glyphOffsetArray.length>=au.MAX_GLYPHS&&wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&Ge.addToSortKeyRanges(Ge.symbolInstances.length,cn.sortKey);const qP=yM(Kn,cn,Mn),[XP,$P]=function(Ps,Zr){const Dc=Ps.length,Da=Zr==null?void 0:Zr.values;if((Da==null?void 0:Da.length)>0)for(let Lc=0;Lc<Da.length;Lc+=2){const Za=Da[Lc+1];Ps.emplaceBack(c.aq[Da[Lc]],Za[0],Za[1])}return[Dc,Ps.length]}(Ge.textAnchorOffsets,qP);Ge.symbolInstances.emplaceBack(fi.x,fi.y,Ao.right>=0?Ao.right:-1,Ao.center>=0?Ao.center:-1,Ao.left>=0?Ao.left:-1,Ao.vertical||-1,Uy,Vy,EM,BP,NP,UP,VP,GP,HP,jP,WP,Vs,SM,TM,Eo,Nf,CM,0,Jn,Ra,XP,$P)}(h,We,Qt,u,f,y,Fe,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,ft,[kt,kt,kt,kt],Ae,R,Ot,$t,ii,Q,a,S,z,O,T)};if(Se==="line")for(const Qt of cM(a.geometry,0,0,Vn,Vn)){const We=RP(Qt,Tt,oe,u.vertical||et,f,24,gt,h.overscaling,Vn);for(const Ge of We)et&&zP(h,et.text,ve,Ge)||Pe(Qt,Ge)}else if(Se==="line-center"){for(const Qt of a.geometry)if(Qt.length>1){const We=IP(Qt,oe,u.vertical||et,f,24,gt);We&&Pe(Qt,We)}}else if(a.type==="Polygon")for(const Qt of Th(a.geometry,0)){const We=LP(Qt,16);Pe(Qt[0],new El(We.x,We.y,0))}else if(a.type==="LineString")for(const Qt of a.geometry)Pe(Qt,new El(Qt[0].x,Qt[0].y,0));else if(a.type==="Point")for(const Qt of a.geometry)for(const We of Qt)Pe([We],new El(We.x,We.y,0))}function xM(h,a,u,f,y,S,T,A,R,z,O,G,$,Q,et){const at=function(Ot,Tt,kt,$t,oe,Ae,ii,Se){const ve=$t.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,je=[];for(const Fe of Tt.positionedLines)for(const Pe of Fe.positionedGlyphs){if(!Pe.rect)continue;const Qt=Pe.rect||{};let We=Fw+1,Ge=!0,fi=1,nn=0;const Ji=(oe||Se)&&Pe.vertical,Yn=Pe.metrics.advance*Pe.scale/2;if(Se&&Tt.verticalizable&&(nn=Fe.lineOffset/2-(Pe.imageName?-(Wn-Pe.metrics.width*Pe.scale)/2:(Pe.scale-1)*Wn)),Pe.imageName){const Hi=ii[Pe.imageName];Ge=Hi.sdf,fi=Hi.pixelRatio,We=nr/fi}const da=oe?[Pe.x+Yn,Pe.y]:[0,0];let _s=oe?[0,0]:[Pe.x+Yn+kt[0],Pe.y+kt[1]-nn],Kn=[0,0];Ji&&(Kn=_s,_s=[0,0]);const Us=Pe.metrics.isDoubleResolution?2:1,Vs=(Pe.metrics.left-We)*Pe.scale-Yn+_s[0],Gs=(-Pe.metrics.top-We)*Pe.scale+_s[1],In=Vs+Qt.w/Us*Pe.scale/fi,Jn=Gs+Qt.h/Us*Pe.scale/fi,Cs=new v(Vs,Gs),gs=new v(In,Gs),Hs=new v(Vs,Jn),ys=new v(In,Jn);if(Ji){const Hi=new v(-Yn,Yn-Df),cn=-Math.PI/2,mn=Wn/2-Yn,Ar=new v(5-Df-mn,-(Pe.imageName?mn:0)),Mn=new v(...Kn);Cs._rotateAround(cn,Hi)._add(Ar)._add(Mn),gs._rotateAround(cn,Hi)._add(Ar)._add(Mn),Hs._rotateAround(cn,Hi)._add(Ar)._add(Mn),ys._rotateAround(cn,Hi)._add(Ar)._add(Mn)}if(ve){const Hi=Math.sin(ve),cn=Math.cos(ve),mn=[cn,-Hi,Hi,cn];Cs._matMult(mn),gs._matMult(mn),Hs._matMult(mn),ys._matMult(mn)}const Xr=new v(0,0),sr=new v(0,0);je.push({tl:Cs,tr:gs,bl:Hs,br:ys,tex:Qt,writingMode:Tt.writingMode,glyphOffset:da,sectionIndex:Pe.sectionIndex,isSDF:Ge,pixelOffsetTL:Xr,pixelOffsetBR:sr,minFontScaleX:0,minFontScaleY:0})}return je}(0,u,A,y,S,T,f,h.allowVerticalPlacement),ft=h.textSizeData;let gt=null;ft.kind==="source"?(gt=[qa*y.layout.get("text-size").evaluate(T,{})],gt[0]>Sl&&wt(`${h.layerIds[0]}: Value for "text-size" is >= ${kf}. Reduce your "text-size".`)):ft.kind==="composite"&&(gt=[qa*Q.compositeTextSizes[0].evaluate(T,{},et),qa*Q.compositeTextSizes[1].evaluate(T,{},et)],(gt[0]>Sl||gt[1]>Sl)&&wt(`${h.layerIds[0]}: Value for "text-size" is >= ${kf}. Reduce your "text-size".`)),h.addSymbols(h.text,at,gt,A,S,T,z,a,R.lineStartIndex,R.lineLength,$,et);for(const Ot of O)G[Ot]=h.text.placedSymbolArray.length-1;return 4*at.length}function vM(h){for(const a in h)return h[a];return null}function zP(h,a,u,f){const y=h.compareText;if(a in y){const S=y[a];for(let T=S.length-1;T>=0;T--)if(f.dist(S[T])<u)return!0}else y[a]=[];return y[a].push(f),!1}const bM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ly{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=f>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const S=bM[15&f];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[A]=new Uint32Array(a,4,1);return new Ly(A,T,S,a)}constructor(a,u=64,f=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const S=bM.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,A=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-A%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${f}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+A+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=a,this.coords[this._pos++]=u,f}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return ky(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,f,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:A}=this,R=[0,S.length-1,0],z=[];for(;R.length;){const O=R.pop()||0,G=R.pop()||0,$=R.pop()||0;if(G-$<=A){for(let ft=$;ft<=G;ft++){const gt=T[2*ft],Ot=T[2*ft+1];gt>=a&&gt<=f&&Ot>=u&&Ot<=y&&z.push(S[ft])}continue}const Q=$+G>>1,et=T[2*Q],at=T[2*Q+1];et>=a&&et<=f&&at>=u&&at<=y&&z.push(S[Q]),(O===0?a<=et:u<=at)&&(R.push($),R.push(Q-1),R.push(1-O)),(O===0?f>=et:y>=at)&&(R.push(Q+1),R.push(G),R.push(1-O))}return z}within(a,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:S,nodeSize:T}=this,A=[0,y.length-1,0],R=[],z=f*f;for(;A.length;){const O=A.pop()||0,G=A.pop()||0,$=A.pop()||0;if(G-$<=T){for(let ft=$;ft<=G;ft++)MM(S[2*ft],S[2*ft+1],a,u)<=z&&R.push(y[ft]);continue}const Q=$+G>>1,et=S[2*Q],at=S[2*Q+1];MM(et,at,a,u)<=z&&R.push(y[Q]),(O===0?a-f<=et:u-f<=at)&&(A.push($),A.push(Q-1),A.push(1-O)),(O===0?a+f>=et:u+f>=at)&&(A.push(Q+1),A.push(G),A.push(1-O))}return R}}function ky(h,a,u,f,y,S){if(y-f<=u)return;const T=f+y>>1;wM(h,a,T,f,y,S),ky(h,a,u,f,T-1,1-S),ky(h,a,u,T+1,y,1-S)}function wM(h,a,u,f,y,S){for(;y>f;){if(y-f>600){const z=y-f+1,O=u-f+1,G=Math.log(z),$=.5*Math.exp(2*G/3),Q=.5*Math.sqrt(G*$*(z-$)/z)*(O-z/2<0?-1:1);wM(h,a,u,Math.max(f,Math.floor(u-O*$/z+Q)),Math.min(y,Math.floor(u+(z-O)*$/z+Q)),S)}const T=a[2*u+S];let A=f,R=y;for(Of(h,a,f,u),a[2*y+S]>T&&Of(h,a,f,y);A<R;){for(Of(h,a,A,R),A++,R--;a[2*A+S]<T;)A++;for(;a[2*R+S]>T;)R--}a[2*f+S]===T?Of(h,a,f,R):(R++,Of(h,a,R,y)),R<=u&&(f=R+1),u<=R&&(y=R-1)}}function Of(h,a,u,f){Fy(h,u,f),Fy(a,2*u,2*f),Fy(a,2*u+1,2*f+1)}function Fy(h,a,u){const f=h[a];h[a]=h[u],h[u]=f}function MM(h,a,u,f){const y=h-u,S=a-f;return y*y+S*S}var zy;c.bg=void 0,(zy=c.bg||(c.bg={})).create="create",zy.load="load",zy.fullLoad="fullLoad";let p_=null,Bf=[];const Oy=1e3/60,By="loadTime",Ny="fullLoadTime",OP={mark(h){performance.mark(h)},frame(h){const a=h;p_!=null&&Bf.push(a-p_),p_=a},clearMetrics(){p_=null,Bf=[],performance.clearMeasures(By),performance.clearMeasures(Ny);for(const h in c.bg)performance.clearMarks(c.bg[h])},getPerformanceMetrics(){performance.measure(By,c.bg.create,c.bg.load),performance.measure(Ny,c.bg.create,c.bg.fullLoad);const h=performance.getEntriesByName(By)[0].duration,a=performance.getEntriesByName(Ny)[0].duration,u=Bf.length,f=1/(Bf.reduce((S,T)=>S+T,0)/u/1e3),y=Bf.filter(S=>S>Oy).reduce((S,T)=>S+(T-Oy)/Oy,0);return{loadTime:h,fullLoadTime:a,fps:f,percentDroppedFrames:y/(u+y)*100,totalFrames:u}}};c.$=class extends H{},c.A=tu,c.B=X0,c.C=function(h){if(Nt==null){const a=h.navigator?h.navigator.userAgent:null;Nt=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Nt},c.D=Ue,c.E=jn,c.F=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new CP(()=>this.process()),this.subscription=function(u,f,y,S){return u.addEventListener(f,y,!1),{unsubscribe:()=>{u.removeEventListener(f,y,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=Gt(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}sendAsync(h,a){return new Promise((u,f)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[y]={resolve:u,reject:f},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[y];const A={id:y,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const S=[],T=Object.assign(Object.assign({},h),{id:y,sourceMapId:this.mapId,origin:location.origin,data:dl(h.data,S)});this.target.postMessage(T,{transfer:S})})}receive(h){const a=h.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const f=this.abortControllers[u];return delete this.abortControllers[u],void(f&&f.abort())}if(Gt(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return o(this,void 0,void 0,function*(){if(a.type==="<response>"){const y=this.resolveRejects[h];return delete this.resolveRejects[h],y?void(a.error?y.reject(fl(a.error)):y.resolve(fl(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=fl(a.data),f=new AbortController;this.abortControllers[h]=f;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,f);this.completeTask(h,null,y)}catch(y){this.completeTask(h,y)}})}completeTask(h,a,u){const f=[];delete this.abortControllers[h];const y={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?dl(a):null,data:dl(u,f)};this.target.postMessage(y,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.G=qe,c.H=function(){var h=new tu(16);return tu!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.I=vy,c.J=function(h,a,u){var f,y,S,T,A,R,z,O,G,$,Q,et,at=u[0],ft=u[1],gt=u[2];return a===h?(h[12]=a[0]*at+a[4]*ft+a[8]*gt+a[12],h[13]=a[1]*at+a[5]*ft+a[9]*gt+a[13],h[14]=a[2]*at+a[6]*ft+a[10]*gt+a[14],h[15]=a[3]*at+a[7]*ft+a[11]*gt+a[15]):(y=a[1],S=a[2],T=a[3],A=a[4],R=a[5],z=a[6],O=a[7],G=a[8],$=a[9],Q=a[10],et=a[11],h[0]=f=a[0],h[1]=y,h[2]=S,h[3]=T,h[4]=A,h[5]=R,h[6]=z,h[7]=O,h[8]=G,h[9]=$,h[10]=Q,h[11]=et,h[12]=f*at+A*ft+G*gt+a[12],h[13]=y*at+R*ft+$*gt+a[13],h[14]=S*at+z*ft+Q*gt+a[14],h[15]=T*at+O*ft+et*gt+a[15]),h},c.K=function(h,a,u){var f=u[0],y=u[1],S=u[2];return h[0]=a[0]*f,h[1]=a[1]*f,h[2]=a[2]*f,h[3]=a[3]*f,h[4]=a[4]*y,h[5]=a[5]*y,h[6]=a[6]*y,h[7]=a[7]*y,h[8]=a[8]*S,h[9]=a[9]*S,h[10]=a[10]*S,h[11]=a[11]*S,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.L=nw,c.M=function(h,a){const u={};for(let f=0;f<a.length;f++){const y=a[f];y in h&&(u[y]=h[y])}return u},c.N=Tl,c.O=Jw,c.P=v,c.Q=Qw,c.R=Wr,c.S=qr,c.T=jh,c.U=I,c.V=V,c.W=me,c.X=Vn,c.Y=C,c.Z=Ff,c._=o,c.a=Jt,c.a$=function(h,a){var u=h[0],f=h[1],y=h[2],S=h[3],T=h[4],A=h[5],R=h[6],z=h[7],O=h[8],G=h[9],$=h[10],Q=h[11],et=h[12],at=h[13],ft=h[14],gt=h[15],Ot=a[0],Tt=a[1],kt=a[2],$t=a[3],oe=a[4],Ae=a[5],ii=a[6],Se=a[7],ve=a[8],je=a[9],Fe=a[10],Pe=a[11],Qt=a[12],We=a[13],Ge=a[14],fi=a[15];return Math.abs(u-Ot)<=Ns*Math.max(1,Math.abs(u),Math.abs(Ot))&&Math.abs(f-Tt)<=Ns*Math.max(1,Math.abs(f),Math.abs(Tt))&&Math.abs(y-kt)<=Ns*Math.max(1,Math.abs(y),Math.abs(kt))&&Math.abs(S-$t)<=Ns*Math.max(1,Math.abs(S),Math.abs($t))&&Math.abs(T-oe)<=Ns*Math.max(1,Math.abs(T),Math.abs(oe))&&Math.abs(A-Ae)<=Ns*Math.max(1,Math.abs(A),Math.abs(Ae))&&Math.abs(R-ii)<=Ns*Math.max(1,Math.abs(R),Math.abs(ii))&&Math.abs(z-Se)<=Ns*Math.max(1,Math.abs(z),Math.abs(Se))&&Math.abs(O-ve)<=Ns*Math.max(1,Math.abs(O),Math.abs(ve))&&Math.abs(G-je)<=Ns*Math.max(1,Math.abs(G),Math.abs(je))&&Math.abs($-Fe)<=Ns*Math.max(1,Math.abs($),Math.abs(Fe))&&Math.abs(Q-Pe)<=Ns*Math.max(1,Math.abs(Q),Math.abs(Pe))&&Math.abs(et-Qt)<=Ns*Math.max(1,Math.abs(et),Math.abs(Qt))&&Math.abs(at-We)<=Ns*Math.max(1,Math.abs(at),Math.abs(We))&&Math.abs(ft-Ge)<=Ns*Math.max(1,Math.abs(ft),Math.abs(Ge))&&Math.abs(gt-fi)<=Ns*Math.max(1,Math.abs(gt),Math.abs(fi))},c.a0=Oi,c.a1=Iy,c.a2=Ut,c.a3=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(u=>{a.onloadstart=()=>{u(a)};for(const f of h){const y=window.document.createElement("source");bi(f)||(a.crossOrigin="Anonymous"),y.src=f,a.appendChild(y)}})},c.a4=function(){return nt++},c.a5=Te,c.a6=au,c.a7=tf,c.a8=Ic,c.a9=rM,c.aA=function(h){if(h.type==="custom")return new AP(h);switch(h.type){case"background":return new SP(h);case"circle":return new uC(h);case"fill":return new CC(h);case"fill-extrusion":return new HC(h);case"heatmap":return new fC(h);case"hillshade":return new mC(h);case"line":return new KC(h);case"raster":return new EP(h);case"symbol":return new c_(h)}},c.aB=ct,c.aC=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let u=[];try{if(!ti(h.version,a.version))return[{command:"setStyle",args:[a]}];ti(h.center,a.center)||u.push({command:"setCenter",args:[a.center]}),ti(h.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),ti(h.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),ti(h.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),ti(h.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),ti(h.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),ti(h.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),ti(h.light,a.light)||u.push({command:"setLight",args:[a.light]}),ti(h.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),ti(h.sky,a.sky)||u.push({command:"setSky",args:[a.sky]}),ti(h.projection,a.projection)||u.push({command:"setProjection",args:[a.projection]});const f={},y=[];(function(T,A,R,z){let O;for(O in A=A||{},T=T||{})Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(A,O)||st(O,R,z));for(O in A)Object.prototype.hasOwnProperty.call(A,O)&&(Object.prototype.hasOwnProperty.call(T,O)?ti(T[O],A[O])||(T[O].type==="geojson"&&A[O].type==="geojson"&&re(T,A,O)?ke(R,{command:"setGeoJSONSourceData",args:[O,A[O].data]}):Ht(O,A,R,z)):mt(O,A,R))})(h.sources,a.sources,y,f);const S=[];h.layers&&h.layers.forEach(T=>{"source"in T&&f[T.source]?u.push({command:"removeLayer",args:[T.id]}):S.push(T)}),u=u.concat(y),function(T,A,R){A=A||[];const z=(T=T||[]).map(ie),O=A.map(ie),G=T.reduce($e,{}),$=A.reduce($e,{}),Q=z.slice(),et=Object.create(null);let at,ft,gt,Ot,Tt;for(let kt=0,$t=0;kt<z.length;kt++)at=z[kt],Object.prototype.hasOwnProperty.call($,at)?$t++:(ke(R,{command:"removeLayer",args:[at]}),Q.splice(Q.indexOf(at,$t),1));for(let kt=0,$t=0;kt<O.length;kt++)at=O[O.length-1-kt],Q[Q.length-1-kt]!==at&&(Object.prototype.hasOwnProperty.call(G,at)?(ke(R,{command:"removeLayer",args:[at]}),Q.splice(Q.lastIndexOf(at,Q.length-$t),1)):$t++,Ot=Q[Q.length-kt],ke(R,{command:"addLayer",args:[$[at],Ot]}),Q.splice(Q.length-kt,0,at),et[at]=!0);for(let kt=0;kt<O.length;kt++)if(at=O[kt],ft=G[at],gt=$[at],!et[at]&&!ti(ft,gt))if(ti(ft.source,gt.source)&&ti(ft["source-layer"],gt["source-layer"])&&ti(ft.type,gt.type)){for(Tt in ae(ft.layout,gt.layout,R,at,null,"setLayoutProperty"),ae(ft.paint,gt.paint,R,at,null,"setPaintProperty"),ti(ft.filter,gt.filter)||ke(R,{command:"setFilter",args:[at,gt.filter]}),ti(ft.minzoom,gt.minzoom)&&ti(ft.maxzoom,gt.maxzoom)||ke(R,{command:"setLayerZoomRange",args:[at,gt.minzoom,gt.maxzoom]}),ft)Object.prototype.hasOwnProperty.call(ft,Tt)&&Tt!=="layout"&&Tt!=="paint"&&Tt!=="filter"&&Tt!=="metadata"&&Tt!=="minzoom"&&Tt!=="maxzoom"&&(Tt.indexOf("paint.")===0?ae(ft[Tt],gt[Tt],R,at,Tt.slice(6),"setPaintProperty"):ti(ft[Tt],gt[Tt])||ke(R,{command:"setLayerProperty",args:[at,Tt,gt[Tt]]}));for(Tt in gt)Object.prototype.hasOwnProperty.call(gt,Tt)&&!Object.prototype.hasOwnProperty.call(ft,Tt)&&Tt!=="layout"&&Tt!=="paint"&&Tt!=="filter"&&Tt!=="metadata"&&Tt!=="minzoom"&&Tt!=="maxzoom"&&(Tt.indexOf("paint.")===0?ae(ft[Tt],gt[Tt],R,at,Tt.slice(6),"setPaintProperty"):ti(ft[Tt],gt[Tt])||ke(R,{command:"setLayerProperty",args:[at,Tt,gt[Tt]]}))}else ke(R,{command:"removeLayer",args:[at]}),Ot=Q[Q.lastIndexOf(at)+1],ke(R,{command:"addLayer",args:[gt,Ot]})}(S,a.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:"setStyle",args:[a]}]}return u},c.aD=function(h){const a=[],u=h.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},c.aE=function h(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let f=0;f<a.length;f++)if(!h(a[f],u[f]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const f in a)if(!h(a[f],u[f]))return!1;return!0}return a===u},c.aF=q,c.aG=J,c.aH=class extends Ac{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.aI=Ym,c.aJ=class extends Ac{constructor(h,a){super(h,a),this.current=nC}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.aK=q1,c.aL=X1,c.aM=ce,c.aN=class extends Ac{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.aO=class extends Ac{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.aP=function(h,a,u,f,y,S,T){var A=1/(a-u),R=1/(f-y),z=1/(S-T);return h[0]=-2*A,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*R,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*z,h[11]=0,h[12]=(a+u)*A,h[13]=(y+f)*R,h[14]=(T+S)*z,h[15]=1,h},c.aQ=hC,c.aR=class extends Ct{},c.aS=eP,c.aT=class extends Bt{},c.aU=ly,c.aV=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.aW=lw,c.aX=fs,c.aY=jr,c.aZ=class extends Ve{},c.a_=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.aa=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,y,S)=>{const T=y||S;return a[f]=!T||T.toLowerCase(),""}),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},c.ab=function(h,a){const u=[];for(const f in h)f in a||u.push(f);return u},c.ac=Z,c.ad=function(h,a,u){var f=Math.sin(u),y=Math.cos(u),S=a[0],T=a[1],A=a[2],R=a[3],z=a[4],O=a[5],G=a[6],$=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=S*y+z*f,h[1]=T*y+O*f,h[2]=A*y+G*f,h[3]=R*y+$*f,h[4]=z*y-S*f,h[5]=O*y-T*f,h[6]=G*y-A*f,h[7]=$*y-R*f,h},c.ae=function(h){var a=new tu(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.af=t_,c.ag=function(h,a){let u=0,f=0;if(h.kind==="constant")f=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:y,minZoom:S,maxZoom:T}=h,A=y?Z(Os.interpolationFactor(y,a,S,T),0,1):0;h.kind==="camera"?f=zs.number(h.minSize,h.maxSize,A):u=A}return{uSizeT:u,uSize:f}},c.ai=function(h,{uSize:a,uSizeT:u},{lowerSize:f,upperSize:y}){return h.kind==="source"?f/qa:h.kind==="composite"?zs.number(f/qa,y/qa,u):a},c.aj=Sy,c.ak=function(h,a,u,f){const y=a.y-h.y,S=a.x-h.x,T=f.y-u.y,A=f.x-u.x,R=T*S-A*y;if(R===0)return null;const z=(A*(h.y-u.y)-T*(h.x-u.x))/R;return new v(h.x+z*S,h.y+z*y)},c.al=cM,c.am=K1,c.an=ry,c.ao=function(h){let a=1/0,u=1/0,f=-1/0,y=-1/0;for(const S of h)a=Math.min(a,S.x),u=Math.min(u,S.y),f=Math.max(f,S.x),y=Math.max(y,S.y);return[a,u,f,y]},c.ap=Wn,c.ar=My,c.as=function(h,a){var u=a[0],f=a[1],y=a[2],S=a[3],T=a[4],A=a[5],R=a[6],z=a[7],O=a[8],G=a[9],$=a[10],Q=a[11],et=a[12],at=a[13],ft=a[14],gt=a[15],Ot=u*A-f*T,Tt=u*R-y*T,kt=u*z-S*T,$t=f*R-y*A,oe=f*z-S*A,Ae=y*z-S*R,ii=O*at-G*et,Se=O*ft-$*et,ve=O*gt-Q*et,je=G*ft-$*at,Fe=G*gt-Q*at,Pe=$*gt-Q*ft,Qt=Ot*Pe-Tt*Fe+kt*je+$t*ve-oe*Se+Ae*ii;return Qt?(h[0]=(A*Pe-R*Fe+z*je)*(Qt=1/Qt),h[1]=(y*Fe-f*Pe-S*je)*Qt,h[2]=(at*Ae-ft*oe+gt*$t)*Qt,h[3]=($*oe-G*Ae-Q*$t)*Qt,h[4]=(R*ve-T*Pe-z*Se)*Qt,h[5]=(u*Pe-y*ve+S*Se)*Qt,h[6]=(ft*kt-et*Ae-gt*Tt)*Qt,h[7]=(O*Ae-$*kt+Q*Tt)*Qt,h[8]=(T*Fe-A*ve+z*ii)*Qt,h[9]=(f*ve-u*Fe-S*ii)*Qt,h[10]=(et*oe-at*kt+gt*Ot)*Qt,h[11]=(G*kt-O*oe-Q*Ot)*Qt,h[12]=(A*Se-T*je-R*ii)*Qt,h[13]=(u*je-f*Se+y*ii)*Qt,h[14]=(at*Tt-et*$t-ft*Ot)*Qt,h[15]=(O*$t-G*Tt+$*Ot)*Qt,h):null},c.at=Dy,c.au=wy,c.av=Ly,c.aw=function(){const h={},a=Ft.$version;for(const u in Ft.$root){const f=Ft.$root[u];if(f.required){let y=null;y=u==="version"?a:f.type==="array"?[]:{},y!=null&&(h[u]=y)}}return h},c.ax=mf,c.ay=Qe,c.az=function(h){h=h.slice();const a=Object.create(null);for(let u=0;u<h.length;u++)a[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=oi(h[u],a[h[u].ref]));return h},c.b=Zt,c.b0=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.b1=function(h,a,u){return h[0]=a[0]*u[0],h[1]=a[1]*u[1],h[2]=a[2]*u[2],h[3]=a[3]*u[3],h},c.b2=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]*a[3]},c.b3=Y,c.b4=iM,c.b5=tM,c.b6=function(h,a,u,f,y){var S,T=1/Math.tan(a/2);return h[0]=T/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=T,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,y!=null&&y!==1/0?(h[10]=(y+f)*(S=1/(f-y)),h[14]=2*y*f*S):(h[10]=-1,h[14]=-2*f),h},c.b7=function(h,a,u){var f=Math.sin(u),y=Math.cos(u),S=a[4],T=a[5],A=a[6],R=a[7],z=a[8],O=a[9],G=a[10],$=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=S*y+z*f,h[5]=T*y+O*f,h[6]=A*y+G*f,h[7]=R*y+$*f,h[8]=z*y-S*f,h[9]=O*y-T*f,h[10]=G*y-A*f,h[11]=$*y-R*f,h},c.b8=U,c.b9=B,c.bA=Cw,c.bB=function(h){return h.message===ri},c.bC=al,c.bD=er,c.ba=function(h){return h*Math.PI/180},c.bb=function(h,a){const{x:u,y:f}=Ff.fromLngLat(a);return!(h<0||h>25||f<0||f>=1||u<0||u>=1)},c.bc=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.bd=class extends N{},c.be=Cy,c.bf=OP,c.bh=be,c.bi=function(h,a){Jt.REGISTERED_PROTOCOLS[h]=a},c.bj=function(h){delete Jt.REGISTERED_PROTOCOLS[h]},c.bk=function(h,a){const u={};for(let y=0;y<h.length;y++){const S=a&&a[h[y].id]||Bm(h[y]);a&&(a[h[y].id]=S);let T=u[S];T||(T=u[S]=[]),T.push(h[y])}const f=[];for(const y in u)f.push(u[y]);return f},c.bl=De,c.bm=sM,c.bn=aM,c.bo=Ow,c.bp=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Vn/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const a=h.bucket.layers[0],u=a.layout,f=a._unevaluatedLayout._values,y={layoutIconSize:f["icon-size"].possiblyEvaluate(new un(h.bucket.zoom+1),h.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new un(h.bucket.zoom+1),h.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new un(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=h.bucket.textSizeData;y.compositeTextSizes=[f["text-size"].possiblyEvaluate(new un(z),h.canonical),f["text-size"].possiblyEvaluate(new un(O),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=h.bucket.iconSizeData;y.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new un(z),h.canonical),f["icon-size"].possiblyEvaluate(new un(O),h.canonical)]}const S=u.get("text-line-height")*Wn,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",A=u.get("text-keep-upright"),R=u.get("text-size");for(const z of h.bucket.features){const O=u.get("text-font").evaluate(z,{},h.canonical).join(","),G=R.evaluate(z,{},h.canonical),$=y.layoutTextSize.evaluate(z,{},h.canonical),Q=y.layoutIconSize.evaluate(z,{},h.canonical),et={horizontal:{},vertical:void 0},at=z.text;let ft,gt=[0,0];if(at){const kt=at.toString(),$t=u.get("text-letter-spacing").evaluate(z,{},h.canonical)*Wn,oe=$0(kt)?$t:0,Ae=u.get("text-anchor").evaluate(z,{},h.canonical),ii=yM(a,z,h.canonical);if(!ii){const Fe=u.get("text-radial-offset").evaluate(z,{},h.canonical);gt=Fe?gM(Ae,[Fe*Wn,Ry]):u.get("text-offset").evaluate(z,{},h.canonical).map(Pe=>Pe*Wn)}let Se=T?"center":u.get("text-justify").evaluate(z,{},h.canonical);const ve=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(z,{},h.canonical)*Wn:1/0,je=()=>{h.bucket.allowVerticalPlacement&&_f(kt)&&(et.vertical=a_(at,h.glyphMap,h.glyphPositions,h.imagePositions,O,ve,S,Ae,"left",oe,gt,c.ah.vertical,!0,$,G))};if(!T&&ii){const Fe=new Set;if(Se==="auto")for(let Qt=0;Qt<ii.values.length;Qt+=2)Fe.add(Dy(ii.values[Qt]));else Fe.add(Se);let Pe=!1;for(const Qt of Fe)if(!et.horizontal[Qt])if(Pe)et.horizontal[Qt]=et.horizontal[0];else{const We=a_(at,h.glyphMap,h.glyphPositions,h.imagePositions,O,ve,S,"center",Qt,oe,gt,c.ah.horizontal,!1,$,G);We&&(et.horizontal[Qt]=We,Pe=We.positionedLines.length===1)}je()}else{Se==="auto"&&(Se=Dy(Ae));const Fe=a_(at,h.glyphMap,h.glyphPositions,h.imagePositions,O,ve,S,Ae,Se,oe,gt,c.ah.horizontal,!1,$,G);Fe&&(et.horizontal[Se]=Fe),je(),_f(kt)&&T&&A&&(et.vertical=a_(at,h.glyphMap,h.glyphPositions,h.imagePositions,O,ve,S,Ae,Se,oe,gt,c.ah.vertical,!1,$,G))}}let Ot=!1;if(z.icon&&z.icon.name){const kt=h.imageMap[z.icon.name];kt&&(ft=xP(h.imagePositions[z.icon.name],u.get("icon-offset").evaluate(z,{},h.canonical),u.get("icon-anchor").evaluate(z,{},h.canonical)),Ot=!!kt.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Ot:h.bucket.sdfIcons!==Ot&&wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(kt.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Tt=vM(et.horizontal)||et.vertical;h.bucket.iconsInText=!!Tt&&Tt.iconsInText,(Tt||ft)&&FP(h.bucket,z,et,ft,h.imageMap,y,$,Q,gt,Ot,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.bq=_y,c.br=fy,c.bs=my,c.bt=wl,c.bu=yy,c.bv=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.bw=function(h,a,u,f,y){return o(this,void 0,void 0,function*(){if(V())try{return yield me(h,a,u,f,y)}catch{}return function(S,T,A,R,z){const O=S.width,G=S.height;Ee&&Le||(Ee=new OffscreenCanvas(O,G),Le=Ee.getContext("2d",{willReadFrequently:!0})),Ee.width=O,Ee.height=G,Le.drawImage(S,0,0,O,G);const $=Le.getImageData(T,A,R,z);return Le.clearRect(0,0,O,G),$.data}(h,a,u,f,y)})},c.bx=nM,c.by=p,c.bz=m,c.c=Ni,c.d=h=>o(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=K,c.f=h=>new Promise((a,u)=>{const f=new Image;f.onload=()=>{a(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=qt})},f.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(h)],{type:"image/png"});f.src=h.byteLength?URL.createObjectURL(y):qt}),c.g=le,c.h=(h,a)=>gi(K(h,{type:"json"}),a),c.i=Gt,c.j=zt,c.k=$i,c.l=(h,a)=>gi(K(h,{type:"arrayBuffer"}),a),c.m=gi,c.n=function(h){return new yy(h).readFields(dP,[])},c.o=Tf,c.p=zw,c.q=M,c.r=q0,c.s=bi,c.t=ff,c.u=wo,c.v=Ft,c.w=wt,c.x=function([h,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(a)*Math.sin(u),y:h*Math.sin(a)*Math.sin(u),z:h*Math.cos(u)}},c.y=zs,c.z=un}),s("worker",["./shared"],function(c){class o{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const ut of W){this._layerConfigs[ut.id]=ut;const xt=this._layers[ut.id]=c.aA(ut);xt._featureFilter=c.a7(xt.filter),this.keyCache[ut.id]&&delete this.keyCache[ut.id]}for(const ut of X)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const it=c.bk(Object.values(this._layerConfigs),this.keyCache);for(const ut of it){const xt=ut.map(Wt=>this._layers[Wt.id]),Et=xt[0];if(Et.visibility==="none")continue;const Dt=Et.source||"";let bt=this.familiesBySource[Dt];bt||(bt=this.familiesBySource[Dt]={});const Xt=Et.sourceLayer||"_geojsonTileLayer";let te=bt[Xt];te||(te=bt[Xt]=[]),te.push(xt)}}}class p{constructor(W){const X={},it=[];for(const Dt in W){const bt=W[Dt],Xt=X[Dt]={};for(const te in bt){const Wt=bt[+te];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const fe={x:0,y:0,w:Wt.bitmap.width+2,h:Wt.bitmap.height+2};it.push(fe),Xt[te]={rect:fe,metrics:Wt.metrics}}}const{w:ut,h:xt}=c.p(it),Et=new c.o({width:ut||1,height:xt||1});for(const Dt in W){const bt=W[Dt];for(const Xt in bt){const te=bt[+Xt];if(!te||te.bitmap.width===0||te.bitmap.height===0)continue;const Wt=X[Dt][Xt].rect;c.o.copy(te.bitmap,Et,{x:0,y:0},{x:Wt.x+1,y:Wt.y+1},te.bitmap)}}this.image=Et,this.positions=X}}c.bl("GlyphAtlas",p);class m{constructor(W){this.tileID=new c.S(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,it,ut){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new c.a5;const xt=new c.bm(Object.keys(W.layers).sort()),Et=new c.bn(this.tileID,this.promoteId);Et.bucketLayerIDs=[];const Dt={},bt={featureIndex:Et,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:it},Xt=X.familiesBySource[this.source];for(const Si in Xt){const rt=W.layers[Si];if(!rt)continue;rt.version===1&&c.w(`Vector tile source "${this.source}" layer "${Si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const At=xt.encode(Si),Vt=[];for(let jt=0;jt<rt.length;jt++){const Rt=rt.feature(jt),pe=Et.getId(Rt,Si);Vt.push({feature:Rt,id:pe,index:jt,sourceLayerIndex:At})}for(const jt of Xt[Si]){const Rt=jt[0];Rt.source!==this.source&&c.w(`layer.source = ${Rt.source} does not equal this.source = ${this.source}`),Rt.minzoom&&this.zoom<Math.floor(Rt.minzoom)||Rt.maxzoom&&this.zoom>=Rt.maxzoom||Rt.visibility!=="none"&&(x(jt,this.zoom,it),(Dt[Rt.id]=Rt.createBucket({index:Et.bucketLayerIDs.length,layers:jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:At,sourceID:this.source})).populate(Vt,bt,this.tileID.canonical),Et.bucketLayerIDs.push(jt.map(pe=>pe.id)))}}const te=c.aF(bt.glyphDependencies,Si=>Object.keys(Si).map(Number));this.inFlightDependencies.forEach(Si=>Si==null?void 0:Si.abort()),this.inFlightDependencies=[];let Wt=Promise.resolve({});if(Object.keys(te).length){const Si=new AbortController;this.inFlightDependencies.push(Si),Wt=ut.sendAsync({type:"GG",data:{stacks:te,source:this.source,tileID:this.tileID,type:"glyphs"}},Si)}const fe=Object.keys(bt.iconDependencies);let He=Promise.resolve({});if(fe.length){const Si=new AbortController;this.inFlightDependencies.push(Si),He=ut.sendAsync({type:"GI",data:{icons:fe,source:this.source,tileID:this.tileID,type:"icons"}},Si)}const Xe=Object.keys(bt.patternDependencies);let ki=Promise.resolve({});if(Xe.length){const Si=new AbortController;this.inFlightDependencies.push(Si),ki=ut.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"patterns"}},Si)}const[hi,Fi,Ci]=yield Promise.all([Wt,He,ki]),En=new p(hi),yn=new c.bo(Fi,Ci);for(const Si in Dt){const rt=Dt[Si];rt instanceof c.a6?(x(rt.layers,this.zoom,it),c.bp({bucket:rt,glyphMap:hi,glyphPositions:En.positions,imageMap:Fi,imagePositions:yn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):rt.hasPattern&&(rt instanceof c.bq||rt instanceof c.br||rt instanceof c.bs)&&(x(rt.layers,this.zoom,it),rt.addFeatures(bt,this.tileID.canonical,yn.patternPositions))}return this.status="done",{buckets:Object.values(Dt).filter(Si=>!Si.isEmpty()),featureIndex:Et,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:En.image,imageAtlas:yn,glyphMap:this.returnDependencies?hi:null,iconMap:this.returnDependencies?Fi:null,glyphPositions:this.returnDependencies?En.positions:null}})}}function x(lt,W,X){const it=new c.z(W);for(const ut of lt)ut.recalculate(it,X)}class v{constructor(W,X,it){this.actor=W,this.layerIndex=X,this.availableImages=it,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return c._(this,void 0,void 0,function*(){const it=yield c.l(W.request,X);try{return{vectorTile:new c.bt.VectorTile(new c.bu(it.data)),rawData:it.data,cacheControl:it.cacheControl,expires:it.expires}}catch(ut){const xt=new Uint8Array(it.data);let Et=`Unable to parse the tile at ${W.request.url}, `;throw Et+=xt[0]===31&&xt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ut.message}`,new Error(Et)}})}loadTile(W){return c._(this,void 0,void 0,function*(){const X=W.uid,it=!!(W&&W.request&&W.request.collectResourceTiming)&&new c.bv(W.request),ut=new m(W);this.loading[X]=ut;const xt=new AbortController;ut.abort=xt;try{const Et=yield this.loadVectorTile(W,xt);if(delete this.loading[X],!Et)return null;const Dt=Et.rawData,bt={};Et.expires&&(bt.expires=Et.expires),Et.cacheControl&&(bt.cacheControl=Et.cacheControl);const Xt={};if(it){const Wt=it.finish();Wt&&(Xt.resourceTiming=JSON.parse(JSON.stringify(Wt)))}ut.vectorTile=Et.vectorTile;const te=ut.parse(Et.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=ut,this.fetching[X]={rawTileData:Dt,cacheControl:bt,resourceTiming:Xt};try{const Wt=yield te;return c.e({rawTileData:Dt.slice(0)},Wt,bt,Xt)}finally{delete this.fetching[X]}}catch(Et){throw delete this.loading[X],ut.status="done",this.loaded[X]=ut,Et}})}reloadTile(W){return c._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const it=this.loaded[X];if(it.showCollisionBoxes=W.showCollisionBoxes,it.status==="parsing"){const ut=yield it.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor);let xt;if(this.fetching[X]){const{rawTileData:Et,cacheControl:Dt,resourceTiming:bt}=this.fetching[X];delete this.fetching[X],xt=c.e({rawTileData:Et.slice(0)},ut,Dt,bt)}else xt=ut;return xt}if(it.status==="done"&&it.vectorTile)return it.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return c._(this,void 0,void 0,function*(){const X=this.loading,it=W.uid;X&&X[it]&&X[it].abort&&(X[it].abort.abort(),delete X[it])})}removeTile(W){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class b{constructor(){this.loaded={}}loadTile(W){return c._(this,void 0,void 0,function*(){const{uid:X,encoding:it,rawImageData:ut,redFactor:xt,greenFactor:Et,blueFactor:Dt,baseShift:bt}=W,Xt=ut.width+2,te=ut.height+2,Wt=c.b(ut)?new c.R({width:Xt,height:te},yield c.bw(ut,-1,-1,Xt,te)):ut,fe=new c.bx(X,Wt,it,xt,Et,Dt,bt);return this.loaded=this.loaded||{},this.loaded[X]=fe,fe})}removeTile(W){const X=this.loaded,it=W.uid;X&&X[it]&&delete X[it]}}function E(lt,W){if(lt.length!==0){D(lt[0],W);for(var X=1;X<lt.length;X++)D(lt[X],!W)}}function D(lt,W){for(var X=0,it=0,ut=0,xt=lt.length,Et=xt-1;ut<xt;Et=ut++){var Dt=(lt[ut][0]-lt[Et][0])*(lt[Et][1]+lt[ut][1]),bt=X+Dt;it+=Math.abs(X)>=Math.abs(Dt)?X-bt+Dt:Dt-bt+X,X=bt}X+it>=0!=!!W&&lt.reverse()}var k=c.by(function lt(W,X){var it,ut=W&&W.type;if(ut==="FeatureCollection")for(it=0;it<W.features.length;it++)lt(W.features[it],X);else if(ut==="GeometryCollection")for(it=0;it<W.geometries.length;it++)lt(W.geometries[it],X);else if(ut==="Feature")lt(W.geometry,X);else if(ut==="Polygon")E(W.coordinates,X);else if(ut==="MultiPolygon")for(it=0;it<W.coordinates.length;it++)E(W.coordinates[it],X);return W});const P=c.bt.VectorTileFeature.prototype.toGeoJSON;var I={exports:{}},V=c.bz,U=c.bt.VectorTileFeature,B=Z;function Z(lt,W){this.options=W||{},this.features=lt,this.length=lt.length}function Y(lt,W){this.id=typeof lt.id=="number"?lt.id:void 0,this.type=lt.type,this.rawGeometry=lt.type===1?[lt.geometry]:lt.geometry,this.properties=lt.tags,this.extent=W||4096}Z.prototype.feature=function(lt){return new Y(this.features[lt],this.options.extent)},Y.prototype.loadGeometry=function(){var lt=this.rawGeometry;this.geometry=[];for(var W=0;W<lt.length;W++){for(var X=lt[W],it=[],ut=0;ut<X.length;ut++)it.push(new V(X[ut][0],X[ut][1]));this.geometry.push(it)}return this.geometry},Y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var lt=this.geometry,W=1/0,X=-1/0,it=1/0,ut=-1/0,xt=0;xt<lt.length;xt++)for(var Et=lt[xt],Dt=0;Dt<Et.length;Dt++){var bt=Et[Dt];W=Math.min(W,bt.x),X=Math.max(X,bt.x),it=Math.min(it,bt.y),ut=Math.max(ut,bt.y)}return[W,it,X,ut]},Y.prototype.toGeoJSON=U.prototype.toGeoJSON;var K=c.bA,nt=B;function q(lt){var W=new K;return function(X,it){for(var ut in X.layers)it.writeMessage(3,J,X.layers[ut])}(lt,W),W.finish()}function J(lt,W){var X;W.writeVarintField(15,lt.version||1),W.writeStringField(1,lt.name||""),W.writeVarintField(5,lt.extent||4096);var it={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<lt.length;X++)it.feature=lt.feature(X),W.writeMessage(2,ct,it);var ut=it.keys;for(X=0;X<ut.length;X++)W.writeStringField(3,ut[X]);var xt=it.values;for(X=0;X<xt.length;X++)W.writeMessage(4,Nt,xt[X])}function ct(lt,W){var X=lt.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,St,lt),W.writeVarintField(3,X.type),W.writeMessage(4,Gt,X)}function St(lt,W){var X=lt.feature,it=lt.keys,ut=lt.values,xt=lt.keycache,Et=lt.valuecache;for(var Dt in X.properties){var bt=X.properties[Dt],Xt=xt[Dt];if(bt!==null){Xt===void 0&&(it.push(Dt),xt[Dt]=Xt=it.length-1),W.writeVarint(Xt);var te=typeof bt;te!=="string"&&te!=="boolean"&&te!=="number"&&(bt=JSON.stringify(bt));var Wt=te+":"+bt,fe=Et[Wt];fe===void 0&&(ut.push(bt),Et[Wt]=fe=ut.length-1),W.writeVarint(fe)}}}function wt(lt,W){return(W<<3)+(7&lt)}function Pt(lt){return lt<<1^lt>>31}function Gt(lt,W){for(var X=lt.loadGeometry(),it=lt.type,ut=0,xt=0,Et=X.length,Dt=0;Dt<Et;Dt++){var bt=X[Dt],Xt=1;it===1&&(Xt=bt.length),W.writeVarint(wt(1,Xt));for(var te=it===3?bt.length-1:bt.length,Wt=0;Wt<te;Wt++){Wt===1&&it!==1&&W.writeVarint(wt(2,te-1));var fe=bt[Wt].x-ut,He=bt[Wt].y-xt;W.writeVarint(Pt(fe)),W.writeVarint(Pt(He)),ut+=fe,xt+=He}it===3&&W.writeVarint(wt(7,1))}}function Nt(lt,W){var X=typeof lt;X==="string"?W.writeStringField(1,lt):X==="boolean"?W.writeBooleanField(7,lt):X==="number"&&(lt%1!=0?W.writeDoubleField(3,lt):lt<0?W.writeSVarintField(6,lt):W.writeVarintField(5,lt))}I.exports=q,I.exports.fromVectorTileJs=q,I.exports.fromGeojsonVt=function(lt,W){W=W||{};var X={};for(var it in lt)X[it]=new nt(lt[it].features,W),X[it].name=it,X[it].version=W.version,X[it].extent=W.extent;return q({layers:X})},I.exports.GeoJSONWrapper=nt;var Zt=c.by(I.exports);const qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:lt=>lt},me=Math.fround||(Ee=new Float32Array(1),lt=>(Ee[0]=+lt,Ee[0]));var Ee;const Le=3,ri=5,Ni=6;class Jt{constructor(W){this.options=Object.assign(Object.create(qt),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:it,maxZoom:ut}=this.options;X&&console.time("total time");const xt=`prepare ${W.length} points`;X&&console.time(xt),this.points=W;const Et=[];for(let bt=0;bt<W.length;bt++){const Xt=W[bt];if(!Xt.geometry)continue;const[te,Wt]=Xt.geometry.coordinates,fe=me(be(te)),He=me(Qe(Wt));Et.push(fe,He,1/0,bt,-1,1),this.options.reduce&&Et.push(0)}let Dt=this.trees[ut+1]=this._createTree(Et);X&&console.timeEnd(xt);for(let bt=ut;bt>=it;bt--){const Xt=+Date.now();Dt=this.trees[bt]=this._createTree(this._cluster(Dt,bt)),X&&console.log("z%d: %d clusters in %dms",bt,Dt.numItems,+Date.now()-Xt)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let it=((W[0]+180)%360+360)%360-180;const ut=Math.max(-90,Math.min(90,W[1]));let xt=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)it=-180,xt=180;else if(it>xt){const Wt=this.getClusters([it,ut,180,Et],X),fe=this.getClusters([-180,ut,xt,Et],X);return Wt.concat(fe)}const Dt=this.trees[this._limitZoom(X)],bt=Dt.range(be(it),Qe(Et),be(xt),Qe(ut)),Xt=Dt.data,te=[];for(const Wt of bt){const fe=this.stride*Wt;te.push(Xt[fe+ri]>1?le(Xt,fe,this.clusterProps):this.points[Xt[fe+Le]])}return te}getChildren(W){const X=this._getOriginId(W),it=this._getOriginZoom(W),ut="No cluster with the specified id.",xt=this.trees[it];if(!xt)throw new Error(ut);const Et=xt.data;if(X*this.stride>=Et.length)throw new Error(ut);const Dt=this.options.radius/(this.options.extent*Math.pow(2,it-1)),bt=xt.within(Et[X*this.stride],Et[X*this.stride+1],Dt),Xt=[];for(const te of bt){const Wt=te*this.stride;Et[Wt+4]===W&&Xt.push(Et[Wt+ri]>1?le(Et,Wt,this.clusterProps):this.points[Et[Wt+Le]])}if(Xt.length===0)throw new Error(ut);return Xt}getLeaves(W,X,it){const ut=[];return this._appendLeaves(ut,W,X=X||10,it=it||0,0),ut}getTile(W,X,it){const ut=this.trees[this._limitZoom(W)],xt=Math.pow(2,W),{extent:Et,radius:Dt}=this.options,bt=Dt/Et,Xt=(it-bt)/xt,te=(it+1+bt)/xt,Wt={features:[]};return this._addTileFeatures(ut.range((X-bt)/xt,Xt,(X+1+bt)/xt,te),ut.data,X,it,xt,Wt),X===0&&this._addTileFeatures(ut.range(1-bt/xt,Xt,1,te),ut.data,xt,it,xt,Wt),X===xt-1&&this._addTileFeatures(ut.range(0,Xt,bt/xt,te),ut.data,-1,it,xt,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const it=this.getChildren(W);if(X++,it.length!==1)break;W=it[0].properties.cluster_id}return X}_appendLeaves(W,X,it,ut,xt){const Et=this.getChildren(X);for(const Dt of Et){const bt=Dt.properties;if(bt&&bt.cluster?xt+bt.point_count<=ut?xt+=bt.point_count:xt=this._appendLeaves(W,bt.cluster_id,it,ut,xt):xt<ut?xt++:W.push(Dt),W.length===it)break}return xt}_createTree(W){const X=new c.av(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let it=0;it<W.length;it+=this.stride)X.add(W[it],W[it+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,it,ut,xt,Et){for(const Dt of W){const bt=Dt*this.stride,Xt=X[bt+ri]>1;let te,Wt,fe;if(Xt)te=qe(X,bt,this.clusterProps),Wt=X[bt],fe=X[bt+1];else{const ki=this.points[X[bt+Le]];te=ki.properties;const[hi,Fi]=ki.geometry.coordinates;Wt=be(hi),fe=Qe(Fi)}const He={type:1,geometry:[[Math.round(this.options.extent*(Wt*xt-it)),Math.round(this.options.extent*(fe*xt-ut))]],tags:te};let Xe;Xe=Xt||this.options.generateId?X[bt+Le]:this.points[X[bt+Le]].id,Xe!==void 0&&(He.id=Xe),Et.features.push(He)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:it,extent:ut,reduce:xt,minPoints:Et}=this.options,Dt=it/(ut*Math.pow(2,X)),bt=W.data,Xt=[],te=this.stride;for(let Wt=0;Wt<bt.length;Wt+=te){if(bt[Wt+2]<=X)continue;bt[Wt+2]=X;const fe=bt[Wt],He=bt[Wt+1],Xe=W.within(bt[Wt],bt[Wt+1],Dt),ki=bt[Wt+ri];let hi=ki;for(const Fi of Xe){const Ci=Fi*te;bt[Ci+2]>X&&(hi+=bt[Ci+ri])}if(hi>ki&&hi>=Et){let Fi,Ci=fe*ki,En=He*ki,yn=-1;const Si=((Wt/te|0)<<5)+(X+1)+this.points.length;for(const rt of Xe){const At=rt*te;if(bt[At+2]<=X)continue;bt[At+2]=X;const Vt=bt[At+ri];Ci+=bt[At]*Vt,En+=bt[At+1]*Vt,bt[At+4]=Si,xt&&(Fi||(Fi=this._map(bt,Wt,!0),yn=this.clusterProps.length,this.clusterProps.push(Fi)),xt(Fi,this._map(bt,At)))}bt[Wt+4]=Si,Xt.push(Ci/hi,En/hi,1/0,Si,-1,hi),xt&&Xt.push(yn)}else{for(let Fi=0;Fi<te;Fi++)Xt.push(bt[Wt+Fi]);if(hi>1)for(const Fi of Xe){const Ci=Fi*te;if(!(bt[Ci+2]<=X)){bt[Ci+2]=X;for(let En=0;En<te;En++)Xt.push(bt[Ci+En])}}}}return Xt}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,it){if(W[X+ri]>1){const Et=this.clusterProps[W[X+Ni]];return it?Object.assign({},Et):Et}const ut=this.points[W[X+Le]].properties,xt=this.options.map(ut);return it&&xt===ut?Object.assign({},xt):xt}}function le(lt,W,X){return{type:"Feature",id:lt[W+Le],properties:qe(lt,W,X),geometry:{type:"Point",coordinates:[(it=lt[W],360*(it-.5)),gi(lt[W+1])]}};var it}function qe(lt,W,X){const it=lt[W+ri],ut=it>=1e4?`${Math.round(it/1e3)}k`:it>=1e3?Math.round(it/100)/10+"k":it,xt=lt[W+Ni],Et=xt===-1?{}:Object.assign({},X[xt]);return Object.assign(Et,{cluster:!0,cluster_id:lt[W+Le],point_count:it,point_count_abbreviated:ut})}function be(lt){return lt/360+.5}function Qe(lt){const W=Math.sin(lt*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function gi(lt){const W=(180-360*lt)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function bi(lt,W,X,it){let ut=it;const xt=W+(X-W>>1);let Et,Dt=X-W;const bt=lt[W],Xt=lt[W+1],te=lt[X],Wt=lt[X+1];for(let fe=W+3;fe<X;fe+=3){const He=Zi(lt[fe],lt[fe+1],bt,Xt,te,Wt);if(He>ut)Et=fe,ut=He;else if(He===ut){const Xe=Math.abs(fe-xt);Xe<Dt&&(Et=fe,Dt=Xe)}}ut>it&&(Et-W>3&&bi(lt,W,Et,it),lt[Et+2]=ut,X-Et>3&&bi(lt,Et,X,it))}function Zi(lt,W,X,it,ut,xt){let Et=ut-X,Dt=xt-it;if(Et!==0||Dt!==0){const bt=((lt-X)*Et+(W-it)*Dt)/(Et*Et+Dt*Dt);bt>1?(X=ut,it=xt):bt>0&&(X+=Et*bt,it+=Dt*bt)}return Et=lt-X,Dt=W-it,Et*Et+Dt*Dt}function Ei(lt,W,X,it){const ut={id:lt??null,type:W,geometry:X,tags:it,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")$i(ut,X);else if(W==="Polygon")$i(ut,X[0]);else if(W==="MultiLineString")for(const xt of X)$i(ut,xt);else if(W==="MultiPolygon")for(const xt of X)$i(ut,xt[0]);return ut}function $i(lt,W){for(let X=0;X<W.length;X+=3)lt.minX=Math.min(lt.minX,W[X]),lt.minY=Math.min(lt.minY,W[X+1]),lt.maxX=Math.max(lt.maxX,W[X]),lt.maxY=Math.max(lt.maxY,W[X+1])}function zt(lt,W,X,it){if(!W.geometry)return;const ut=W.geometry.coordinates;if(ut&&ut.length===0)return;const xt=W.geometry.type,Et=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Dt=[],bt=W.id;if(X.promoteId?bt=W.properties[X.promoteId]:X.generateId&&(bt=it||0),xt==="Point")jn(ut,Dt);else if(xt==="MultiPoint")for(const Xt of ut)jn(Xt,Dt);else if(xt==="LineString")Ft(ut,Dt,Et,!1);else if(xt==="MultiLineString"){if(X.lineMetrics){for(const Xt of ut)Dt=[],Ft(Xt,Dt,Et,!1),lt.push(Ei(bt,"LineString",Dt,W.properties));return}Ai(ut,Dt,Et,!1)}else if(xt==="Polygon")Ai(ut,Dt,Et,!0);else{if(xt!=="MultiPolygon"){if(xt==="GeometryCollection"){for(const Xt of W.geometry.geometries)zt(lt,{id:bt,geometry:Xt,properties:W.properties},X,it);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xt of ut){const te=[];Ai(Xt,te,Et,!0),Dt.push(te)}}lt.push(Ei(bt,xt,Dt,W.properties))}function jn(lt,W){W.push(oi(lt[0]),ti(lt[1]),0)}function Ft(lt,W,X,it){let ut,xt,Et=0;for(let bt=0;bt<lt.length;bt++){const Xt=oi(lt[bt][0]),te=ti(lt[bt][1]);W.push(Xt,te,0),bt>0&&(Et+=it?(ut*te-Xt*xt)/2:Math.sqrt(Math.pow(Xt-ut,2)+Math.pow(te-xt,2))),ut=Xt,xt=te}const Dt=W.length-3;W[2]=1,bi(W,0,Dt,X),W[Dt+2]=1,W.size=Math.abs(Et),W.start=0,W.end=W.size}function Ai(lt,W,X,it){for(let ut=0;ut<lt.length;ut++){const xt=[];Ft(lt[ut],xt,X,it),W.push(xt)}}function oi(lt){return lt/360+.5}function ti(lt){const W=Math.sin(lt*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function ke(lt,W,X,it,ut,xt,Et,Dt){if(it/=W,xt>=(X/=W)&&Et<it)return lt;if(Et<X||xt>=it)return null;const bt=[];for(const Xt of lt){const te=Xt.geometry;let Wt=Xt.type;const fe=ut===0?Xt.minX:Xt.minY,He=ut===0?Xt.maxX:Xt.maxY;if(fe>=X&&He<it){bt.push(Xt);continue}if(He<X||fe>=it)continue;let Xe=[];if(Wt==="Point"||Wt==="MultiPoint")mt(te,Xe,X,it,ut);else if(Wt==="LineString")st(te,Xe,X,it,ut,!1,Dt.lineMetrics);else if(Wt==="MultiLineString")re(te,Xe,X,it,ut,!1);else if(Wt==="Polygon")re(te,Xe,X,it,ut,!0);else if(Wt==="MultiPolygon")for(const ki of te){const hi=[];re(ki,hi,X,it,ut,!0),hi.length&&Xe.push(hi)}if(Xe.length){if(Dt.lineMetrics&&Wt==="LineString"){for(const ki of Xe)bt.push(Ei(Xt.id,Wt,ki,Xt.tags));continue}Wt!=="LineString"&&Wt!=="MultiLineString"||(Xe.length===1?(Wt="LineString",Xe=Xe[0]):Wt="MultiLineString"),Wt!=="Point"&&Wt!=="MultiPoint"||(Wt=Xe.length===3?"Point":"MultiPoint"),bt.push(Ei(Xt.id,Wt,Xe,Xt.tags))}}return bt.length?bt:null}function mt(lt,W,X,it,ut){for(let xt=0;xt<lt.length;xt+=3){const Et=lt[xt+ut];Et>=X&&Et<=it&&ae(W,lt[xt],lt[xt+1],lt[xt+2])}}function st(lt,W,X,it,ut,xt,Et){let Dt=Ht(lt);const bt=ut===0?ie:$e;let Xt,te,Wt=lt.start;for(let hi=0;hi<lt.length-3;hi+=3){const Fi=lt[hi],Ci=lt[hi+1],En=lt[hi+2],yn=lt[hi+3],Si=lt[hi+4],rt=ut===0?Fi:Ci,At=ut===0?yn:Si;let Vt=!1;Et&&(Xt=Math.sqrt(Math.pow(Fi-yn,2)+Math.pow(Ci-Si,2))),rt<X?At>X&&(te=bt(Dt,Fi,Ci,yn,Si,X),Et&&(Dt.start=Wt+Xt*te)):rt>it?At<it&&(te=bt(Dt,Fi,Ci,yn,Si,it),Et&&(Dt.start=Wt+Xt*te)):ae(Dt,Fi,Ci,En),At<X&&rt>=X&&(te=bt(Dt,Fi,Ci,yn,Si,X),Vt=!0),At>it&&rt<=it&&(te=bt(Dt,Fi,Ci,yn,Si,it),Vt=!0),!xt&&Vt&&(Et&&(Dt.end=Wt+Xt*te),W.push(Dt),Dt=Ht(lt)),Et&&(Wt+=Xt)}let fe=lt.length-3;const He=lt[fe],Xe=lt[fe+1],ki=ut===0?He:Xe;ki>=X&&ki<=it&&ae(Dt,He,Xe,lt[fe+2]),fe=Dt.length-3,xt&&fe>=3&&(Dt[fe]!==Dt[0]||Dt[fe+1]!==Dt[1])&&ae(Dt,Dt[0],Dt[1],Dt[2]),Dt.length&&W.push(Dt)}function Ht(lt){const W=[];return W.size=lt.size,W.start=lt.start,W.end=lt.end,W}function re(lt,W,X,it,ut,xt){for(const Et of lt)st(Et,W,X,it,ut,xt,!1)}function ae(lt,W,X,it){lt.push(W,X,it)}function ie(lt,W,X,it,ut,xt){const Et=(xt-W)/(it-W);return ae(lt,xt,X+(ut-X)*Et,1),Et}function $e(lt,W,X,it,ut,xt){const Et=(xt-X)/(ut-X);return ae(lt,W+(it-W)*Et,xt,1),Et}function Ut(lt,W){const X=[];for(let it=0;it<lt.length;it++){const ut=lt[it],xt=ut.type;let Et;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")Et=Ie(ut.geometry,W);else if(xt==="MultiLineString"||xt==="Polygon"){Et=[];for(const Dt of ut.geometry)Et.push(Ie(Dt,W))}else if(xt==="MultiPolygon"){Et=[];for(const Dt of ut.geometry){const bt=[];for(const Xt of Dt)bt.push(Ie(Xt,W));Et.push(bt)}}X.push(Ei(ut.id,xt,Et,ut.tags))}return X}function Ie(lt,W){const X=[];X.size=lt.size,lt.start!==void 0&&(X.start=lt.start,X.end=lt.end);for(let it=0;it<lt.length;it+=3)X.push(lt[it]+W,lt[it+1],lt[it+2]);return X}function yi(lt,W){if(lt.transformed)return lt;const X=1<<lt.z,it=lt.x,ut=lt.y;for(const xt of lt.features){const Et=xt.geometry,Dt=xt.type;if(xt.geometry=[],Dt===1)for(let bt=0;bt<Et.length;bt+=2)xt.geometry.push(ue(Et[bt],Et[bt+1],W,X,it,ut));else for(let bt=0;bt<Et.length;bt++){const Xt=[];for(let te=0;te<Et[bt].length;te+=2)Xt.push(ue(Et[bt][te],Et[bt][te+1],W,X,it,ut));xt.geometry.push(Xt)}}return lt.transformed=!0,lt}function ue(lt,W,X,it,ut,xt){return[Math.round(X*(lt*it-ut)),Math.round(X*(W*it-xt))]}function Be(lt,W,X,it,ut){const xt=W===ut.maxZoom?0:ut.tolerance/((1<<W)*ut.extent),Et={features:[],numPoints:0,numSimplified:0,numFeatures:lt.length,source:null,x:X,y:it,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Dt of lt)Yt(Et,Dt,xt,ut);return Et}function Yt(lt,W,X,it){const ut=W.geometry,xt=W.type,Et=[];if(lt.minX=Math.min(lt.minX,W.minX),lt.minY=Math.min(lt.minY,W.minY),lt.maxX=Math.max(lt.maxX,W.maxX),lt.maxY=Math.max(lt.maxY,W.maxY),xt==="Point"||xt==="MultiPoint")for(let Dt=0;Dt<ut.length;Dt+=3)Et.push(ut[Dt],ut[Dt+1]),lt.numPoints++,lt.numSimplified++;else if(xt==="LineString")ge(Et,ut,lt,X,!1,!1);else if(xt==="MultiLineString"||xt==="Polygon")for(let Dt=0;Dt<ut.length;Dt++)ge(Et,ut[Dt],lt,X,xt==="Polygon",Dt===0);else if(xt==="MultiPolygon")for(let Dt=0;Dt<ut.length;Dt++){const bt=ut[Dt];for(let Xt=0;Xt<bt.length;Xt++)ge(Et,bt[Xt],lt,X,!0,Xt===0)}if(Et.length){let Dt=W.tags||null;if(xt==="LineString"&&it.lineMetrics){Dt={};for(const Xt in W.tags)Dt[Xt]=W.tags[Xt];Dt.mapbox_clip_start=ut.start/ut.size,Dt.mapbox_clip_end=ut.end/ut.size}const bt={geometry:Et,type:xt==="Polygon"||xt==="MultiPolygon"?3:xt==="LineString"||xt==="MultiLineString"?2:1,tags:Dt};W.id!==null&&(bt.id=W.id),lt.features.push(bt)}}function ge(lt,W,X,it,ut,xt){const Et=it*it;if(it>0&&W.size<(ut?Et:it))return void(X.numPoints+=W.length/3);const Dt=[];for(let bt=0;bt<W.length;bt+=3)(it===0||W[bt+2]>Et)&&(X.numSimplified++,Dt.push(W[bt],W[bt+1])),X.numPoints++;ut&&function(bt,Xt){let te=0;for(let Wt=0,fe=bt.length,He=fe-2;Wt<fe;He=Wt,Wt+=2)te+=(bt[Wt]-bt[He])*(bt[Wt+1]+bt[He+1]);if(te>0===Xt)for(let Wt=0,fe=bt.length;Wt<fe/2;Wt+=2){const He=bt[Wt],Xe=bt[Wt+1];bt[Wt]=bt[fe-2-Wt],bt[Wt+1]=bt[fe-1-Wt],bt[fe-2-Wt]=He,bt[fe-1-Wt]=Xe}}(Dt,xt),lt.push(Dt)}const ne={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xi{constructor(W,X){const it=(X=this.options=function(xt,Et){for(const Dt in Et)xt[Dt]=Et[Dt];return xt}(Object.create(ne),X)).debug;if(it&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let ut=function(xt,Et){const Dt=[];if(xt.type==="FeatureCollection")for(let bt=0;bt<xt.features.length;bt++)zt(Dt,xt.features[bt],Et,bt);else zt(Dt,xt.type==="Feature"?xt:{geometry:xt},Et);return Dt}(W,X);this.tiles={},this.tileCoords=[],it&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ut=function(xt,Et){const Dt=Et.buffer/Et.extent;let bt=xt;const Xt=ke(xt,1,-1-Dt,Dt,0,-1,2,Et),te=ke(xt,1,1-Dt,2+Dt,0,-1,2,Et);return(Xt||te)&&(bt=ke(xt,1,-Dt,1+Dt,0,-1,2,Et)||[],Xt&&(bt=Ut(Xt,1).concat(bt)),te&&(bt=bt.concat(Ut(te,-1)))),bt}(ut,X),ut.length&&this.splitTile(ut,0,0,0),it&&(ut.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,X,it,ut,xt,Et,Dt){const bt=[W,X,it,ut],Xt=this.options,te=Xt.debug;for(;bt.length;){ut=bt.pop(),it=bt.pop(),X=bt.pop(),W=bt.pop();const Wt=1<<X,fe=ci(X,it,ut);let He=this.tiles[fe];if(!He&&(te>1&&console.time("creation"),He=this.tiles[fe]=Be(W,X,it,ut,Xt),this.tileCoords.push({z:X,x:it,y:ut}),te)){te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,it,ut,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));const Vt=`z${X}`;this.stats[Vt]=(this.stats[Vt]||0)+1,this.total++}if(He.source=W,xt==null){if(X===Xt.indexMaxZoom||He.numPoints<=Xt.indexMaxPoints)continue}else{if(X===Xt.maxZoom||X===xt)continue;if(xt!=null){const Vt=xt-X;if(it!==Et>>Vt||ut!==Dt>>Vt)continue}}if(He.source=null,W.length===0)continue;te>1&&console.time("clipping");const Xe=.5*Xt.buffer/Xt.extent,ki=.5-Xe,hi=.5+Xe,Fi=1+Xe;let Ci=null,En=null,yn=null,Si=null,rt=ke(W,Wt,it-Xe,it+hi,0,He.minX,He.maxX,Xt),At=ke(W,Wt,it+ki,it+Fi,0,He.minX,He.maxX,Xt);W=null,rt&&(Ci=ke(rt,Wt,ut-Xe,ut+hi,1,He.minY,He.maxY,Xt),En=ke(rt,Wt,ut+ki,ut+Fi,1,He.minY,He.maxY,Xt),rt=null),At&&(yn=ke(At,Wt,ut-Xe,ut+hi,1,He.minY,He.maxY,Xt),Si=ke(At,Wt,ut+ki,ut+Fi,1,He.minY,He.maxY,Xt),At=null),te>1&&console.timeEnd("clipping"),bt.push(Ci||[],X+1,2*it,2*ut),bt.push(En||[],X+1,2*it,2*ut+1),bt.push(yn||[],X+1,2*it+1,2*ut),bt.push(Si||[],X+1,2*it+1,2*ut+1)}}getTile(W,X,it){W=+W,X=+X,it=+it;const ut=this.options,{extent:xt,debug:Et}=ut;if(W<0||W>24)return null;const Dt=1<<W,bt=ci(W,X=X+Dt&Dt-1,it);if(this.tiles[bt])return yi(this.tiles[bt],xt);Et>1&&console.log("drilling down to z%d-%d-%d",W,X,it);let Xt,te=W,Wt=X,fe=it;for(;!Xt&&te>0;)te--,Wt>>=1,fe>>=1,Xt=this.tiles[ci(te,Wt,fe)];return Xt&&Xt.source?(Et>1&&(console.log("found parent tile z%d-%d-%d",te,Wt,fe),console.time("drilling down")),this.splitTile(Xt.source,te,Wt,fe,W,X,it),Et>1&&console.timeEnd("drilling down"),this.tiles[bt]?yi(this.tiles[bt],xt):null):null}}function ci(lt,W,X){return 32*((1<<lt)*X+W)+lt}function Re(lt,W){return W?lt.properties[W]:lt.id}function It(lt,W){if(lt==null)return!0;if(lt.type==="Feature")return Re(lt,W)!=null;if(lt.type==="FeatureCollection"){const X=new Set;for(const it of lt.features){const ut=Re(it,W);if(ut==null||X.has(ut))return!1;X.add(ut)}return!0}return!1}function Me(lt,W){const X=new Map;if(lt!=null)if(lt.type==="Feature")X.set(Re(lt,W),lt);else for(const it of lt.features)X.set(Re(it,W),it);return X}class Kt extends v{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return c._(this,void 0,void 0,function*(){const it=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ut=this._geoJSONIndex.getTile(it.z,it.x,it.y);if(!ut)return null;const xt=new class{constructor(Dt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.X,this.length=Dt.length,this._features=Dt}feature(Dt){return new class{constructor(bt){this._feature=bt,this.extent=c.X,this.type=bt.type,this.properties=bt.tags,"id"in bt&&!isNaN(bt.id)&&(this.id=parseInt(bt.id,10))}loadGeometry(){if(this._feature.type===1){const bt=[];for(const Xt of this._feature.geometry)bt.push([new c.P(Xt[0],Xt[1])]);return bt}{const bt=[];for(const Xt of this._feature.geometry){const te=[];for(const Wt of Xt)te.push(new c.P(Wt[0],Wt[1]));bt.push(te)}return bt}}toGeoJSON(bt,Xt,te){return P.call(this,bt,Xt,te)}}(this._features[Dt])}}(ut.features);let Et=Zt(xt);return Et.byteOffset===0&&Et.byteLength===Et.buffer.byteLength||(Et=new Uint8Array(Et)),{vectorTile:xt,rawData:Et.buffer}})}loadData(W){return c._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const it=!!(W&&W.request&&W.request.collectResourceTiming)&&new c.bv(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new Jt(function({superclusterOptions:Et,clusterProperties:Dt}){if(!Dt||!Et)return Et;const bt={},Xt={},te={accumulated:null,zoom:0},Wt={properties:null},fe=Object.keys(Dt);for(const He of fe){const[Xe,ki]=Dt[He],hi=c.bC(ki),Fi=c.bC(typeof Xe=="string"?[Xe,["accumulated"],["get",He]]:Xe);bt[He]=hi.value,Xt[He]=Fi.value}return Et.map=He=>{Wt.properties=He;const Xe={};for(const ki of fe)Xe[ki]=bt[ki].evaluate(te,Wt);return Xe},Et.reduce=(He,Xe)=>{Wt.properties=Xe;for(const ki of fe)te.accumulated=He[ki],He[ki]=Xt[ki].evaluate(te,Wt)},Et}(W)).load((yield this._pendingData).features):(ut=yield this._pendingData,new xi(ut,W.geojsonVtOptions)),this.loaded={};const xt={};if(it){const Et=it.finish();Et&&(xt.resourceTiming={},xt.resourceTiming[W.source]=JSON.parse(JSON.stringify(Et)))}return xt}catch(xt){if(delete this._pendingRequest,c.bB(xt))return{abandoned:!0};throw xt}var ut})}getData(){return c._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,X){return c._(this,void 0,void 0,function*(){let it=yield this.loadGeoJSON(W,X);if(delete this._pendingRequest,typeof it!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(k(it,!0),W.filter){const ut=c.bC(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ut.result==="error")throw new Error(ut.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));it={type:"FeatureCollection",features:it.features.filter(Et=>ut.value.evaluate({zoom:0},Et))}}return it})}loadGeoJSON(W,X){return c._(this,void 0,void 0,function*(){const{promoteId:it}=W;if(W.request){const ut=yield c.h(W.request,X);return this._dataUpdateable=It(ut.data,it)?Me(ut.data,it):void 0,ut.data}if(typeof W.data=="string")try{const ut=JSON.parse(W.data);return this._dataUpdateable=It(ut,it)?Me(ut,it):void 0,ut}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(ut,xt,Et){var Dt,bt,Xt,te;if(xt.removeAll&&ut.clear(),xt.remove)for(const Wt of xt.remove)ut.delete(Wt);if(xt.add)for(const Wt of xt.add){const fe=Re(Wt,Et);fe!=null&&ut.set(fe,Wt)}if(xt.update)for(const Wt of xt.update){let fe=ut.get(Wt.id);if(fe==null)continue;const He=!Wt.removeAllProperties&&(((Dt=Wt.removeProperties)===null||Dt===void 0?void 0:Dt.length)>0||((bt=Wt.addOrUpdateProperties)===null||bt===void 0?void 0:bt.length)>0);if((Wt.newGeometry||Wt.removeAllProperties||He)&&(fe=Object.assign({},fe),ut.set(Wt.id,fe),He&&(fe.properties=Object.assign({},fe.properties))),Wt.newGeometry&&(fe.geometry=Wt.newGeometry),Wt.removeAllProperties)fe.properties={};else if(((Xt=Wt.removeProperties)===null||Xt===void 0?void 0:Xt.length)>0)for(const Xe of Wt.removeProperties)Object.prototype.hasOwnProperty.call(fe.properties,Xe)&&delete fe.properties[Xe];if(((te=Wt.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0)for(const{key:Xe,value:ki}of Wt.addOrUpdateProperties)fe.properties[Xe]=ki}}(this._dataUpdateable,W.dataDiff,it),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class se{constructor(W){this.self=W,this.actor=new c.F(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,it)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=it},this.self.addProtocol=c.bi,this.self.removeProtocol=c.bj,this.self.registerRTLTextPlugin=X=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,it)=>this._getDEMWorkerSource(X,it.source).loadTile(it)),this.actor.registerMessageHandler("RDT",(X,it)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,it.source).removeTile(it)})),this.actor.registerMessageHandler("GCEZ",(X,it)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,it.type,it.source).getClusterExpansionZoom(it)})),this.actor.registerMessageHandler("GCC",(X,it)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,it.type,it.source).getClusterChildren(it)})),this.actor.registerMessageHandler("GCL",(X,it)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,it.type,it.source).getClusterLeaves(it)})),this.actor.registerMessageHandler("LD",(X,it)=>this._getWorkerSource(X,it.type,it.source).loadData(it)),this.actor.registerMessageHandler("GD",(X,it)=>this._getWorkerSource(X,it.type,it.source).getData()),this.actor.registerMessageHandler("LT",(X,it)=>this._getWorkerSource(X,it.type,it.source).loadTile(it)),this.actor.registerMessageHandler("RT",(X,it)=>this._getWorkerSource(X,it.type,it.source).reloadTile(it)),this.actor.registerMessageHandler("AT",(X,it)=>this._getWorkerSource(X,it.type,it.source).abortTile(it)),this.actor.registerMessageHandler("RMT",(X,it)=>this._getWorkerSource(X,it.type,it.source).removeTile(it)),this.actor.registerMessageHandler("RS",(X,it)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][it.type]||!this.workerSources[X][it.type][it.source])return;const ut=this.workerSources[X][it.type][it.source];delete this.workerSources[X][it.type][it.source],ut.removeSource!==void 0&&ut.removeSource(it)})),this.actor.registerMessageHandler("RM",X=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,it)=>c._(this,void 0,void 0,function*(){this.referrer=it})),this.actor.registerMessageHandler("SRPS",(X,it)=>this._syncRTLPluginState(X,it)),this.actor.registerMessageHandler("IS",(X,it)=>c._(this,void 0,void 0,function*(){this.self.importScripts(it)})),this.actor.registerMessageHandler("SI",(X,it)=>this._setImages(X,it)),this.actor.registerMessageHandler("UL",(X,it)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(it.layers,it.removedIds)})),this.actor.registerMessageHandler("SL",(X,it)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(it)}))}_setImages(W,X){return c._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const it in this.workerSources[W]){const ut=this.workerSources[W][it];for(const xt in ut)ut[xt].availableImages=X}})}_syncRTLPluginState(W,X){return c._(this,void 0,void 0,function*(){if(c.bD.isParsed())return c.bD.getState();if(X.pluginStatus!=="loading")return c.bD.setState(X),X;const it=X.pluginURL;if(this.self.importScripts(it),c.bD.isParsed()){const ut={pluginStatus:"loaded",pluginURL:it};return c.bD.setState(ut),ut}throw c.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${it}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new o),X}_getWorkerSource(W,X,it){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][it]){const ut={sendAsync:(xt,Et)=>(xt.targetMapId=W,this.actor.sendAsync(xt,Et))};switch(X){case"vector":this.workerSources[W][X][it]=new v(ut,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][it]=new Kt(ut,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][it]=new this.externalWorkerSourceTypes[X](ut,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][it]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new b),this.demWorkerSources[W][X]}}return c.i(self)&&(self.worker=new se(self)),se}),s("index",["exports","./shared"],function(c,o){var p="4.7.1";let m,x;const v={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:M=>new Promise((r,d)=>{const _=requestAnimationFrame(r);M.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),d(o.c())})}),getImageData(M,r=0){return this.getImageCanvasContext(M).getImageData(-r,-r,M.width+2*r,M.height+2*r)},getImageCanvasContext(M){const r=window.document.createElement("canvas"),d=r.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return r.width=M.width,r.height=M.height,d.drawImage(M,0,0,M.width,M.height),d},resolveURL:M=>(m||(m=document.createElement("a")),m.href=M,m.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class b{static testProp(r){if(!b.docStyle)return r[0];for(let d=0;d<r.length;d++)if(r[d]in b.docStyle)return r[d];return r[0]}static create(r,d,_){const g=window.document.createElement(r);return d!==void 0&&(g.className=d),_&&_.appendChild(g),g}static createNS(r,d){return window.document.createElementNS(r,d)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(r,d){r.style[b.transformProp]=d}static addEventListener(r,d,_,g={}){r.addEventListener(d,_,"passive"in g?g:g.capture)}static removeEventListener(r,d,_,g={}){r.removeEventListener(d,_,"passive"in g?g:g.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static getScale(r){const d=r.getBoundingClientRect();return{x:d.width/r.offsetWidth||1,y:d.height/r.offsetHeight||1,boundingClientRect:d}}static getPoint(r,d,_){const g=d.boundingClientRect;return new o.P((_.clientX-g.left)/d.x-r.clientLeft,(_.clientY-g.top)/d.y-r.clientTop)}static mousePos(r,d){const _=b.getScale(r);return b.getPoint(r,_,d)}static touchPos(r,d){const _=[],g=b.getScale(r);for(let w=0;w<d.length;w++)_.push(b.getPoint(r,g,d[w]));return _}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(M){!P&&k&&(I?V(M):D=M)}};let D,k,P=!1,I=!1;function V(M){const r=M.createTexture();M.bindTexture(M.TEXTURE_2D,r);try{if(M.texImage2D(M.TEXTURE_2D,0,M.RGBA,M.RGBA,M.UNSIGNED_BYTE,k),M.isContextLost())return;E.supported=!0}catch{}M.deleteTexture(r),P=!0}var U;typeof document<"u"&&(k=document.createElement("img"),k.onload=()=>{D&&V(D),D=null,I=!0},k.onerror=()=>{P=!0,D=null},k.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(M){let r,d,_,g;M.resetRequestQueue=()=>{r=[],d=0,_=0,g={}},M.addThrottleControl=F=>{const N=_++;return g[N]=F,N},M.removeThrottleControl=F=>{delete g[F],C()},M.getImage=(F,N,H=!0)=>new Promise((j,tt)=>{E.supported&&(F.headers||(F.headers={}),F.headers.accept="image/webp,*/*"),o.e(F,{type:"image"}),r.push({abortController:N,requestParameters:F,supportImageRefresh:H,state:"queued",onError:ot=>{tt(ot)},onSuccess:ot=>{j(ot)}}),C()});const w=F=>o._(this,void 0,void 0,function*(){F.state="running";const{requestParameters:N,supportImageRefresh:H,onError:j,onSuccess:tt,abortController:ot}=F,ht=H===!1&&!o.i(self)&&!o.g(N.url)&&(!N.headers||Object.keys(N.headers).reduce((vt,Mt)=>vt&&Mt==="accept",!0));d++;const pt=ht?L(N,ot):o.m(N,ot);try{const vt=yield pt;delete F.abortController,F.state="completed",vt.data instanceof HTMLImageElement||o.b(vt.data)?tt(vt):vt.data&&tt({data:yield(yt=vt.data,typeof createImageBitmap=="function"?o.d(yt):o.f(yt)),cacheControl:vt.cacheControl,expires:vt.expires})}catch(vt){delete F.abortController,j(vt)}finally{d--,C()}var yt}),C=()=>{const F=(()=>{for(const N of Object.keys(g))if(g[N]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let N=d;N<F&&r.length>0;N++){const H=r.shift();H.abortController.signal.aborted?N--:w(H)}},L=(F,N)=>new Promise((H,j)=>{const tt=new Image,ot=F.url,ht=F.credentials;ht&&ht==="include"?tt.crossOrigin="use-credentials":(ht&&ht==="same-origin"||!o.s(ot))&&(tt.crossOrigin="anonymous"),N.signal.addEventListener("abort",()=>{tt.src="",j(o.c())}),tt.fetchPriority="high",tt.onload=()=>{tt.onerror=tt.onload=null,H({data:tt})},tt.onerror=()=>{tt.onerror=tt.onload=null,N.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},tt.src=ot})}(U||(U={})),U.resetRequestQueue();class B{constructor(r){this._transformRequestFn=r}transformRequest(r,d){return this._transformRequestFn&&this._transformRequestFn(r,d)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function Z(M){var r=new o.A(3);return r[0]=M[0],r[1]=M[1],r[2]=M[2],r}var Y,K=function(M,r,d){return M[0]=r[0]-d[0],M[1]=r[1]-d[1],M[2]=r[2]-d[2],M};Y=new o.A(3),o.A!=Float32Array&&(Y[0]=0,Y[1]=0,Y[2]=0);var nt=function(M){var r=M[0],d=M[1];return r*r+d*d};function q(M){const r=[];if(typeof M=="string")r.push({id:"default",url:M});else if(M&&M.length>0){const d=[];for(const{id:_,url:g}of M){const w=`${_}${g}`;d.indexOf(w)===-1&&(d.push(w),r.push({id:_,url:g}))}}return r}function J(M,r,d){const _=M.split("?");return _[0]+=`${r}${d}`,_.join("?")}(function(){var M=new o.A(2);o.A!=Float32Array&&(M[0]=0,M[1]=0)})();class ct{constructor(r,d,_,g){this.context=r,this.format=_,this.texture=r.gl.createTexture(),this.update(d,g)}update(r,d,_){const{width:g,height:w}=r,C=!(this.size&&this.size[0]===g&&this.size[1]===w||_),{context:L}=this,{gl:F}=L;if(this.useMipmap=!!(d&&d.useMipmap),F.bindTexture(F.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!d||d.premultiply!==!1)),C)this.size=[g,w],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.b(r)?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,r):F.texImage2D(F.TEXTURE_2D,0,this.format,g,w,0,this.format,F.UNSIGNED_BYTE,r.data);else{const{x:N,y:H}=_||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||o.b(r)?F.texSubImage2D(F.TEXTURE_2D,0,N,H,F.RGBA,F.UNSIGNED_BYTE,r):F.texSubImage2D(F.TEXTURE_2D,0,N,H,g,w,F.RGBA,F.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&F.generateMipmap(F.TEXTURE_2D)}bind(r,d,_){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),r!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,r),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||r),this.filter=r),d!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,d),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function St(M){const{userImage:r}=M;return!!(r&&r.render&&r.render())&&(M.data.replace(new Uint8Array(r.data.buffer)),!0)}class wt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(r){const d=this.images[r];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new o.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(r,d){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,d)&&(this.images[r]=d)}_validate(r,d){let _=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${r}" has invalid "content" value`))),_=!1),_}_validateStretch(r,d){if(!r)return!0;let _=0;for(const g of r){if(g[0]<_||g[1]<g[0]||d<g[1])return!1;_=g[1]}return!0}_validateContent(r,d){if(!r)return!0;if(r.length!==4)return!1;const _=d.spriteData,g=_&&_.width||d.data.width,w=_&&_.height||d.data.height;return!(r[0]<0||g<r[0]||r[1]<0||w<r[1]||r[2]<0||g<r[2]||r[3]<0||w<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,d,_=!0){const g=this.getImage(r);if(_&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[r]=d,this.updatedImages[r]=!0}removeImage(r){const d=this.images[r];delete this.images[r],delete this.patterns[r],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((d,_)=>{let g=!0;if(!this.isLoaded())for(const w of r)this.images[w]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:d})})}_getImagesForIds(r){const d={};for(const _ of r){let g=this.getImage(_);g||(this.fire(new o.k("styleimagemissing",{id:_})),g=this.getImage(_)),g?d[_]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:o.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:r,height:d}=this.atlasImage;return{width:r,height:d}}getPattern(r){const d=this.patterns[r],_=this.getImage(r);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const g={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new o.I(g,_);this.patterns[r]={bin:g,position:w}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const d=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ct(r,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const w in this.patterns)r.push(this.patterns[w].bin);const{w:d,h:_}=o.p(r),g=this.atlasImage;g.resize({width:d||1,height:_||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],L=C.x+1,F=C.y+1,N=this.getImage(w).data,H=N.width,j=N.height;o.R.copy(N,g,{x:0,y:0},{x:L,y:F},{width:H,height:j}),o.R.copy(N,g,{x:0,y:j-1},{x:L,y:F-1},{width:H,height:1}),o.R.copy(N,g,{x:0,y:0},{x:L,y:F+j},{width:H,height:1}),o.R.copy(N,g,{x:H-1,y:0},{x:L-1,y:F},{width:1,height:j}),o.R.copy(N,g,{x:0,y:0},{x:L+H,y:F},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const d of r){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||o.w(`Image with ID: "${d}" was not found`),St(_)&&this.updateImage(d,_)}}}const Pt=1e20;function Gt(M,r,d,_,g,w,C,L,F){for(let N=r;N<r+_;N++)Nt(M,d*w+N,w,g,C,L,F);for(let N=d;N<d+g;N++)Nt(M,N*w+r,1,_,C,L,F)}function Nt(M,r,d,_,g,w,C){w[0]=0,C[0]=-Pt,C[1]=Pt,g[0]=M[r];for(let L=1,F=0,N=0;L<_;L++){g[L]=M[r+L*d];const H=L*L;do{const j=w[F];N=(g[L]-g[j]+H-j*j)/(L-j)/2}while(N<=C[F]&&--F>-1);F++,w[F]=L,C[F]=N,C[F+1]=Pt}for(let L=0,F=0;L<_;L++){for(;C[F+1]<L;)F++;const N=w[F],H=L-N;M[r+L*d]=g[N]+H*H}}class Zt{constructor(r,d){this.requestManager=r,this.localIdeographFontFamily=d,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return o._(this,void 0,void 0,function*(){const d=[];for(const w in r)for(const C of r[w])d.push(this._getAndCacheGlyphsPromise(w,C));const _=yield Promise.all(d),g={};for(const{stack:w,id:C,glyph:L}of _)g[w]||(g[w]={}),g[w][C]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return g})}_getAndCacheGlyphsPromise(r,d){return o._(this,void 0,void 0,function*(){let _=this.entries[r];_||(_=this.entries[r]={glyphs:{},requests:{},ranges:{}});let g=_.glyphs[d];if(g!==void 0)return{stack:r,id:d,glyph:g};if(g=this._tinySDF(_,r,d),g)return _.glyphs[d]=g,{stack:r,id:d,glyph:g};const w=Math.floor(d/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:r,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const L=Zt.loadGlyphRange(r,w,this.url,this.requestManager);_.requests[w]=L}const C=yield _.requests[w];for(const L in C)this._doesCharSupportLocalGlyph(+L)||(_.glyphs[+L]=C[+L]);return _.ranges[w]=!0,{stack:r,id:d,glyph:C[d]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(r))}_tinySDF(r,d,_){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(_))return;let w=r.tinySDF;if(!w){let L="400";/bold/i.test(d)?L="900":/medium/i.test(d)?L="500":/light/i.test(d)&&(L="200"),w=r.tinySDF=new Zt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:L})}const C=w.draw(String.fromCharCode(_));return{id:_,bitmap:new o.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Zt.loadGlyphRange=function(M,r,d,_){return o._(this,void 0,void 0,function*(){const g=256*r,w=g+255,C=_.transformRequest(d.replace("{fontstack}",M).replace("{range}",`${g}-${w}`),"Glyphs"),L=yield o.l(C,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${r}, ${g}-${w}`);const F={};for(const N of o.n(L.data))F[N.id]=N;return F})},Zt.TinySDF=class{constructor({fontSize:M=24,buffer:r=3,radius:d=8,cutoff:_=.25,fontFamily:g="sans-serif",fontWeight:w="normal",fontStyle:C="normal"}={}){this.buffer=r,this.cutoff=_,this.radius=d;const L=this.size=M+4*r,F=this._createCanvas(L),N=this.ctx=F.getContext("2d",{willReadFrequently:!0});N.font=`${C} ${w} ${M}px ${g}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(M){const r=document.createElement("canvas");return r.width=r.height=M,r}draw(M){const{width:r,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:g,actualBoundingBoxRight:w}=this.ctx.measureText(M),C=Math.ceil(d),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-g))),F=Math.min(this.size-this.buffer,C+Math.ceil(_)),N=L+2*this.buffer,H=F+2*this.buffer,j=Math.max(N*H,0),tt=new Uint8ClampedArray(j),ot={data:tt,width:N,height:H,glyphWidth:L,glyphHeight:F,glyphTop:C,glyphLeft:0,glyphAdvance:r};if(L===0||F===0)return ot;const{ctx:ht,buffer:pt,gridInner:yt,gridOuter:vt}=this;ht.clearRect(pt,pt,L,F),ht.fillText(M,pt,pt+C);const Mt=ht.getImageData(pt,pt,L,F);vt.fill(Pt,0,j),yt.fill(0,0,j);for(let dt=0;dt<F;dt++)for(let Ct=0;Ct<L;Ct++){const Lt=Mt.data[4*(dt*L+Ct)+3]/255;if(Lt===0)continue;const Bt=(dt+pt)*N+Ct+pt;if(Lt===1)vt[Bt]=0,yt[Bt]=Pt;else{const ee=.5-Lt;vt[Bt]=ee>0?ee*ee:0,yt[Bt]=ee<0?ee*ee:0}}Gt(vt,0,0,N,H,N,this.f,this.v,this.z),Gt(yt,pt,pt,L,F,N,this.f,this.v,this.z);for(let dt=0;dt<j;dt++){const Ct=Math.sqrt(vt[dt])-Math.sqrt(yt[dt]);tt[dt]=Math.round(255-255*(Ct/this.radius+this.cutoff))}return ot}};class qt{constructor(){this.specification=o.v.light.position}possiblyEvaluate(r,d){return o.x(r.expression.evaluate(d))}interpolate(r,d,_){return{x:o.y.number(r.x,d.x,_),y:o.y.number(r.y,d.y,_),z:o.y.number(r.z,d.z,_)}}}let me;class Ee extends o.E{constructor(r){super(),me=me||new o.q({anchor:new o.D(o.v.light.anchor),position:new qt,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(me),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,d={}){if(!this._validate(o.r,r,d))for(const _ in r){const g=r[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),g):this._transitionable.setValue(_,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,_){return(!_||_.validate!==!1)&&o.t(this,r.call(o.u,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Le=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class ri extends o.E{constructor(r){super(),this._transitionable=new o.T(Le),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(r,d={}){if(!this._validate(o.B,r,d)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in r){const g=r[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),g):this._transitionable.setValue(_,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,_={}){return(_==null?void 0:_.validate)!==!1&&o.t(this,r.call(o.u,o.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class Ni{constructor(r,d){this.width=r,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,d){const _=r.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(r,d)),this.dashEntry[_]}getDashRanges(r,d,_){const g=[];let w=r.length%2==1?-r[r.length-1]*_:0,C=r[0]*_,L=!0;g.push({left:w,right:C,isDash:L,zeroLength:r[0]===0});let F=r[0];for(let N=1;N<r.length;N++){L=!L;const H=r[N];w=F*_,F+=H,C=F*_,g.push({left:w,right:C,isDash:L,zeroLength:H===0})}return g}addRoundDash(r,d,_){const g=d/2;for(let w=-_;w<=_;w++){const C=this.width*(this.nextRow+_+w);let L=0,F=r[L];for(let N=0;N<this.width;N++){N/F.right>1&&(F=r[++L]);const H=Math.abs(N-F.left),j=Math.abs(N-F.right),tt=Math.min(H,j);let ot;const ht=w/_*(g+1);if(F.isDash){const pt=g-Math.abs(ht);ot=Math.sqrt(tt*tt+pt*pt)}else ot=g-Math.sqrt(tt*tt+ht*ht);this.data[C+N]=Math.max(0,Math.min(255,ot+128))}}}addRegularDash(r){for(let L=r.length-1;L>=0;--L){const F=r[L],N=r[L+1];F.zeroLength?r.splice(L,1):N&&N.isDash===F.isDash&&(N.left=F.left,r.splice(L,1))}const d=r[0],_=r[r.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const g=this.width*this.nextRow;let w=0,C=r[w];for(let L=0;L<this.width;L++){L/C.right>1&&(C=r[++w]);const F=Math.abs(L-C.left),N=Math.abs(L-C.right),H=Math.min(F,N);this.data[g+L]=Math.max(0,Math.min(255,(C.isDash?H:-H)+128))}}addDash(r,d){const _=d?7:0,g=2*_+1;if(this.nextRow+g>this.height)return o.w("LineAtlas out of space"),null;let w=0;for(let L=0;L<r.length;L++)w+=r[L];if(w!==0){const L=this.width/w,F=this.getDashRanges(r,this.width,L);d?this.addRoundDash(F,L,_):this.addRegularDash(F)}const C={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=g,this.dirty=!0,C}bind(r){const d=r.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Jt="maplibre_preloaded_worker_pool";class le{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<le.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Jt]}numActive(){return Object.keys(this.active).length}}const qe=Math.floor(v.hardwareConcurrency/2);let be,Qe;function gi(){return be||(be=new le),be}le.workerCount=o.C(globalThis)?Math.max(Math.min(qe,3),1):1;class bi{constructor(r,d){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let g=0;g<_.length;g++){const w=new o.F(_[g],d);w.name=`Worker ${g}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,d){const _=[];for(const g of this.actors)_.push(g.sendAsync({type:r,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,d){for(const _ of this.actors)_.registerMessageHandler(r,d)}}function Zi(){return Qe||(Qe=new bi(gi(),o.G),Qe.registerMessageHandler("GR",(M,r,d)=>o.m(r,d))),Qe}function Ei(M,r){const d=o.H();return o.J(d,d,[1,1,0]),o.K(d,d,[.5*M.width,.5*M.height,1]),o.L(d,d,M.calculatePosMatrix(r.toUnwrapped()))}function $i(M,r,d,_,g,w){const C=function(j,tt,ot){if(j)for(const ht of j){const pt=tt[ht];if(pt&&pt.source===ot&&pt.type==="fill-extrusion")return!0}else for(const ht in tt){const pt=tt[ht];if(pt.source===ot&&pt.type==="fill-extrusion")return!0}return!1}(g&&g.layers,r,M.id),L=w.maxPitchScaleFactor(),F=M.tilesIn(_,L,C);F.sort(zt);const N=[];for(const j of F)N.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(r,d,M._state,j.queryGeometry,j.cameraQueryGeometry,j.scale,g,w,L,Ei(M.transform,j.tileID))});const H=function(j){const tt={},ot={};for(const ht of j){const pt=ht.queryResults,yt=ht.wrappedTileID,vt=ot[yt]=ot[yt]||{};for(const Mt in pt){const dt=pt[Mt],Ct=vt[Mt]=vt[Mt]||{},Lt=tt[Mt]=tt[Mt]||[];for(const Bt of dt)Ct[Bt.featureIndex]||(Ct[Bt.featureIndex]=!0,Lt.push(Bt))}}return tt}(N);for(const j in H)H[j].forEach(tt=>{const ot=tt.feature,ht=M.getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=ht});return H}function zt(M,r){const d=M.tileID,_=r.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function jn(M,r,d){return o._(this,void 0,void 0,function*(){let _=M;if(M.url?_=(yield o.h(r.transformRequest(M.url,"Source"),d)).data:yield v.frameAsync(d),!_)return null;const g=o.M(o.e(_,M),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(g.vectorLayerIds=_.vector_layers.map(w=>w.id)),g})}class Ft{constructor(r,d){r&&(d?this.setSouthWest(r).setNorthEast(d):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof o.N?new o.N(r.lng,r.lat):o.N.convert(r),this}setSouthWest(r){return this._sw=r instanceof o.N?new o.N(r.lng,r.lat):o.N.convert(r),this}extend(r){const d=this._sw,_=this._ne;let g,w;if(r instanceof o.N)g=r,w=r;else{if(!(r instanceof Ft))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Ft.convert(r)):this.extend(o.N.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(o.N.convert(r)):this;if(g=r._sw,w=r._ne,!g||!w)return this}return d||_?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new o.N(g.lng,g.lat),this._ne=new o.N(w.lng,w.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:d,lat:_}=o.N.convert(r);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&g}static convert(r){return r instanceof Ft?r:r&&new Ft(r)}static fromLngLat(r,d=0){const _=360*d/40075017,g=_/Math.cos(Math.PI/180*r.lat);return new Ft(new o.N(r.lng-g,r.lat-_),new o.N(r.lng+g,r.lat+_))}adjustAntiMeridian(){const r=new o.N(this._sw.lng,this._sw.lat),d=new o.N(this._ne.lng,this._ne.lat);return new Ft(r,r.lng>d.lng?new o.N(d.lng+360,d.lat):d)}}class Ai{constructor(r,d,_){this.bounds=Ft.convert(this.validateBounds(r)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const d=Math.pow(2,r.z),_=Math.floor(o.O(this.bounds.getWest())*d),g=Math.floor(o.Q(this.bounds.getNorth())*d),w=Math.ceil(o.O(this.bounds.getEast())*d),C=Math.ceil(o.Q(this.bounds.getSouth())*d);return r.x>=_&&r.x<w&&r.y>=g&&r.y<C}}class oi extends o.E{constructor(r,d,_,g){if(super(),this.id=r,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Ai(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new o.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(r){return o._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((w,C)=>{r.reloadPromise={resolve:w,reject:C}})}else r.actor=this.dispatcher.getActor(),g="LT";r.abortController=new AbortController;try{const w=yield r.actor.sendAsync({type:g,data:_},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,w)}catch(w){if(delete r.abortController,r.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,d){if(d&&d.resourceTiming&&(r.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&r.setExpiryData(d),r.loadVectorData(d,this.map.painter),r.reloadPromise){const _=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(_.resolve).catch(_.reject)}}abortTile(r){return o._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return o._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ti extends o.E{constructor(r,d,_,g){super(),this.id=r,this.dispatcher=_,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.M(d,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Ai(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new o.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return o._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const _=yield U.getImage(this.map._requestManager.transformRequest(d,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&r.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const g=this.map.painter.context,w=g.gl,C=_.data;r.texture=this.map.painter.getTileTexture(C.width),r.texture?r.texture.update(C,{useMipmap:!0}):(r.texture=new ct(g,C,w.RGBA,{useMipmap:!0}),r.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(_){if(delete r.abortController,r.aborted)r.state="unloaded";else if(_)throw r.state="errored",_}})}abortTile(r){return o._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return o._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class ke extends ti{constructor(r,d,_,g){super(r,d,_,g),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(r){return o._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const g=yield U.getImage(_,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(g&&g.data){const w=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&r.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const C=o.b(w)&&o.U()?w:yield this.readImageNow(w),L={type:this.type,uid:r.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const F=yield r.actor.sendAsync({type:"LDT",data:L});r.dem=F,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(g){if(delete r.abortController,r.aborted)r.state="unloaded";else if(g)throw r.state="errored",g}})}readImageNow(r){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const d=r.width+2,_=r.height+2;try{return new o.R({width:d,height:_},yield o.W(r,-1,-1,d,_))}catch{}}return v.getImageData(r,1)})}_getNeighboringTiles(r){const d=r.canonical,_=Math.pow(2,d.z),g=(d.x-1+_)%_,w=d.x===0?r.wrap-1:r.wrap,C=(d.x+1+_)%_,L=d.x+1===_?r.wrap+1:r.wrap,F={};return F[new o.S(r.overscaledZ,w,d.z,g,d.y).key]={backfilled:!1},F[new o.S(r.overscaledZ,L,d.z,C,d.y).key]={backfilled:!1},d.y>0&&(F[new o.S(r.overscaledZ,w,d.z,g,d.y-1).key]={backfilled:!1},F[new o.S(r.overscaledZ,r.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},F[new o.S(r.overscaledZ,L,d.z,C,d.y-1).key]={backfilled:!1}),d.y+1<_&&(F[new o.S(r.overscaledZ,w,d.z,g,d.y+1).key]={backfilled:!1},F[new o.S(r.overscaledZ,r.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},F[new o.S(r.overscaledZ,L,d.z,C,d.y+1).key]={backfilled:!1}),F}unloadTile(r){return o._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class mt extends o.E{constructor(r,d,_,g){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(g),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const w=o.X/this.tileSize;d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*w,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*w,extent:o.X,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.X,radius:(d.clusterRadius||50)*w,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}getData(){return o._(this,void 0,void 0,function*(){const r=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})})}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,d,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:d,offset:_}})}_updateWorkerData(r){return o._(this,void 0,void 0,function*(){const d=o.e({type:this.type},this.workerOptions);r?d.dataDiff=r:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(v.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let g=null;_.resourceTiming&&_.resourceTiming[this.id]&&(g=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&o.e(w,{resourceTiming:g}),this.fire(new o.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(r){return o._(this,void 0,void 0,function*(){const d=r.actor?"RT":"LT";r.actor=this.actor;const _={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:_},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(g,this.map.painter,d==="RT")})}abortTile(r){return o._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return o._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var st=o.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ht extends o.E{constructor(r,d,_,g){super(),this.id=r,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(r){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield U.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,r&&(this.coordinates=r),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new o.j(d))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const d=r.map(o.Z.fromLngLat);this.tileID=function(g){let w=1/0,C=1/0,L=-1/0,F=-1/0;for(const tt of g)w=Math.min(w,tt.x),C=Math.min(C,tt.y),L=Math.max(L,tt.x),F=Math.max(F,tt.y);const N=Math.max(L-w,F-C),H=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),j=Math.pow(2,H);return new o.a1(H,Math.floor((w+L)/2*j),Math.floor((C+F)/2*j))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new o.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,o.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,o.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,o.X,o.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ct(r,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const g in this.tiles){const w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class re extends Ht{constructor(r,d,_,g){super(r,d,_,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const d of r.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield o.a3(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const d=this.video.seekable;r<d.start(0)||r>d.end(0)?this.fire(new o.j(new o.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ct(r,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const g in this.tiles){const w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ae extends Ht{constructor(r,d,_,g){super(r,d,_,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(C=>typeof C!="number"))||this.fire(new o.j(new o.a2(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a2(`sources.${r}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.a2(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a2(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a2(`sources.${r}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ct(d,this.canvas,_.RGBA,{premultiply:!0});let g=!1;for(const w in this.tiles){const C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const ie={},$e=M=>{switch(M){case"geojson":return mt;case"image":return Ht;case"raster":return ti;case"raster-dem":return ke;case"vector":return oi;case"video":return re;case"canvas":return ae}return ie[M]},Ut="RTLPluginLoaded";class Ie extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Zi()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return o._(this,arguments,void 0,function*(d,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=v.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Ut))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let yi=null;function ue(){return yi||(yi=new Ie),yi}class Be{constructor(r,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=o.a4(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const d=r+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,w){const C={};if(!w)return C;for(const L of g){const F=L.layerIds.map(N=>w.getLayer(N)).filter(Boolean);if(F.length!==0){L.layers=F,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(N=>F.filter(H=>H.id===N)[0]));for(const N of F)C[N.id]=L}}return C}(r.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const w=this.buckets[g];if(w instanceof o.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const w=this.buckets[g];if(w instanceof o.a6&&w.hasRTLText){this.hasRTLText=!0,ue().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const w=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(w))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new o.a5}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const _ in this.buckets){const g=this.buckets[_];g.uploadPending()&&g.upload(r)}const d=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ct(r,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ct(r,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,d,_,g,w,C,L,F,N,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:w,scale:C,tileSize:this.tileSize,pixelPosMatrix:H,transform:F,params:L,queryPadding:this.queryPadding*N},r,d,_):{}}querySourceFeatures(r,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const g=_.loadVTLayers(),w=d&&d.sourceLayer?d.sourceLayer:"",C=g._geojsonTileLayer||g[w];if(!C)return;const L=o.a7(d&&d.filter),{z:F,x:N,y:H}=this.tileID.canonical,j={z:F,x:N,y:H};for(let tt=0;tt<C.length;tt++){const ot=C.feature(tt);if(L.needGeometry){const yt=o.a8(ot,!0);if(!L.filter(new o.z(this.tileID.overscaledZ),yt,this.tileID.canonical))continue}else if(!L.filter(new o.z(this.tileID.overscaledZ),ot))continue;const ht=_.getId(ot,w),pt=new o.a9(ot,F,N,H,ht);pt.tile=j,r.push(pt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const d=this.expirationTime;if(r.cacheControl){const _=o.aa(r.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const _=Date.now();let g=!1;if(this.expirationTime>_)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const w=this.expirationTime-d;w?this.expirationTime=_+Math.max(w,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const w=this.buckets[g],C=w.layers[0].sourceLayer||"_geojsonTileLayer",L=_[C],F=r[C];if(!L||!F||Object.keys(F).length===0)continue;w.update(F,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const N=d&&d.style&&d.style.getLayer(g);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=v.now()+r}setDependencies(r,d){const _={};for(const g of d)_[g]=!0;this.dependencies[r]=_}hasDependency(r,d){for(const _ of r){const g=this.dependencies[_];if(g){for(const w of d)if(g[w])return!0}}return!1}}class Yt{constructor(r,d){this.max=r,this.onRemove=d,this.reset()}reset(){for(const r in this.data)for(const d of this.data[r])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(r,d,_){const g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const w={value:d,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(r,w)},_)),this.data[g].push(w),this.order.push(g),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const d=this.data[r].shift();return d.timeout&&clearTimeout(d.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),d.value}getByKey(r){const d=this.data[r];return d?d[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,d){if(!this.has(r))return this;const _=r.wrapped().key,g=d===void 0?0:this.data[_].indexOf(d),w=this.data[_][g];return this.data[_].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(r){const d=[];for(const _ in this.data)for(const g of this.data[_])r(g.value)||d.push(g);for(const _ of d)this.remove(_.value.tileID,_)}}class ge{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,d,_){const g=String(d);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},o.e(this.stateChanges[r][g],_),this.deletedStates[r]===null){this.deletedStates[r]={};for(const w in this.state[r])w!==g&&(this.deletedStates[r][w]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(const w in this.state[r][g])_[w]||(this.deletedStates[r][g][w]=null)}else for(const w in _)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][w]===null&&delete this.deletedStates[r][g][w]}removeFeatureState(r,d,_){if(this.deletedStates[r]===null)return;const g=String(d);if(this.deletedStates[r]=this.deletedStates[r]||{},_&&d!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][_]=null);else if(d!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(_ in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][_]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,d){const _=String(d),g=o.e({},(this.state[r]||{})[_],(this.stateChanges[r]||{})[_]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const w=this.deletedStates[r][d];if(w===null)return{};for(const C in w)delete g[C]}return g}initializeTileState(r,d){r.setFeatureState(this.state,d)}coalesceChanges(r,d){const _={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const w={};for(const C in this.stateChanges[g])this.state[g][C]||(this.state[g][C]={}),o.e(this.state[g][C],this.stateChanges[g][C]),w[C]=this.state[g][C];_[g]=w}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const w={};if(this.deletedStates[g]===null)for(const C in this.state[g])w[C]={},this.state[g][C]={};else for(const C in this.deletedStates[g]){if(this.deletedStates[g][C]===null)this.state[g][C]={};else for(const L of Object.keys(this.deletedStates[g][C]))delete this.state[g][C][L];w[C]=this.state[g][C]}_[g]=_[g]||{},o.e(_[g],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const g in r)r[g].setFeatureState(_,d)}}class ne extends o.E{constructor(r,d,_){super(),this.id=r,this.dispatcher=_,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,w,C,L)=>{const F=new($e(w.type))(g,w,C,L);if(F.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${F.id}`);return F})(r,d,_,this),this._tiles={},this._cache=new Yt(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ge,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const d=this._tiles[r];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,d,_){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,d,_)}catch(g){r.state="errored",g.status!==404?this._source.fire(new o.j(g,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new o.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(r),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(xi).map(r=>r.key)}getRenderableIds(r){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,r)&&d.push(this._tiles[_]);return r?d.sort((_,g)=>{const w=_.tileID,C=g.tileID,L=new o.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),F=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-C.overscaledZ||F.y-L.y||F.x-L.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(xi).map(_=>_.key)}hasRenderableParent(r){const d=this.findLoadedParent(r,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(r,d){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(d||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,d){return o._(this,void 0,void 0,function*(){const _=this._tiles[r];_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,r,d))})}_tileLoaded(r,d,_){r.timeAdded=v.now(),_==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(d,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const w=d[g];if(r.neighboringTiles&&r.neighboringTiles[w]){const C=this.getTileByID(w);_(r,C),_(C,r)}}function _(g,w){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let C=w.tileID.canonical.x-g.tileID.canonical.x;const L=w.tileID.canonical.y-g.tileID.canonical.y,F=Math.pow(2,g.tileID.canonical.z),N=w.tileID.key;C===0&&L===0||Math.abs(L)>1||(Math.abs(C)>1&&(Math.abs(C+F)===1?C+=F:Math.abs(C-F)===1&&(C-=F)),w.dem&&g.dem&&(g.dem.backfillBorder(w.dem,C,L),g.neighboringTiles&&g.neighboringTiles[N]&&(g.neighboringTiles[N].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,d,_,g){for(const w in this._tiles){let C=this._tiles[w];if(g[w]||!C.hasData()||C.tileID.overscaledZ<=d||C.tileID.overscaledZ>_)continue;let L=C.tileID;for(;C&&C.tileID.overscaledZ>d+1;){const N=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[N.key],C&&C.hasData()&&(L=N)}let F=L;for(;F.overscaledZ>d;)if(F=F.scaledTo(F.overscaledZ-1),r[F.key]){g[L.key]=L;break}}}findLoadedParent(r,d){if(r.key in this._loadedParentTiles){const _=this._loadedParentTiles[r.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=r.overscaledZ-1;_>=d;_--){const g=r.scaledTo(_),w=this._getLoadedTile(g);if(w)return w}}findLoadedSibling(r){return this._getLoadedTile(r)}_getLoadedTile(r){const d=this._tiles[r.key];return d&&d.hasData()?d:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const d=Math.ceil(r.width/this._source.tileSize)+1,_=Math.ceil(r.height/this._source.tileSize)+1,g=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(w)}handleWrapJump(r){const d=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,d){const _={};for(const g in this._tiles){const w=this._tiles[g];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+d),_[w.tileID.key]=w}this._tiles=_;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(r,d,_,g,w,C){const L={},F={},N=Object.keys(r),H=v.now();for(const j of N){const tt=r[j],ot=this._tiles[j];if(!ot||ot.fadeEndTime!==0&&ot.fadeEndTime<=H)continue;const ht=this.findLoadedParent(tt,d),pt=this.findLoadedSibling(tt),yt=ht||pt||null;yt&&(this._addTile(yt.tileID),L[yt.tileID.key]=yt.tileID),F[j]=tt}this._retainLoadedChildren(F,g,_,r);for(const j in L)r[j]||(this._coveredTiles[j]=!0,r[j]=L[j]);if(C){const j={},tt={};for(const ot of w)this._tiles[ot.key].hasData()?j[ot.key]=ot:tt[ot.key]=ot;for(const ot in tt){const ht=tt[ot].children(this._source.maxzoom);this._tiles[ht[0].key]&&this._tiles[ht[1].key]&&this._tiles[ht[2].key]&&this._tiles[ht[3].key]&&(j[ht[0].key]=r[ht[0].key]=ht[0],j[ht[1].key]=r[ht[1].key]=ht[1],j[ht[2].key]=r[ht[2].key]=ht[2],j[ht[3].key]=r[ht[3].key]=ht[3],delete tt[ot])}for(const ot in tt){const ht=tt[ot],pt=this.findLoadedParent(ht,this._source.minzoom),yt=this.findLoadedSibling(ht),vt=pt||yt||null;if(vt){j[vt.tileID.key]=r[vt.tileID.key]=vt.tileID;for(const Mt in j)j[Mt].isChildOf(vt.tileID)&&delete j[Mt]}}for(const ot in this._tiles)j[ot]||(this._coveredTiles[ot]=!0)}}update(r,d){if(!this._sourceLoaded||this._paused)return;let _;this.transform=r,this.terrain=d,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new o.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const g=r.coveringZoomLevel(this._source),w=Math.max(g-ne.maxOverzooming,this._source.minzoom),C=Math.max(g+ne.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const j of _)if(j.canonical.z>this._source.minzoom){const tt=j.scaledTo(j.canonical.z-1);H[tt.key]=tt;const ot=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));H[ot.key]=ot}_=_.concat(Object.values(H))}const L=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const F=this._updateRetainedTiles(_,g);ci(this._source.type)&&this._updateCoveredAndRetainedTiles(F,w,C,g,_,d);for(const H in F)this._tiles[H].clearFadeHold();const N=o.ab(this._tiles,F);for(const H of N){const j=this._tiles[H];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,d){var _;const g={},w={},C=Math.max(d-ne.maxOverzooming,this._source.minzoom),L=Math.max(d+ne.maxUnderzooming,this._source.minzoom),F={};for(const N of r){const H=this._addTile(N);g[N.key]=N,H.hasData()||d<this._source.maxzoom&&(F[N.key]=N)}this._retainLoadedChildren(F,d,L,g);for(const N of r){let H=this._tiles[N.key];if(H.hasData())continue;if(d+1>this._source.maxzoom){const tt=N.children(this._source.maxzoom)[0],ot=this.getTile(tt);if(ot&&ot.hasData()){g[tt.key]=tt;continue}}else{const tt=N.children(this._source.maxzoom);if(g[tt[0].key]&&g[tt[1].key]&&g[tt[2].key]&&g[tt[3].key])continue}let j=H.wasRequested();for(let tt=N.overscaledZ-1;tt>=C;--tt){const ot=N.scaledTo(tt);if(w[ot.key])break;if(w[ot.key]=!0,H=this.getTile(ot),!H&&j&&(H=this._addTile(ot)),H){const ht=H.hasData();if((ht||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||j)&&(g[ot.key]=ot),j=H.wasRequested(),ht)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const d=[];let _,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){_=this._loadedParentTiles[g.key];break}d.push(g.key);const w=g.scaledTo(g.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;g=w}for(const w of d)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const r in this._tiles){const d=this._tiles[r].tileID,_=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=_}}_addTile(r){let d=this._tiles[r.key];if(d)return d;d=this._cache.getAndRemove(r),d&&(this._setTileReloadTimer(r.key,d),d.tileID=r,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,d)));const _=d;return d||(d=new Be(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(d,r.key,d.state)),d.uses++,this._tiles[r.key]=d,_||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(r,d){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const _=d.getExpiryTimeout();_&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},_))}_removeTile(r){const d=this._tiles[r];d&&(d.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(r){const d=r.sourceDataType;r.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,d,_){const g=[],w=this.transform;if(!w)return g;const C=_?w.getCameraQueryGeometry(r):r,L=r.map(ht=>w.pointCoordinate(ht,this.terrain)),F=C.map(ht=>w.pointCoordinate(ht,this.terrain)),N=this.getIds();let H=1/0,j=1/0,tt=-1/0,ot=-1/0;for(const ht of F)H=Math.min(H,ht.x),j=Math.min(j,ht.y),tt=Math.max(tt,ht.x),ot=Math.max(ot,ht.y);for(let ht=0;ht<N.length;ht++){const pt=this._tiles[N[ht]];if(pt.holdingForFade())continue;const yt=pt.tileID,vt=Math.pow(2,w.zoom-pt.tileID.overscaledZ),Mt=d*pt.queryPadding*o.X/pt.tileSize/vt,dt=[yt.getTilePoint(new o.Z(H,j)),yt.getTilePoint(new o.Z(tt,ot))];if(dt[0].x-Mt<o.X&&dt[0].y-Mt<o.X&&dt[1].x+Mt>=0&&dt[1].y+Mt>=0){const Ct=L.map(Bt=>yt.getTilePoint(Bt)),Lt=F.map(Bt=>yt.getTilePoint(Bt));g.push({tile:pt,tileID:yt,queryGeometry:Ct,cameraQueryGeometry:Lt,scale:vt})}}return g}getVisibleCoordinates(r){const d=this.getRenderableIds(r).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(ci(this._source.type)){const r=v.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=r)return!0}return!1}setFeatureState(r,d,_){this._state.updateState(r=r||"_geojsonTileLayer",d,_)}removeFeatureState(r,d,_){this._state.removeFeatureState(r=r||"_geojsonTileLayer",d,_)}getFeatureState(r,d){return this._state.getState(r=r||"_geojsonTileLayer",d)}setDependencies(r,d,_){const g=this._tiles[r];g&&g.setDependencies(d,_)}reloadTilesForDependencies(r,d){for(const _ in this._tiles)this._tiles[_].hasDependency(r,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(r,d))}}function xi(M,r){const d=Math.abs(2*M.wrap)-+(M.wrap<0),_=Math.abs(2*r.wrap)-+(r.wrap<0);return M.overscaledZ-r.overscaledZ||_-d||r.canonical.y-M.canonical.y||r.canonical.x-M.canonical.x}function ci(M){return M==="raster"||M==="image"||M==="video"}ne.maxOverzooming=10,ne.maxUnderzooming=3;class Re{constructor(r,d){this.reset(r,d)}reset(r,d){this.points=r||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ac(r,0,1);let d=1,_=this._distances[d];const g=r*this.paddedLength+this.padding;for(;_<g&&d<this._distances.length;)_=this._distances[++d];const w=d-1,C=this._distances[w],L=_-C,F=L>0?(g-C)/L:0;return this.points[w].mult(1-F).add(this.points[d].mult(F))}}function It(M,r){let d=!0;return M==="always"||M!=="never"&&r!=="never"||(d=!1),d}class Me{constructor(r,d,_){const g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(r/_),this.yCellCount=Math.ceil(d/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=d,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,d,_,g,w){this._forEachCell(d,_,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(g),this.bboxes.push(w)}insertCircle(r,d,_,g){this._forEachCell(d-g,_-g,d+g,_+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(d),this.circles.push(_),this.circles.push(g)}_insertBoxCell(r,d,_,g,w,C){this.boxCells[w].push(C)}_insertCircleCell(r,d,_,g,w,C){this.circleCells[w].push(C)}_query(r,d,_,g,w,C,L){if(_<0||r>this.width||g<0||d>this.height)return[];const F=[];if(r<=0&&d<=0&&this.width<=_&&this.height<=g){if(w)return[{key:null,x1:r,y1:d,x2:_,y2:g}];for(let N=0;N<this.boxKeys.length;N++)F.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const H=this.circles[3*N],j=this.circles[3*N+1],tt=this.circles[3*N+2];F.push({key:this.circleKeys[N],x1:H-tt,y1:j-tt,x2:H+tt,y2:j+tt})}}else this._forEachCell(r,d,_,g,this._queryCell,F,{hitTest:w,overlapMode:C,seenUids:{box:{},circle:{}}},L);return F}query(r,d,_,g){return this._query(r,d,_,g,!1,null)}hitTest(r,d,_,g,w,C){return this._query(r,d,_,g,!0,w,C).length>0}hitTestCircle(r,d,_,g,w){const C=r-_,L=r+_,F=d-_,N=d+_;if(L<0||C>this.width||N<0||F>this.height)return!1;const H=[];return this._forEachCell(C,F,L,N,this._queryCellCircle,H,{hitTest:!0,overlapMode:g,circle:{x:r,y:d,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(r,d,_,g,w,C,L,F){const{seenUids:N,hitTest:H,overlapMode:j}=L,tt=this.boxCells[w];if(tt!==null){const ht=this.bboxes;for(const pt of tt)if(!N.box[pt]){N.box[pt]=!0;const yt=4*pt,vt=this.boxKeys[pt];if(r<=ht[yt+2]&&d<=ht[yt+3]&&_>=ht[yt+0]&&g>=ht[yt+1]&&(!F||F(vt))&&(!H||!It(j,vt.overlapMode))&&(C.push({key:vt,x1:ht[yt],y1:ht[yt+1],x2:ht[yt+2],y2:ht[yt+3]}),H))return!0}}const ot=this.circleCells[w];if(ot!==null){const ht=this.circles;for(const pt of ot)if(!N.circle[pt]){N.circle[pt]=!0;const yt=3*pt,vt=this.circleKeys[pt];if(this._circleAndRectCollide(ht[yt],ht[yt+1],ht[yt+2],r,d,_,g)&&(!F||F(vt))&&(!H||!It(j,vt.overlapMode))){const Mt=ht[yt],dt=ht[yt+1],Ct=ht[yt+2];if(C.push({key:vt,x1:Mt-Ct,y1:dt-Ct,x2:Mt+Ct,y2:dt+Ct}),H)return!0}}}return!1}_queryCellCircle(r,d,_,g,w,C,L,F){const{circle:N,seenUids:H,overlapMode:j}=L,tt=this.boxCells[w];if(tt!==null){const ht=this.bboxes;for(const pt of tt)if(!H.box[pt]){H.box[pt]=!0;const yt=4*pt,vt=this.boxKeys[pt];if(this._circleAndRectCollide(N.x,N.y,N.radius,ht[yt+0],ht[yt+1],ht[yt+2],ht[yt+3])&&(!F||F(vt))&&!It(j,vt.overlapMode))return C.push(!0),!0}}const ot=this.circleCells[w];if(ot!==null){const ht=this.circles;for(const pt of ot)if(!H.circle[pt]){H.circle[pt]=!0;const yt=3*pt,vt=this.circleKeys[pt];if(this._circlesCollide(ht[yt],ht[yt+1],ht[yt+2],N.x,N.y,N.radius)&&(!F||F(vt))&&!It(j,vt.overlapMode))return C.push(!0),!0}}}_forEachCell(r,d,_,g,w,C,L,F){const N=this._convertToXCellCoord(r),H=this._convertToYCellCoord(d),j=this._convertToXCellCoord(_),tt=this._convertToYCellCoord(g);for(let ot=N;ot<=j;ot++)for(let ht=H;ht<=tt;ht++)if(w.call(this,r,d,_,g,this.xCellCount*ht+ot,C,L,F))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,d,_,g,w,C){const L=g-r,F=w-d,N=_+C;return N*N>L*L+F*F}_circleAndRectCollide(r,d,_,g,w,C,L){const F=(C-g)/2,N=Math.abs(r-(g+F));if(N>F+_)return!1;const H=(L-w)/2,j=Math.abs(d-(w+H));if(j>H+_)return!1;if(N<=F||j<=H)return!0;const tt=N-F,ot=j-H;return tt*tt+ot*ot<=_*_}}function Kt(M,r,d,_,g){const w=o.H();return r?(o.K(w,w,[1/g,1/g,1]),d||o.ad(w,w,_.angle)):o.L(w,_.labelPlaneMatrix,M),w}function se(M,r,d,_,g){if(r){const w=o.ae(M);return o.K(w,w,[g,g,1]),d||o.ad(w,w,-_.angle),w}return _.glCoordMatrix}function lt(M,r,d,_){let g;_?(g=[M,r,_(M,r),1],o.af(g,g,d)):(g=[M,r,0,1],ki(g,g,d));const w=g[3];return{point:new o.P(g[0]/w,g[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function W(M,r){return .5+M/r*.5}function X(M,r){return M.x>=-r[0]&&M.x<=r[0]&&M.y>=-r[1]&&M.y<=r[1]}function it(M,r,d,_,g,w,C,L,F,N,H,j,tt,ot,ht){const pt=_?M.textSizeData:M.iconSizeData,yt=o.ag(pt,d.transform.zoom),vt=[256/d.width*2+1,256/d.height*2+1],Mt=_?M.text.dynamicLayoutVertexArray:M.icon.dynamicLayoutVertexArray;Mt.clear();const dt=M.lineVertexArray,Ct=_?M.text.placedSymbolArray:M.icon.placedSymbolArray,Lt=d.transform.width/d.transform.height;let Bt=!1;for(let ee=0;ee<Ct.length;ee++){const he=Ct.get(ee);if(he.hidden||he.writingMode===o.ah.vertical&&!Bt){Xe(he.numGlyphs,Mt);continue}Bt=!1;const we=lt(he.anchorX,he.anchorY,r,ht);if(!X(we.point,vt)){Xe(he.numGlyphs,Mt);continue}const Ce=W(d.transform.cameraToCenterDistance,we.signedDistanceFromCamera),ye=o.ai(pt,yt,he),_e=C?ye/Ce:ye*Ce,Ve={getElevation:ht,labelPlaneMatrix:g,lineVertexArray:dt,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:N,tileAnchorPoint:new o.P(he.anchorX,he.anchorY),unwrappedTileID:H,width:j,height:tt,translation:ot},mi=Et(Ve,he,_e,!1,L,r,w,M.glyphOffsetArray,Mt,Lt,F);Bt=mi.useVertical,(mi.notEnoughRoom||Bt||mi.needsFlipping&&Et(Ve,he,_e,!0,L,r,w,M.glyphOffsetArray,Mt,Lt,F).notEnoughRoom)&&Xe(he.numGlyphs,Mt)}_?M.text.dynamicLayoutVertexBuffer.updateData(Mt):M.icon.dynamicLayoutVertexBuffer.updateData(Mt)}function ut(M,r,d,_,g,w,C,L){const F=w.glyphStartIndex+w.numGlyphs,N=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,j=r.getoffsetX(w.glyphStartIndex),tt=r.getoffsetX(F-1),ot=fe(M*j,d,_,g,w.segment,N,H,L,C);if(!ot)return null;const ht=fe(M*tt,d,_,g,w.segment,N,H,L,C);return ht?L.projectionCache.anyProjectionOccluded?null:{first:ot,last:ht}:null}function xt(M,r,d,_){return M===o.ah.horizontal&&Math.abs(d.y-r.y)>Math.abs(d.x-r.x)*_?{useVertical:!0}:(M===o.ah.vertical?r.y<d.y:r.x>d.x)?{needsFlipping:!0}:null}function Et(M,r,d,_,g,w,C,L,F,N,H){const j=d/24,tt=r.lineOffsetX*j,ot=r.lineOffsetY*j;let ht;if(r.numGlyphs>1){const pt=r.glyphStartIndex+r.numGlyphs,yt=r.lineStartIndex,vt=r.lineStartIndex+r.lineLength,Mt=ut(j,L,tt,ot,_,r,H,M);if(!Mt)return{notEnoughRoom:!0};const dt=lt(Mt.first.point.x,Mt.first.point.y,C,M.getElevation).point,Ct=lt(Mt.last.point.x,Mt.last.point.y,C,M.getElevation).point;if(g&&!_){const Lt=xt(r.writingMode,dt,Ct,N);if(Lt)return Lt}ht=[Mt.first];for(let Lt=r.glyphStartIndex+1;Lt<pt-1;Lt++)ht.push(fe(j*L.getoffsetX(Lt),tt,ot,_,r.segment,yt,vt,M,H));ht.push(Mt.last)}else{if(g&&!_){const yt=lt(M.tileAnchorPoint.x,M.tileAnchorPoint.y,w,M.getElevation).point,vt=r.lineStartIndex+r.segment+1,Mt=new o.P(M.lineVertexArray.getx(vt),M.lineVertexArray.gety(vt)),dt=lt(Mt.x,Mt.y,w,M.getElevation),Ct=dt.signedDistanceFromCamera>0?dt.point:function(Bt,ee,he,we,Ce,ye){return Dt(Bt,ee,he,1,Ce,ye)}(M.tileAnchorPoint,Mt,yt,0,w,M),Lt=xt(r.writingMode,yt,Ct,N);if(Lt)return Lt}const pt=fe(j*L.getoffsetX(r.glyphStartIndex),tt,ot,_,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,M,H);if(!pt||M.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ht=[pt]}for(const pt of ht)o.aj(F,pt.point,pt.angle);return{}}function Dt(M,r,d,_,g,w){const C=M.add(M.sub(r)._unit()),L=g!==void 0?lt(C.x,C.y,g,w.getElevation).point:Xt(C.x,C.y,w).point,F=d.sub(L);return d.add(F._mult(_/F.mag()))}function bt(M,r,d){const _=r.projectionCache;if(_.projections[M])return _.projections[M];const g=new o.P(r.lineVertexArray.getx(M),r.lineVertexArray.gety(M)),w=Xt(g.x,g.y,r);if(w.signedDistanceFromCamera>0)return _.projections[M]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const C=M-d.direction;return function(L,F,N,H,j){return Dt(L,F,N,H,void 0,j)}(d.distanceFromAnchor===0?r.tileAnchorPoint:new o.P(r.lineVertexArray.getx(C),r.lineVertexArray.gety(C)),g,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,r)}function Xt(M,r,d){const _=M+d.translation[0],g=r+d.translation[1];let w;return!d.pitchWithMap&&d.projection.useSpecialProjectionForSymbols?(w=d.projection.projectTileCoordinates(_,g,d.unwrappedTileID,d.getElevation),w.point.x=(.5*w.point.x+.5)*d.width,w.point.y=(.5*-w.point.y+.5)*d.height):(w=lt(_,g,d.labelPlaneMatrix,d.getElevation),w.isOccluded=!1),w}function te(M,r,d){return M._unit()._perp()._mult(r*d)}function Wt(M,r,d,_,g,w,C,L,F){if(L.projectionCache.offsets[M])return L.projectionCache.offsets[M];const N=d.add(r);if(M+F.direction<_||M+F.direction>=g)return L.projectionCache.offsets[M]=N,N;const H=bt(M+F.direction,L,F),j=te(H.sub(d),C,F.direction),tt=d.add(j),ot=H.add(j);return L.projectionCache.offsets[M]=o.ak(w,N,tt,ot)||N,L.projectionCache.offsets[M]}function fe(M,r,d,_,g,w,C,L,F){const N=_?M-r:M+r;let H=N>0?1:-1,j=0;_&&(H*=-1,j=Math.PI),H<0&&(j+=Math.PI);let tt,ot=H>0?w+g:w+g+1;L.projectionCache.cachedAnchorPoint?tt=L.projectionCache.cachedAnchorPoint:(tt=Xt(L.tileAnchorPoint.x,L.tileAnchorPoint.y,L).point,L.projectionCache.cachedAnchorPoint=tt);let ht,pt,yt=tt,vt=tt,Mt=0,dt=0;const Ct=Math.abs(N),Lt=[];let Bt;for(;Mt+dt<=Ct;){if(ot+=H,ot<w||ot>=C)return null;Mt+=dt,vt=yt,pt=ht;const we={absOffsetX:Ct,direction:H,distanceFromAnchor:Mt,previousVertex:vt};if(yt=bt(ot,L,we),d===0)Lt.push(vt),Bt=yt.sub(vt);else{let Ce;const ye=yt.sub(vt);Ce=ye.mag()===0?te(bt(ot+H,L,we).sub(yt),d,H):te(ye,d,H),pt||(pt=vt.add(Ce)),ht=Wt(ot,Ce,yt,w,C,pt,d,L,we),Lt.push(pt),Bt=ht.sub(pt)}dt=Bt.mag()}const ee=Bt._mult((Ct-Mt)/dt)._add(pt||vt),he=j+Math.atan2(yt.y-vt.y,yt.x-vt.x);return Lt.push(ee),{point:ee,angle:F?he:0,path:Lt}}const He=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xe(M,r){for(let d=0;d<M;d++){const _=r.length;r.resize(_+4),r.float32.set(He,3*_)}}function ki(M,r,d){const _=r[0],g=r[1];return M[0]=d[0]*_+d[4]*g+d[12],M[1]=d[1]*_+d[5]*g+d[13],M[3]=d[3]*_+d[7]*g+d[15],M}const hi=100;class Fi{constructor(r,d,_=new Me(r.width+200,r.height+200,25),g=new Me(r.width+200,r.height+200,25)){this.transform=r,this.mapProjection=d,this.grid=_,this.ignoredGrid=g,this.pitchFactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+hi,this.screenBottomBoundary=r.height+hi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,d,_,g,w,C,L,F,N,H,j){const tt=r.anchorPointX+F[0],ot=r.anchorPointY+F[1],ht=this.projectAndGetPerspectiveRatio(g,tt,ot,w,H),pt=_*ht.perspectiveRatio;let yt;if(C||L)yt=this._projectCollisionBox(r,pt,g,w,C,L,F,ht,H,j);else{const Lt=ht.point.x+(j?j.x*pt:0),Bt=ht.point.y+(j?j.y*pt:0);yt={allPointsOccluded:!1,box:[Lt+r.x1*pt,Bt+r.y1*pt,Lt+r.x2*pt,Bt+r.y2*pt]}}const[vt,Mt,dt,Ct]=yt.box;return this.mapProjection.useSpecialProjectionForSymbols&&(C?yt.allPointsOccluded:this.mapProjection.isOccluded(tt,ot,w))||ht.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(vt,Mt,dt,Ct)||d!=="always"&&this.grid.hitTest(vt,Mt,dt,Ct,d,N)?{box:[vt,Mt,dt,Ct],placeable:!1,offscreen:!1}:{box:[vt,Mt,dt,Ct],placeable:!0,offscreen:this.isOffscreen(vt,Mt,dt,Ct)}}placeCollisionCircles(r,d,_,g,w,C,L,F,N,H,j,tt,ot,ht,pt,yt){const vt=[],Mt=new o.P(d.anchorX,d.anchorY),dt=this.getPerspectiveRatio(C,Mt.x,Mt.y,L,yt),Ct=(j?w/dt:w*dt)/o.ap,Lt={getElevation:yt,labelPlaneMatrix:F,lineVertexArray:_,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Mt,unwrappedTileID:L,width:this.transform.width,height:this.transform.height,translation:pt},Bt=ut(Ct,g,d.lineOffsetX*Ct,d.lineOffsetY*Ct,!1,d,!1,Lt);let ee=!1,he=!1,we=!0;if(Bt){const Ce=.5*ot*dt+ht,ye=new o.P(-100,-100),_e=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ve=new Re,mi=Bt.first,xe=Bt.last;let Te=[];for(let Ti=mi.path.length-1;Ti>=1;Ti--)Te.push(mi.path[Ti]);for(let Ti=1;Ti<xe.path.length;Ti++)Te.push(xe.path[Ti]);const di=2.5*Ce;if(N){const Ti=this.projectPathToScreenSpace(Te,Lt,N);Te=Ti.some(Di=>Di.signedDistanceFromCamera<=0)?[]:Ti.map(Di=>Di.point)}let dn=[];if(Te.length>0){const Ti=Te[0].clone(),Di=Te[0].clone();for(let fn=1;fn<Te.length;fn++)Ti.x=Math.min(Ti.x,Te[fn].x),Ti.y=Math.min(Ti.y,Te[fn].y),Di.x=Math.max(Di.x,Te[fn].x),Di.y=Math.max(Di.y,Te[fn].y);dn=Ti.x>=ye.x&&Di.x<=_e.x&&Ti.y>=ye.y&&Di.y<=_e.y?[Te]:Di.x<ye.x||Ti.x>_e.x||Di.y<ye.y||Ti.y>_e.y?[]:o.al([Te],ye.x,ye.y,_e.x,_e.y)}for(const Ti of dn){Ve.reset(Ti,.25*Ce);let Di=0;Di=Ve.length<=.5*Ce?1:Math.ceil(Ve.paddedLength/di)+1;for(let fn=0;fn<Di;fn++){const ds=fn/Math.max(Di-1,1),Hr=Ve.lerp(ds),pn=Hr.x+hi,Bs=Hr.y+hi;vt.push(pn,Bs,Ce,0);const Es=pn-Ce,fs=Bs-Ce,As=pn+Ce,ua=Bs+Ce;if(we=we&&this.isOffscreen(Es,fs,As,ua),he=he||this.isInsideGrid(Es,fs,As,ua),r!=="always"&&this.grid.hitTestCircle(pn,Bs,Ce,r,tt)&&(ee=!0,!H))return{circles:[],offscreen:!1,collisionDetected:ee}}}}return{circles:!H&&ee||!he||dt<this.perspectiveRatioCutoff?[]:vt,offscreen:we,collisionDetected:ee}}projectPathToScreenSpace(r,d,_){return r.map(g=>lt(g.x,g.y,_,d.getElevation))}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,g=1/0,w=-1/0,C=-1/0;for(const H of r){const j=new o.P(H.x+hi,H.y+hi);_=Math.min(_,j.x),g=Math.min(g,j.y),w=Math.max(w,j.x),C=Math.max(C,j.y),d.push(j)}const L=this.grid.query(_,g,w,C).concat(this.ignoredGrid.query(_,g,w,C)),F={},N={};for(const H of L){const j=H.key;if(F[j.bucketInstanceId]===void 0&&(F[j.bucketInstanceId]={}),F[j.bucketInstanceId][j.featureIndex])continue;const tt=[new o.P(H.x1,H.y1),new o.P(H.x2,H.y1),new o.P(H.x2,H.y2),new o.P(H.x1,H.y2)];o.am(d,tt)&&(F[j.bucketInstanceId][j.featureIndex]=!0,N[j.bucketInstanceId]===void 0&&(N[j.bucketInstanceId]=[]),N[j.bucketInstanceId].push(j.featureIndex))}return N}insertCollisionBox(r,d,_,g,w,C){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:w,collisionGroupID:C,overlapMode:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,d,_,g,w,C){const L=_?this.ignoredGrid:this.grid,F={bucketInstanceId:g,featureIndex:w,collisionGroupID:C,overlapMode:d};for(let N=0;N<r.length;N+=4)L.insertCircle(F,r[N],r[N+1],r[N+2])}projectAndGetPerspectiveRatio(r,d,_,g,w){let C;w?(C=[d,_,w(d,_),1],o.af(C,C,r)):(C=[d,_,0,1],ki(C,C,r));const L=C[3];return{point:new o.P((C[0]/L+1)/2*this.transform.width+hi,(-C[1]/L+1)/2*this.transform.height+hi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/L*.5,isOccluded:!1,signedDistanceFromCamera:L}}getPerspectiveRatio(r,d,_,g,w){const C=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,_,g,w):lt(d,_,r,w);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(r,d,_,g){return _<hi||r>=this.screenRightBoundary||g<hi||d>this.screenBottomBoundary}isInsideGrid(r,d,_,g){return _>=0&&r<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const r=o.an([]);return o.J(r,r,[-100,-100,0]),r}_projectCollisionBox(r,d,_,g,w,C,L,F,N,H){let j=new o.P(1,0),tt=new o.P(0,1);const ot=new o.P(r.anchorPointX+L[0],r.anchorPointY+L[1]);if(C&&!w){const we=this.projectAndGetPerspectiveRatio(_,ot.x+1,ot.y,g,N).point.sub(F.point).unit(),Ce=Math.atan(we.y/we.x)+(we.x<0?Math.PI:0),ye=Math.sin(Ce),_e=Math.cos(Ce);j=new o.P(_e,ye),tt=new o.P(-ye,_e)}else if(!C&&w){const we=-this.transform.angle,Ce=Math.sin(we),ye=Math.cos(we);j=new o.P(ye,Ce),tt=new o.P(-Ce,ye)}let ht=F.point,pt=d;if(w){ht=ot;const we=this.transform.zoom-Math.floor(this.transform.zoom);pt=Math.pow(2,-we),pt*=this.mapProjection.getPitchedTextCorrection(this.transform,ot,g),H||(pt*=o.ac(.5+F.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(ht=ht.add(j.mult(H.x*pt)).add(tt.mult(H.y*pt)));const yt=r.x1*pt,vt=r.x2*pt,Mt=(yt+vt)/2,dt=r.y1*pt,Ct=r.y2*pt,Lt=(dt+Ct)/2,Bt=[{offsetX:yt,offsetY:dt},{offsetX:Mt,offsetY:dt},{offsetX:vt,offsetY:dt},{offsetX:vt,offsetY:Lt},{offsetX:vt,offsetY:Ct},{offsetX:Mt,offsetY:Ct},{offsetX:yt,offsetY:Ct},{offsetX:yt,offsetY:Lt}];let ee=[];for(const{offsetX:we,offsetY:Ce}of Bt)ee.push(new o.P(ht.x+j.x*we+tt.x*Ce,ht.y+j.y*we+tt.y*Ce));let he=!1;if(w){const we=ee.map(Ce=>this.projectAndGetPerspectiveRatio(_,Ce.x,Ce.y,g,N));he=we.some(Ce=>!Ce.isOccluded),ee=we.map(Ce=>Ce.point)}else he=!0;return{box:o.ao(ee),allPointsOccluded:!he}}}function Ci(M,r,d){return r*(o.X/(M.tileSize*Math.pow(2,d-M.tileID.overscaledZ)))}class En{constructor(r,d,_,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?d:-d))):g&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class yn{constructor(r,d,_,g,w){this.text=new En(r?r.text:null,d,_,w),this.icon=new En(r?r.icon:null,d,g,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Si{constructor(r,d,_){this.text=r,this.icon=d,this.skipFade=_}}class rt{constructor(){this.invProjMatrix=o.H(),this.viewportMatrix=o.H(),this.circles=[]}}class At{constructor(r,d,_,g,w){this.bucketInstanceId=r,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=g,this.tileID=w}}class Vt{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const d=++this.maxGroupID;this.collisionGroups[r]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[r]}}function jt(M,r,d,_,g){const{horizontalAlign:w,verticalAlign:C}=o.au(M);return new o.P(-(w-.5)*r+_[0]*g,-(C-.5)*d+_[1]*g)}class Rt{constructor(r,d,_,g,w,C){this.transform=r.clone(),this.terrain=_,this.collisionIndex=new Fi(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Vt(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){const d=this.terrain;return d?(_,g)=>d.getElevation(r,_,g):null}getBucketParts(r,d,_,g){const w=_.getBucket(d),C=_.latestFeatureIndex;if(!w||!C||d.id!==w.layerIds[0])return;const L=_.collisionBoxArray,F=w.layers[0].layout,N=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),j=_.tileSize/o.X,tt=_.tileID.toUnwrapped(),ot=this.transform.calculatePosMatrix(tt),ht=F.get("text-pitch-alignment")==="map",pt=F.get("text-rotation-alignment")==="map",yt=Ci(_,1,this.transform.zoom),vt=this.collisionIndex.mapProjection.translatePosition(this.transform,_,N.get("text-translate"),N.get("text-translate-anchor")),Mt=this.collisionIndex.mapProjection.translatePosition(this.transform,_,N.get("icon-translate"),N.get("icon-translate-anchor")),dt=Kt(ot,ht,pt,this.transform,yt);let Ct=null;if(ht){const Bt=se(ot,ht,pt,this.transform,yt);Ct=o.L([],this.transform.labelPlaneMatrix,Bt)}this.retainedQueryData[w.bucketInstanceId]=new At(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,_.tileID);const Lt={bucket:w,layout:F,translationText:vt,translationIcon:Mt,posMatrix:ot,unwrappedTileID:tt,textLabelPlaneMatrix:dt,labelToScreenMatrix:Ct,scale:H,textPixelRatio:j,holdingForFade:_.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:o.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(const Bt of w.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:we}=Bt;r.push({sortKey:ee,symbolInstanceStart:he,symbolInstanceEnd:we,parameters:Lt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Lt})}attemptAnchorPlacement(r,d,_,g,w,C,L,F,N,H,j,tt,ot,ht,pt,yt,vt,Mt,dt){const Ct=o.aq[r.textAnchor],Lt=[r.textOffset0,r.textOffset1],Bt=jt(Ct,_,g,Lt,w),ee=this.collisionIndex.placeCollisionBox(d,tt,F,N,H,L,C,yt,j.predicate,dt,Bt);if((!Mt||this.collisionIndex.placeCollisionBox(Mt,tt,F,N,H,L,C,vt,j.predicate,dt,Bt).placeable)&&ee.placeable){let he;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ot.crossTileID]&&this.prevPlacement.placements[ot.crossTileID]&&this.prevPlacement.placements[ot.crossTileID].text&&(he=this.prevPlacement.variableOffsets[ot.crossTileID].anchor),ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ot.crossTileID]={textOffset:Lt,width:_,height:g,anchor:Ct,textBoxScale:w,prevAnchor:he},this.markUsedJustification(ht,Ct,ot,pt),ht.allowVerticalPlacement&&(this.markUsedOrientation(ht,pt,ot),this.placedOrientations[ot.crossTileID]=pt),{shift:Bt,placedGlyphBoxes:ee}}}placeLayerBucketPart(r,d,_){const{bucket:g,layout:w,translationText:C,translationIcon:L,posMatrix:F,unwrappedTileID:N,textLabelPlaneMatrix:H,labelToScreenMatrix:j,textPixelRatio:tt,holdingForFade:ot,collisionBoxArray:ht,partiallyEvaluatedTextSize:pt,collisionGroup:yt}=r.parameters,vt=w.get("text-optional"),Mt=w.get("icon-optional"),dt=o.ar(w,"text-overlap","text-allow-overlap"),Ct=dt==="always",Lt=o.ar(w,"icon-overlap","icon-allow-overlap"),Bt=Lt==="always",ee=w.get("text-rotation-alignment")==="map",he=w.get("text-pitch-alignment")==="map",we=w.get("icon-text-fit")!=="none",Ce=w.get("symbol-z-order")==="viewport-y",ye=Ct&&(Bt||!g.hasIconData()||Mt),_e=Bt&&(Ct||!g.hasTextData()||vt);!g.collisionArrays&&ht&&g.deserializeCollisionBoxes(ht);const Ve=this._getTerrainElevationFunc(this.retainedQueryData[g.bucketInstanceId].tileID),mi=(xe,Te,di)=>{var dn,Ti;if(d[xe.crossTileID])return;if(ot)return void(this.placements[xe.crossTileID]=new Si(!1,!1,!1));let Di=!1,fn=!1,ds=!0,Hr=null,pn={box:null,placeable:!1,offscreen:null},Bs={box:null,placeable:!1,offscreen:null},Es=null,fs=null,As=null,ua=0,_l=0,Xh=0;Te.textFeatureIndex?ua=Te.textFeatureIndex:xe.useRuntimeCollisionCircles&&(ua=xe.featureIndex),Te.verticalTextFeatureIndex&&(_l=Te.verticalTextFeatureIndex);const gl=Te.textBox;if(gl){const Tr=ss=>{let ps=o.ah.horizontal;if(g.allowVerticalPlacement&&!ss&&this.prevPlacement){const ir=this.prevPlacement.placedOrientations[xe.crossTileID];ir&&(this.placedOrientations[xe.crossTileID]=ir,ps=ir,this.markUsedOrientation(g,ps,xe))}return ps},Er=(ss,ps)=>{if(g.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&Te.verticalTextBox){for(const ir of g.writingModes)if(ir===o.ah.vertical?(pn=ps(),Bs=pn):pn=ss(),pn&&pn.placeable)break}else pn=ss()},ja=xe.textAnchorOffsetStartIndex,jr=xe.textAnchorOffsetEndIndex;if(jr===ja){const ss=(ps,ir)=>{const Oi=this.collisionIndex.placeCollisionBox(ps,dt,tt,F,N,he,ee,C,yt.predicate,Ve);return Oi&&Oi.placeable&&(this.markUsedOrientation(g,ir,xe),this.placedOrientations[xe.crossTileID]=ir),Oi};Er(()=>ss(gl,o.ah.horizontal),()=>{const ps=Te.verticalTextBox;return g.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&ps?ss(ps,o.ah.vertical):{box:null,offscreen:null}}),Tr(pn&&pn.placeable)}else{let ss=o.aq[(Ti=(dn=this.prevPlacement)===null||dn===void 0?void 0:dn.variableOffsets[xe.crossTileID])===null||Ti===void 0?void 0:Ti.anchor];const ps=(Oi,Mo,yl)=>{const xl=Oi.x2-Oi.x1,Xm=Oi.y2-Oi.y1,Q0=xe.textBoxScale,$m=we&&Lt==="never"?Mo:null;let Wa=null,Zm=dt==="never"?1:2,Zh="never";ss&&Zm++;for(let Ec=0;Ec<Zm;Ec++){for(let Yh=ja;Yh<jr;Yh++){const Kh=g.textAnchorOffsets.get(Yh);if(ss&&Kh.textAnchor!==ss)continue;const vl=this.attemptAnchorPlacement(Kh,Oi,xl,Xm,Q0,ee,he,tt,F,N,yt,Zh,xe,g,yl,C,L,$m,Ve);if(vl&&(Wa=vl.placedGlyphBoxes,Wa&&Wa.placeable))return Di=!0,Hr=vl.shift,Wa}ss?ss=null:Zh=dt}return _&&!Wa&&(Wa={box:this.collisionIndex.placeCollisionBox(gl,"always",tt,F,N,he,ee,C,yt.predicate,Ve,new o.P(0,0)).box,offscreen:!1,placeable:!1}),Wa};Er(()=>ps(gl,Te.iconBox,o.ah.horizontal),()=>{const Oi=Te.verticalTextBox;return g.allowVerticalPlacement&&(!pn||!pn.placeable)&&xe.numVerticalGlyphVertices>0&&Oi?ps(Oi,Te.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),pn&&(Di=pn.placeable,ds=pn.offscreen);const ir=Tr(pn&&pn.placeable);if(!Di&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[xe.crossTileID];Oi&&(this.variableOffsets[xe.crossTileID]=Oi,this.markUsedJustification(g,Oi.anchor,xe,ir))}}}if(Es=pn,Di=Es&&Es.placeable,ds=Es&&Es.offscreen,xe.useRuntimeCollisionCircles){const Tr=g.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex),Er=o.ai(g.textSizeData,pt,Tr),ja=w.get("text-padding");fs=this.collisionIndex.placeCollisionCircles(dt,Tr,g.lineVertexArray,g.glyphOffsetArray,Er,F,N,H,j,_,he,yt.predicate,xe.collisionCircleDiameter,ja,C,Ve),fs.circles.length&&fs.collisionDetected&&!_&&o.w("Collisions detected, but collision boxes are not shown"),Di=Ct||fs.circles.length>0&&!fs.collisionDetected,ds=ds&&fs.offscreen}if(Te.iconFeatureIndex&&(Xh=Te.iconFeatureIndex),Te.iconBox){const Tr=Er=>this.collisionIndex.placeCollisionBox(Er,Lt,tt,F,N,he,ee,L,yt.predicate,Ve,we&&Hr?Hr:void 0);Bs&&Bs.placeable&&Te.verticalIconBox?(As=Tr(Te.verticalIconBox),fn=As.placeable):(As=Tr(Te.iconBox),fn=As.placeable),ds=ds&&As.offscreen}const Sr=vt||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,$h=Mt||xe.numIconVertices===0;Sr||$h?$h?Sr||(fn=fn&&Di):Di=fn&&Di:fn=Di=fn&&Di;const bf=fn&&As.placeable;if(Di&&Es.placeable&&this.collisionIndex.insertCollisionBox(Es.box,dt,w.get("text-ignore-placement"),g.bucketInstanceId,Bs&&Bs.placeable&&_l?_l:ua,yt.ID),bf&&this.collisionIndex.insertCollisionBox(As.box,Lt,w.get("icon-ignore-placement"),g.bucketInstanceId,Xh,yt.ID),fs&&Di&&this.collisionIndex.insertCollisionCircles(fs.circles,dt,w.get("text-ignore-placement"),g.bucketInstanceId,ua,yt.ID),_&&this.storeCollisionData(g.bucketInstanceId,di,Te,Es,As,fs),xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xe.crossTileID]=new Si(Di||ye,fn||_e,ds||g.justReloaded),d[xe.crossTileID]=!0};if(Ce){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xe=g.getSortedSymbolIndexes(this.transform.angle);for(let Te=xe.length-1;Te>=0;--Te){const di=xe[Te];mi(g.symbolInstances.get(di),g.collisionArrays[di],di)}}else for(let xe=r.symbolInstanceStart;xe<r.symbolInstanceEnd;xe++)mi(g.symbolInstances.get(xe),g.collisionArrays[xe],xe);if(_&&g.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[g.bucketInstanceId];o.as(xe.invProjMatrix,F),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}storeCollisionData(r,d,_,g,w,C){if(_.textBox||_.iconBox){let L,F;this.collisionBoxArrays.has(r)?L=this.collisionBoxArrays.get(r):(L=new Map,this.collisionBoxArrays.set(r,L)),L.has(d)?F=L.get(d):(F={text:null,icon:null},L.set(d,F)),_.textBox&&(F.text=g.box),_.iconBox&&(F.icon=w.box)}if(C){let L=this.collisionCircleArrays[r];L===void 0&&(L=this.collisionCircleArrays[r]=new rt);for(let F=0;F<C.circles.length;F+=4)L.circles.push(C.circles[F+0]),L.circles.push(C.circles[F+1]),L.circles.push(C.circles[F+2]),L.circles.push(C.collisionDetected?1:0)}}markUsedJustification(r,d,_,g){let w;w=g===o.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[o.at(d)];const C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const L of C)L>=0&&(r.text.placedSymbolArray.get(L).crossTileID=w>=0&&L!==w?0:_.crossTileID)}markUsedOrientation(r,d,_){const g=d===o.ah.horizontal||d===o.ah.horizontalOnly?d:0,w=d===o.ah.vertical?d:0,C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const L of C)r.text.placedSymbolArray.get(L).placedOrientation=g;_.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(r):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(const F in this.placements){const N=this.placements[F],H=w[F];H?(this.opacities[F]=new yn(H,g,N.text,N.icon),_=_||N.text!==H.text.placed||N.icon!==H.icon.placed):(this.opacities[F]=new yn(null,g,N.text,N.icon,N.skipFade),_=_||N.text||N.icon)}for(const F in w){const N=w[F];if(!this.opacities[F]){const H=new yn(N,g,!1,!1);H.isHidden()||(this.opacities[F]=H,_=_||N.text.placed||N.icon.placed)}}for(const F in C)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=C[F]);for(const F in L)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=L[F]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:r)}updateLayerOpacities(r,d){const _={};for(const g of d){const w=g.getBucket(r);w&&g.latestFeatureIndex&&r.id===w.layerIds[0]&&this.updateBucketOpacities(w,g.tileID,_,g.collisionBoxArray)}}updateBucketOpacities(r,d,_,g){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const w=r.layers[0],C=w.layout,L=new yn(null,0,!1,!1,!0),F=C.get("text-allow-overlap"),N=C.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=C.get("text-rotation-alignment")==="map",tt=C.get("text-pitch-alignment")==="map",ot=C.get("icon-text-fit")!=="none",ht=new yn(null,0,F&&(N||!r.hasIconData()||C.get("icon-optional")),N&&(F||!r.hasTextData()||C.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);const pt=(vt,Mt,dt)=>{for(let Ct=0;Ct<Mt/4;Ct++)vt.opacityVertexArray.emplaceBack(dt);vt.hasVisibleVertices=vt.hasVisibleVertices||dt!==qi},yt=this.collisionBoxArrays.get(r.bucketInstanceId);for(let vt=0;vt<r.symbolInstances.length;vt++){const Mt=r.symbolInstances.get(vt),{numHorizontalGlyphVertices:dt,numVerticalGlyphVertices:Ct,crossTileID:Lt}=Mt;let Bt=this.opacities[Lt];_[Lt]?Bt=L:Bt||(Bt=ht,this.opacities[Lt]=Bt),_[Lt]=!0;const ee=Mt.numIconVertices>0,he=this.placedOrientations[Mt.crossTileID],we=he===o.ah.vertical,Ce=he===o.ah.horizontal||he===o.ah.horizontalOnly;if(dt>0||Ct>0){const _e=Ri(Bt.text);pt(r.text,dt,we?qi:_e),pt(r.text,Ct,Ce?qi:_e);const Ve=Bt.text.isHidden();[Mt.rightJustifiedTextSymbolIndex,Mt.centerJustifiedTextSymbolIndex,Mt.leftJustifiedTextSymbolIndex].forEach(Te=>{Te>=0&&(r.text.placedSymbolArray.get(Te).hidden=Ve||we?1:0)}),Mt.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(Mt.verticalPlacedTextSymbolIndex).hidden=Ve||Ce?1:0);const mi=this.variableOffsets[Mt.crossTileID];mi&&this.markUsedJustification(r,mi.anchor,Mt,he);const xe=this.placedOrientations[Mt.crossTileID];xe&&(this.markUsedJustification(r,"left",Mt,xe),this.markUsedOrientation(r,xe,Mt))}if(ee){const _e=Ri(Bt.icon),Ve=!(ot&&Mt.verticalPlacedIconSymbolIndex&&we);Mt.placedIconSymbolIndex>=0&&(pt(r.icon,Mt.numIconVertices,Ve?_e:qi),r.icon.placedSymbolArray.get(Mt.placedIconSymbolIndex).hidden=Bt.icon.isHidden()),Mt.verticalPlacedIconSymbolIndex>=0&&(pt(r.icon,Mt.numVerticalIconVertices,Ve?qi:_e),r.icon.placedSymbolArray.get(Mt.verticalPlacedIconSymbolIndex).hidden=Bt.icon.isHidden())}const ye=yt&&yt.has(vt)?yt.get(vt):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const _e=r.collisionArrays[vt];if(_e){let Ve=new o.P(0,0);if(_e.textBox||_e.verticalTextBox){let mi=!0;if(H){const xe=this.variableOffsets[Lt];xe?(Ve=jt(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textBoxScale),j&&Ve._rotate(tt?this.transform.angle:-this.transform.angle)):mi=!1}if(_e.textBox||_e.verticalTextBox){let xe;_e.textBox&&(xe=we),_e.verticalTextBox&&(xe=Ce),pe(r.textCollisionBox.collisionVertexArray,Bt.text.placed,!mi||xe,ye.text,Ve.x,Ve.y)}}if(_e.iconBox||_e.verticalIconBox){const mi=!!(!Ce&&_e.verticalIconBox);let xe;_e.iconBox&&(xe=mi),_e.verticalIconBox&&(xe=!mi),pe(r.iconCollisionBox.collisionVertexArray,Bt.icon.placed,xe,ye.icon,ot?Ve.x:0,ot?Ve.y:0)}}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const vt=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=vt.invProjMatrix,r.placementViewportMatrix=vt.viewportMatrix,r.collisionCircleArray=vt.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>r}setStale(){this.stale=!0}}function pe(M,r,d,_,g,w){_&&_.length!==0||(_=[0,0,0,0]);const C=_[0]-hi,L=_[1]-hi,F=_[2]-hi,N=_[3]-hi;M.emplaceBack(r?1:0,d?1:0,g||0,w||0,C,L),M.emplaceBack(r?1:0,d?1:0,g||0,w||0,F,L),M.emplaceBack(r?1:0,d?1:0,g||0,w||0,F,N),M.emplaceBack(r?1:0,d?1:0,g||0,w||0,C,N)}const ce=Math.pow(2,25),Ze=Math.pow(2,24),Ye=Math.pow(2,17),ei=Math.pow(2,16),li=Math.pow(2,9),Je=Math.pow(2,8),wi=Math.pow(2,1);function Ri(M){if(M.opacity===0&&!M.placed)return 0;if(M.opacity===1&&M.placed)return 4294967295;const r=M.placed?1:0,d=Math.floor(127*M.opacity);return d*ce+r*Ze+d*Ye+r*ei+d*li+r*Je+d*wi+r}const qi=0;function An(){return{isOccluded:(M,r,d)=>!1,getPitchedTextCorrection:(M,r,d)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(M,r,d,_){throw new Error("Not implemented.")},translatePosition:(M,r,d,_)=>function(g,w,C,L,F=!1){if(!C[0]&&!C[1])return[0,0];const N=F?L==="map"?g.angle:0:L==="viewport"?-g.angle:0;if(N){const H=Math.sin(N),j=Math.cos(N);C=[C[0]*j-C[1]*H,C[0]*H+C[1]*j]}return[F?C[0]:Ci(w,C[0],g.zoom),F?C[1]:Ci(w,C[1],g.zoom)]}(M,r,d,_),getCircleRadiusCorrection:M=>1}}class pi{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,d,_,g,w){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(d.getBucketParts(C,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((L,F)=>L.sortKey-F.sortKey));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class Ke{constructor(r,d,_,g,w,C,L,F){this.placement=new Rt(r,An(),d,C,L,F),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(r,d,_){const g=v.now(),w=()=>!this._forceFullPlacement&&v.now()-g>2;for(;this._currentPlacementIndex>=0;){const C=d[r[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=L)&&(!C.maxzoom||C.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new pi(C)),this._inProgressLayer.continuePlacement(_[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Dn=512/o.X/2;class ui{constructor(r,d,_){this.tileID=r,this.bucketInstanceId=_,this._symbolsByKey={};const g=new Map;for(let w=0;w<d.length;w++){const C=d.get(w),L=C.key,F=g.get(L);F?F.push(C):g.set(L,[C])}for(const[w,C]of g){const L={positions:C.map(F=>({x:Math.floor(F.anchorX*Dn),y:Math.floor(F.anchorY*Dn)})),crossTileIDs:C.map(F=>F.crossTileID)};if(L.positions.length>128){const F=new o.av(L.positions.length,16,Uint16Array);for(const{x:N,y:H}of L.positions)F.add(N,H);F.finish(),delete L.positions,L.index=F}this._symbolsByKey[w]=L}}getScaledCoordinates(r,d){const{x:_,y:g,z:w}=this.tileID.canonical,{x:C,y:L,z:F}=d.canonical,N=Dn/Math.pow(2,F-w),H=(L*o.X+r.anchorY)*N,j=g*o.X*Dn;return{x:Math.floor((C*o.X+r.anchorX)*N-_*o.X*Dn),y:Math.floor(H-j)}}findMatches(r,d,_){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<r.length;w++){const C=r.get(w);if(C.crossTileID)continue;const L=this._symbolsByKey[C.key];if(!L)continue;const F=this.getScaledCoordinates(C,d);if(L.index){const N=L.index.range(F.x-g,F.y-g,F.x+g,F.y+g).sort();for(const H of N){const j=L.crossTileIDs[H];if(!_[j]){_[j]=!0,C.crossTileID=j;break}}}else if(L.positions)for(let N=0;N<L.positions.length;N++){const H=L.positions[N],j=L.crossTileIDs[N];if(Math.abs(H.x-F.x)<=g&&Math.abs(H.y-F.y)<=g&&!_[j]){_[j]=!0,C.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const d=Math.round((r-this.lng)/360);if(d!==0)for(const _ in this.indexes){const g=this.indexes[_],w={};for(const C in g){const L=g[C];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),w[L.tileID.key]=L}this.indexes[_]=w}this.lng=r}addBucket(r,d,_){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const g=this.usedCrossTileIDs[r.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>r.overscaledZ)for(const L in C){const F=C[L];F.tileID.isChildOf(r)&&F.findMatches(d.symbolInstances,r,g)}else{const L=C[r.scaledTo(Number(w)).key];L&&L.findMatches(d.symbolInstances,r,g)}}for(let w=0;w<d.symbolInstances.length;w++){const C=d.symbolInstances.get(w);C.crossTileID||(C.crossTileID=_.generate(),g[C.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ui(r,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(r,d){for(const _ of d.getCrossTileIDsLists())for(const g of _)delete this.usedCrossTileIDs[r][g]}removeStaleBuckets(r){let d=!1;for(const _ in this.indexes){const g=this.indexes[_];for(const w in g)r[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,g[w]),delete g[w],d=!0)}return d}}class is{constructor(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,d,_){let g=this.layerIndexes[r.id];g===void 0&&(g=this.layerIndexes[r.id]=new Zn);let w=!1;const C={};g.handleWrapJump(_);for(const L of d){const F=L.getBucket(r);F&&r.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(L.tileID,F,this.crossTileIDs)&&(w=!0),C[F.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(w=!0),w}pruneUnusedLayers(r){const d={};r.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const ns=(M,r)=>o.t(M,r&&r.filter(d=>d.identifier!=="source.canvas")),on=o.aw();class Ts extends o.E{constructor(r,d={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const g=this.sourceCaches[_].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[_].reload()}},this.map=r,this.dispatcher=new bi(gi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,g)=>this.getGlyphs(_,g)),this.dispatcher.registerMessageHandler("GI",(_,g)=>this.getImages(_,g)),this.imageManager=new wt,this.imageManager.setEventedParent(this),this.glyphManager=new Zt(r._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ni(256,512),this.crossTileSymbolIndex=new is,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),ue().on(Ut,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const g=this.sourceCaches[_.sourceId];if(!g)return;const w=g.getSource();if(w&&w.vectorLayerIds)for(const C in this._layers){const L=this._layers[C];L.source===w.id&&this._validateLayer(L)}})}loadURL(r,d={},_){this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;o.h(g,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,d,_)}).catch(C=>{this._loadStyleRequest=null,C&&!w.signal.aborted&&this.fire(new o.j(C))})}loadJSON(r,d={},_){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(r,d,_)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(on,{validate:!1})}_load(r,d,_){var g;const w=d.transformStyle?d.transformStyle(_,r):r;if(!d.validate||!ns(this,o.u(w))){this._loaded=!0,this.stylesheet=w;for(const C in w.sources)this.addSource(C,w.sources[C],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Ee(this.stylesheet.light),this.sky=new ri(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const r=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of r){const _=o.aA(d);_.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=_}}_loadSprite(r,d=!1,_=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,C,L,F){return o._(this,void 0,void 0,function*(){const N=q(w),H=L>1?"@2x":"",j={},tt={};for(const{id:ot,url:ht}of N){const pt=C.transformRequest(J(ht,H,".json"),"SpriteJSON");j[ot]=o.h(pt,F);const yt=C.transformRequest(J(ht,H,".png"),"SpriteImage");tt[ot]=U.getImage(yt,F)}return yield Promise.all([...Object.values(j),...Object.values(tt)]),function(ot,ht){return o._(this,void 0,void 0,function*(){const pt={};for(const yt in ot){pt[yt]={};const vt=v.getImageCanvasContext((yield ht[yt]).data),Mt=(yield ot[yt]).data;for(const dt in Mt){const{width:Ct,height:Lt,x:Bt,y:ee,sdf:he,pixelRatio:we,stretchX:Ce,stretchY:ye,content:_e,textFitWidth:Ve,textFitHeight:mi}=Mt[dt];pt[yt][dt]={data:null,pixelRatio:we,sdf:he,stretchX:Ce,stretchY:ye,content:_e,textFitWidth:Ve,textFitHeight:mi,spriteData:{width:Ct,height:Lt,x:Bt,y:ee,context:vt}}}}return pt})}(j,tt)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const C in w){this._spritesImagesIds[C]=[];const L=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(F=>!(F in w)):[];for(const F of L)this.imageManager.removeImage(F),this._changedImages[F]=!0;for(const F in w[C]){const N=C==="default"?F:`${C}:${F}`;this._spritesImagesIds[C].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,w[C][F],!1):this.imageManager.addImage(N,w[C][F]),d&&(this._changedImages[N]=!0)}}}).catch(w=>{this._spriteRequest=null,g=w,this.fire(new o.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),_&&_(g)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(r){const d=this.sourceCaches[r.source];if(!d)return;const _=r.sourceLayer;if(!_)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(_)===-1)&&this.fire(new o.j(new Error(`Source layer "${_}" does not exist on source "${g.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,d=!1){const _=this._serializedAllLayers();if(!r||r.length===0)return Object.values(d?o.aB(_):_);const g=[];for(const w of r)if(_[w]){const C=d?o.aB(_[w]):_[w];g.push(C)}return g}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const g=this._layers[_];g.type!=="custom"&&(r[_]=g.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const d=this._changed;if(d){const g=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(g.length||w.length)&&this._updateWorkerLayers(g,w);for(const C in this._updatedSources){const L=this._updatedSources[C];if(L==="reload")this._reloadSource(C);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}const _={};for(const g in this.sourceCaches){const w=this.sourceCaches[g];_[g]=w.used,w.used=!1}for(const g of this._order){const w=this._layers[g];w.recalculate(r,this._availableImages),!w.isHidden(r.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const g in _){const w=this.sourceCaches[g];!!_[g]!=!!w.used&&w.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(r),this.sky.recalculate(r),this.z=r.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,d={}){var _;this._checkLoaded();const g=this.serialize();if(r=d.transformStyle?d.transformStyle(g,r):r,((_=d.validate)===null||_===void 0||_)&&ns(this,o.u(r)))return!1;(r=o.aB(r)).layers=o.az(r.layers);const w=o.aC(g,r),C=this._getOperationsToPerform(w);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const L of C.operations)L();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const d=[],_=[];for(const g of r)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setSky":d.push(()=>this.setSky.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:_.push(g.command)}return{operations:d,unimplemented:_}}addImage(r,d){if(this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,d),this._afterImageUpdated(r)}updateImage(r,d){this.imageManager.updateImage(r,d)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new o.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,d,_={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.u.source,`sources.${r}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[r]=new ne(r,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:r})),g.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.j(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,d){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const _=this.sourceCaches[r].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,d,_={}){this._checkLoaded();const g=r.id;if(this.getLayer(g))return void this.fire(new o.j(new Error(`Layer "${g}" already exists on this map.`)));let w;if(r.type==="custom"){if(ns(this,o.aD(r)))return;w=o.aA(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(g,r.source),r=o.aB(r),r=o.e(r,{source:g})),this._validate(o.u.layer,`layers.${g}`,r,{arrayIndex:-1},_))return;w=o.aA(r),this._validateLayer(w),w.setEventedParent(this,{layer:{id:g}})}const C=d?this._order.indexOf(d):this._order.length;if(d&&C===-1)this.fire(new o.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(C,0,g),this._layerOrderChanged=!0,this._layers[g]=w,this._removedLayers[g]&&w.source&&w.type!=="custom"){const L=this._removedLayers[g];delete this._removedLayers[g],L.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(r,d){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===d)return;const _=this._order.indexOf(r);this._order.splice(_,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new o.j(new Error(`Cannot move layer "${r}" before non-existing layer "${d}".`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const d=this._layers[r];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${r}".`)));d.setEventedParent(null);const _=this._order.indexOf(r);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=d,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],d.onRemove&&d.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,d,_){this._checkLoaded();const g=this.getLayer(r);g?g.minzoom===d&&g.maxzoom===_||(d!=null&&(g.minzoom=d),_!=null&&(g.maxzoom=_),this._updateLayer(g)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,d,_={}){this._checkLoaded();const g=this.getLayer(r);if(g){if(!o.aE(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(o.u.filter,`layers.${g.id}.filter`,d,null,_)||(g.filter=o.aB(d),this._updateLayer(g)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return o.aB(this.getLayer(r).filter)}setLayoutProperty(r,d,_,g={}){this._checkLoaded();const w=this.getLayer(r);w?o.aE(w.getLayoutProperty(d),_)||(w.setLayoutProperty(d,_,g),this._updateLayer(w)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,d){const _=this.getLayer(r);if(_)return _.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,d,_,g={}){this._checkLoaded();const w=this.getLayer(r);w?o.aE(w.getPaintProperty(d),_)||(w.setPaintProperty(d,_,g)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,d){return this.getLayer(r).getPaintProperty(d)}setFeatureState(r,d){this._checkLoaded();const _=r.source,g=r.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new o.j(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.getSource().type;C==="geojson"&&g?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||g?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(g,r.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,d){this._checkLoaded();const _=r.source,g=this.sourceCaches[_];if(g===void 0)return void this.fire(new o.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=g.getSource().type,C=w==="vector"?r.sourceLayer:void 0;w!=="vector"||C?d&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(C,r.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const d=r.source,_=r.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||_?(r.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(_,r.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=o.aF(this.sourceCaches,w=>w.serialize()),d=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,g=this.stylesheet;return o.aG({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:r,layers:d,terrain:_},w=>w!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const d=C=>this._layers[C].type==="fill-extrusion",_={},g=[];for(let C=this._order.length-1;C>=0;C--){const L=this._order[C];if(d(L)){_[L]=C;for(const F of r){const N=F[L];if(N)for(const H of N)g.push(H)}}}g.sort((C,L)=>L.intersectionZ-C.intersectionZ);const w=[];for(let C=this._order.length-1;C>=0;C--){const L=this._order[C];if(d(L))for(let F=g.length-1;F>=0;F--){const N=g[F].feature;if(_[N.layer.id]<C)break;w.push(N),g.pop()}else for(const F of r){const N=F[L];if(N)for(const H of N)w.push(H.feature)}}return w}queryRenderedFeatures(r,d,_){d&&d.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const L of d.layers){const F=this._layers[L];if(!F)return this.fire(new o.j(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];g[F.source]=!0}}const w=[];d.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const L in this.sourceCaches)d.layers&&!g[L]||w.push($i(this.sourceCaches[L],this._layers,C,r,d,_));return this.placement&&w.push(function(L,F,N,H,j,tt,ot){const ht={},pt=tt.queryRenderedSymbols(H),yt=[];for(const vt of Object.keys(pt).map(Number))yt.push(ot[vt]);yt.sort(zt);for(const vt of yt){const Mt=vt.featureIndex.lookupSymbolFeatures(pt[vt.bucketInstanceId],F,vt.bucketIndex,vt.sourceLayerIndex,j.filter,j.layers,j.availableImages,L);for(const dt in Mt){const Ct=ht[dt]=ht[dt]||[],Lt=Mt[dt];Lt.sort((Bt,ee)=>{const he=vt.featureSortOrder;if(he){const we=he.indexOf(Bt.featureIndex);return he.indexOf(ee.featureIndex)-we}return ee.featureIndex-Bt.featureIndex});for(const Bt of Lt)Ct.push(Bt)}}for(const vt in ht)ht[vt].forEach(Mt=>{const dt=Mt.feature,Ct=N[L[vt].source].getFeatureState(dt.layer["source-layer"],dt.id);dt.source=dt.layer.source,dt.layer["source-layer"]&&(dt.sourceLayer=dt.layer["source-layer"]),dt.state=Ct});return ht}(this._layers,C,this.sourceCaches,r,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(r,d){d&&d.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[r];return _?function(g,w){const C=g.getRenderableIds().map(N=>g.getTileByID(N)),L=[],F={};for(let N=0;N<C.length;N++){const H=C[N],j=H.tileID.canonical.key;F[j]||(F[j]=!0,H.querySourceFeatures(L,w))}return L}(_,d):[]}getLight(){return this.light.getLight()}setLight(r,d={}){this._checkLoaded();const _=this.light.getLight();let g=!1;for(const C in r)if(!o.aE(r[C],_[C])){g=!0;break}if(!g)return;const w={now:v.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,d),this.light.updateTransitions(w)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,d={}){const _=this.getSky();let g=!1;if(!r&&!_)return;if(r&&!_)g=!0;else if(!r&&_)g=!0;else for(const C in r)if(!o.aE(r[C],_[C])){g=!0;break}if(!g)return;const w={now:v.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,d),this.sky.updateTransitions(w)}_validate(r,d,_,g,w={}){return(!w||w.validate!==!1)&&ns(this,r.call(o.u,o.e({key:d,style:this.serialize(),value:_,styleSpec:o.v},g)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ue().off(Ut,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const _=this.sourceCaches[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const d in this.sourceCaches)this.sourceCaches[d].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,d,_,g,w=!1){let C=!1,L=!1;const F={};for(const N of this._order){const H=this._layers[N];if(H.type!=="symbol")continue;if(!F[H.source]){const tt=this.sourceCaches[H.source];F[H.source]=tt.getRenderableIds(!0).map(ot=>tt.getTileByID(ot)).sort((ot,ht)=>ht.tileID.overscaledZ-ot.tileID.overscaledZ||(ot.tileID.isLessThan(ht.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(H,F[H.source],r.center.lng);C=C||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.now(),r.zoom))&&(this.pauseablePlacement=new Ke(r,this.map.terrain,this._order,w,d,_,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.now()),L=!0),C&&this.pauseablePlacement.placement.setStale()),L||C)for(const N of this._order){const H=this._layers[N];H.type==="symbol"&&this.placement.updateLayerOpacities(H,F[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,d){return o._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),_})}getGlyphs(r,d){return o._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,d={}){this._checkLoaded(),r&&this._validate(o.u.glyphs,"glyphs",r,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,d,_={},g){this._checkLoaded();const w=[{id:r,url:d}],C=[...q(this.stylesheet.sprite),...w];this._validate(o.u.sprite,"sprite",C,null,_)||(this.stylesheet.sprite=C,this._loadSprite(w,!0,g))}removeSprite(r){this._checkLoaded();const d=q(this.stylesheet.sprite);if(d.find(_=>_.id===r)){if(this._spritesImagesIds[r])for(const _ of this._spritesImagesIds[r])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex(_=>_.id===r),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return q(this.stylesheet.sprite)}setSprite(r,d={},_){this._checkLoaded(),r&&this._validate(o.u.sprite,"sprite",r,null,d)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,_):(this._unloadSprite(),_&&_(null)))}}var Qs=o.Y([{name:"a_pos",type:"Int16",components:2}]);const Ln={prelude:Pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Pi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Pi(M,r){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=r.match(/attribute ([\w]+) ([\w]+)/g),g=M.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(g):g,L={};return{fragmentSource:M=M.replace(d,(F,N,H,j,tt)=>(L[tt]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${tt}
varying ${H} ${j} ${tt};
#else
uniform ${H} ${j} u_${tt};
#endif
`:`
#ifdef HAS_UNIFORM_u_${tt}
    ${H} ${j} ${tt} = u_${tt};
#endif
`)),vertexSource:r=r.replace(d,(F,N,H,j,tt)=>{const ot=j==="float"?"vec2":"vec4",ht=tt.match(/color/)?"color":ot;return L[tt]?N==="define"?`
#ifndef HAS_UNIFORM_u_${tt}
uniform lowp float u_${tt}_t;
attribute ${H} ${ot} a_${tt};
varying ${H} ${j} ${tt};
#else
uniform ${H} ${j} u_${tt};
#endif
`:ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${tt}
    ${tt} = a_${tt};
#else
    ${H} ${j} ${tt} = u_${tt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${tt}
    ${tt} = unpack_mix_${ht}(a_${tt}, u_${tt}_t);
#else
    ${H} ${j} ${tt} = u_${tt};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${tt}
uniform lowp float u_${tt}_t;
attribute ${H} ${ot} a_${tt};
#else
uniform ${H} ${j} u_${tt};
#endif
`:ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${tt}
    ${H} ${j} ${tt} = a_${tt};
#else
    ${H} ${j} ${tt} = u_${tt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${tt}
    ${H} ${j} ${tt} = unpack_mix_${ht}(a_${tt}, u_${tt}_t);
#else
    ${H} ${j} ${tt} = u_${tt};
#endif
`}),staticAttributes:_,staticUniforms:C}}class vr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,d,_,g,w,C,L,F,N){this.context=r;let H=this.boundPaintVertexBuffers.length!==g.length;for(let j=0;!H&&j<g.length;j++)this.boundPaintVertexBuffers[j]!==g[j]&&(H=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==F||this.boundDynamicVertexBuffer3!==N?this.freshBind(d,_,g,w,C,L,F,N):(r.bindVertexArray.set(this.vao),L&&L.bind(),w&&w.dynamicDraw&&w.bind(),F&&F.bind(),N&&N.bind())}freshBind(r,d,_,g,w,C,L,F){const N=r.numAttributes,H=this.context,j=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=F,d.enableAttributes(j,r);for(const tt of _)tt.enableAttributes(j,r);C&&C.enableAttributes(j,r),L&&L.enableAttributes(j,r),F&&F.enableAttributes(j,r),d.bind(),d.setVertexAttribPointers(j,r,w);for(const tt of _)tt.bind(),tt.setVertexAttribPointers(j,r,w);C&&(C.bind(),C.setVertexAttribPointers(j,r,w)),g&&g.bind(),L&&(L.bind(),L.setVertexAttribPointers(j,r,w)),F&&(F.bind(),F.setVertexAttribPointers(j,r,w)),H.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Yo=(M,r,d,_,g)=>({u_matrix:M,u_texture:0,u_ele_delta:r,u_fog_matrix:d,u_fog_color:_?_.properties.get("fog-color"):o.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(g):0,u_horizon_color:_?_.properties.get("horizon-color"):o.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function Ko(M){const r=[];for(let d=0;d<M.length;d++){if(M[d]===null)continue;const _=M[d].split(" ");r.push(_.pop())}return r}class zd{constructor(r,d,_,g,w,C){const L=r.gl;this.program=L.createProgram();const F=Ko(d.staticAttributes),N=_?_.getBinderAttributes():[],H=F.concat(N),j=Ln.prelude.staticUniforms?Ko(Ln.prelude.staticUniforms):[],tt=d.staticUniforms?Ko(d.staticUniforms):[],ot=_?_.getBinderUniforms():[],ht=j.concat(tt).concat(ot),pt=[];for(const Bt of ht)pt.indexOf(Bt)<0&&pt.push(Bt);const yt=_?_.defines():[];w&&yt.push("#define OVERDRAW_INSPECTOR;"),C&&yt.push("#define TERRAIN3D;");const vt=yt.concat(Ln.prelude.fragmentSource,d.fragmentSource).join(`
`),Mt=yt.concat(Ln.prelude.vertexSource,d.vertexSource).join(`
`),dt=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(dt,vt),L.compileShader(dt),!L.getShaderParameter(dt,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(dt)}`);L.attachShader(this.program,dt);const Ct=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(Ct,Mt),L.compileShader(Ct),!L.getShaderParameter(Ct,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(Ct)}`);L.attachShader(this.program,Ct),this.attributes={};const Lt={};this.numAttributes=H.length;for(let Bt=0;Bt<this.numAttributes;Bt++)H[Bt]&&(L.bindAttribLocation(this.program,Bt,H[Bt]),this.attributes[H[Bt]]=Bt);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(Ct),L.deleteShader(dt);for(let Bt=0;Bt<pt.length;Bt++){const ee=pt[Bt];if(ee&&!Lt[ee]){const he=L.getUniformLocation(this.program,ee);he&&(Lt[ee]=he)}}this.fixedUniforms=g(r,Lt),this.terrainUniforms=((Bt,ee)=>({u_depth:new o.aH(Bt,ee.u_depth),u_terrain:new o.aH(Bt,ee.u_terrain),u_terrain_dim:new o.aI(Bt,ee.u_terrain_dim),u_terrain_matrix:new o.aJ(Bt,ee.u_terrain_matrix),u_terrain_unpack:new o.aK(Bt,ee.u_terrain_unpack),u_terrain_exaggeration:new o.aI(Bt,ee.u_terrain_exaggeration)}))(r,Lt),this.binderUniforms=_?_.getUniforms(r,Lt):[]}draw(r,d,_,g,w,C,L,F,N,H,j,tt,ot,ht,pt,yt,vt,Mt){const dt=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(_),r.setStencilMode(g),r.setColorMode(w),r.setCullFace(C),F){r.activeTexture.set(dt.TEXTURE2),dt.bindTexture(dt.TEXTURE_2D,F.depthTexture),r.activeTexture.set(dt.TEXTURE3),dt.bindTexture(dt.TEXTURE_2D,F.texture);for(const Lt in this.terrainUniforms)this.terrainUniforms[Lt].set(F[Lt])}for(const Lt in this.fixedUniforms)this.fixedUniforms[Lt].set(L[Lt]);pt&&pt.setUniforms(r,this.binderUniforms,ot,{zoom:ht});let Ct=0;switch(d){case dt.LINES:Ct=2;break;case dt.TRIANGLES:Ct=3;break;case dt.LINE_STRIP:Ct=1}for(const Lt of tt.get()){const Bt=Lt.vaos||(Lt.vaos={});(Bt[N]||(Bt[N]=new vr)).bind(r,this,H,pt?pt.getPaintVertexBuffers():[],j,Lt.vertexOffset,yt,vt,Mt),dt.drawElements(d,Lt.primitiveLength*Ct,dt.UNSIGNED_SHORT,Lt.primitiveOffset*Ct*2)}}}function yh(M,r,d){const _=1/Ci(d,1,r.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,r.transform.tileZoom)/g,C=w*(d.tileID.canonical.x+d.tileID.wrap*g),L=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,M.fromScale,M.toScale],u_fade:M.t,u_pixel_coord_upper:[C>>16,L>>16],u_pixel_coord_lower:[65535&C,65535&L]}}const lc=(M,r,d,_)=>{const g=r.style.light,w=g.properties.get("position"),C=[w.x,w.y,w.z],L=function(){var N=new o.A(9);return o.A!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,N}();g.properties.get("anchor")==="viewport"&&function(N,H){var j=Math.sin(H),tt=Math.cos(H);N[0]=tt,N[1]=j,N[2]=0,N[3]=-j,N[4]=tt,N[5]=0,N[6]=0,N[7]=0,N[8]=1}(L,-r.transform.angle),function(N,H,j){var tt=H[0],ot=H[1],ht=H[2];N[0]=tt*j[0]+ot*j[3]+ht*j[6],N[1]=tt*j[1]+ot*j[4]+ht*j[7],N[2]=tt*j[2]+ot*j[5]+ht*j[8]}(C,C,L);const F=g.properties.get("color");return{u_matrix:M,u_lightpos:C,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+d,u_opacity:_}},xh=(M,r,d,_,g,w,C)=>o.e(lc(M,r,d,_),yh(w,r,C),{u_height_factor:-Math.pow(2,g.overscaledZ)/C.tileSize/8}),Jo=M=>({u_matrix:M}),pm=(M,r,d,_)=>o.e(Jo(M),yh(d,r,_)),P0=(M,r)=>({u_matrix:M,u_world:r}),mm=(M,r,d,_,g)=>o.e(pm(M,r,d,_),{u_world:g}),I0=(M,r,d,_)=>{const g=M.transform;let w,C;if(_.paint.get("circle-pitch-alignment")==="map"){const L=Ci(d,1,g.zoom);w=!0,C=[L,L]}else w=!1,C=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:M.translatePosMatrix(r.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:M.pixelRatio,u_extrude_scale:C}},fo=(M,r,d)=>({u_matrix:M,u_inv_matrix:r,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}),cc=(M,r,d=1)=>({u_matrix:M,u_color:r,u_overlay:0,u_overlay_scale:d}),zs=M=>({u_matrix:M}),Os=(M,r,d,_)=>({u_matrix:M,u_extrude_scale:Ci(r,1,d),u_intensity:_}),vh=(M,r,d,_)=>{const g=o.H();o.aP(g,0,M.width,M.height,0,0,1);const w=M.context.gl;return{u_matrix:g,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:d,u_color_ramp:_,u_opacity:r.paint.get("heatmap-opacity")}};function bh(M,r){const d=Math.pow(2,r.canonical.z),_=r.canonical.y;return[new o.Z(0,_/d).toLngLat().lat,new o.Z(0,(_+1)/d).toLngLat().lat]}const wh=(M,r,d,_)=>{const g=M.transform;return{u_matrix:ym(M,r,d,_),u_ratio:1/Ci(r,1,g.zoom),u_device_pixel_ratio:M.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},_m=(M,r,d,_,g)=>o.e(wh(M,r,d,g),{u_image:0,u_image_height:_}),Qo=(M,r,d,_,g)=>{const w=M.transform,C=gm(r,w);return{u_matrix:ym(M,r,d,g),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Ci(r,1,w.zoom),u_device_pixel_ratio:M.pixelRatio,u_image:0,u_scale:[C,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},R0=(M,r,d,_,g,w)=>{const C=M.lineAtlas,L=gm(r,M.transform),F=d.layout.get("line-cap")==="round",N=C.getDash(_.from,F),H=C.getDash(_.to,F),j=N.width*g.fromScale,tt=H.width*g.toScale;return o.e(wh(M,r,d,w),{u_patternscale_a:[L/j,-N.height/2],u_patternscale_b:[L/tt,-H.height/2],u_sdfgamma:C.width/(256*Math.min(j,tt)*M.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:H.y,u_mix:g.t})};function gm(M,r){return 1/Ci(M,1,r.tileZoom)}function ym(M,r,d,_){return M.translatePosMatrix(_?_.posMatrix:r.tileID.posMatrix,r,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const D0=(M,r,d,_,g)=>{return{u_matrix:M,u_tl_parent:r,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=g.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:L0(g.paint.get("raster-hue-rotate"))};var w,C};function L0(M){M*=Math.PI/180;const r=Math.sin(M),d=Math.cos(M);return[(2*d+1)/3,(-Math.sqrt(3)*r-d+1)/3,(Math.sqrt(3)*r-d+1)/3]}const xm=(M,r,d,_,g,w,C,L,F,N,H,j,tt,ot)=>{const ht=C.transform;return{u_is_size_zoom_constant:+(M==="constant"||M==="source"),u_is_size_feature_constant:+(M==="constant"||M==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ht.cameraToCenterDistance,u_pitch:ht.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ht.width/ht.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:F,u_coord_matrix:N,u_is_text:+j,u_pitch_with_map:+_,u_is_along_line:g,u_is_variable_anchor:w,u_texsize:tt,u_texture:0,u_translation:H,u_pitched_scale:ot}},hc=(M,r,d,_,g,w,C,L,F,N,H,j,tt,ot,ht)=>{const pt=C.transform;return o.e(xm(M,r,d,_,g,w,C,L,F,N,H,j,tt,ht),{u_gamma_scale:_?Math.cos(pt._pitch)*pt.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:+ot})},Od=(M,r,d,_,g,w,C,L,F,N,H,j,tt,ot)=>o.e(hc(M,r,d,_,g,w,C,L,F,N,H,!0,j,!0,ot),{u_texsize_icon:tt,u_texture_icon:1}),Mh=(M,r,d)=>({u_matrix:M,u_opacity:r,u_color:d}),Bd=(M,r,d,_,g,w)=>o.e(function(C,L,F,N){const H=F.imageManager.getPattern(C.from.toString()),j=F.imageManager.getPattern(C.to.toString()),{width:tt,height:ot}=F.imageManager.getPixelSize(),ht=Math.pow(2,N.tileID.overscaledZ),pt=N.tileSize*Math.pow(2,F.transform.tileZoom)/ht,yt=pt*(N.tileID.canonical.x+N.tileID.wrap*ht),vt=pt*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[tt,ot],u_mix:L.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Ci(N,1,F.transform.tileZoom),u_pixel_coord_upper:[yt>>16,vt>>16],u_pixel_coord_lower:[65535&yt,65535&vt]}}(_,w,d,g),{u_matrix:M,u_opacity:r}),Nd={fillExtrusion:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_lightpos:new o.aN(M,r.u_lightpos),u_lightintensity:new o.aI(M,r.u_lightintensity),u_lightcolor:new o.aN(M,r.u_lightcolor),u_vertical_gradient:new o.aI(M,r.u_vertical_gradient),u_opacity:new o.aI(M,r.u_opacity)}),fillExtrusionPattern:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_lightpos:new o.aN(M,r.u_lightpos),u_lightintensity:new o.aI(M,r.u_lightintensity),u_lightcolor:new o.aN(M,r.u_lightcolor),u_vertical_gradient:new o.aI(M,r.u_vertical_gradient),u_height_factor:new o.aI(M,r.u_height_factor),u_image:new o.aH(M,r.u_image),u_texsize:new o.aO(M,r.u_texsize),u_pixel_coord_upper:new o.aO(M,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(M,r.u_pixel_coord_lower),u_scale:new o.aN(M,r.u_scale),u_fade:new o.aI(M,r.u_fade),u_opacity:new o.aI(M,r.u_opacity)}),fill:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix)}),fillPattern:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_image:new o.aH(M,r.u_image),u_texsize:new o.aO(M,r.u_texsize),u_pixel_coord_upper:new o.aO(M,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(M,r.u_pixel_coord_lower),u_scale:new o.aN(M,r.u_scale),u_fade:new o.aI(M,r.u_fade)}),fillOutline:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_world:new o.aO(M,r.u_world)}),fillOutlinePattern:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_world:new o.aO(M,r.u_world),u_image:new o.aH(M,r.u_image),u_texsize:new o.aO(M,r.u_texsize),u_pixel_coord_upper:new o.aO(M,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(M,r.u_pixel_coord_lower),u_scale:new o.aN(M,r.u_scale),u_fade:new o.aI(M,r.u_fade)}),circle:(M,r)=>({u_camera_to_center_distance:new o.aI(M,r.u_camera_to_center_distance),u_scale_with_map:new o.aH(M,r.u_scale_with_map),u_pitch_with_map:new o.aH(M,r.u_pitch_with_map),u_extrude_scale:new o.aO(M,r.u_extrude_scale),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_matrix:new o.aJ(M,r.u_matrix)}),collisionBox:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_pixel_extrude_scale:new o.aO(M,r.u_pixel_extrude_scale)}),collisionCircle:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_inv_matrix:new o.aJ(M,r.u_inv_matrix),u_camera_to_center_distance:new o.aI(M,r.u_camera_to_center_distance),u_viewport_size:new o.aO(M,r.u_viewport_size)}),debug:(M,r)=>({u_color:new o.aL(M,r.u_color),u_matrix:new o.aJ(M,r.u_matrix),u_overlay:new o.aH(M,r.u_overlay),u_overlay_scale:new o.aI(M,r.u_overlay_scale)}),clippingMask:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix)}),heatmap:(M,r)=>({u_extrude_scale:new o.aI(M,r.u_extrude_scale),u_intensity:new o.aI(M,r.u_intensity),u_matrix:new o.aJ(M,r.u_matrix)}),heatmapTexture:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_world:new o.aO(M,r.u_world),u_image:new o.aH(M,r.u_image),u_color_ramp:new o.aH(M,r.u_color_ramp),u_opacity:new o.aI(M,r.u_opacity)}),hillshade:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_image:new o.aH(M,r.u_image),u_latrange:new o.aO(M,r.u_latrange),u_light:new o.aO(M,r.u_light),u_shadow:new o.aL(M,r.u_shadow),u_highlight:new o.aL(M,r.u_highlight),u_accent:new o.aL(M,r.u_accent)}),hillshadePrepare:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_image:new o.aH(M,r.u_image),u_dimension:new o.aO(M,r.u_dimension),u_zoom:new o.aI(M,r.u_zoom),u_unpack:new o.aK(M,r.u_unpack)}),line:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_ratio:new o.aI(M,r.u_ratio),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_units_to_pixels:new o.aO(M,r.u_units_to_pixels)}),lineGradient:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_ratio:new o.aI(M,r.u_ratio),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_units_to_pixels:new o.aO(M,r.u_units_to_pixels),u_image:new o.aH(M,r.u_image),u_image_height:new o.aI(M,r.u_image_height)}),linePattern:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_texsize:new o.aO(M,r.u_texsize),u_ratio:new o.aI(M,r.u_ratio),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_image:new o.aH(M,r.u_image),u_units_to_pixels:new o.aO(M,r.u_units_to_pixels),u_scale:new o.aN(M,r.u_scale),u_fade:new o.aI(M,r.u_fade)}),lineSDF:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_ratio:new o.aI(M,r.u_ratio),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_units_to_pixels:new o.aO(M,r.u_units_to_pixels),u_patternscale_a:new o.aO(M,r.u_patternscale_a),u_patternscale_b:new o.aO(M,r.u_patternscale_b),u_sdfgamma:new o.aI(M,r.u_sdfgamma),u_image:new o.aH(M,r.u_image),u_tex_y_a:new o.aI(M,r.u_tex_y_a),u_tex_y_b:new o.aI(M,r.u_tex_y_b),u_mix:new o.aI(M,r.u_mix)}),raster:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_tl_parent:new o.aO(M,r.u_tl_parent),u_scale_parent:new o.aI(M,r.u_scale_parent),u_buffer_scale:new o.aI(M,r.u_buffer_scale),u_fade_t:new o.aI(M,r.u_fade_t),u_opacity:new o.aI(M,r.u_opacity),u_image0:new o.aH(M,r.u_image0),u_image1:new o.aH(M,r.u_image1),u_brightness_low:new o.aI(M,r.u_brightness_low),u_brightness_high:new o.aI(M,r.u_brightness_high),u_saturation_factor:new o.aI(M,r.u_saturation_factor),u_contrast_factor:new o.aI(M,r.u_contrast_factor),u_spin_weights:new o.aN(M,r.u_spin_weights)}),symbolIcon:(M,r)=>({u_is_size_zoom_constant:new o.aH(M,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(M,r.u_is_size_feature_constant),u_size_t:new o.aI(M,r.u_size_t),u_size:new o.aI(M,r.u_size),u_camera_to_center_distance:new o.aI(M,r.u_camera_to_center_distance),u_pitch:new o.aI(M,r.u_pitch),u_rotate_symbol:new o.aH(M,r.u_rotate_symbol),u_aspect_ratio:new o.aI(M,r.u_aspect_ratio),u_fade_change:new o.aI(M,r.u_fade_change),u_matrix:new o.aJ(M,r.u_matrix),u_label_plane_matrix:new o.aJ(M,r.u_label_plane_matrix),u_coord_matrix:new o.aJ(M,r.u_coord_matrix),u_is_text:new o.aH(M,r.u_is_text),u_pitch_with_map:new o.aH(M,r.u_pitch_with_map),u_is_along_line:new o.aH(M,r.u_is_along_line),u_is_variable_anchor:new o.aH(M,r.u_is_variable_anchor),u_texsize:new o.aO(M,r.u_texsize),u_texture:new o.aH(M,r.u_texture),u_translation:new o.aO(M,r.u_translation),u_pitched_scale:new o.aI(M,r.u_pitched_scale)}),symbolSDF:(M,r)=>({u_is_size_zoom_constant:new o.aH(M,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(M,r.u_is_size_feature_constant),u_size_t:new o.aI(M,r.u_size_t),u_size:new o.aI(M,r.u_size),u_camera_to_center_distance:new o.aI(M,r.u_camera_to_center_distance),u_pitch:new o.aI(M,r.u_pitch),u_rotate_symbol:new o.aH(M,r.u_rotate_symbol),u_aspect_ratio:new o.aI(M,r.u_aspect_ratio),u_fade_change:new o.aI(M,r.u_fade_change),u_matrix:new o.aJ(M,r.u_matrix),u_label_plane_matrix:new o.aJ(M,r.u_label_plane_matrix),u_coord_matrix:new o.aJ(M,r.u_coord_matrix),u_is_text:new o.aH(M,r.u_is_text),u_pitch_with_map:new o.aH(M,r.u_pitch_with_map),u_is_along_line:new o.aH(M,r.u_is_along_line),u_is_variable_anchor:new o.aH(M,r.u_is_variable_anchor),u_texsize:new o.aO(M,r.u_texsize),u_texture:new o.aH(M,r.u_texture),u_gamma_scale:new o.aI(M,r.u_gamma_scale),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_is_halo:new o.aH(M,r.u_is_halo),u_translation:new o.aO(M,r.u_translation),u_pitched_scale:new o.aI(M,r.u_pitched_scale)}),symbolTextAndIcon:(M,r)=>({u_is_size_zoom_constant:new o.aH(M,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(M,r.u_is_size_feature_constant),u_size_t:new o.aI(M,r.u_size_t),u_size:new o.aI(M,r.u_size),u_camera_to_center_distance:new o.aI(M,r.u_camera_to_center_distance),u_pitch:new o.aI(M,r.u_pitch),u_rotate_symbol:new o.aH(M,r.u_rotate_symbol),u_aspect_ratio:new o.aI(M,r.u_aspect_ratio),u_fade_change:new o.aI(M,r.u_fade_change),u_matrix:new o.aJ(M,r.u_matrix),u_label_plane_matrix:new o.aJ(M,r.u_label_plane_matrix),u_coord_matrix:new o.aJ(M,r.u_coord_matrix),u_is_text:new o.aH(M,r.u_is_text),u_pitch_with_map:new o.aH(M,r.u_pitch_with_map),u_is_along_line:new o.aH(M,r.u_is_along_line),u_is_variable_anchor:new o.aH(M,r.u_is_variable_anchor),u_texsize:new o.aO(M,r.u_texsize),u_texsize_icon:new o.aO(M,r.u_texsize_icon),u_texture:new o.aH(M,r.u_texture),u_texture_icon:new o.aH(M,r.u_texture_icon),u_gamma_scale:new o.aI(M,r.u_gamma_scale),u_device_pixel_ratio:new o.aI(M,r.u_device_pixel_ratio),u_is_halo:new o.aH(M,r.u_is_halo),u_translation:new o.aO(M,r.u_translation),u_pitched_scale:new o.aI(M,r.u_pitched_scale)}),background:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_opacity:new o.aI(M,r.u_opacity),u_color:new o.aL(M,r.u_color)}),backgroundPattern:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_opacity:new o.aI(M,r.u_opacity),u_image:new o.aH(M,r.u_image),u_pattern_tl_a:new o.aO(M,r.u_pattern_tl_a),u_pattern_br_a:new o.aO(M,r.u_pattern_br_a),u_pattern_tl_b:new o.aO(M,r.u_pattern_tl_b),u_pattern_br_b:new o.aO(M,r.u_pattern_br_b),u_texsize:new o.aO(M,r.u_texsize),u_mix:new o.aI(M,r.u_mix),u_pattern_size_a:new o.aO(M,r.u_pattern_size_a),u_pattern_size_b:new o.aO(M,r.u_pattern_size_b),u_scale_a:new o.aI(M,r.u_scale_a),u_scale_b:new o.aI(M,r.u_scale_b),u_pixel_coord_upper:new o.aO(M,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(M,r.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(M,r.u_tile_units_to_pixels)}),terrain:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_texture:new o.aH(M,r.u_texture),u_ele_delta:new o.aI(M,r.u_ele_delta),u_fog_matrix:new o.aJ(M,r.u_fog_matrix),u_fog_color:new o.aL(M,r.u_fog_color),u_fog_ground_blend:new o.aI(M,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.aI(M,r.u_fog_ground_blend_opacity),u_horizon_color:new o.aL(M,r.u_horizon_color),u_horizon_fog_blend:new o.aI(M,r.u_horizon_fog_blend)}),terrainDepth:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_ele_delta:new o.aI(M,r.u_ele_delta)}),terrainCoords:(M,r)=>({u_matrix:new o.aJ(M,r.u_matrix),u_texture:new o.aH(M,r.u_texture),u_terrain_coords_id:new o.aI(M,r.u_terrain_coords_id),u_ele_delta:new o.aI(M,r.u_ele_delta)}),sky:(M,r)=>({u_sky_color:new o.aL(M,r.u_sky_color),u_horizon_color:new o.aL(M,r.u_horizon_color),u_horizon:new o.aI(M,r.u_horizon),u_sky_horizon_blend:new o.aI(M,r.u_sky_horizon_blend)})};class la{constructor(r,d,_){this.context=r;const g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const k0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ud{constructor(r,d,_,g){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=r;const w=r.gl;this.buffer=w.createBuffer(),r.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,d){for(let _=0;_<this.attributes.length;_++){const g=d.attributes[this.attributes[_].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,d,_){for(let g=0;g<this.attributes.length;g++){const w=this.attributes[g],C=d.attributes[w.name];C!==void 0&&r.vertexAttribPointer(C,w.components,r[k0[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const po=new WeakMap;function Ha(M){var r;if(po.has(M))return po.get(M);{const d=(r=M.getParameter(M.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return po.set(M,d),d}}class Xi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sh extends Xi{getDefault(){return o.aM.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class F0 extends Xi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class tl extends Xi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class z0 extends Xi{getDefault(){return[!0,!0,!0,!0]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vm extends Xi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class O0 extends Xi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class bm extends Xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const d=this.current;(r.func!==d.func||r.ref!==d.ref||r.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Vd extends Xi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class wm extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=r,this.dirty=!1}}class Mm extends Xi{getDefault(){return[0,1]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Sm extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=r,this.dirty=!1}}class Tm extends Xi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class mo extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.BLEND):d.disable(d.BLEND),this.current=r,this.dirty=!1}}class Em extends Xi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class B0 extends Xi{getDefault(){return o.aM.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Am extends Xi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class uc extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=r,this.dirty=!1}}class N0 extends Xi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Th extends Xi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class U0 extends Xi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class V0 extends Xi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Cm extends Xi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Pm extends Xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Im extends Xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Gd extends Xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Rm extends Xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Eh extends Xi{getDefault(){return null}set(r){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ca extends Xi{getDefault(){return null}set(r){var d;if(r===this.current&&!this.dirty)return;const _=this.gl;Ha(_)?_.bindVertexArray(r):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Hd extends Xi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class jd extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Wd extends Xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ah extends Xi{constructor(r,d){super(r),this.context=r,this.parent=d}getDefault(){return null}}class qd extends Ah{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class _o extends Ah{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Xd extends Ah{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class G0{constructor(r,d,_,g,w){this.context=r,this.width=d,this.height=_;const C=r.gl,L=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new qd(r,L),g)this.depthAttachment=w?new Xd(r,L):new _o(r,L);else if(w)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,d=this.colorAttachment.get();if(d&&r.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&r.deleteRenderbuffer(_)}r.deleteFramebuffer(this.framebuffer)}}class Cn{constructor(r,d,_){this.blendFunction=r,this.blendColor=d,this.mask=_}}Cn.Replace=[1,0],Cn.disabled=new Cn(Cn.Replace,o.aM.transparent,[!1,!1,!1,!1]),Cn.unblended=new Cn(Cn.Replace,o.aM.transparent,[!0,!0,!0,!0]),Cn.alphaBlended=new Cn([1,771],o.aM.transparent,[!0,!0,!0,!0]);class H0{constructor(r){var d,_;if(this.gl=r,this.clearColor=new Sh(this),this.clearDepth=new F0(this),this.clearStencil=new tl(this),this.colorMask=new z0(this),this.depthMask=new vm(this),this.stencilMask=new O0(this),this.stencilFunc=new bm(this),this.stencilOp=new Vd(this),this.stencilTest=new wm(this),this.depthRange=new Mm(this),this.depthTest=new Sm(this),this.depthFunc=new Tm(this),this.blend=new mo(this),this.blendFunc=new Em(this),this.blendColor=new B0(this),this.blendEquation=new Am(this),this.cullFace=new uc(this),this.cullFaceSide=new N0(this),this.frontFace=new Th(this),this.program=new U0(this),this.activeTexture=new V0(this),this.viewport=new Cm(this),this.bindFramebuffer=new Pm(this),this.bindRenderbuffer=new Im(this),this.bindTexture=new Gd(this),this.bindVertexBuffer=new Rm(this),this.bindElementBuffer=new Eh(this),this.bindVertexArray=new Ca(this),this.pixelStoreUnpack=new Hd(this),this.pixelStoreUnpackPremultiplyAlpha=new jd(this),this.pixelStoreUnpackFlipY=new Wd(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),Ha(r)){this.HALF_FLOAT=r.HALF_FLOAT;const g=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=r.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(_=r.RGB16F)!==null&&_!==void 0?_:g==null?void 0:g.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const g=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,d){return new la(this,r,d)}createVertexBuffer(r,d,_){return new Ud(this,r,d,_)}createRenderbuffer(r,d,_){const g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,r,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(r,d,_,g){return new G0(this,r,d,_,g)}clear({color:r,depth:d,stencil:_}){const g=this.gl;let w=0;r&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(w|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),g.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.aE(r.blendFunction,Cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return Ha(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var d;return Ha(this.gl)?this.gl.deleteVertexArray(r):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class Ii{constructor(r,d,_){this.func=r,this.mask=d,this.range=_}}Ii.ReadOnly=!1,Ii.ReadWrite=!0,Ii.disabled=new Ii(519,Ii.ReadOnly,[0,1]);const Ch=7680;class ln{constructor(r,d,_,g,w,C){this.test=r,this.ref=d,this.mask=_,this.fail=g,this.depthFail=w,this.pass=C}}ln.disabled=new ln({func:519,mask:0},0,0,Ch,Ch,Ch);class Yi{constructor(r,d,_){this.enable=r,this.mode=d,this.frontFace=_}}let go;function dc(M,r,d,_,g){const w=M.context,C=w.gl,L=M.useProgram("collisionBox"),F=[];let N=0,H=0;for(let vt=0;vt<_.length;vt++){const Mt=_[vt],dt=r.getTile(Mt).getBucket(d);if(!dt)continue;const Ct=g?dt.textCollisionBox:dt.iconCollisionBox,Lt=dt.collisionCircleArray;if(Lt.length>0){const Bt=o.H();o.aQ(Bt,dt.placementInvProjMatrix,M.transform.glCoordMatrix),o.aQ(Bt,Bt,dt.placementViewportMatrix),F.push({circleArray:Lt,circleOffset:H,transform:Mt.posMatrix,invTransform:Bt,coord:Mt}),N+=Lt.length/4,H=N}Ct&&L.draw(w,C.LINES,Ii.disabled,ln.disabled,M.colorModeForRenderPass(),Yi.disabled,{u_matrix:Mt.posMatrix,u_pixel_extrude_scale:[1/(j=M.transform).width,1/j.height]},M.style.map.terrain&&M.style.map.terrain.getTerrainData(Mt),d.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,M.transform.zoom,null,null,Ct.collisionVertexBuffer)}var j;if(!g||!F.length)return;const tt=M.useProgram("collisionCircle"),ot=new o.aR;ot.resize(4*N),ot._trim();let ht=0;for(const vt of F)for(let Mt=0;Mt<vt.circleArray.length/4;Mt++){const dt=4*Mt,Ct=vt.circleArray[dt+0],Lt=vt.circleArray[dt+1],Bt=vt.circleArray[dt+2],ee=vt.circleArray[dt+3];ot.emplace(ht++,Ct,Lt,Bt,ee,0),ot.emplace(ht++,Ct,Lt,Bt,ee,1),ot.emplace(ht++,Ct,Lt,Bt,ee,2),ot.emplace(ht++,Ct,Lt,Bt,ee,3)}(!go||go.length<2*N)&&(go=function(vt){const Mt=2*vt,dt=new o.aT;dt.resize(Mt),dt._trim();for(let Ct=0;Ct<Mt;Ct++){const Lt=6*Ct;dt.uint16[Lt+0]=4*Ct+0,dt.uint16[Lt+1]=4*Ct+1,dt.uint16[Lt+2]=4*Ct+2,dt.uint16[Lt+3]=4*Ct+2,dt.uint16[Lt+4]=4*Ct+3,dt.uint16[Lt+5]=4*Ct+0}return dt}(N));const pt=w.createIndexBuffer(go,!0),yt=w.createVertexBuffer(ot,o.aS.members,!0);for(const vt of F){const Mt=fo(vt.transform,vt.invTransform,M.transform);tt.draw(w,C.TRIANGLES,Ii.disabled,ln.disabled,M.colorModeForRenderPass(),Yi.disabled,Mt,M.style.map.terrain&&M.style.map.terrain.getTerrainData(vt.coord),d.id,yt,pt,o.a0.simpleSegment(0,2*vt.circleOffset,vt.circleArray.length,vt.circleArray.length/2),null,M.transform.zoom,null,null,null)}yt.destroy(),pt.destroy()}Yi.disabled=new Yi(!1,1029,2305),Yi.backCCW=new Yi(!0,1029,2305);const fc=o.an(new Float32Array(16));function $d(M,r,d,_,g,w){const{horizontalAlign:C,verticalAlign:L}=o.au(M);return new o.P((-(C-.5)*r/g+_[0])*w,(-(L-.5)*d/g+_[1])*w)}function yo(M,r,d,_,g,w){const C=r.tileAnchorPoint.add(new o.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let L=_.mult(w);d||(L=L.rotate(-g));const F=C.add(L);return lt(F.x,F.y,r.labelPlaneMatrix,r.getElevation).point}if(d){const L=Xt(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(M),F=Math.atan(L.y/L.x)+(L.x<0?Math.PI:0);return M.add(_.rotate(F))}return M.add(_)}function el(M,r,d,_,g,w,C,L,F,N,H,j,tt,ot){const ht=M.text.placedSymbolArray,pt=M.text.dynamicLayoutVertexArray,yt=M.icon.dynamicLayoutVertexArray,vt={};pt.clear();for(let Mt=0;Mt<ht.length;Mt++){const dt=ht.get(Mt),Ct=dt.hidden||!dt.crossTileID||M.allowVerticalPlacement&&!dt.placedOrientation?null:_[dt.crossTileID];if(Ct){const Lt=new o.P(dt.anchorX,dt.anchorY),Bt={getElevation:ot,width:g.width,height:g.height,labelPlaneMatrix:w,pitchWithMap:d,projection:H,tileAnchorPoint:Lt,translation:j,unwrappedTileID:tt},ee=d?lt(Lt.x,Lt.y,C,ot):Xt(Lt.x,Lt.y,Bt),he=W(g.cameraToCenterDistance,ee.signedDistanceFromCamera);let we=o.ai(M.textSizeData,F,dt)*he/o.ap;d&&(we*=M.tilePixelRatio/L);const{width:Ce,height:ye,anchor:_e,textOffset:Ve,textBoxScale:mi}=Ct,xe=$d(_e,Ce,ye,Ve,mi,we),Te=H.getPitchedTextCorrection(g,Lt.add(new o.P(j[0],j[1])),tt),di=yo(ee.point,Bt,r,xe,g.angle,Te),dn=M.allowVerticalPlacement&&dt.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Ti=0;Ti<dt.numGlyphs;Ti++)o.aj(pt,di,dn);N&&dt.associatedIconIndex>=0&&(vt[dt.associatedIconIndex]={shiftedAnchor:di,angle:dn})}else Xe(dt.numGlyphs,pt)}if(N){yt.clear();const Mt=M.icon.placedSymbolArray;for(let dt=0;dt<Mt.length;dt++){const Ct=Mt.get(dt);if(Ct.hidden)Xe(Ct.numGlyphs,yt);else{const Lt=vt[dt];if(Lt)for(let Bt=0;Bt<Ct.numGlyphs;Bt++)o.aj(yt,Lt.shiftedAnchor,Lt.angle);else Xe(Ct.numGlyphs,yt)}}M.icon.dynamicLayoutVertexBuffer.updateData(yt)}M.text.dynamicLayoutVertexBuffer.updateData(pt)}function br(M,r,d){return d.iconsInText&&r?"symbolTextAndIcon":M?"symbolSDF":"symbolIcon"}function Zd(M,r,d,_,g,w,C,L,F,N,H,j){const tt=M.context,ot=tt.gl,ht=M.transform,pt=An(),yt=L==="map",vt=F==="map",Mt=L!=="viewport"&&d.layout.get("symbol-placement")!=="point",dt=yt&&!vt&&!Mt,Ct=!vt&&Mt,Lt=!d.layout.get("symbol-sort-key").isConstant();let Bt=!1;const ee=M.depthModeForSublayer(0,Ii.ReadOnly),he=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),we=[],Ce=pt.getCircleRadiusCorrection(ht);for(const ye of _){const _e=r.getTile(ye),Ve=_e.getBucket(d);if(!Ve)continue;const mi=g?Ve.text:Ve.icon;if(!mi||!mi.segments.get().length||!mi.hasVisibleVertices)continue;const xe=mi.programConfigurations.get(d.id),Te=g||Ve.sdfIcons,di=g?Ve.textSizeData:Ve.iconSizeData,dn=vt||ht.pitch!==0,Ti=M.useProgram(br(Te,g,Ve),xe),Di=o.ag(di,ht.zoom),fn=M.style.map.terrain&&M.style.map.terrain.getTerrainData(ye);let ds,Hr,pn,Bs,Es=[0,0],fs=null;if(g)Hr=_e.glyphAtlasTexture,pn=ot.LINEAR,ds=_e.glyphAtlasTexture.size,Ve.iconsInText&&(Es=_e.imageAtlasTexture.size,fs=_e.imageAtlasTexture,Bs=dn||M.options.rotating||M.options.zooming||di.kind==="composite"||di.kind==="camera"?ot.LINEAR:ot.NEAREST);else{const Oi=d.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Hr=_e.imageAtlasTexture,pn=Te||M.options.rotating||M.options.zooming||Oi||dn?ot.LINEAR:ot.NEAREST,ds=_e.imageAtlasTexture.size}const As=Ci(_e,1,M.transform.zoom),ua=Ct?ye.posMatrix:fc,_l=Kt(ua,vt,yt,M.transform,As),Xh=se(ua,vt,yt,M.transform,As),gl=se(ye.posMatrix,vt,yt,M.transform,As),Sr=pt.translatePosition(M.transform,_e,w,C),$h=he&&Ve.hasTextData(),bf=d.layout.get("icon-text-fit")!=="none"&&$h&&Ve.hasIconData();if(Mt){const Oi=M.style.map.terrain?(yl,xl)=>M.style.map.terrain.getElevation(ye,yl,xl):null,Mo=d.layout.get("text-rotation-alignment")==="map";it(Ve,ye.posMatrix,M,g,_l,gl,vt,N,Mo,pt,ye.toUnwrapped(),ht.width,ht.height,Sr,Oi)}const Tr=ye.posMatrix,Er=g&&he||bf,ja=Mt||Er?fc:_l,jr=Xh,ss=Te&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ps;ps=Te?Ve.iconsInText?Od(di.kind,Di,dt,vt,Mt,Er,M,Tr,ja,jr,Sr,ds,Es,Ce):hc(di.kind,Di,dt,vt,Mt,Er,M,Tr,ja,jr,Sr,g,ds,!0,Ce):xm(di.kind,Di,dt,vt,Mt,Er,M,Tr,ja,jr,Sr,g,ds,Ce);const ir={program:Ti,buffers:mi,uniformValues:ps,atlasTexture:Hr,atlasTextureIcon:fs,atlasInterpolation:pn,atlasInterpolationIcon:Bs,isSDF:Te,hasHalo:ss};if(Lt&&Ve.canOverlap){Bt=!0;const Oi=mi.segments.get();for(const Mo of Oi)we.push({segments:new o.a0([Mo]),sortKey:Mo.sortKey,state:ir,terrainData:fn})}else we.push({segments:mi.segments,sortKey:0,state:ir,terrainData:fn})}Bt&&we.sort((ye,_e)=>ye.sortKey-_e.sortKey);for(const ye of we){const _e=ye.state;if(tt.activeTexture.set(ot.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,ot.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(tt.activeTexture.set(ot.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,ot.CLAMP_TO_EDGE)),_e.isSDF){const Ve=_e.uniformValues;_e.hasHalo&&(Ve.u_is_halo=1,Yd(_e.buffers,ye.segments,d,M,_e.program,ee,H,j,Ve,ye.terrainData)),Ve.u_is_halo=0}Yd(_e.buffers,ye.segments,d,M,_e.program,ee,H,j,_e.uniformValues,ye.terrainData)}}function Yd(M,r,d,_,g,w,C,L,F,N){const H=_.context;g.draw(H,H.gl.TRIANGLES,w,C,L,Yi.disabled,F,N,d.id,M.layoutVertexBuffer,M.indexBuffer,r,d.paint,_.transform.zoom,M.programConfigurations.get(d.id),M.dynamicLayoutVertexBuffer,M.opacityVertexBuffer)}function Kd(M,r,d,_){const g=M.context,w=g.gl,C=ln.disabled,L=new Cn([w.ONE,w.ONE],o.aM.transparent,[!0,!0,!0,!0]),F=r.getBucket(d);if(!F)return;const N=_.key;let H=d.heatmapFbos.get(N);H||(H=pc(g,r.tileSize,r.tileSize),d.heatmapFbos.set(N,H)),g.bindFramebuffer.set(H.framebuffer),g.viewport.set([0,0,r.tileSize,r.tileSize]),g.clear({color:o.aM.transparent});const j=F.programConfigurations.get(d.id),tt=M.useProgram("heatmap",j),ot=M.style.map.terrain.getTerrainData(_);tt.draw(g,w.TRIANGLES,Ii.disabled,C,L,Yi.disabled,Os(_.posMatrix,r,M.transform.zoom,d.paint.get("heatmap-intensity")),ot,d.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,d.paint,M.transform.zoom,j)}function xo(M,r,d){const _=M.context,g=_.gl;_.setColorMode(M.colorModeForRenderPass());const w=mc(_,r),C=d.key,L=r.heatmapFbos.get(C);L&&(_.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,L.colorAttachment.get()),_.activeTexture.set(g.TEXTURE1),w.bind(g.LINEAR,g.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(_,g.TRIANGLES,Ii.disabled,ln.disabled,M.colorModeForRenderPass(),Yi.disabled,vh(M,r,0,1),null,r.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments,r.paint,M.transform.zoom),L.destroy(),r.heatmapFbos.delete(C))}function pc(M,r,d){var _,g;const w=M.gl,C=w.createTexture();w.bindTexture(w.TEXTURE_2D,C),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const L=(_=M.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,F=(g=M.RGBA16F)!==null&&g!==void 0?g:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,F,r,d,0,w.RGBA,L,null);const N=M.createFramebuffer(r,d,!1,!1);return N.colorAttachment.set(C),N}function mc(M,r){return r.colorRampTexture||(r.colorRampTexture=new ct(M,r.colorRamp,M.gl.RGBA)),r.colorRampTexture}function il(M,r,d,_,g){if(!d||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let C=w[d.to.toString()],L=w[d.from.toString()];if(!C&&L&&(C=L),!L&&C&&(L=C),!C||!L){const F=g.getPaintProperty(r);C=w[F],L=w[F]}C&&L&&M.setConstantPatternPositions(C,L)}function _c(M,r,d,_,g,w,C){const L=M.context.gl,F="fill-pattern",N=d.paint.get(F),H=N&&N.constantOr(1),j=d.getCrossfadeParameters();let tt,ot,ht,pt,yt;C?(ot=H&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",tt=L.LINES):(ot=H?"fillPattern":"fill",tt=L.TRIANGLES);const vt=N.constantOr(null);for(const Mt of _){const dt=r.getTile(Mt);if(H&&!dt.patternsLoaded())continue;const Ct=dt.getBucket(d);if(!Ct)continue;const Lt=Ct.programConfigurations.get(d.id),Bt=M.useProgram(ot,Lt),ee=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Mt);H&&(M.context.activeTexture.set(L.TEXTURE0),dt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Lt.updatePaintBuffers(j)),il(Lt,F,vt,dt,d);const he=ee?Mt:null,we=M.translatePosMatrix(he?he.posMatrix:Mt.posMatrix,dt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(C){pt=Ct.indexBuffer2,yt=Ct.segments2;const Ce=[L.drawingBufferWidth,L.drawingBufferHeight];ht=ot==="fillOutlinePattern"&&H?mm(we,M,j,dt,Ce):P0(we,Ce)}else pt=Ct.indexBuffer,yt=Ct.segments,ht=H?pm(we,M,j,dt):Jo(we);Bt.draw(M.context,tt,g,M.stencilModeForClipping(Mt),w,Yi.disabled,ht,ee,d.id,Ct.layoutVertexBuffer,pt,yt,d.paint,M.transform.zoom,Lt)}}function Ph(M,r,d,_,g,w,C){const L=M.context,F=L.gl,N="fill-extrusion-pattern",H=d.paint.get(N),j=H.constantOr(1),tt=d.getCrossfadeParameters(),ot=d.paint.get("fill-extrusion-opacity"),ht=H.constantOr(null);for(const pt of _){const yt=r.getTile(pt),vt=yt.getBucket(d);if(!vt)continue;const Mt=M.style.map.terrain&&M.style.map.terrain.getTerrainData(pt),dt=vt.programConfigurations.get(d.id),Ct=M.useProgram(j?"fillExtrusionPattern":"fillExtrusion",dt);j&&(M.context.activeTexture.set(F.TEXTURE0),yt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),dt.updatePaintBuffers(tt)),il(dt,N,ht,yt,d);const Lt=M.translatePosMatrix(pt.posMatrix,yt,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Bt=d.paint.get("fill-extrusion-vertical-gradient"),ee=j?xh(Lt,M,Bt,ot,pt,tt,yt):lc(Lt,M,Bt,ot);Ct.draw(L,L.gl.TRIANGLES,g,w,C,Yi.backCCW,ee,Mt,d.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,d.paint,M.transform.zoom,dt,M.style.map.terrain&&vt.centroidVertexBuffer)}}function nl(M,r,d,_,g,w,C){const L=M.context,F=L.gl,N=d.fbo;if(!N)return;const H=M.useProgram("hillshade"),j=M.style.map.terrain&&M.style.map.terrain.getTerrainData(r);L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.colorAttachment.get()),H.draw(L,F.TRIANGLES,g,w,C,Yi.disabled,((tt,ot,ht,pt)=>{const yt=ht.paint.get("hillshade-shadow-color"),vt=ht.paint.get("hillshade-highlight-color"),Mt=ht.paint.get("hillshade-accent-color");let dt=ht.paint.get("hillshade-illumination-direction")*(Math.PI/180);ht.paint.get("hillshade-illumination-anchor")==="viewport"&&(dt-=tt.transform.angle);const Ct=!tt.options.moving;return{u_matrix:pt?pt.posMatrix:tt.transform.calculatePosMatrix(ot.tileID.toUnwrapped(),Ct),u_image:0,u_latrange:bh(0,ot.tileID),u_light:[ht.paint.get("hillshade-exaggeration"),dt],u_shadow:yt,u_highlight:vt,u_accent:Mt}})(M,d,_,j?r:null),j,_.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments)}function sl(M,r,d,_,g,w){const C=M.context,L=C.gl,F=r.dem;if(F&&F.data){const N=F.dim,H=F.stride,j=F.getPixels();if(C.activeTexture.set(L.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||M.getTileTexture(H),r.demTexture){const ot=r.demTexture;ot.update(j,{premultiply:!1}),ot.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else r.demTexture=new ct(C,j,L.RGBA,{premultiply:!1}),r.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);C.activeTexture.set(L.TEXTURE0);let tt=r.fbo;if(!tt){const ot=new ct(C,{width:N,height:N,data:null},L.RGBA);ot.bind(L.LINEAR,L.CLAMP_TO_EDGE),tt=r.fbo=C.createFramebuffer(N,N,!0,!1),tt.colorAttachment.set(ot.texture)}C.bindFramebuffer.set(tt.framebuffer),C.viewport.set([0,0,N,N]),M.useProgram("hillshadePrepare").draw(C,L.TRIANGLES,_,g,w,Yi.disabled,((ot,ht)=>{const pt=ht.stride,yt=o.H();return o.aP(yt,0,o.X,-o.X,0,0,1),o.J(yt,yt,[0,-o.X,0]),{u_matrix:yt,u_image:1,u_dimension:[pt,pt],u_zoom:ot.overscaledZ,u_unpack:ht.getUnpackVector()}})(r.tileID,F),null,d.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function Dm(M,r,d,_,g,w){const C=_.paint.get("raster-fade-duration");if(!w&&C>0){const L=v.now(),F=(L-M.timeAdded)/C,N=r?(L-r.timeAdded)/C:-1,H=d.getSource(),j=g.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),tt=!r||Math.abs(r.tileID.overscaledZ-j)>Math.abs(M.tileID.overscaledZ-j),ot=tt&&M.refreshedUponExpiration?1:o.ac(tt?F:1-N,0,1);return M.refreshedUponExpiration&&F>=1&&(M.refreshedUponExpiration=!1),r?{opacity:1,mix:1-ot}:{opacity:ot,mix:0}}return{opacity:1,mix:0}}const Jd=new o.aM(1,0,0,1),Gi=new o.aM(0,1,0,1),Ih=new o.aM(0,0,1,1),j0=new o.aM(1,0,1,1),Lm=new o.aM(0,1,1,1);function rl(M,r,d,_){Rh(M,0,r+d/2,M.transform.width,d,_)}function km(M,r,d,_){Rh(M,r-d/2,0,d,M.transform.height,_)}function Rh(M,r,d,_,g,w){const C=M.context,L=C.gl;L.enable(L.SCISSOR_TEST),L.scissor(r*M.pixelRatio,d*M.pixelRatio,_*M.pixelRatio,g*M.pixelRatio),C.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Fm(M,r,d){const _=M.context,g=_.gl,w=d.posMatrix,C=M.useProgram("debug"),L=Ii.disabled,F=ln.disabled,N=M.colorModeForRenderPass(),H="$debug",j=M.style.map.terrain&&M.style.map.terrain.getTerrainData(d);_.activeTexture.set(g.TEXTURE0);const tt=r.getTileByID(d.key).latestRawTileData,ot=Math.floor((tt&&tt.byteLength||0)/1024),ht=r.getTile(d).tileSize,pt=512/Math.min(ht,512)*(d.overscaledZ/M.transform.zoom)*.5;let yt=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(yt+=` => ${d.overscaledZ}`),function(vt,Mt){vt.initDebugOverlayCanvas();const dt=vt.debugOverlayCanvas,Ct=vt.context.gl,Lt=vt.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,dt.width,dt.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(Mt,5,5),Lt.strokeText(Mt,5,5),vt.debugOverlayTexture.update(dt),vt.debugOverlayTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE)}(M,`${yt} ${ot}kB`),C.draw(_,g.TRIANGLES,L,F,Cn.alphaBlended,Yi.disabled,cc(w,o.aM.transparent,pt),null,H,M.debugBuffer,M.quadTriangleIndexBuffer,M.debugSegments),C.draw(_,g.LINE_STRIP,L,F,N,Yi.disabled,cc(w,o.aM.red),j,H,M.debugBuffer,M.tileBorderIndexBuffer,M.debugSegments)}function zm(M,r,d){const _=M.context,g=_.gl,w=M.colorModeForRenderPass(),C=new Ii(g.LEQUAL,Ii.ReadWrite,M.depthRangeFor3D),L=M.useProgram("terrain"),F=r.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,M.width,M.height]);for(const N of d){const H=M.renderToTexture.getTexture(N),j=r.getTerrainData(N.tileID);_.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,H.texture);const tt=M.transform.calculatePosMatrix(N.tileID.toUnwrapped()),ot=r.getMeshFrameDelta(M.transform.zoom),ht=M.transform.calculateFogMatrix(N.tileID.toUnwrapped()),pt=Yo(tt,ot,ht,M.style.sky,M.transform.pitch);L.draw(_,g.TRIANGLES,C,ln.disabled,w,Yi.backCCW,pt,j,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}class Dh{constructor(r,d,_){this.vertexBuffer=r,this.indexBuffer=d,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Lh{constructor(r,d){this.context=new H0(r),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ne.maxUnderzooming+ne.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new is}resize(r,d,_){if(this.width=Math.floor(r*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const r=this.context,d=new o.aX;d.emplaceBack(0,0),d.emplaceBack(o.X,0),d.emplaceBack(0,o.X),d.emplaceBack(o.X,o.X),this.tileExtentBuffer=r.createVertexBuffer(d,Qs.members),this.tileExtentSegments=o.a0.simpleSegment(0,0,4,2);const _=new o.aX;_.emplaceBack(0,0),_.emplaceBack(o.X,0),_.emplaceBack(0,o.X),_.emplaceBack(o.X,o.X),this.debugBuffer=r.createVertexBuffer(_,Qs.members),this.debugSegments=o.a0.simpleSegment(0,0,4,5);const g=new o.$;g.emplaceBack(0,0,0,0),g.emplaceBack(o.X,0,o.X,0),g.emplaceBack(0,o.X,0,o.X),g.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=r.createVertexBuffer(g,st.members),this.rasterBoundsSegments=o.a0.simpleSegment(0,0,4,2);const w=new o.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(w,Qs.members),this.viewportSegments=o.a0.simpleSegment(0,0,4,2);const C=new o.aZ;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(C);const L=new o.aY;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(L);const F=this.context.gl;this.stencilClearMode=new ln({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)}clearStencil(){const r=this.context,d=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=o.H();o.aP(_,0,this.width,this.height,0,0,1),o.K(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,d.TRIANGLES,Ii.disabled,this.stencilClearMode,Cn.disabled,Yi.disabled,zs(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,d){if(this.currentStencilSource===r.source||!r.isTileClipped()||!d||!d.length)return;this.currentStencilSource=r.source;const _=this.context,g=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Cn.disabled),_.setDepthMode(Ii.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);w.draw(_,g.TRIANGLES,Ii.disabled,new ln({func:g.ALWAYS,mask:0},L,255,g.KEEP,g.KEEP,g.REPLACE),Cn.disabled,Yi.disabled,zs(C.posMatrix),F,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,d=this.context.gl;return new ln({func:d.NOTEQUAL,mask:255},r,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(r){const d=this.context.gl;return new ln({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(r){const d=this.context.gl,_=r.sort((C,L)=>L.overscaledZ-C.overscaledZ),g=_[_.length-1].overscaledZ,w=_[0].overscaledZ-g+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let L=0;L<w;L++)C[L+g]=new ln({func:d.GEQUAL,mask:255},L+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[C,_]}return[{[g]:ln.disabled},_]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Cn([r.CONSTANT_COLOR,r.ONE],new o.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Cn.unblended:Cn.alphaBlended}depthModeForSublayer(r,d,_){if(!this.opaquePassEnabledForLayer())return Ii.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Ii(_||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,d){this.style=r,this.options=d,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(v.now()),this.imageManager.beginFrame();const _=this.style._order,g=this.style.sourceCaches,w={},C={},L={};for(const F in g){const N=g[F];N.used&&N.prepare(this.context),w[F]=N.getVisibleCoordinates(),C[F]=w[F].slice().reverse(),L[F]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<_.length;F++)if(this.style._layers[_[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of _){const N=this.style._layers[F];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const H=C[N.source];(N.type==="custom"||H.length)&&this.renderLayer(this,g[N.source],N,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aM.black:o.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,N){const H=F.context,j=H.gl,tt=((vt,Mt,dt)=>({u_sky_color:vt.properties.get("sky-color"),u_horizon_color:vt.properties.get("horizon-color"),u_horizon:(Mt.height/2+Mt.getHorizon())*dt,u_sky_horizon_blend:vt.properties.get("sky-horizon-blend")*Mt.height/2*dt}))(N,F.style.map.transform,F.pixelRatio),ot=new Ii(j.LEQUAL,Ii.ReadWrite,[0,1]),ht=ln.disabled,pt=F.colorModeForRenderPass(),yt=F.useProgram("sky");if(!N.mesh){const vt=new o.aX;vt.emplaceBack(-1,-1),vt.emplaceBack(1,-1),vt.emplaceBack(1,1),vt.emplaceBack(-1,1);const Mt=new o.aY;Mt.emplaceBack(0,1,2),Mt.emplaceBack(0,2,3),N.mesh=new Dh(H.createVertexBuffer(vt,Qs.members),H.createIndexBuffer(Mt),o.a0.simpleSegment(0,0,vt.length,Mt.length))}yt.draw(H,j.TRIANGLES,ot,ht,pt,Yi.disabled,tt,void 0,"sky",N.mesh.vertexBuffer,N.mesh.indexBuffer,N.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[_[this.currentLayer]],N=g[F.source],H=w[F.source];this._renderTileClippingMasks(F,H),this.renderLayer(this,N,F,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const F=this.style._layers[_[this.currentLayer]],N=g[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F))continue;const H=(F.type==="symbol"?L:C)[F.source];this._renderTileClippingMasks(F,w[F.source]),this.renderLayer(this,N,F,H)}if(this.options.showTileBoundaries){const F=function(N,H){let j=null;const tt=Object.values(N._layers).flatMap(yt=>yt.source&&!yt.isHidden(H)?[N.sourceCaches[yt.source]]:[]),ot=tt.filter(yt=>yt.getSource().type==="vector"),ht=tt.filter(yt=>yt.getSource().type!=="vector"),pt=yt=>{(!j||j.getSource().maxzoom<yt.getSource().maxzoom)&&(j=yt)};return ot.forEach(yt=>pt(yt)),j||ht.forEach(yt=>pt(yt)),j}(this.style,this.transform.zoom);F&&function(N,H,j){for(let tt=0;tt<j.length;tt++)Fm(N,H,j[tt])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const N=F.transform.padding;rl(F,F.transform.height-(N.top||0),3,Jd),rl(F,N.bottom||0,3,Gi),km(F,N.left||0,3,Ih),km(F,F.transform.width-(N.right||0),3,j0);const H=F.transform.centerPoint;(function(j,tt,ot,ht){Rh(j,tt-1,ot-10,2,20,ht),Rh(j,tt-10,ot-1,20,2,ht)})(F,H.x,F.transform.height-H.y,Lm)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=r?!o.a_(d,_):!o.a$(d,_)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(o.b0(d,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,C){const L=w.context,F=L.gl,N=Cn.unblended,H=new Ii(F.LEQUAL,Ii.ReadWrite,[0,1]),j=C.getTerrainMesh(),tt=C.sourceCache.getRenderableTiles(),ot=w.useProgram("terrainDepth");L.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),L.clear({color:o.aM.transparent,depth:1});for(const ht of tt){const pt=C.getTerrainData(ht.tileID),yt={u_matrix:w.transform.calculatePosMatrix(ht.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(w.transform.zoom)};ot.draw(L,F.TRIANGLES,H,ln.disabled,N,Yi.backCCW,yt,pt,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,C){const L=w.context,F=L.gl,N=Cn.unblended,H=new Ii(F.LEQUAL,Ii.ReadWrite,[0,1]),j=C.getTerrainMesh(),tt=C.getCoordsTexture(),ot=C.sourceCache.getRenderableTiles(),ht=w.useProgram("terrainCoords");L.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),L.clear({color:o.aM.transparent,depth:1}),C.coordsIndex=[];for(const pt of ot){const yt=C.getTerrainData(pt.tileID);L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,tt.texture);const vt={u_matrix:w.transform.calculatePosMatrix(pt.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(w.transform.zoom)};ht.draw(L,F.TRIANGLES,H,ln.disabled,N,Yi.backCCW,vt,yt,"terrain",j.vertexBuffer,j.indexBuffer,j.segments),C.coordsIndex.push(pt.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(r,d,_,g){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(g||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,C,L,F,N){if(w.renderPass!=="translucent")return;const H=ln.disabled,j=w.colorModeForRenderPass();(L._unevaluatedLayout.hasValue("text-variable-anchor")||L._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(tt,ot,ht,pt,yt,vt,Mt,dt,Ct){const Lt=ot.transform,Bt=An(),ee=yt==="map",he=vt==="map";for(const we of tt){const Ce=pt.getTile(we),ye=Ce.getBucket(ht);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const _e=o.ag(ye.textSizeData,Lt.zoom),Ve=Ci(Ce,1,ot.transform.zoom),mi=Kt(we.posMatrix,he,ee,ot.transform,Ve),xe=ht.layout.get("icon-text-fit")!=="none"&&ye.hasIconData();if(_e){const Te=Math.pow(2,Lt.zoom-Ce.tileID.overscaledZ),di=ot.style.map.terrain?(Ti,Di)=>ot.style.map.terrain.getElevation(we,Ti,Di):null,dn=Bt.translatePosition(Lt,Ce,Mt,dt);el(ye,ee,he,Ct,Lt,mi,we.posMatrix,Te,_e,xe,Bt,dn,we.toUnwrapped(),di)}}}(F,w,L,C,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),N),L.paint.get("icon-opacity").constantOr(1)!==0&&Zd(w,C,L,F,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),H,j),L.paint.get("text-opacity").constantOr(1)!==0&&Zd(w,C,L,F,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),H,j),C.map.showCollisionBoxes&&(dc(w,C,L,F,!0),dc(w,C,L,F,!1))})(r,d,_,g,this.style.placement.variableOffsets);break;case"circle":(function(w,C,L,F){if(w.renderPass!=="translucent")return;const N=L.paint.get("circle-opacity"),H=L.paint.get("circle-stroke-width"),j=L.paint.get("circle-stroke-opacity"),tt=!L.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(H.constantOr(1)===0||j.constantOr(1)===0))return;const ot=w.context,ht=ot.gl,pt=w.depthModeForSublayer(0,Ii.ReadOnly),yt=ln.disabled,vt=w.colorModeForRenderPass(),Mt=[];for(let dt=0;dt<F.length;dt++){const Ct=F[dt],Lt=C.getTile(Ct),Bt=Lt.getBucket(L);if(!Bt)continue;const ee=Bt.programConfigurations.get(L.id),he=w.useProgram("circle",ee),we=Bt.layoutVertexBuffer,Ce=Bt.indexBuffer,ye=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ct),_e={programConfiguration:ee,program:he,layoutVertexBuffer:we,indexBuffer:Ce,uniformValues:I0(w,Ct,Lt,L),terrainData:ye};if(tt){const Ve=Bt.segments.get();for(const mi of Ve)Mt.push({segments:new o.a0([mi]),sortKey:mi.sortKey,state:_e})}else Mt.push({segments:Bt.segments,sortKey:0,state:_e})}tt&&Mt.sort((dt,Ct)=>dt.sortKey-Ct.sortKey);for(const dt of Mt){const{programConfiguration:Ct,program:Lt,layoutVertexBuffer:Bt,indexBuffer:ee,uniformValues:he,terrainData:we}=dt.state;Lt.draw(ot,ht.TRIANGLES,pt,yt,vt,Yi.disabled,he,we,L.id,Bt,ee,dt.segments,L.paint,w.transform.zoom,Ct)}})(r,d,_,g);break;case"heatmap":(function(w,C,L,F){if(L.paint.get("heatmap-opacity")===0)return;const N=w.context;if(w.style.map.terrain){for(const H of F){const j=C.getTile(H);C.hasRenderableParent(H)||(w.renderPass==="offscreen"?Kd(w,j,L,H):w.renderPass==="translucent"&&xo(w,L,H))}N.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,j,tt,ot){const ht=H.context,pt=ht.gl,yt=ln.disabled,vt=new Cn([pt.ONE,pt.ONE],o.aM.transparent,[!0,!0,!0,!0]);(function(Mt,dt,Ct){const Lt=Mt.gl;Mt.activeTexture.set(Lt.TEXTURE1),Mt.viewport.set([0,0,dt.width/4,dt.height/4]);let Bt=Ct.heatmapFbos.get(o.aU);Bt?(Lt.bindTexture(Lt.TEXTURE_2D,Bt.colorAttachment.get()),Mt.bindFramebuffer.set(Bt.framebuffer)):(Bt=pc(Mt,dt.width/4,dt.height/4),Ct.heatmapFbos.set(o.aU,Bt))})(ht,H,tt),ht.clear({color:o.aM.transparent});for(let Mt=0;Mt<ot.length;Mt++){const dt=ot[Mt];if(j.hasRenderableParent(dt))continue;const Ct=j.getTile(dt),Lt=Ct.getBucket(tt);if(!Lt)continue;const Bt=Lt.programConfigurations.get(tt.id),ee=H.useProgram("heatmap",Bt),{zoom:he}=H.transform;ee.draw(ht,pt.TRIANGLES,Ii.disabled,yt,vt,Yi.disabled,Os(dt.posMatrix,Ct,he,tt.paint.get("heatmap-intensity")),null,tt.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,tt.paint,H.transform.zoom,Bt)}ht.viewport.set([0,0,H.width,H.height])}(w,C,L,F):w.renderPass==="translucent"&&function(H,j){const tt=H.context,ot=tt.gl;tt.setColorMode(H.colorModeForRenderPass());const ht=j.heatmapFbos.get(o.aU);ht&&(tt.activeTexture.set(ot.TEXTURE0),ot.bindTexture(ot.TEXTURE_2D,ht.colorAttachment.get()),tt.activeTexture.set(ot.TEXTURE1),mc(tt,j).bind(ot.LINEAR,ot.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(tt,ot.TRIANGLES,Ii.disabled,ln.disabled,H.colorModeForRenderPass(),Yi.disabled,vh(H,j,0,1),null,j.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,j.paint,H.transform.zoom))}(w,L)})(r,d,_,g);break;case"line":(function(w,C,L,F){if(w.renderPass!=="translucent")return;const N=L.paint.get("line-opacity"),H=L.paint.get("line-width");if(N.constantOr(1)===0||H.constantOr(1)===0)return;const j=w.depthModeForSublayer(0,Ii.ReadOnly),tt=w.colorModeForRenderPass(),ot=L.paint.get("line-dasharray"),ht=L.paint.get("line-pattern"),pt=ht.constantOr(1),yt=L.paint.get("line-gradient"),vt=L.getCrossfadeParameters(),Mt=pt?"linePattern":ot?"lineSDF":yt?"lineGradient":"line",dt=w.context,Ct=dt.gl;let Lt=!0;for(const Bt of F){const ee=C.getTile(Bt);if(pt&&!ee.patternsLoaded())continue;const he=ee.getBucket(L);if(!he)continue;const we=he.programConfigurations.get(L.id),Ce=w.context.program.get(),ye=w.useProgram(Mt,we),_e=Lt||ye.program!==Ce,Ve=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Bt),mi=ht.constantOr(null);if(mi&&ee.imageAtlas){const di=ee.imageAtlas,dn=di.patternPositions[mi.to.toString()],Ti=di.patternPositions[mi.from.toString()];dn&&Ti&&we.setConstantPatternPositions(dn,Ti)}const xe=Ve?Bt:null,Te=pt?Qo(w,ee,L,vt,xe):ot?R0(w,ee,L,ot,vt,xe):yt?_m(w,ee,L,he.lineClipsArray.length,xe):wh(w,ee,L,xe);if(pt)dt.activeTexture.set(Ct.TEXTURE0),ee.imageAtlasTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE),we.updatePaintBuffers(vt);else if(ot&&(_e||w.lineAtlas.dirty))dt.activeTexture.set(Ct.TEXTURE0),w.lineAtlas.bind(dt);else if(yt){const di=he.gradients[L.id];let dn=di.texture;if(L.gradientVersion!==di.version){let Ti=256;if(L.stepInterpolant){const Di=C.getSource().maxzoom,fn=Bt.canonical.z===Di?Math.ceil(1<<w.transform.maxZoom-Bt.canonical.z):1;Ti=o.ac(o.aV(he.maxLineLength/o.X*1024*fn),256,dt.maxTextureSize)}di.gradient=o.aW({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:di.gradient||void 0,clips:he.lineClipsArray}),di.texture?di.texture.update(di.gradient):di.texture=new ct(dt,di.gradient,Ct.RGBA),di.version=L.gradientVersion,dn=di.texture}dt.activeTexture.set(Ct.TEXTURE0),dn.bind(L.stepInterpolant?Ct.NEAREST:Ct.LINEAR,Ct.CLAMP_TO_EDGE)}ye.draw(dt,Ct.TRIANGLES,j,w.stencilModeForClipping(Bt),tt,Yi.disabled,Te,Ve,L.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,L.paint,w.transform.zoom,we,he.layoutVertexBuffer2),Lt=!1}})(r,d,_,g);break;case"fill":(function(w,C,L,F){const N=L.paint.get("fill-color"),H=L.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const j=w.colorModeForRenderPass(),tt=L.paint.get("fill-pattern"),ot=w.opaquePassEnabledForLayer()&&!tt.constantOr(1)&&N.constantOr(o.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ot){const ht=w.depthModeForSublayer(1,w.renderPass==="opaque"?Ii.ReadWrite:Ii.ReadOnly);_c(w,C,L,F,ht,j,!1)}if(w.renderPass==="translucent"&&L.paint.get("fill-antialias")){const ht=w.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,Ii.ReadOnly);_c(w,C,L,F,ht,j,!0)}})(r,d,_,g);break;case"fill-extrusion":(function(w,C,L,F){const N=L.paint.get("fill-extrusion-opacity");if(N!==0&&w.renderPass==="translucent"){const H=new Ii(w.context.gl.LEQUAL,Ii.ReadWrite,w.depthRangeFor3D);if(N!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))Ph(w,C,L,F,H,ln.disabled,Cn.disabled),Ph(w,C,L,F,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const j=w.colorModeForRenderPass();Ph(w,C,L,F,H,ln.disabled,j)}}})(r,d,_,g);break;case"hillshade":(function(w,C,L,F){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const N=w.context,H=w.depthModeForSublayer(0,Ii.ReadOnly),j=w.colorModeForRenderPass(),[tt,ot]=w.renderPass==="translucent"?w.stencilConfigForOverlap(F):[{},F];for(const ht of ot){const pt=C.getTile(ht);pt.needsHillshadePrepare!==void 0&&pt.needsHillshadePrepare&&w.renderPass==="offscreen"?sl(w,pt,L,H,ln.disabled,j):w.renderPass==="translucent"&&nl(w,ht,pt,L,H,tt[ht.overscaledZ],j)}N.viewport.set([0,0,w.width,w.height])})(r,d,_,g);break;case"raster":(function(w,C,L,F){if(w.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!F.length)return;const N=w.context,H=N.gl,j=C.getSource(),tt=w.useProgram("raster"),ot=w.colorModeForRenderPass(),[ht,pt]=j instanceof Ht?[{},F]:w.stencilConfigForOverlap(F),yt=pt[pt.length-1].overscaledZ,vt=!w.options.moving;for(const Mt of pt){const dt=w.depthModeForSublayer(Mt.overscaledZ-yt,L.paint.get("raster-opacity")===1?Ii.ReadWrite:Ii.ReadOnly,H.LESS),Ct=C.getTile(Mt);Ct.registerFadeDuration(L.paint.get("raster-fade-duration"));const Lt=C.findLoadedParent(Mt,0),Bt=C.findLoadedSibling(Mt),ee=Dm(Ct,Lt||Bt||null,C,L,w.transform,w.style.map.terrain);let he,we;const Ce=L.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;N.activeTexture.set(H.TEXTURE0),Ct.texture.bind(Ce,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(H.TEXTURE1),Lt?(Lt.texture.bind(Ce,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),he=Math.pow(2,Lt.tileID.overscaledZ-Ct.tileID.overscaledZ),we=[Ct.tileID.canonical.x*he%1,Ct.tileID.canonical.y*he%1]):Ct.texture.bind(Ce,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ct.texture.useMipmap&&N.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const ye=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Mt),_e=ye?Mt:null,Ve=_e?_e.posMatrix:w.transform.calculatePosMatrix(Mt.toUnwrapped(),vt),mi=D0(Ve,we||[0,0],he||1,ee,L);j instanceof Ht?tt.draw(N,H.TRIANGLES,dt,ln.disabled,ot,Yi.disabled,mi,ye,L.id,j.boundsBuffer,w.quadTriangleIndexBuffer,j.boundsSegments):tt.draw(N,H.TRIANGLES,dt,ht[Mt.overscaledZ],ot,Yi.disabled,mi,ye,L.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(r,d,_,g);break;case"background":(function(w,C,L,F){const N=L.paint.get("background-color"),H=L.paint.get("background-opacity");if(H===0)return;const j=w.context,tt=j.gl,ot=w.transform,ht=ot.tileSize,pt=L.paint.get("background-pattern");if(w.isPatternMissing(pt))return;const yt=!pt&&N.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==yt)return;const vt=ln.disabled,Mt=w.depthModeForSublayer(0,yt==="opaque"?Ii.ReadWrite:Ii.ReadOnly),dt=w.colorModeForRenderPass(),Ct=w.useProgram(pt?"backgroundPattern":"background"),Lt=F||ot.coveringTiles({tileSize:ht,terrain:w.style.map.terrain});pt&&(j.activeTexture.set(tt.TEXTURE0),w.imageManager.bind(w.context));const Bt=L.getCrossfadeParameters();for(const ee of Lt){const he=F?ee.posMatrix:w.transform.calculatePosMatrix(ee.toUnwrapped()),we=pt?Bd(he,H,w,pt,{tileID:ee,tileSize:ht},Bt):Mh(he,H,N),Ce=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ee);Ct.draw(j,tt.TRIANGLES,Mt,vt,dt,Yi.disabled,we,Ce,L.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(r,0,_,g);break;case"custom":(function(w,C,L){const F=w.context,N=L.implementation;if(w.renderPass==="offscreen"){const H=N.prerender;H&&(w.setCustomLayerDefaults(),F.setColorMode(w.colorModeForRenderPass()),H.call(N,F.gl,w.transform.customLayerMatrix()),F.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),F.setColorMode(w.colorModeForRenderPass()),F.setStencilMode(ln.disabled);const H=N.renderingMode==="3d"?new Ii(w.context.gl.LEQUAL,Ii.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Ii.ReadOnly);F.setDepthMode(H),N.render(F.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),F.setDirty(),w.setBaseState(),F.bindFramebuffer.set(null)}})(r,0,_)}}translatePosMatrix(r,d,_,g,w){if(!_[0]&&!_[1])return r;const C=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){const N=Math.sin(C),H=Math.cos(C);_=[_[0]*H-_[1]*N,_[0]*N+_[1]*H]}const L=[w?_[0]:Ci(d,_[0],this.transform.zoom),w?_[1]:Ci(d,_[1],this.transform.zoom),0],F=new Float32Array(16);return o.J(F,r,L),F}saveTileTexture(r){const d=this._tileTextures[r.size[0]];d?d.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const d=this._tileTextures[r];return d&&d.length>0?d.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const d=this.imageManager.getPattern(r.from.toString()),_=this.imageManager.getPattern(r.to.toString());return!d||!_}useProgram(r,d){this.cache=this.cache||{};const _=r+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new zd(this.context,Ln[r],d,Nd[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:d}=this.context.gl;return this.width!==r||this.height!==d}}class al{constructor(r,d){this.points=r,this.planes=d}static fromInvProjectionMatrix(r,d,_){const g=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const F=1/(L=o.af([],L,r))[3]/d*g;return o.b1(L,L,[F,F,1/L[3],F])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const F=function(tt,ot){var ht=ot[0],pt=ot[1],yt=ot[2],vt=ht*ht+pt*pt+yt*yt;return vt>0&&(vt=1/Math.sqrt(vt)),tt[0]=ot[0]*vt,tt[1]=ot[1]*vt,tt[2]=ot[2]*vt,tt}([],function(tt,ot,ht){var pt=ot[0],yt=ot[1],vt=ot[2],Mt=ht[0],dt=ht[1],Ct=ht[2];return tt[0]=yt*Ct-vt*dt,tt[1]=vt*Mt-pt*Ct,tt[2]=pt*dt-yt*Mt,tt}([],K([],w[L[0]],w[L[1]]),K([],w[L[2]],w[L[1]]))),N=-((H=F)[0]*(j=w[L[1]])[0]+H[1]*j[1]+H[2]*j[2]);var H,j;return F.concat(N)});return new al(w,C)}}class ol{constructor(r,d){this.min=r,this.max=d,this.center=function(_,g,w){return _[0]=.5*g[0],_[1]=.5*g[1],_[2]=.5*g[2],_}([],function(_,g,w){return _[0]=g[0]+w[0],_[1]=g[1]+w[1],_[2]=g[2]+w[2],_}([],this.min,this.max))}quadrant(r){const d=[r%2==0,r<2],_=Z(this.min),g=Z(this.max);for(let w=0;w<d.length;w++)_[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new ol(_,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let g=0;g<r.planes.length;g++){const w=r.planes[g];let C=0;for(let L=0;L<d.length;L++)o.b2(w,d[L])>=0&&C++;if(C===0)return 0;C!==d.length&&(_=!1)}if(_)return 2;for(let g=0;g<3;g++){let w=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let L=0;L<r.points.length;L++){const F=r.points[L][g]-this.min[g];w=Math.min(w,F),C=Math.max(C,F)}if(C<0||w>this.max[g]-this.min[g])return 0}return 1}}class ll{constructor(r=0,d=0,_=0,g=0){if(isNaN(r)||r<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=d,this.left=_,this.right=g}interpolate(r,d,_){return d.top!=null&&r.top!=null&&(this.top=o.y.number(r.top,d.top,_)),d.bottom!=null&&r.bottom!=null&&(this.bottom=o.y.number(r.bottom,d.bottom,_)),d.left!=null&&r.left!=null&&(this.left=o.y.number(r.left,d.left,_)),d.right!=null&&r.right!=null&&(this.right=o.y.number(r.right,d.right,_)),this}getCenter(r,d){const _=o.ac((this.left+r-this.right)/2,0,r),g=o.ac((this.top+d-this.bottom)/2,0,d);return new o.P(_,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ll(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qd=85.051129;class cl{constructor(r,d,_,g,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=r||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ll,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new cl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.lngRange=r.lngRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const d=-o.b3(r,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var _=new o.A(4);return o.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,g,w){var C=g[0],L=g[1],F=g[2],N=g[3],H=Math.sin(w),j=Math.cos(w);_[0]=C*j+F*H,_[1]=L*j+N*H,_[2]=C*-H+F*j,_[3]=L*-H+N*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const d=o.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const d=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,d,_){this._unmodified=!1,this._edgeInsets.interpolate(r,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const d=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(r){const d=[new o.b4(0,r)];if(this._renderWorldCopies){const _=this.pointCoordinate(new o.P(0,0)),g=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),C=this.pointCoordinate(new o.P(0,this.height)),L=Math.floor(Math.min(_.x,g.x,w.x,C.x)),F=Math.floor(Math.max(_.x,g.x,w.x,C.x)),N=1;for(let H=L-N;H<=F+N;H++)H!==0&&d.push(new o.b4(H,r))}return d}coveringTiles(r){var d,_;let g=this.coveringZoomLevel(r);const w=g;if(r.minzoom!==void 0&&g<r.minzoom)return[];r.maxzoom!==void 0&&g>r.maxzoom&&(g=r.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),L=o.Z.fromLngLat(this.center),F=Math.pow(2,g),N=[F*C.x,F*C.y,0],H=[F*L.x,F*L.y,0],j=al.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,g);let tt=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(tt=g);const ot=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,ht=dt=>({aabb:new ol([dt*F,0,0],[(dt+1)*F,F,0]),zoom:0,x:0,y:0,wrap:dt,fullyVisible:!1}),pt=[],yt=[],vt=g,Mt=r.reparseOverscaled?w:g;if(this._renderWorldCopies)for(let dt=1;dt<=3;dt++)pt.push(ht(-dt)),pt.push(ht(dt));for(pt.push(ht(0));pt.length>0;){const dt=pt.pop(),Ct=dt.x,Lt=dt.y;let Bt=dt.fullyVisible;if(!Bt){const ye=dt.aabb.intersects(j);if(ye===0)continue;Bt=ye===2}const ee=r.terrain?N:H,he=dt.aabb.distanceX(ee),we=dt.aabb.distanceY(ee),Ce=Math.max(Math.abs(he),Math.abs(we));if(dt.zoom===vt||Ce>ot+(1<<vt-dt.zoom)-2&&dt.zoom>=tt){const ye=vt-dt.zoom,_e=N[0]-.5-(Ct<<ye),Ve=N[1]-.5-(Lt<<ye);yt.push({tileID:new o.S(dt.zoom===vt?Mt:dt.zoom,dt.wrap,dt.zoom,Ct,Lt),distanceSq:nt([H[0]-.5-Ct,H[1]-.5-Lt]),tileDistanceToCamera:Math.sqrt(_e*_e+Ve*Ve)})}else for(let ye=0;ye<4;ye++){const _e=(Ct<<1)+ye%2,Ve=(Lt<<1)+(ye>>1),mi=dt.zoom+1;let xe=dt.aabb.quadrant(ye);if(r.terrain){const Te=new o.S(mi,dt.wrap,mi,_e,Ve),di=r.terrain.getMinMaxElevation(Te),dn=(d=di.minElevation)!==null&&d!==void 0?d:this.elevation,Ti=(_=di.maxElevation)!==null&&_!==void 0?_:this.elevation;xe=new ol([xe.min[0],xe.min[1],dn],[xe.max[0],xe.max[1],Ti])}pt.push({aabb:xe,zoom:mi,x:_e,y:Ve,wrap:dt.wrap,fullyVisible:Bt})}}return yt.sort((dt,Ct)=>dt.distanceSq-Ct.distanceSq).map(dt=>dt.tileID)}resize(r,d){this.width=r,this.height=d,this.pixelsToGLUnits=[2/r,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const d=o.ac(r.lat,-85.051129,Qd);return new o.P(o.O(r.lng)*this.worldSize,o.Q(d)*this.worldSize)}unproject(r){return new o.Z(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const d=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,r),w=r.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-w))return;const C=_+d-w,L=Math.cos(this._pitch)*this.cameraToCenterDistance/C/o.b5(1,g.lat),F=this.scaleZoom(L/this.tileSize);this._elevation=w,this._center=g,this.zoom=F}setLocationAtPoint(r,d){const _=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(r),C=new o.Z(w.x-(_.x-g.x),w.y-(_.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,d){return d?this.coordinatePoint(this.locationCoordinate(r),d.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,d){return this.coordinateLocation(this.pointCoordinate(r,d))}locationCoordinate(r){return o.Z.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,d){if(d){const tt=d.pointCoordinate(r);if(tt!=null)return tt}const _=[r.x,r.y,0,1],g=[r.x,r.y,1,1];o.af(_,_,this.pixelMatrixInverse),o.af(g,g,this.pixelMatrixInverse);const w=_[3],C=g[3],L=_[1]/w,F=g[1]/C,N=_[2]/w,H=g[2]/C,j=N===H?0:(0-N)/(H-N);return new o.Z(o.y.number(_[0]/w,g[0]/C,j)/this.worldSize,o.y.number(L,F,j)/this.worldSize)}coordinatePoint(r,d=0,_=this.pixelMatrix){const g=[r.x*this.worldSize,r.y*this.worldSize,d,1];return o.af(g,g,_),new o.P(g[0]/g[3],g[1]/g[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new Ft().extend(this.pointLocation(new o.P(0,r))).extend(this.pointLocation(new o.P(this.width,r))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ft([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Qd])}calculateTileMatrix(r){const d=r.canonical,_=this.worldSize/this.zoomScale(d.z),g=d.x+Math.pow(2,d.z)*r.wrap,w=o.an(new Float64Array(16));return o.J(w,w,[g*_,d.y*_,0]),o.K(w,w,[_/o.X,_/o.X,1]),w}calculatePosMatrix(r,d=!1){const _=r.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[_])return g[_];const w=this.calculateTileMatrix(r);return o.L(w,d?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),g[_]=new Float32Array(w),g[_]}calculateFogMatrix(r){const d=r.key,_=this._fogMatrixCache;if(_[d])return _[d];const g=this.calculateTileMatrix(r);return o.L(g,this.fogMatrix,g),_[d]=new Float32Array(g),_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,d){d=o.ac(+d,this.minZoom,this.maxZoom);const _={center:new o.N(r.lng,r.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const dt=179.9999999999;g=[-dt,dt]}const w=this.tileSize*this.zoomScale(_.zoom);let C=0,L=w,F=0,N=w,H=0,j=0;const{x:tt,y:ot}=this.size;if(this.latRange){const dt=this.latRange;C=o.Q(dt[1])*w,L=o.Q(dt[0])*w,L-C<ot&&(H=ot/(L-C))}g&&(F=o.b3(o.O(g[0])*w,0,w),N=o.b3(o.O(g[1])*w,0,w),N<F&&(N+=w),N-F<tt&&(j=tt/(N-F)));const{x:ht,y:pt}=this.project.call({worldSize:w},r);let yt,vt;const Mt=Math.max(j||0,H||0);if(Mt){const dt=new o.P(j?(N+F)/2:ht,H?(L+C)/2:pt);return _.center=this.unproject.call({worldSize:w},dt).wrap(),_.zoom+=this.scaleZoom(Mt),_}if(this.latRange){const dt=ot/2;pt-dt<C&&(vt=C+dt),pt+dt>L&&(vt=L-dt)}if(g){const dt=(F+N)/2;let Ct=ht;this._renderWorldCopies&&(Ct=o.b3(ht,dt-w/2,dt+w/2));const Lt=tt/2;Ct-Lt<F&&(yt=F+Lt),Ct+Lt>N&&(yt=N-Lt)}if(yt!==void 0||vt!==void 0){const dt=new o.P(yt??ht,vt??pt);_.center=this.unproject.call({worldSize:w},dt).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:d,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=_,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b5(1,this.center.lat)*this.worldSize;let g=o.an(new Float64Array(16));o.K(g,g,[this.width/2,-this.height/2,1]),o.J(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=o.an(new Float64Array(16)),o.K(g,g,[1,-1,1]),o.J(g,g,[-1,-1,0]),o.K(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),L=w-C*this._pixelPerMeter/Math.cos(this._pitch),F=C<0?L:w,N=Math.PI/2+this._pitch,H=this._fov*(.5+r.y/this.height),j=Math.sin(H)*F/Math.sin(o.ac(Math.PI-N-H,.01,Math.PI-.01)),tt=this.getHorizon(),ot=2*Math.atan(tt/this.cameraToCenterDistance)*(.5+r.y/(2*tt)),ht=Math.sin(ot)*F/Math.sin(o.ac(Math.PI-N-ot,.01,Math.PI-.01)),pt=Math.min(j,ht);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*pt+F),this.nearZ=this.height/50,g=new Float64Array(16),o.b6(g,this._fov,this.width/this.height,this.nearZ,this.farZ),g[8]=2*-r.x/this.width,g[9]=2*r.y/this.height,this.projectionMatrix=o.ae(g),o.K(g,g,[1,-1,1]),o.J(g,g,[0,0,-this.cameraToCenterDistance]),o.b7(g,g,this._pitch),o.ad(g,g,this.angle),o.J(g,g,[-d,-_,0]),this.mercatorMatrix=o.K([],g,[this.worldSize,this.worldSize,this.worldSize]),o.K(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.L(new Float64Array(16),this.labelPlaneMatrix,g),o.J(g,g,[0,0,-this.elevation]),this.modelViewProjectionMatrix=g,this.invModelViewProjectionMatrix=o.as([],g),this.fogMatrix=new Float64Array(16),o.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-r.x/this.width,this.fogMatrix[9]=2*r.y/this.height,o.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b7(this.fogMatrix,this.fogMatrix,this._pitch),o.ad(this.fogMatrix,this.fogMatrix,this.angle),o.J(this.fogMatrix,this.fogMatrix,[-d,-_,0]),o.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=o.L(new Float64Array(16),this.labelPlaneMatrix,g);const yt=this.width%2/2,vt=this.height%2/2,Mt=Math.cos(this.angle),dt=Math.sin(this.angle),Ct=d-Math.round(d)+Mt*yt+dt*vt,Lt=_-Math.round(_)+Mt*vt+dt*yt,Bt=new Float64Array(g);if(o.J(Bt,Bt,[Ct>.5?Ct-1:Ct,Lt>.5?Lt-1:Lt,0]),this.alignedModelViewProjectionMatrix=Bt,g=o.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new o.P(0,0)),d=[r.x*this.worldSize,r.y*this.worldSize,0,1];return o.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}getCameraQueryGeometry(r){const d=this.getCameraPoint();if(r.length===1)return[r[0],d];{let _=d.x,g=d.y,w=d.x,C=d.y;for(const L of r)_=Math.min(_,L.x),g=Math.min(g,L.y),w=Math.max(w,L.x),C=Math.max(C,L.y);return[new o.P(_,g),new o.P(w,g),new o.P(w,C),new o.P(_,C),new o.P(_,g)]}}lngLatToCameraDepth(r,d){const _=this.locationCoordinate(r),g=[_.x*this.worldSize,_.y*this.worldSize,d,1];return o.af(g,g,this.modelViewProjectionMatrix),g[2]/g[3]}}function gc(M,r){let d,_=!1,g=null,w=null;const C=()=>{g=null,_&&(M.apply(w,d),g=setTimeout(C,r),_=!1)};return(...L)=>(_=!0,w=this,d=L,g||C(),g)}class kh{constructor(r){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(_=g)}),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const _=d.join("/");let g=_;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${_}`);let w=window.location.hash.replace(g,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let C=window.location.href.replace(/(#.+)?$/,w);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=gc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,g=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),C=Math.round(d.lng*w)/w,L=Math.round(d.lat*w)/w,F=this._map.getBearing(),N=this._map.getPitch();let H="";if(H+=r?`/${C}/${L}/${_}`:`${_}/${L}/${C}`,(F||N)&&(H+="/"+Math.round(10*F)/10),N&&(H+=`/${Math.round(N)}`),this._hashName){const j=this._hashName;let tt=!1;const ot=window.location.hash.slice(1).split("&").map(ht=>{const pt=ht.split("=")[0];return pt===j?(tt=!0,`${pt}=${H}`):ht}).filter(ht=>ht);return tt||ot.push(`${j}=${H}`),`#${ot.join("&")}`}return`#${H}`}}const Fh={linearity:.3,easing:o.b8(0,0,.3,1)},tf=o.e({deceleration:2500,maxSpeed:1400},Fh),W0=o.e({deceleration:20,maxSpeed:1400},Fh),Om=o.e({deceleration:1e3,maxSpeed:360},Fh),zh=o.e({deceleration:1e3,maxSpeed:90},Fh);class ef{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,d=v.now();for(;r.length>0&&d-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const w=xc(d.pan.mag(),_,o.e({},tf,r||{}));g.offset=d.pan.mult(w.amount/d.pan.mag()),g.center=this._map.transform.center,yc(g,w)}if(d.zoom){const w=xc(d.zoom,_,W0);g.zoom=this._map.transform.zoom+w.amount,yc(g,w)}if(d.bearing){const w=xc(d.bearing,_,Om);g.bearing=this._map.transform.bearing+o.ac(w.amount,-179,179),yc(g,w)}if(d.pitch){const w=xc(d.pitch,_,zh);g.pitch=this._map.transform.pitch+w.amount,yc(g,w)}if(g.zoom||g.bearing){const w=d.pinchAround===void 0?d.around:d.pinchAround;g.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),o.e(g,{noMoveStart:!0})}}function yc(M,r){(!M.duration||M.duration<r.duration)&&(M.duration=r.duration,M.easing=r.easing)}function xc(M,r,d){const{maxSpeed:_,linearity:g,deceleration:w}=d,C=o.ac(M*g/(r/1e3),-_,_),L=Math.abs(C)/(w*g);return{easing:d.easing,duration:1e3*L,amount:C*(L/2)}}class us extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,_,g={}){const w=b.mousePos(d.getCanvas(),_),C=d.unproject(w);super(r,o.e({point:w,lngLat:C,originalEvent:_},g)),this._defaultPrevented=!1,this.target=d}}class vo extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,_){const g=r==="touchend"?_.changedTouches:_.touches,w=b.touchPos(d.getCanvasContainer(),g),C=w.map(F=>d.unproject(F)),L=w.reduce((F,N,H,j)=>F.add(N.div(j.length)),new o.P(0,0));super(r,{points:w,point:L,lngLats:C,lngLat:d.unproject(L),originalEvent:_}),this._defaultPrevented=!1}}class Bm extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,_){super(r,{originalEvent:_}),this._defaultPrevented=!1}}class Nm{constructor(r,d){this._map=r,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Bm(r.type,this._map,r))}mousedown(r,d){return this._mousedownPos=d,this._firePreventable(new us(r.type,this._map,r))}mouseup(r){this._map.fire(new us(r.type,this._map,r))}click(r,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new us(r.type,this._map,r))}dblclick(r){return this._firePreventable(new us(r.type,this._map,r))}mouseover(r){this._map.fire(new us(r.type,this._map,r))}mouseout(r){this._map.fire(new us(r.type,this._map,r))}touchstart(r){return this._firePreventable(new vo(r.type,this._map,r))}touchmove(r){this._map.fire(new vo(r.type,this._map,r))}touchend(r){this._map.fire(new vo(r.type,this._map,r))}touchcancel(r){this._map.fire(new vo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pn{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new us(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new us(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vr{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(o.P.convert(r),this._map.terrain)}}class tr{constructor(r,d){this._map=r,this._tr=new Vr(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,d){this.isEnabled()&&r.shiftKey&&r.button===0&&(b.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(r,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=_,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(g.x,_.x),C=Math.max(g.x,_.x),L=Math.min(g.y,_.y),F=Math.max(g.y,_.y);b.setTransform(this._box,`translate(${w}px,${L}px)`),this._box.style.width=C-w+"px",this._box.style.height=F-L+"px"}mouseupWindow(r,d){if(!this._active||r.button!==0)return;const _=this._startPos,g=d;if(this.reset(),b.suppressClick(),_.x!==g.x||_.y!==g.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:r})),{cameraAnimation:w=>w.fitScreenCoordinates(_,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,d){return this._map.fire(new o.k(r,{originalEvent:d}))}}function vc(M,r){if(M.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${M.length}, points ${r.length}`);const d={};for(let _=0;_<M.length;_++)d[M[_].identifier]=r[_];return d}class nf{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),_.length===this.numTouches&&(this.centroid=function(g){const w=new o.P(0,0);for(const C of g)w._add(C);return w.div(g.length)}(d),this.touches=vc(_,d)))}touchmove(r,d,_){if(this.aborted||!this.centroid)return;const g=vc(_,d);for(const w in this.touches){const C=g[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(r,d,_){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Oh{constructor(r){this.singleTap=new nf(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,d,_){this.singleTap.touchstart(r,d,_)}touchmove(r,d,_){this.singleTap.touchmove(r,d,_)}touchend(r,d,_){const g=this.singleTap.touchend(r,d,_);if(g){const w=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(w&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class hl{constructor(r){this._tr=new Vr(r),this._zoomIn=new Oh({numTouches:1,numTaps:2}),this._zoomOut=new Oh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,d,_){this._zoomIn.touchstart(r,d,_),this._zoomOut.touchstart(r,d,_)}touchmove(r,d,_){this._zoomIn.touchmove(r,d,_),this._zoomOut.touchmove(r,d,_)}touchend(r,d,_){const g=this._zoomIn.touchend(r,d,_),w=this._zoomOut.touchend(r,d,_),C=this._tr;return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(g)},{originalEvent:r})}):w?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(w)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pa{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const d=this._moveFunction(...r);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(r,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const g=d.length?d[0]:d;return!this._moved&&g.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(_,g))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&b.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const sf={0:1,2:2};class Bh{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const d=b.mouseButton(r);this._eventButton=d}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(d,_){const g=sf[_];return d.buttons===void 0||(d.buttons&g)!==g}(r,this._eventButton)}isValidEndEvent(r){return b.mouseButton(r)===this._eventButton}}class rf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Nh=M=>{M.mousedown=M.dragStart,M.mousemoveWindow=M.dragMove,M.mouseup=M.dragEnd,M.contextmenu=r=>{r.preventDefault()}},af=({enable:M,clickTolerance:r,bearingDegreesPerPixelMoved:d=.8})=>{const _=new Bh({checkCorrectEvent:g=>b.mouseButton(g)===0&&g.ctrlKey||b.mouseButton(g)===2});return new Pa({clickTolerance:r,move:(g,w)=>({bearingDelta:(w.x-g.x)*d}),moveStateManager:_,enable:M,assignEvents:Nh})},of=({enable:M,clickTolerance:r,pitchDegreesPerPixelMoved:d=-.5})=>{const _=new Bh({checkCorrectEvent:g=>b.mouseButton(g)===0&&g.ctrlKey||b.mouseButton(g)===2});return new Pa({clickTolerance:r,move:(g,w)=>({pitchDelta:(w.y-g.y)*d}),moveStateManager:_,enable:M,assignEvents:Nh})};class bo{constructor(r,d){this._clickTolerance=r.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,d,_){return this._calculateTransform(r,d,_)}touchmove(r,d,_){if(this._active){if(!this._shouldBePrevented(_.length))return r.preventDefault(),this._calculateTransform(r,d,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,d,_){this._calculateTransform(r,d,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,d,_){_.length>0&&(this._active=!0);const g=vc(_,d),w=new o.P(0,0),C=new o.P(0,0);let L=0;for(const N in g){const H=g[N],j=this._touches[N];j&&(w._add(H),C._add(H.sub(j)),L++,g[N]=H)}if(this._touches=g,this._shouldBePrevented(L)||!C.mag())return;const F=C.div(L);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(L),panDelta:F}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(r,d,_){if(!this._firstTwoTouches)return;r.preventDefault();const[g,w]=this._firstTwoTouches,C=bc(_,d,g),L=bc(_,d,w);if(!C||!L)return;const F=this._aroundCenter?null:C.add(L).div(2);return this._move([C,L],F,r)}touchend(r,d,_){if(!this._firstTwoTouches)return;const[g,w]=this._firstTwoTouches,C=bc(_,d,g),L=bc(_,d,w);C&&L||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function bc(M,r,d){for(let _=0;_<M.length;_++)if(M[_].identifier===d)return r[_]}function lf(M,r){return Math.log(M/r)/Math.LN2}class cf extends Uh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,d){const _=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(lf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lf(this._distance,_),pinchAround:d}}}function hf(M,r){return 180*M.angleWith(r)/Math.PI}class uf extends Uh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,d,_){const g=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hf(this._vector,g),pinchAround:d}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const d=25/(Math.PI*this._minDiameter)*360,_=hf(r,this._startVector);return Math.abs(_)<d}}function Vh(M){return Math.abs(M.y)>Math.abs(M.x)}class wc extends Uh{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,d,_){super.touchstart(r,d,_),this._currentTouchCount=_.length}_start(r){this._lastPoints=r,Vh(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=r[0].sub(this._lastPoints[0]),w=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,w,_.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(r,d,_){if(this._valid!==void 0)return this._valid;const g=r.mag()>=2,w=d.mag()>=2;if(!g&&!w)return;if(!g||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=r.y>0==d.y>0;return Vh(r)&&Vh(d)&&C}}const Um={panStep:100,bearingStep:15,pitchStep:10};class wr{constructor(r){this._tr=new Vr(r);const d=Um;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let d=0,_=0,g=0,w=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:r.shiftKey?_=-1:(r.preventDefault(),w=-1);break;case 39:r.shiftKey?_=1:(r.preventDefault(),w=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,g=0),{cameraAnimation:L=>{const F=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:ca,zoom:d?Math.round(F.zoom)+d*(r.shiftKey?2:1):F.zoom,bearing:F.bearing+_*this._bearingStep,pitch:F.pitch+g*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:F.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ca(M){return M*(2-M)}const df=4.000244140625;class Gr{constructor(r,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=r,this._tr=new Vr(r),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let d=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const _=v.now(),g=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%df==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),r.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=r,this._delta-=d,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=b.mousePos(this._map.getCanvas(),r),_=this._tr;this._around=d.y>_.transform.height/2-_.transform.getHorizon()?o.N.convert(this._aroundCenter?_.center:_.unproject(d)):o.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>df?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&N!==0&&(N=1/N);const H=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(H*N))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,_=this._startZoom,g=this._easing;let w,C=!1;const L=v.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&g&&L){const F=Math.min(L/200,1),N=g(F);w=o.y.number(_,d,N),F<1?this._frameId||(this._frameId=!0):C=!0}else w=d,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:w-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let d=o.b9;if(this._prevEase){const _=this._prevEase,g=(v.now()-_.start)/_.duration,w=_.easing(g+.01)-_.easing(g),C=.27/Math.sqrt(w*w+1e-4)*.01,L=Math.sqrt(.0729-C*C);d=o.b8(C,L,.25,1)}return this._prevEase={start:v.now(),duration:r,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class wo{constructor(r,d){this._clickZoom=r,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class q0{constructor(r){this._tr=new Vr(r),this.reset()}reset(){this._active=!1}dblclick(r,d){return r.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class X0{constructor(){this._tap=new Oh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,d,_){if(!this._swipePoint)if(this._tapTime){const g=d[0],w=r.timeStamp-this._tapTime<500,C=this._tapPoint.dist(g)<30;w&&C?_.length>0&&(this._swipePoint=g,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(r,d,_)}touchmove(r,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(r,d,_)}touchend(r,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const g=this._tap.touchend(r,d,_);g&&(this._tapTime=r.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vm{constructor(r,d,_){this._el=r,this._mousePan=d,this._touchPan=_}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gm{constructor(r,d,_){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ff{constructor(r,d,_,g){this._el=r,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ul{constructor(r,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=b.create("div","maplibregl-cooperative-gesture-screen",r);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(b.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,d){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:r,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Mr=M=>M.zoom||M.drag||M.pitch||M.rotate;class De extends o.k{}function Gh(M){return M.panDelta&&M.panDelta.mag()||M.zoomDelta||M.bearingDelta||M.pitchDelta}class pf{constructor(r,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,w)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=g.type==="renderFrame"?void 0:g,L={needsRenderFrame:!1},F={},N={},H=g.touches,j=H?this._getMapTouches(H):void 0,tt=j?b.touchPos(this._map.getCanvas(),j):b.mousePos(this._map.getCanvas(),g);for(const{handlerName:pt,handler:yt,allowed:vt}of this._handlers){if(!yt.isEnabled())continue;let Mt;this._blockedByActive(N,vt,pt)?yt.reset():yt[w||g.type]&&(Mt=yt[w||g.type](g,tt,j),this.mergeHandlerResult(L,F,Mt,pt,C),Mt&&Mt.needsRenderFrame&&this._triggerRenderFrame()),(Mt||yt.isActive())&&(N[pt]=yt)}const ot={};for(const pt in this._previousActiveHandlers)N[pt]||(ot[pt]=C);this._previousActiveHandlers=N,(Object.keys(ot).length||Gh(L))&&(this._changes.push([L,F,ot]),this._triggerRenderFrame()),(Object.keys(N).length||Gh(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ht}=L;ht&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ht(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ef(r),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,w,C]of this._listeners)b.addEventListener(g,w,g===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,d,_]of this._listeners)b.removeEventListener(r,d,r===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(r){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Nm(d,r));const g=d.boxZoom=new tr(d,r);this._add("boxZoom",g),r.interactive&&r.boxZoom&&g.enable();const w=d.cooperativeGestures=new ul(d,r.cooperativeGestures);this._add("cooperativeGestures",w),r.cooperativeGestures&&w.enable();const C=new hl(d),L=new q0(d);d.doubleClickZoom=new wo(L,C),this._add("tapZoom",C),this._add("clickZoom",L),r.interactive&&r.doubleClickZoom&&d.doubleClickZoom.enable();const F=new X0;this._add("tapDragZoom",F);const N=d.touchPitch=new wc(d);this._add("touchPitch",N),r.interactive&&r.touchPitch&&d.touchPitch.enable(r.touchPitch);const H=af(r),j=of(r);d.dragRotate=new Gm(r,H,j),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]),r.interactive&&r.dragRotate&&d.dragRotate.enable();const tt=(({enable:Mt,clickTolerance:dt})=>{const Ct=new Bh({checkCorrectEvent:Lt=>b.mouseButton(Lt)===0&&!Lt.ctrlKey});return new Pa({clickTolerance:dt,move:(Lt,Bt)=>({around:Bt,panDelta:Bt.sub(Lt)}),activateOnStart:!0,moveStateManager:Ct,enable:Mt,assignEvents:Nh})})(r),ot=new bo(r,d);d.dragPan=new Vm(_,tt,ot),this._add("mousePan",tt),this._add("touchPan",ot,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&d.dragPan.enable(r.dragPan);const ht=new uf,pt=new cf;d.touchZoomRotate=new ff(_,pt,ht,F),this._add("touchRotate",ht,["touchPan","touchZoom"]),this._add("touchZoom",pt,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&d.touchZoomRotate.enable(r.touchZoomRotate);const yt=d.scrollZoom=new Gr(d,()=>this._triggerRenderFrame());this._add("scrollZoom",yt,["mousePan"]),r.interactive&&r.scrollZoom&&d.scrollZoom.enable(r.scrollZoom);const vt=d.keyboard=new wr(d);this._add("keyboard",vt),r.interactive&&r.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Pn(d))}_add(r,d,_){this._handlers.push({handlerName:r,handler:d,allowed:_}),this._handlersById[r]=d}stop(r){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mr(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,d,_){for(const g in r)if(g!==_&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(r){const d=[];for(const _ of r)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(r,d,_,g,w){if(!_)return;o.e(r,_);const C={handlerName:g,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(d.zoom=C),_.panDelta!==void 0&&(d.drag=C),_.pitchDelta!==void 0&&(d.pitch=C),_.bearingDelta!==void 0&&(d.rotate=C)}_applyChanges(){const r={},d={},_={};for(const[g,w,C]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),o.e(d,w),o.e(_,C);this._updateMapTransform(r,d,_),this._changes=[]}_updateMapTransform(r,d,_){const g=this._map,w=g._getTransformForUpdate(),C=g.terrain;if(!(Gh(r)||C&&this._terrainMovement))return this._fireEvents(d,_,!0);let{panDelta:L,zoomDelta:F,bearingDelta:N,pitchDelta:H,around:j,pinchAround:tt}=r;tt!==void 0&&(j=tt),g._stop(!0),j=j||g.transform.centerPoint;const ot=w.pointLocation(L?j.sub(L):j);N&&(w.bearing+=N),H&&(w.pitch+=H),F&&(w.zoom+=F),C?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(L)):w.setLocationAtPoint(ot,j):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(ot,j)):w.setLocationAtPoint(ot,j),g._applyUpdatedTransform(w),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(d,_,!0)}_fireEvents(r,d,_){const g=Mr(this._eventsInProgress),w=Mr(r),C={};for(const j in r){const{originalEvent:tt}=r[j];this._eventsInProgress[j]||(C[`${j}start`]=tt),this._eventsInProgress[j]=r[j]}!g&&w&&this._fireEvent("movestart",w.originalEvent);for(const j in C)this._fireEvent(j,C[j]);w&&this._fireEvent("move",w.originalEvent);for(const j in r){const{originalEvent:tt}=r[j];this._fireEvent(j,tt)}const L={};let F;for(const j in this._eventsInProgress){const{handlerName:tt,originalEvent:ot}=this._eventsInProgress[j];this._handlersById[tt].isActive()||(delete this._eventsInProgress[j],F=d[tt]||ot,L[`${j}end`]=F)}for(const j in L)this._fireEvent(j,L[j]);const N=Mr(this._eventsInProgress),H=(g||w)&&!N;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();j.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(j)}if(_&&H){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),tt=ot=>ot!==0&&-this._bearingSnap<ot&&ot<this._bearingSnap;!j||!j.essential&&v.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:F})),tt(this._map.getBearing())&&this._map.resetNorth()):(tt(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:F})),this._updatingCamera=!1}}_fireEvent(r,d){this._map.fire(new o.k(r,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new De("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hm extends o.E{constructor(r,d){super(),this._renderFrameCallback=()=>{const _=Math.min((v.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(r,d){return this.jumpTo({center:r},d)}panBy(r,d,_){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},d),_)}panTo(r,d,_){return this.easeTo(o.e({center:r},d),_)}getZoom(){return this.transform.zoom}setZoom(r,d){return this.jumpTo({zoom:r},d),this}zoomTo(r,d,_){return this.easeTo(o.e({zoom:r},d),_)}zoomIn(r,d){return this.zoomTo(this.getZoom()+1,r,d),this}zoomOut(r,d){return this.zoomTo(this.getZoom()-1,r,d),this}getBearing(){return this.transform.bearing}setBearing(r,d){return this.jumpTo({bearing:r},d),this}getPadding(){return this.transform.padding}setPadding(r,d){return this.jumpTo({padding:r},d),this}rotateTo(r,d,_){return this.easeTo(o.e({bearing:r},d),_)}resetNorth(r,d){return this.rotateTo(0,o.e({duration:1e3},r),d),this}resetNorthPitch(r,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),d),this}snapToNorth(r,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,d):this}getPitch(){return this.transform.pitch}setPitch(r,d){return this.jumpTo({pitch:r},d),this}cameraForBounds(r,d){r=Ft.convert(r).adjustAntiMeridian();const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),_,d)}_cameraForBoxAndBearing(r,d,_,g){const w={top:0,bottom:0,right:0,left:0};if(typeof(g=o.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const ye=g.padding;g.padding={top:ye,bottom:ye,right:ye,left:ye}}g.padding=o.e(w,g.padding);const C=this.transform,L=C.padding,F=new Ft(r,d),N=C.project(F.getNorthWest()),H=C.project(F.getNorthEast()),j=C.project(F.getSouthEast()),tt=C.project(F.getSouthWest()),ot=o.ba(-_),ht=N.rotate(ot),pt=H.rotate(ot),yt=j.rotate(ot),vt=tt.rotate(ot),Mt=new o.P(Math.max(ht.x,pt.x,vt.x,yt.x),Math.max(ht.y,pt.y,vt.y,yt.y)),dt=new o.P(Math.min(ht.x,pt.x,vt.x,yt.x),Math.min(ht.y,pt.y,vt.y,yt.y)),Ct=Mt.sub(dt),Lt=(C.width-(L.left+L.right+g.padding.left+g.padding.right))/Ct.x,Bt=(C.height-(L.top+L.bottom+g.padding.top+g.padding.bottom))/Ct.y;if(Bt<0||Lt<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ee=Math.min(C.scaleZoom(C.scale*Math.min(Lt,Bt)),g.maxZoom),he=o.P.convert(g.offset),we=new o.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(o.ba(_)),Ce=he.add(we).mult(C.scale/C.zoomScale(ee));return{center:C.unproject(N.add(j).div(2).sub(Ce)),zoom:ee,bearing:_}}fitBounds(r,d,_){return this._fitInternal(this.cameraForBounds(r,d),d,_)}fitScreenCoordinates(r,d,_,g,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(r)),this.transform.pointLocation(o.P.convert(d)),_,g),g,w)}_fitInternal(r,d,_){return r?(delete(d=o.e(r,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(r,d){this.stop();const _=this._getTransformForUpdate();let g=!1,w=!1,C=!1;return"zoom"in r&&_.zoom!==+r.zoom&&(g=!0,_.zoom=+r.zoom),r.center!==void 0&&(_.center=o.N.convert(r.center)),"bearing"in r&&_.bearing!==+r.bearing&&(w=!0,_.bearing=+r.bearing),"pitch"in r&&_.pitch!==+r.pitch&&(C=!0,_.pitch=+r.pitch),r.padding==null||_.isPaddingEqual(r.padding)||(_.padding=r.padding),this._applyUpdatedTransform(_),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),g&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),w&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),C&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(r,d,_,g=0){const w=o.Z.fromLngLat(r,d),C=o.Z.fromLngLat(_,g),L=C.x-w.x,F=C.y-w.y,N=C.z-w.z,H=Math.hypot(L,F,N);if(H===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(L,F),tt=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ot=180*Math.atan2(L,-F)/Math.PI;let ht=180*Math.acos(j/H)/Math.PI;return ht=N<0?90-ht:90+ht,{center:C.toLngLat(),zoom:tt,pitch:ht,bearing:ot}}easeTo(r,d){var _;this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.b9},r)).animate===!1||!r.essential&&v.prefersReducedMotion)&&(r.duration=0);const g=this._getTransformForUpdate(),w=g.zoom,C=g.bearing,L=g.pitch,F=g.padding,N="bearing"in r?this._normalizeBearing(r.bearing,C):C,H="pitch"in r?+r.pitch:L,j="padding"in r?r.padding:g.padding,tt=o.P.convert(r.offset);let ot=g.centerPoint.add(tt);const ht=g.pointLocation(ot),{center:pt,zoom:yt}=g.getConstrained(o.N.convert(r.center||ht),(_=r.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(pt,g);const vt=g.project(ht),Mt=g.project(pt).sub(vt),dt=g.zoomScale(yt-w);let Ct,Lt;r.around&&(Ct=o.N.convert(r.around),Lt=g.locationPoint(Ct));const Bt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||yt!==w,this._rotating=this._rotating||C!==N,this._pitching=this._pitching||H!==L,this._padding=!g.isPaddingEqual(j),this._easeId=r.easeId,this._prepareEase(d,r.noMoveStart,Bt),this.terrain&&this._prepareElevation(pt),this._ease(ee=>{if(this._zooming&&(g.zoom=o.y.number(w,yt,ee)),this._rotating&&(g.bearing=o.y.number(C,N,ee)),this._pitching&&(g.pitch=o.y.number(L,H,ee)),this._padding&&(g.interpolatePadding(F,j,ee),ot=g.centerPoint.add(tt)),this.terrain&&!r.freezeElevation&&this._updateElevation(ee),Ct)g.setLocationAtPoint(Ct,Lt);else{const he=g.zoomScale(g.zoom-w),we=yt>w?Math.min(2,dt):Math.max(.5,dt),Ce=Math.pow(we,1-ee),ye=g.unproject(vt.add(Mt.mult(ee*Ce)).mult(he));g.setLocationAtPoint(g.renderWorldCopies?ye.wrap():ye,ot)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},ee=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(d,ee)},r),this}_prepareEase(r,d,_={}){this._moving=!0,d||_.moving||this.fire(new o.k("movestart",r)),this._zooming&&!_.zooming&&this.fire(new o.k("zoomstart",r)),this._rotating&&!_.rotating&&this.fire(new o.k("rotatestart",r)),this._pitching&&!_.pitching&&this.fire(new o.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(_-(d-(_*r+this._elevationStart))/(1-r)),this._elevationTarget=d}this.transform.elevation=o.y.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){const d=r.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(d.lngLat,r.zoom);if(d.altitude<_){const g=this.calculateCameraOptionsFromTo(d.lngLat,_,r.center,r.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(r){const d=[];if(this.terrain&&d.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&d.push(g=>this.transformCameraUpdate(g)),!d.length)return;const _=r.clone();for(const g of d){const w=_.clone(),{center:C,zoom:L,pitch:F,bearing:N,elevation:H}=g(w);C&&(w.center=C),L!==void 0&&(w.zoom=L),F!==void 0&&(w.pitch=F),N!==void 0&&(w.bearing=N),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(r){this.fire(new o.k("move",r)),this._zooming&&this.fire(new o.k("zoom",r)),this._rotating&&this.fire(new o.k("rotate",r)),this._pitching&&this.fire(new o.k("pitch",r))}_afterEase(r,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,g=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new o.k("zoomend",r)),g&&this.fire(new o.k("rotateend",r)),w&&this.fire(new o.k("pitchend",r)),this.fire(new o.k("moveend",r))}flyTo(r,d){var _;if(!r.essential&&v.prefersReducedMotion){const Te=o.M(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Te,d)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b9},r);const g=this._getTransformForUpdate(),w=g.zoom,C=g.bearing,L=g.pitch,F=g.padding,N="bearing"in r?this._normalizeBearing(r.bearing,C):C,H="pitch"in r?+r.pitch:L,j="padding"in r?r.padding:g.padding,tt=o.P.convert(r.offset);let ot=g.centerPoint.add(tt);const ht=g.pointLocation(ot),{center:pt,zoom:yt}=g.getConstrained(o.N.convert(r.center||ht),(_=r.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(pt,g);const vt=g.zoomScale(yt-w),Mt=g.project(ht),dt=g.project(pt).sub(Mt);let Ct=r.curve;const Lt=Math.max(g.width,g.height),Bt=Lt/vt,ee=dt.mag();if("minZoom"in r){const Te=o.ac(Math.min(r.minZoom,w,yt),g.minZoom,g.maxZoom),di=Lt/g.zoomScale(Te-w);Ct=Math.sqrt(di/ee*2)}const he=Ct*Ct;function we(Te){const di=(Bt*Bt-Lt*Lt+(Te?-1:1)*he*he*ee*ee)/(2*(Te?Bt:Lt)*he*ee);return Math.log(Math.sqrt(di*di+1)-di)}function Ce(Te){return(Math.exp(Te)-Math.exp(-Te))/2}function ye(Te){return(Math.exp(Te)+Math.exp(-Te))/2}const _e=we(!1);let Ve=function(Te){return ye(_e)/ye(_e+Ct*Te)},mi=function(Te){return Lt*((ye(_e)*(Ce(di=_e+Ct*Te)/ye(di))-Ce(_e))/he)/ee;var di},xe=(we(!0)-_e)/Ct;if(Math.abs(ee)<1e-6||!isFinite(xe)){if(Math.abs(Lt-Bt)<1e-6)return this.easeTo(r,d);const Te=Bt<Lt?-1:1;xe=Math.abs(Math.log(Bt/Lt))/Ct,mi=()=>0,Ve=di=>Math.exp(Te*Ct*di)}return r.duration="duration"in r?+r.duration:1e3*xe/("screenSpeed"in r?+r.screenSpeed/Ct:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=C!==N,this._pitching=H!==L,this._padding=!g.isPaddingEqual(j),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(pt),this._ease(Te=>{const di=Te*xe,dn=1/Ve(di);g.zoom=Te===1?yt:w+g.scaleZoom(dn),this._rotating&&(g.bearing=o.y.number(C,N,Te)),this._pitching&&(g.pitch=o.y.number(L,H,Te)),this._padding&&(g.interpolatePadding(F,j,Te),ot=g.centerPoint.add(tt)),this.terrain&&!r.freezeElevation&&this._updateElevation(Te);const Ti=Te===1?pt:g.unproject(Mt.add(dt.mult(mi(di))).mult(dn));g.setLocationAtPoint(g.renderWorldCopies?Ti.wrap():Ti,ot),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(d)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,d){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,d)}return r||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(r,d,_){_.animate===!1||_.duration===0?(r(1),d()):(this._easeStart=v.now(),this._easeOptions=_,this._onEaseFrame=r,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,d){r=o.b3(r,-180,180);const _=Math.abs(r-d);return Math.abs(r-360-d)<_&&(r-=360),Math.abs(r+360-d)<_&&(r+=360),r}_normalizeCenter(r,d){if(!d.renderWorldCopies||d.lngRange)return;const _=r.lng-d.center.lng;r.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const dl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class fl{constructor(r=dl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,d){const _=this._map._getUIString(`AttributionControl.${d}`);r.title=_,r.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const w=d[g];if(w.used||w.usedForTerrain){const C=w.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r=r.filter(g=>String(g).trim()),r.sort((g,w)=>g.length-w.length),r=r.filter((g,w)=>{for(let C=w+1;C<r.length;C++)if(r[C].indexOf(g)>=0)return!1;return!0});const _=r.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,r.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class mf{constructor(r={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const d=b.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const d=++this._id;return this._queue.push({callback:r,id:d,cancelled:!1}),d}remove(r){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const g of _)if(g.id===r)return void(g.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var _f=o.Y([{name:"a_pos3d",type:"Int16",components:3}]);class $0 extends o.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,d){this.sourceCache.update(r,d),this._renderableTilesKeys=[];const _={};for(const g of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))_[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),o.aP(g.posMatrix,0,o.X,0,o.X,0,1),this._tiles[g.key]=new Be(g,this.tileSize));for(const g in this._tiles)_[g]||delete this._tiles[g]}freeRtt(r){for(const d in this._tiles){const _=this._tiles[d];(!r||_.tileID.equals(r)||_.tileID.isChildOf(r)||r.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const d={};for(const _ of this._renderableTilesKeys){const g=this._tiles[_].tileID;if(g.canonical.equals(r.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16),o.aP(w.posMatrix,0,o.X,0,o.X,0,1),d[_]=w}else if(g.canonical.isChildOf(r.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16);const C=g.canonical.z-r.canonical.z,L=g.canonical.x-(g.canonical.x>>C<<C),F=g.canonical.y-(g.canonical.y>>C<<C),N=o.X>>C;o.aP(w.posMatrix,0,N,0,N,0,1),o.J(w.posMatrix,w.posMatrix,[-L*N,-F*N,0]),d[_]=w}else if(r.canonical.isChildOf(g.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16);const C=r.canonical.z-g.canonical.z,L=r.canonical.x-(r.canonical.x>>C<<C),F=r.canonical.y-(r.canonical.y>>C<<C),N=o.X>>C;o.aP(w.posMatrix,0,o.X,0,o.X,0,1),o.J(w.posMatrix,w.posMatrix,[L*N,F*N,0]),o.K(w.posMatrix,w.posMatrix,[1/2**C,1/2**C,0]),d[_]=w}}return d}getSourceTile(r,d){const _=this.sourceCache._source;let g=r.overscaledZ-this.deltaZoom;if(g>_.maxzoom&&(g=_.maxzoom),g<_.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(g).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!w||!w.dem)&&d)for(;g>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(r.scaledTo(g--).key);return w}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=r)}}class gf{constructor(r,d,_){this.painter=r,this.sourceCache=new $0(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,d,_,g=o.X){var w;if(!(d>=0&&d<g&&_>=0&&_<g))return 0;const C=this.getTerrainData(r),L=(w=C.tile)===null||w===void 0?void 0:w.dem;if(!L)return 0;const F=function(ht,pt,yt){var vt=pt[0],Mt=pt[1];return ht[0]=yt[0]*vt+yt[4]*Mt+yt[12],ht[1]=yt[1]*vt+yt[5]*Mt+yt[13],ht}([],[d/g*o.X,_/g*o.X],C.u_terrain_matrix),N=[F[0]*L.dim,F[1]*L.dim],H=Math.floor(N[0]),j=Math.floor(N[1]),tt=N[0]-H,ot=N[1]-j;return L.get(H,j)*(1-tt)*(1-ot)+L.get(H+1,j)*tt*(1-ot)+L.get(H,j+1)*(1-tt)*ot+L.get(H+1,j+1)*tt*ot}getElevationForLngLatZoom(r,d){if(!o.bb(d,r.wrap()))return 0;const{tileID:_,mercatorX:g,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(r,d);return this.getElevation(_,g%o.X,w%o.X,o.X)}getElevation(r,d,_,g=o.X){return this.getDEMElevation(r,d,_,g)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const g=this.painter.context,w=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ct(g,w,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ct(g,new o.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const d=this.sourceCache.getSourceTile(r,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ct(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+r.key;if(_&&!this._demMatrixCache[_]){const g=this.sourceCache.sourceCache._source.maxzoom;let w=r.canonical.z-d.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=g?w=r.canonical.z-g:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=r.canonical.x-(r.canonical.x>>w<<w),L=r.canonical.y-(r.canonical.y>>w<<w),F=o.bc(new Float64Array(16),[1/(o.X<<w),1/(o.X<<w),0]);o.J(F,F,[C*o.X,L*o.X,0]),this._demMatrixCache[r.key]={matrix:F,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(r){const d=this.painter,_=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ct(d.context,{width:_,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ct(d.context,{width:_,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,g))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,C=0;w<this._coordsTextureSize;w++)for(let L=0;L<this._coordsTextureSize;L++,C+=4)d[C+0]=255&L,d[C+1]=255&w,d[C+2]=L>>8<<4|w>>8,d[C+3]=0;const _=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new ct(r,_,r.gl.RGBA,{premultiply:!1});return g.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),_=this.painter.context,g=_.gl,w=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),L=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(w,L-C-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const F=d[0]+(d[2]>>4<<8),N=d[1]+((15&d[2])<<8),H=this.coordsIndex[255-d[3]],j=H&&this.sourceCache.getTileByID(H);if(!j)return null;const tt=this._coordsTextureSize,ot=(1<<j.tileID.canonical.z)*tt;return new o.Z((j.tileID.canonical.x*tt+F)/ot+j.tileID.wrap,(j.tileID.canonical.y*tt+N)/ot,this.getElevation(j.tileID,F,N,tt))}depthAtPoint(r){const d=new Uint8Array(4),_=this.painter.context,g=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,d=new o.bd,_=new o.aY,g=this.meshSize,w=o.X/g,C=g*g;for(let j=0;j<=g;j++)for(let tt=0;tt<=g;tt++)d.emplaceBack(tt*w,j*w,0);for(let j=0;j<C;j+=g+1)for(let tt=0;tt<g;tt++)_.emplaceBack(tt+j,g+tt+j+1,g+tt+j+2),_.emplaceBack(tt+j,g+tt+j+2,tt+j+1);const L=d.length,F=L+2*(g+1);for(const j of[0,1])for(let tt=0;tt<=g;tt++)for(const ot of[0,1])d.emplaceBack(tt*w,j*o.X,ot);for(let j=0;j<2*g;j+=2)_.emplaceBack(F+j,F+j+1,F+j+3),_.emplaceBack(F+j,F+j+3,F+j+2),_.emplaceBack(L+j,L+j+3,L+j+1),_.emplaceBack(L+j,L+j+2,L+j+3);const N=d.length,H=N+2*(g+1);for(const j of[0,1])for(let tt=0;tt<=g;tt++)for(const ot of[0,1])d.emplaceBack(j*o.X,tt*w,ot);for(let j=0;j<2*g;j+=2)_.emplaceBack(N+j,N+j+1,N+j+3),_.emplaceBack(N+j,N+j+3,N+j+2),_.emplaceBack(H+j,H+j+3,H+j+1),_.emplaceBack(H+j,H+j+2,H+j+3);return this._mesh=new Dh(r.createVertexBuffer(d,_f.members),r.createIndexBuffer(_),o.a0.simpleSegment(0,0,d.length,_.length)),this._mesh}getMeshFrameDelta(r){return 2*Math.PI*o.be/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,d){var _;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(r,d);return(_=this.getMinMaxElevation(g).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(r){const d=this.getTerrainData(r).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(r,d){const _=o.Z.fromLngLat(r.wrap()),g=(1<<d)*o.X,w=_.x*g,C=_.y*g,L=Math.floor(w/o.X),F=Math.floor(C/o.X);return{tileID:new o.S(d,0,d,L,F),mercatorX:w,mercatorY:C}}}class Z0{constructor(r,d,_){this._context=r,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:r,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>r.id!==d),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const pl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class jm{constructor(r,d){this.painter=r,this.terrain=d,this.pool=new Z0(r.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(_=>!r._layers[_].isHidden(d)),this._coordsDescendingInv={};for(const _ in r.sourceCaches){this._coordsDescendingInv[_]={};const g=r.sourceCaches[_].getVisibleCoordinates();for(const w of g){const C=this.terrain.sourceCache.getTerrainCoords(w);for(const L in C)this._coordsDescendingInv[_][L]||(this._coordsDescendingInv[_][L]=[]),this._coordsDescendingInv[_][L].push(C[L])}}this._coordsDescendingInvStr={};for(const _ of r._order){const g=r._layers[_],w=g.source;if(pl[g.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const C in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][C]=this._coordsDescendingInv[w][C].map(L=>L.key).sort().join()}}for(const _ of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[g][_.tileID.key];w&&w!==_.rttCoords[g]&&(_.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const d=r.type,_=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(pl[d]&&(this._prevType&&pl[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(r.id),!g))return!0;if(pl[this._prevType]||pl[d]&&g){this._prevType=d;const w=this._stacks.length-1,C=this._stacks[w]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(zm(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[w]){const N=this.pool.getObjectForId(L.rtt[w].id);if(N.stamp===L.rtt[w].stamp){this.pool.useObject(N);continue}}const F=this.pool.getOrCreateFreeObject();this.pool.useObject(F),this.pool.stampObject(F),L.rtt[w]={id:F.id,stamp:F.stamp},_.context.bindFramebuffer.set(F.fbo.framebuffer),_.context.clear({color:o.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let N=0;N<C.length;N++){const H=_.style._layers[C[N]],j=H.source?this._coordsDescendingInv[H.source][L.tileID.key]:[L.tileID];_.context.viewport.set([0,0,F.fbo.width,F.fbo.height]),_._renderTileClippingMasks(H,j),_.renderLayer(_,_.style.sourceCaches[H.source],H,j),H.source&&(L.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][L.tileID.key])}}return zm(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),pl[d]}return!1}}const yf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Wm=p,Y0={hash:!1,interactive:!0,bearingSnap:7,attributionControl:dl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},xf=M=>{M.touchstart=M.dragStart,M.touchmoveWindow=M.dragMove,M.touchend=M.dragEnd},K0={showCompass:!0,showZoom:!0,visualizePitch:!1};class J0{constructor(r,d,_=!1){this.mousedown=C=>{this.startMouse(o.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),b.mousePos(this.element,C)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,b.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=r.dragRotate._mouseRotate.getClickTolerance(),w=r.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=af({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:L,bearingDegreesPerPixelMoved:F=.8})=>{const N=new rf;return new Pa({clickTolerance:L,move:(H,j)=>({bearingDelta:(j.x-H.x)*F}),moveStateManager:N,enable:C,assignEvents:xf})})({clickTolerance:g,enable:!0}),this.map=r,_&&(this.mousePitch=of({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:L,pitchDegreesPerPixelMoved:F=-.5})=>{const N=new rf;return new Pa({clickTolerance:L,move:(H,j)=>({pitchDelta:(j.y-H.y)*F}),moveStateManager:N,enable:C,assignEvents:xf})})({clickTolerance:w,enable:!0})),b.addEventListener(d,"mousedown",this.mousedown),b.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(d,"touchcancel",this.reset)}startMouse(r,d){this.mouseRotate.dragStart(r,d),this.mousePitch&&this.mousePitch.dragStart(r,d),b.disableDrag()}startTouch(r,d){this.touchRotate.dragStart(r,d),this.touchPitch&&this.touchPitch.dragStart(r,d),b.disableDrag()}moveMouse(r,d){const _=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(r,d)||{};if(g&&_.setBearing(_.getBearing()+g),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(r,d)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(r,d){const _=this.map,{bearingDelta:g}=this.touchRotate.dragMove(r,d)||{};if(g&&_.setBearing(_.getBearing()+g),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(r,d)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const r=this.element;b.removeEventListener(r,"mousedown",this.mousedown),b.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let er;function un(M,r,d){const _=new o.N(M.lng,M.lat);if(M=new o.N(M.lng,M.lat),r){const g=new o.N(M.lng-360,M.lat),w=new o.N(M.lng+360,M.lat),C=d.locationPoint(M).distSqr(r);d.locationPoint(g).distSqr(r)<C?M=g:d.locationPoint(w).distSqr(r)<C&&(M=w)}for(;Math.abs(M.lng-d.center.lng)>180;){const g=d.locationPoint(M);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;M.lng>d.center.lng?M.lng-=360:M.lng+=360}return M.lng!==_.lng&&d.locationPoint(M).y>d.height/2-d.getHorizon()?M:_}const ml={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hh(M,r,d){const _=M.classList;for(const g in ml)_.remove(`maplibregl-${d}-anchor-${g}`);_.add(`maplibregl-${d}-anchor-${r}`)}class jh extends o.E{constructor(r){if(super(),this._onKeyPress=d=>{const _=d.code,g=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,g=this._element;this._popup&&(_===g||g.contains(_))&&this.togglePopup()},this._update=d=>{var _;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?un(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${ml[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${w}`),v.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div");const d=b.createNS("http://www.w3.org/2000/svg","svg"),_=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${_}`);const w=b.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const C=b.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const L=b.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const F=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const vt of F){const Mt=b.createNS("http://www.w3.org/2000/svg","ellipse");Mt.setAttributeNS(null,"opacity","0.04"),Mt.setAttributeNS(null,"cx","10.5"),Mt.setAttributeNS(null,"cy","5.80029008"),Mt.setAttributeNS(null,"rx",vt.rx),Mt.setAttributeNS(null,"ry",vt.ry),L.appendChild(Mt)}const N=b.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const H=b.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(H);const j=b.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const tt=b.createNS("http://www.w3.org/2000/svg","path");tt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(tt);const ot=b.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ot.setAttributeNS(null,"fill","#FFFFFF");const ht=b.createNS("http://www.w3.org/2000/svg","g");ht.setAttributeNS(null,"transform","translate(8.0, 8.0)");const pt=b.createNS("http://www.w3.org/2000/svg","circle");pt.setAttributeNS(null,"fill","#000000"),pt.setAttributeNS(null,"opacity","0.25"),pt.setAttributeNS(null,"cx","5.5"),pt.setAttributeNS(null,"cy","5.5"),pt.setAttributeNS(null,"r","5.4999962");const yt=b.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),ht.appendChild(pt),ht.appendChild(yt),C.appendChild(L),C.appendChild(N),C.appendChild(j),C.appendChild(ot),C.appendChild(ht),d.appendChild(C),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Hh(this._element,this._anchor,"marker"),r&&r.className)for(const d of r.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.N.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var d,_;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,w=g.terrain.depthAtPoint(this._pos),C=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,C)-w<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/g.transform._pixelPerMeter,F=Math.sin(g.getPitch()*Math.PI/180)*L,N=g.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),H=g.transform.lngLatToCameraDepth(this._lngLat,C+F)-N>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,d){return r===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const qm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mc=0,Sc=!1;const ha={maxWidth:100,unit:"metric"};function Tc(M,r,d){const _=d&&d.maxWidth||100,g=M._container.clientHeight/2,w=M.unproject([0,g]),C=M.unproject([_,g]),L=w.distanceTo(C);if(d&&d.unit==="imperial"){const F=3.2808*L;F>5280?Ue(r,_,F/5280,M._getUIString("ScaleControl.Miles")):Ue(r,_,F,M._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Ue(r,_,L/1852,M._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Ue(r,_,L/1e3,M._getUIString("ScaleControl.Kilometers")):Ue(r,_,L,M._getUIString("ScaleControl.Meters"))}function Ue(M,r,d,_){const g=function(w){const C=Math.pow(10,`${Math.floor(w)}`.length-1);let L=w/C;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(F){const N=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*N)/N}(L),C*L}(d);M.style.width=r*(g/d)+"px",M.innerHTML=`${g}&nbsp;${_}`}const ai={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Wh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qh(M){if(M){if(typeof M=="number"){const r=Math.round(Math.abs(M)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,M),"top-left":new o.P(r,r),"top-right":new o.P(-r,r),bottom:new o.P(0,-M),"bottom-left":new o.P(r,-r),"bottom-right":new o.P(-r,-r),left:new o.P(M,0),right:new o.P(-M,0)}}if(M instanceof o.P||Array.isArray(M)){const r=o.P.convert(M);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:o.P.convert(M.center||[0,0]),top:o.P.convert(M.top||[0,0]),"top-left":o.P.convert(M["top-left"]||[0,0]),"top-right":o.P.convert(M["top-right"]||[0,0]),bottom:o.P.convert(M.bottom||[0,0]),"bottom-left":o.P.convert(M["bottom-left"]||[0,0]),"bottom-right":o.P.convert(M["bottom-right"]||[0,0]),left:o.P.convert(M.left||[0,0]),right:o.P.convert(M.right||[0,0])}}return qh(new o.P(0,0))}const vf=p;c.AJAXError=o.bh,c.Evented=o.E,c.LngLat=o.N,c.MercatorCoordinate=o.Z,c.Point=o.P,c.addProtocol=o.bi,c.config=o.a,c.removeProtocol=o.bj,c.AttributionControl=fl,c.BoxZoomHandler=tr,c.CanvasSource=ae,c.CooperativeGesturesHandler=ul,c.DoubleClickZoomHandler=wo,c.DragPanHandler=Vm,c.DragRotateHandler=Gm,c.EdgeInsets=ll,c.FullscreenControl=class extends o.E{constructor(M={}){super(),this._onFullscreenChange=()=>{var r;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=d==null?void 0:d.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,M&&M.container&&(M.container instanceof HTMLElement?this._container=M.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(M){return this._map=M,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const M=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",M).setAttribute("aria-hidden","true"),M.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const M=this._getTitle();this._fullscreenButton.setAttribute("aria-label",M),this._fullscreenButton.title=M}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=mt,c.GeolocateControl=class extends o.E{constructor(M){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const d=new o.N(r.coords.longitude,r.coords.latitude),_=r.coords.accuracy,g=this._map.getBearing(),w=o.e({bearing:g},this.options.fitBoundsOptions),C=Ft.fromLngLat(d,_);this._map.fitBounds(C,w,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const d=new o.N(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&Sc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jh({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},qm,M)}onAdd(M){return this._map=M,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(r=!1){if(er!==void 0&&!r)return er;if(window.navigator.permissions===void 0)return er=!!window.navigator.geolocation,er;try{er=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{er=!!window.navigator.geolocation}return er})}().then(r=>this._finishSetupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mc=0,Sc=!1}_isOutOfMapMaxBounds(M){const r=this._map.getMaxBounds(),d=M.coords;return r&&(d.longitude<r.getWest()||d.longitude>r.getEast()||d.latitude<r.getSouth()||d.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const M=this._map.getBounds(),r=M.getSouthEast(),d=M.getNorthEast(),_=r.distanceTo(d),g=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mc--,Sc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let M;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mc++,Mc>1?(M={maximumAge:6e5,timeout:0},Sc=!0):(M=this.options.positionOptions,Sc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,M)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=kh,c.ImageSource=Ht,c.KeyboardHandler=wr,c.LngLatBounds=Ft,c.LogoControl=mf,c.Map=class extends Hm{constructor(M){o.bf.mark(o.bg.create);const r=Object.assign(Object.assign({},Y0),M);if(r.minZoom!=null&&r.maxZoom!=null&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(r.minPitch!=null&&r.maxPitch!=null&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(r.minPitch!=null&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(r.maxPitch!=null&&r.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new cl(r.minZoom,r.maxZoom,r.minPitch,r.maxPitch,r.renderWorldCopies),{bearingSnap:r.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new zi,this._controls=[],this._mapId=o.a4(),this._contextLost=d=>{d.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:d}))},this._contextRestored=d=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:d}))},this._onMapScroll=d=>{if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._maxTileCacheZoomLevels=r.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=r.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=r.preserveDrawingBuffer===!0,this._antialias=r.antialias===!0,this._trackResize=r.trackResize===!0,this._bearingSnap=r.bearingSnap,this._refreshExpiredTiles=r.refreshExpiredTiles===!0,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=r.crossSourceCollisions===!0,this._collectResourceTiming=r.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},yf),r.locale),this._clickTolerance=r.clickTolerance,this._overridePixelRatio=r.pixelRatio,this._maxCanvasSize=r.maxCanvasSize,this.transformCameraUpdate=r.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=r.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new B(r.transformRequest),typeof r.container=="string"){if(this._container=document.getElementById(r.container),!this._container)throw new Error(`Container '${r.container}' not found.`)}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let d=!1;const _=gc(g=>{this._trackResize&&!this._removed&&(this.resize(g),this.redraw())},50);this._resizeObserver=new ResizeObserver(g=>{d?_(g):d=!0}),this._resizeObserver.observe(this._container)}this.handlers=new pf(this,r),this._hash=r.hash&&new kh(typeof r.hash=="string"&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,o.e({},r.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=r.localIdeographFontFamily,this._validateStyle=r.validateStyle,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new fl(typeof r.attributionControl=="boolean"?void 0:r.attributionControl)),r.maplibreLogo&&this.addControl(new mf,r.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new o.k(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new o.k(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new o.k("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(M,r){if(r===void 0&&(r=M.getDefaultPosition?M.getDefaultPosition():"top-right"),!M||!M.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=M.onAdd(this);this._controls.push(M);const _=this._controlPositions[r];return r.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(M){if(!M||!M.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(M);return r>-1&&this._controls.splice(r,1),M.onRemove(this),this}hasControl(M){return this._controls.indexOf(M)>-1}calculateCameraOptionsFromTo(M,r,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(M,r,d,_)}resize(M){var r;const d=this._containerDimensions(),_=d[0],g=d[1],w=this._getClampedPixelRatio(_,g);if(this._resizeCanvas(_,g,w),this.painter.resize(_,g,w),this.painter.overLimit()){const L=this.painter.context.gl;this._maxCanvasSize=[L.drawingBufferWidth,L.drawingBufferHeight];const F=this._getClampedPixelRatio(_,g);this._resizeCanvas(_,g,F),this.painter.resize(_,g,F)}this.transform.resize(_,g),(r=this._requestedCameraState)===null||r===void 0||r.resize(_,g);const C=!this._moving;return C&&(this.stop(),this.fire(new o.k("movestart",M)).fire(new o.k("move",M))),this.fire(new o.k("resize",M)),C&&this.fire(new o.k("moveend",M)),this}_getClampedPixelRatio(M,r){const{0:d,1:_}=this._maxCanvasSize,g=this.getPixelRatio(),w=M*g,C=r*g;return Math.min(w>d?d/w:1,C>_?_/C:1)*g}getPixelRatio(){var M;return(M=this._overridePixelRatio)!==null&&M!==void 0?M:devicePixelRatio}setPixelRatio(M){this._overridePixelRatio=M,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(M){return this.transform.setMaxBounds(Ft.convert(M)),this._update()}setMinZoom(M){if((M=M??-2)>=-2&&M<=this.transform.maxZoom)return this.transform.minZoom=M,this._update(),this.getZoom()<M&&this.setZoom(M),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(M){if((M=M??22)>=this.transform.minZoom)return this.transform.maxZoom=M,this._update(),this.getZoom()>M&&this.setZoom(M),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(M){if((M=M??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(M>=0&&M<=this.transform.maxPitch)return this.transform.minPitch=M,this._update(),this.getPitch()<M&&this.setPitch(M),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(M){if((M=M??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(M>=this.transform.minPitch)return this.transform.maxPitch=M,this._update(),this.getPitch()>M&&this.setPitch(M),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(M){return this.transform.renderWorldCopies=M,this._update()}project(M){return this.transform.locationPoint(o.N.convert(M),this.style&&this.terrain)}unproject(M){return this.transform.pointLocation(o.P.convert(M),this.terrain)}isMoving(){var M;return this._moving||((M=this.handlers)===null||M===void 0?void 0:M.isMoving())}isZooming(){var M;return this._zooming||((M=this.handlers)===null||M===void 0?void 0:M.isZooming())}isRotating(){var M;return this._rotating||((M=this.handlers)===null||M===void 0?void 0:M.isRotating())}_createDelegatedListener(M,r,d){if(M==="mouseenter"||M==="mouseover"){let _=!1;return{layers:r,listener:d,delegates:{mousemove:w=>{const C=r.filter(F=>this.getLayer(F)),L=C.length!==0?this.queryRenderedFeatures(w.point,{layers:C}):[];L.length?_||(_=!0,d.call(this,new us(M,this,w.originalEvent,{features:L}))):_=!1},mouseout:()=>{_=!1}}}}if(M==="mouseleave"||M==="mouseout"){let _=!1;return{layers:r,listener:d,delegates:{mousemove:C=>{const L=r.filter(F=>this.getLayer(F));(L.length!==0?this.queryRenderedFeatures(C.point,{layers:L}):[]).length?_=!0:_&&(_=!1,d.call(this,new us(M,this,C.originalEvent)))},mouseout:C=>{_&&(_=!1,d.call(this,new us(M,this,C.originalEvent)))}}}}{const _=g=>{const w=r.filter(L=>this.getLayer(L)),C=w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[];C.length&&(g.features=C,d.call(this,g),delete g.features)};return{layers:r,listener:d,delegates:{[M]:_}}}}_saveDelegatedListener(M,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[M]=this._delegatedListeners[M]||[],this._delegatedListeners[M].push(r)}_removeDelegatedListener(M,r,d){if(!this._delegatedListeners||!this._delegatedListeners[M])return;const _=this._delegatedListeners[M];for(let g=0;g<_.length;g++){const w=_[g];if(w.listener===d&&w.layers.length===r.length&&w.layers.every(C=>r.includes(C))){for(const C in w.delegates)this.off(C,w.delegates[C]);return void _.splice(g,1)}}}on(M,r,d){if(d===void 0)return super.on(M,r);const _=this._createDelegatedListener(M,typeof r=="string"?[r]:r,d);this._saveDelegatedListener(M,_);for(const g in _.delegates)this.on(g,_.delegates[g]);return this}once(M,r,d){if(d===void 0)return super.once(M,r);const _=typeof r=="string"?[r]:r,g=this._createDelegatedListener(M,_,d);for(const w in g.delegates){const C=g.delegates[w];g.delegates[w]=(...L)=>{this._removeDelegatedListener(M,_,d),C(...L)}}this._saveDelegatedListener(M,g);for(const w in g.delegates)this.once(w,g.delegates[w]);return this}off(M,r,d){return d===void 0?super.off(M,r):(this._removeDelegatedListener(M,typeof r=="string"?[r]:r,d),this)}queryRenderedFeatures(M,r){if(!this.style)return[];let d;const _=M instanceof o.P||Array.isArray(M),g=_?M:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(_?{}:M)||{},g instanceof o.P||typeof g[0]=="number")d=[o.P.convert(g)];else{const w=o.P.convert(g[0]),C=o.P.convert(g[1]);d=[w,new o.P(C.x,w.y),C,new o.P(w.x,C.y),w]}return this.style.queryRenderedFeatures(d,r,this.transform)}querySourceFeatures(M,r){return this.style.querySourceFeatures(M,r)}setStyle(M,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&M?(this._diffStyle(M,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(M,r))}setTransformRequest(M){return this._requestManager.setTransformRequest(M),this}_getUIString(M){const r=this._locale[M];if(r==null)throw new Error(`Missing UI string '${M}'`);return r}_updateStyle(M,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(M,r));const d=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!M)),M?(this.style=new Ts(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof M=="string"?this.style.loadURL(M,r,d):this.style.loadJSON(M,r,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(M,r){if(typeof M=="string"){const d=this._requestManager.transformRequest(M,"Style");o.h(d,new AbortController).then(_=>{this._updateDiff(_.data,r)}).catch(_=>{_&&this.fire(new o.j(_))})}else typeof M=="object"&&this._updateDiff(M,r)}_updateDiff(M,r){try{this.style.setState(M,r)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(M,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(M,r){return this._lazyInitEmptyStyle(),this.style.addSource(M,r),this._update(!0)}isSourceLoaded(M){const r=this.style&&this.style.sourceCaches[M];if(r!==void 0)return r.loaded();this.fire(new o.j(new Error(`There is no source with ID '${M}'`)))}setTerrain(M){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),M){const r=this.style.sourceCaches[M.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${M.source}`);this.terrain===null&&r.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===M.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gf(this.painter,r,M),this.painter.renderToTexture=new jm(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==M.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:M})),this}getTerrain(){var M,r;return(r=(M=this.terrain)===null||M===void 0?void 0:M.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const M=this.style&&this.style.sourceCaches;for(const r in M){const d=M[r]._tiles;for(const _ in d){const g=d[_];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(M){return this.style.removeSource(M),this._update(!0)}getSource(M){return this.style.getSource(M)}addImage(M,r,d={}){const{pixelRatio:_=1,sdf:g=!1,stretchX:w,stretchY:C,content:L,textFitWidth:F,textFitHeight:N}=d;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||o.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:j,data:tt}=r,ot=r;return this.style.addImage(M,{data:new o.R({width:H,height:j},new Uint8Array(tt)),pixelRatio:_,stretchX:w,stretchY:C,content:L,textFitWidth:F,textFitHeight:N,sdf:g,version:0,userImage:ot}),ot.onAdd&&ot.onAdd(this,M),this}}{const{width:H,height:j,data:tt}=v.getImageData(r);this.style.addImage(M,{data:new o.R({width:H,height:j},tt),pixelRatio:_,stretchX:w,stretchY:C,content:L,textFitWidth:F,textFitHeight:N,sdf:g,version:0})}}updateImage(M,r){const d=this.style.getImage(M);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=r instanceof HTMLImageElement||o.b(r)?v.getImageData(r):r,{width:g,height:w,data:C}=_;if(g===void 0||w===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||w!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(r instanceof HTMLImageElement||o.b(r));return d.data.replace(C,L),this.style.updateImage(M,d),this}getImage(M){return this.style.getImage(M)}hasImage(M){return M?!!this.style.getImage(M):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(M){this.style.removeImage(M)}loadImage(M){return U.getImage(this._requestManager.transformRequest(M,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(M,r){return this._lazyInitEmptyStyle(),this.style.addLayer(M,r),this._update(!0)}moveLayer(M,r){return this.style.moveLayer(M,r),this._update(!0)}removeLayer(M){return this.style.removeLayer(M),this._update(!0)}getLayer(M){return this.style.getLayer(M)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(M,r,d){return this.style.setLayerZoomRange(M,r,d),this._update(!0)}setFilter(M,r,d={}){return this.style.setFilter(M,r,d),this._update(!0)}getFilter(M){return this.style.getFilter(M)}setPaintProperty(M,r,d,_={}){return this.style.setPaintProperty(M,r,d,_),this._update(!0)}getPaintProperty(M,r){return this.style.getPaintProperty(M,r)}setLayoutProperty(M,r,d,_={}){return this.style.setLayoutProperty(M,r,d,_),this._update(!0)}getLayoutProperty(M,r){return this.style.getLayoutProperty(M,r)}setGlyphs(M,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(M,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(M,r,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(M,r,d,_=>{_||this._update(!0)}),this}removeSprite(M){return this._lazyInitEmptyStyle(),this.style.removeSprite(M),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(M,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(M,r,d=>{d||this._update(!0)}),this}setLight(M,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(M,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(M){return this._lazyInitEmptyStyle(),this.style.setSky(M),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(M,r){return this.style.setFeatureState(M,r),this._update()}removeFeatureState(M,r){return this.style.removeFeatureState(M,r),this._update()}getFeatureState(M){return this.style.getFeatureState(M)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let M=0,r=0;return this._container&&(M=this._container.clientWidth||400,r=this._container.clientHeight||300),[M,r]}_setupContainer(){const M=this._container;M.classList.add("maplibregl-map");const r=this._canvasContainer=b.create("div","maplibregl-canvas-container",M);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const g=this._controlContainer=b.create("div","maplibregl-control-container",M),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{w[C]=b.create("div",`maplibregl-ctrl-${C} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(M,r,d){this._canvas.width=Math.floor(d*M),this._canvas.height=Math.floor(d*r),this._canvas.style.width=`${M}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const M={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{r={requestedAttributes:M},_&&(r.statusMessage=_.statusMessage,r.type=_.type)},{once:!0});const d=this._canvas.getContext("webgl2",M)||this._canvas.getContext("webgl",M);if(!d){const _="Failed to initialize WebGL";throw r?(r.message=_,new Error(JSON.stringify(r))):new Error(_)}this.painter=new Lh(d,this.transform),E.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(M){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||M,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(M){return this._update(),this._renderTaskQueue.add(M)}_cancelRenderFrame(M){this._renderTaskQueue.remove(M)}_render(M){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(M),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,w=v.now();this.style.zoomHistory.update(g,w);const C=new o.z(g,{now:w,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=C.crossFadingFactor();L===1&&L===this._crossFadingFactor||(d=!0,this._crossFadingFactor=L),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bf.mark(o.bg.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,o.bf.mark(o.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var M;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(M=this._resizeObserver)===null||M===void 0||M.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r!=null&&r.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bf.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(M=>{o.bf.frame(M),this._frameRequest=null,this._render(M)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(M){this._showTileBoundaries!==M&&(this._showTileBoundaries=M,this._update())}get showPadding(){return!!this._showPadding}set showPadding(M){this._showPadding!==M&&(this._showPadding=M,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(M){this._showCollisionBoxes!==M&&(this._showCollisionBoxes=M,M?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(M){this._showOverdrawInspector!==M&&(this._showOverdrawInspector=M,this._update())}get repaint(){return!!this._repaint}set repaint(M){this._repaint!==M&&(this._repaint=M,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(M){this._vertices=M,this._update()}get version(){return Wm}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=us,c.MapTouchEvent=vo,c.MapWheelEvent=Bm,c.Marker=jh,c.NavigationControl=class{constructor(M){this._updateZoomButtons=()=>{const r=this._map.getZoom(),d=r===this._map.getMaxZoom(),_=r===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);r.title=_,r.setAttribute("aria-label",_)},this.options=o.e({},K0,M),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(M){return this._map=M,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new J0(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(M,r){const d=b.create("button",M,this._container);return d.type="button",d.addEventListener("click",r),d}},c.Popup=class extends o.E{constructor(M){super(),this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const L of this.options.className.split(" "))this._container.classList.add(L);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?un(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!r)return;const _=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const w=qh(this.options.offset);if(!g){const L=this._container.offsetWidth,F=this._container.offsetHeight;let N;N=_.y+w.bottom.y<F?["top"]:_.y>this._map.transform.height-F?["bottom"]:[],_.x<L/2?N.push("left"):_.x>this._map.transform.width-L/2&&N.push("right"),g=N.length===0?"bottom":N.join("-")}let C=_.add(w[g]);this.options.subpixelPositioning||(C=C.round()),b.setTransform(this._container,`${ml[g]} translate(${C.x}px,${C.y}px)`),Hh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ai),M)}addTo(M){return this._map&&this.remove(),this._map=M,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(M){return this._lngLat=o.N.convert(M),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(M){return this.setDOMContent(document.createTextNode(M))}setHTML(M){const r=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=M;_=d.firstChild,_;)r.appendChild(_);return this.setDOMContent(r)}getMaxWidth(){var M;return(M=this._container)===null||M===void 0?void 0:M.style.maxWidth}setMaxWidth(M){return this.options.maxWidth=M,this._update(),this}setDOMContent(M){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(M),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(M){return this._container&&this._container.classList.add(M),this}removeClassName(M){return this._container&&this._container.classList.remove(M),this}setOffset(M){return this.options.offset=M,this._update(),this}toggleClassName(M){if(this._container)return this._container.classList.toggle(M)}setSubpixelPositioning(M){this.options.subpixelPositioning=M}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const M=this._container.querySelector(Wh);M&&M.focus()}},c.RasterDEMTileSource=ke,c.RasterTileSource=ti,c.ScaleControl=class{constructor(M){this._onMove=()=>{Tc(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,Tc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ha),M)}getDefaultPosition(){return"bottom-left"}onAdd(M){return this._map=M,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",M.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Gr,c.Style=Ts,c.TerrainControl=class{constructor(M){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=M}onAdd(M){return this._map=M,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=wc,c.TwoFingersTouchRotateHandler=uf,c.TwoFingersTouchZoomHandler=cf,c.TwoFingersTouchZoomRotateHandler=ff,c.VectorTileSource=oi,c.VideoSource=re,c.addSourceType=(M,r)=>o._(void 0,void 0,void 0,function*(){if($e(M))throw new Error(`A source type called "${M}" already exists.`);((d,_)=>{ie[d]=_})(M,r)}),c.clearPrewarmedResources=function(){const M=be;M&&(M.isPreloaded()&&M.numActive()===1?(M.release(Jt),be=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ue().getRTLTextPluginStatus()},c.getVersion=function(){return vf},c.getWorkerCount=function(){return le.workerCount},c.getWorkerUrl=function(){return o.a.WORKER_URL},c.importScriptInWorkers=function(M){return Zi().broadcast("IS",M)},c.prewarm=function(){gi().acquire(Jt)},c.setMaxParallelImageRequests=function(M){o.a.MAX_PARALLEL_IMAGE_REQUESTS=M},c.setRTLTextPlugin=function(M,r){return ue().setRTLTextPlugin(M,r)},c.setWorkerCount=function(M){le.workerCount=M},c.setWorkerUrl=function(M){o.a.WORKER_URL=M}});var l=e;return l})})(UA);var j5=UA.exports;const x0=ZE(j5),fr=new x0.Map({container:"map",style:{version:8,glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",sources:{FloorSurface:{type:"geojson",data:"plateau_shinjuku/ubld/geojson/UndergroundBuilding.geojson"},obj2_2d:{type:"geojson",data:"plateau_shinjuku/ubld/geojson/obj2_2d.geojson"},gsi_vector:{type:"vector",tiles:["https://cyberjapandata.gsi.go.jp/xyz/experimental_bvmap/{z}/{x}/{y}.pbf"],maxzoom:16,minzoom:4,attribution:""}},layers:[{id:"background",type:"background",paint:{"background-color":"#595959","background-opacity":.5}},{id:"railway",source:"gsi_vector","source-layer":"railway",type:"line",paint:{"line-color":"#4cf100","line-width":2},layout:{}},{id:"road",source:"gsi_vector","source-layer":"road",type:"line",paint:{"line-color":"rgb(198, 198, 198)","line-width":1},layout:{}},{id:"building",source:"gsi_vector","source-layer":"building",type:"line",paint:{"line-color":"#00d3ff","line-width":1},layout:{}},{id:"FloorSurface",source:"FloorSurface",type:"fill",paint:{"fill-color":"#292929","fill-outline-color":"#ffffff","fill-opacity":1}},{id:"FloorSurface_line",source:"FloorSurface",type:"line",paint:{"line-color":"#ffffff","line-width":1.5}},{id:"obj2_2d_line",source:"obj2_2d",type:"line",paint:{"line-color":"#ffffff","line-width":1.5}}]},center:[139.700925,35.691417],zoom:18,maxPitch:0,maxBounds:[[139.689,35.682],[139.712,35.7]]});fr.dragRotate.disable();const W5=new x0.NavigationControl({});fr.addControl(W5,"top-left");let Fx,ob;fetch("./location.svg").then(n=>n.text()).then(n=>{const t=document.createElement("div");t.className="location",t.innerHTML=n,ob=t}).catch(n=>{console.error("Failed to fetch SVG:",n)});const lb=(n,t,e)=>{const i=hk(n,t);ob.style.transform=`rotate(${e}deg)`,Fx?Fx.setLngLat(i).setRotation(e):Fx=new x0.Marker({element:ob}).setLngLat(i).addTo(fr).setRotation(e),fr.easeTo({center:i,duration:0,zoom:18}),fk(e,i[1],i[0])};let CT=fr.getCenter();bn.subscribe("showMapViewer",n=>{n?(CT=fr.getCenter(),fr.setPaintProperty("background","background-opacity",1)):(fr.setPaintProperty("background","background-opacity",.5),fr.easeTo({center:CT,duration:0}))});const zx=new _1,PT=new _1,q5=new _t(0,-1,0);class X5{constructor(t,e,i,s,l,c,o){ni(this,"model");ni(this,"mixer");ni(this,"animationsMap",new Map);ni(this,"orbitControl");ni(this,"zoomControls");ni(this,"camera");ni(this,"y",100);ni(this,"toggleRun",!0);ni(this,"currentAction");ni(this,"walkDirection",new _t);ni(this,"rotateAngle",new _t(0,1,0));ni(this,"rotateQuarternion",new _r);ni(this,"cameraTarget",new _t);ni(this,"fadeDuration",.2);ni(this,"runVelocity",7);this.model=t,this.mixer=e,this.animationsMap=i,this.currentAction=o,this.animationsMap.forEach((p,m)=>{m==o&&p.play()}),this.orbitControl=s,this.zoomControls=l,this.camera=c,this.updateTarget(),this.orbitControl.addEventListener("change",()=>{this.camera&&this.camera.updateProjectionMatrix()})}switchRunToggle(){this.toggleRun=!this.toggleRun}getPosition(){return this.model.position}checkCollision(t,e){const i=this.model.position.clone();i.y+=1;const s=this.walkDirection;return s.normalize(),zx.set(i,s),zx.far=e+.5,zx.intersectObject(t,!0).length>0}getFacingDirection(){const t=new _t;return this.model.getWorldDirection(t),t.normalize(),t}getModelRotationAngle(){const t=this.getFacingDirection(),e=Math.atan2(t.x,-t.z);return(hh.radToDeg(e)+360)%360}update(t,e,i,s){const l=e.x!==0||e.y!==0,o=this.getPosition().clone();o.y+=1.5,PT.set(o,q5);const p=PT.intersectObject(i,!0);let m=this.y;p.length>0&&(m=p[0].point.y,this.y=m);let x="";if(l&&this.toggleRun?x="run":x="agree",this.currentAction!=x){const v=this.animationsMap.get(x),b=this.animationsMap.get(this.currentAction);if(!b||!v)return;b.fadeOut(this.fadeDuration),v.reset().fadeIn(this.fadeDuration).play(),this.currentAction=x}if(this.mixer.update(t),this.currentAction=="run"){const v=Math.atan2(this.camera.position.x-this.model.position.x,this.camera.position.z-this.model.position.z);this.walkDirection.set(e.x,0,-e.y),this.walkDirection.normalize(),this.walkDirection.applyAxisAngle(this.rotateAngle,v);const E=this.runVelocity*t;if(this.checkCollision(s,E))return;const D=Math.atan2(this.walkDirection.x,this.walkDirection.z);this.rotateQuarternion.setFromAxisAngle(this.rotateAngle,D),this.model.quaternion.rotateTowards(this.rotateQuarternion,.2);const k=this.walkDirection.x*E,P=this.walkDirection.z*E;this.model.position.x+=k,this.model.position.z+=P,this.model.position.y=m,this.updateTarget();const I=this.getModelRotationAngle();lb(this.model.position.x,this.model.position.z,I)}else{const v=this.getModelRotationAngle();lb(this.model.position.x,this.model.position.z,v)}}updateTarget(){const t=new _t().subVectors(this.camera.position,this.orbitControl.target),e=this.model.position.y;this.cameraTarget.set(this.model.position.x,e+1,this.model.position.z),this.camera.position.copy(this.cameraTarget).add(t),this.orbitControl.target.copy(this.cameraTarget),this.zoomControls.target.copy(this.cameraTarget),this.orbitControl.update(),this.zoomControls.update(),this.camera.updateProjectionMatrix()}setModelPosition(t,e,i){this.model.position.set(t,e,i),this.updateTarget()}}const IT={triangulate:function(n,t,e=2){const i=t&&t.length,s=i?t[0]*e:n.length;let l=GA(n,0,s,e,!0);const c=[];if(!l||l.next===l.prev)return c;let o,p,m,x,v,b,E;if(i&&(l=J5(n,t,l,e)),n.length>80*e){o=m=n[0],p=x=n[1];for(let D=e;D<s;D+=e)v=n[D],b=n[D+1],v<o&&(o=v),b<p&&(p=b),v>m&&(m=v),b>x&&(x=b);E=Math.max(m-o,x-p),E=E!==0?32767/E:0}return Gp(l,c,e,o,p,E,0),c}};function GA(n,t,e,i,s){let l,c;if(s===c6(n,t,e,i)>0)for(l=t;l<e;l+=i)c=RT(l,n[l],n[l+1],c);else for(l=e-i;l>=t;l-=i)c=RT(l,n[l],n[l+1],c);return c&&v0(c,c.next)&&(jp(c),c=c.next),c}function dh(n,t){if(!n)return n;t||(t=n);let e=n,i;do if(i=!1,!e.steiner&&(v0(e,e.next)||On(e.prev,e,e.next)===0)){if(jp(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Gp(n,t,e,i,s,l,c){if(!n)return;!c&&l&&n6(n,i,s,l);let o=n,p,m;for(;n.prev!==n.next;){if(p=n.prev,m=n.next,l?Z5(n,i,s,l):$5(n)){t.push(p.i/e|0),t.push(n.i/e|0),t.push(m.i/e|0),jp(n),n=m.next,o=m.next;continue}if(n=m,n===o){c?c===1?(n=Y5(dh(n),t,e),Gp(n,t,e,i,s,l,2)):c===2&&K5(n,t,e,i,s,l):Gp(dh(n),t,e,i,s,l,1);break}}}function $5(n){const t=n.prev,e=n,i=n.next;if(On(t,e,i)>=0)return!1;const s=t.x,l=e.x,c=i.x,o=t.y,p=e.y,m=i.y,x=s<l?s<c?s:c:l<c?l:c,v=o<p?o<m?o:m:p<m?p:m,b=s>l?s>c?s:c:l>c?l:c,E=o>p?o>m?o:m:p>m?p:m;let D=i.next;for(;D!==t;){if(D.x>=x&&D.x<=b&&D.y>=v&&D.y<=E&&ju(s,o,l,p,c,m,D.x,D.y)&&On(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function Z5(n,t,e,i){const s=n.prev,l=n,c=n.next;if(On(s,l,c)>=0)return!1;const o=s.x,p=l.x,m=c.x,x=s.y,v=l.y,b=c.y,E=o<p?o<m?o:m:p<m?p:m,D=x<v?x<b?x:b:v<b?v:b,k=o>p?o>m?o:m:p>m?p:m,P=x>v?x>b?x:b:v>b?v:b,I=cb(E,D,t,e,i),V=cb(k,P,t,e,i);let U=n.prevZ,B=n.nextZ;for(;U&&U.z>=I&&B&&B.z<=V;){if(U.x>=E&&U.x<=k&&U.y>=D&&U.y<=P&&U!==s&&U!==c&&ju(o,x,p,v,m,b,U.x,U.y)&&On(U.prev,U,U.next)>=0||(U=U.prevZ,B.x>=E&&B.x<=k&&B.y>=D&&B.y<=P&&B!==s&&B!==c&&ju(o,x,p,v,m,b,B.x,B.y)&&On(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;U&&U.z>=I;){if(U.x>=E&&U.x<=k&&U.y>=D&&U.y<=P&&U!==s&&U!==c&&ju(o,x,p,v,m,b,U.x,U.y)&&On(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;B&&B.z<=V;){if(B.x>=E&&B.x<=k&&B.y>=D&&B.y<=P&&B!==s&&B!==c&&ju(o,x,p,v,m,b,B.x,B.y)&&On(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function Y5(n,t,e){let i=n;do{const s=i.prev,l=i.next.next;!v0(s,l)&&HA(s,i,i.next,l)&&Hp(s,l)&&Hp(l,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),jp(i),jp(i.next),i=n=l),i=i.next}while(i!==n);return dh(i)}function K5(n,t,e,i,s,l){let c=n;do{let o=c.next.next;for(;o!==c.prev;){if(c.i!==o.i&&a6(c,o)){let p=jA(c,o);c=dh(c,c.next),p=dh(p,p.next),Gp(c,t,e,i,s,l,0),Gp(p,t,e,i,s,l,0);return}o=o.next}c=c.next}while(c!==n)}function J5(n,t,e,i){const s=[];let l,c,o,p,m;for(l=0,c=t.length;l<c;l++)o=t[l]*i,p=l<c-1?t[l+1]*i:n.length,m=GA(n,o,p,i,!1),m===m.next&&(m.steiner=!0),s.push(r6(m));for(s.sort(Q5),l=0;l<s.length;l++)e=t6(s[l],e);return e}function Q5(n,t){return n.x-t.x}function t6(n,t){const e=e6(n,t);if(!e)return t;const i=jA(e,n);return dh(i,i.next),dh(e,e.next)}function e6(n,t){let e=t,i=-1/0,s;const l=n.x,c=n.y;do{if(c<=e.y&&c>=e.next.y&&e.next.y!==e.y){const b=e.x+(c-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(b<=l&&b>i&&(i=b,s=e.x<e.next.x?e:e.next,b===l))return s}e=e.next}while(e!==t);if(!s)return null;const o=s,p=s.x,m=s.y;let x=1/0,v;e=s;do l>=e.x&&e.x>=p&&l!==e.x&&ju(c<m?l:i,c,p,m,c<m?i:l,c,e.x,e.y)&&(v=Math.abs(c-e.y)/(l-e.x),Hp(e,n)&&(v<x||v===x&&(e.x>s.x||e.x===s.x&&i6(s,e)))&&(s=e,x=v)),e=e.next;while(e!==o);return s}function i6(n,t){return On(n.prev,n,t.prev)<0&&On(t.next,n,n.next)<0}function n6(n,t,e,i){let s=n;do s.z===0&&(s.z=cb(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,s6(s)}function s6(n){let t,e,i,s,l,c,o,p,m=1;do{for(e=n,n=null,l=null,c=0;e;){for(c++,i=e,o=0,t=0;t<m&&(o++,i=i.nextZ,!!i);t++);for(p=m;o>0||p>0&&i;)o!==0&&(p===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,o--):(s=i,i=i.nextZ,p--),l?l.nextZ=s:n=s,s.prevZ=l,l=s;e=i}l.nextZ=null,m*=2}while(c>1);return n}function cb(n,t,e,i,s){return n=(n-e)*s|0,t=(t-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function r6(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function ju(n,t,e,i,s,l,c,o){return(s-c)*(t-o)>=(n-c)*(l-o)&&(n-c)*(i-o)>=(e-c)*(t-o)&&(e-c)*(l-o)>=(s-c)*(i-o)}function a6(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!o6(n,t)&&(Hp(n,t)&&Hp(t,n)&&l6(n,t)&&(On(n.prev,n,t.prev)||On(n,t.prev,t))||v0(n,t)&&On(n.prev,n,n.next)>0&&On(t.prev,t,t.next)>0)}function On(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function v0(n,t){return n.x===t.x&&n.y===t.y}function HA(n,t,e,i){const s=tg(On(n,t,e)),l=tg(On(n,t,i)),c=tg(On(e,i,n)),o=tg(On(e,i,t));return!!(s!==l&&c!==o||s===0&&Q_(n,e,t)||l===0&&Q_(n,i,t)||c===0&&Q_(e,n,i)||o===0&&Q_(e,t,i))}function Q_(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function tg(n){return n>0?1:n<0?-1:0}function o6(n,t){let e=n;do{if(e.i!==n.i&&e.next.i!==n.i&&e.i!==t.i&&e.next.i!==t.i&&HA(e,e.next,n,t))return!0;e=e.next}while(e!==n);return!1}function Hp(n,t){return On(n.prev,n,n.next)<0?On(n,t,n.next)>=0&&On(n,n.prev,t)>=0:On(n,t,n.prev)<0||On(n,n.next,t)<0}function l6(n,t){let e=n,i=!1;const s=(n.x+t.x)/2,l=(n.y+t.y)/2;do e.y>l!=e.next.y>l&&e.next.y!==e.y&&s<(e.next.x-e.x)*(l-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==n);return i}function jA(n,t){const e=new hb(n.i,n.x,n.y),i=new hb(t.i,t.x,t.y),s=n.next,l=t.prev;return n.next=t,t.prev=n,e.next=s,s.prev=e,i.next=e,e.prev=i,l.next=i,i.prev=l,i}function RT(n,t,e,i){const s=new hb(n,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function jp(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function hb(n,t,e){this.i=n,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function c6(n,t,e,i){let s=0;for(let l=t,c=e-i;l<e;l+=i)s+=(n[c]-n[l])*(n[l+1]+n[c+1]),c=l;return s}const Kf=4,Jf=4,cm=4,Ol=new Int32Array(2),DT=new Float32Array(Ol.buffer),LT=new Float64Array(Ol.buffer),eg=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ub;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(ub||(ub={}));class Wo{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Wo(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Ol[0]=this.readInt32(t),DT[0]}readFloat64(t){return Ol[eg?0:1]=this.readInt32(t),Ol[eg?1:0]=this.readInt32(t+4),LT[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){DT[0]=e,this.writeInt32(t,Ol[0])}writeFloat64(t,e){LT[0]=e,this.writeInt32(t,Ol[eg?0:1]),this.writeInt32(t+4,Ol[eg?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Kf+Jf)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Jf;e++)t+=String.fromCharCode(this.readInt8(this.position_+Kf+e));return t}__offset(t,e){const i=t-this.readInt32(t);return e<this.readInt16(i)?this.readInt16(i+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const i=this.readInt32(t);t+=Kf;const s=this.bytes_.subarray(t,t+i);return e===ub.UTF8_BYTES?s:this.text_decoder_.decode(s)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Kf}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Jf)throw new Error("FlatBuffers: file identifier must be length "+Jf);for(let e=0;e<Jf;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Kf+e))return!1;return!0}createScalarList(t,e){const i=[];for(let s=0;s<e;++s){const l=t(s);l!==null&&i.push(l)}return i}createObjList(t,e){const i=[];for(let s=0;s<e;++s){const l=t(s);l!==null&&i.push(l.unpack())}return i}}const v1=new Uint8Array(0);function h6(){return this._source.cancel()}function u6(n,t){if(!n.length)return t;if(!t.length)return n;var e=new Uint8Array(n.length+t.length);return e.set(n),e.set(t,n.length),e}function d6(){var n=this,t=n._array.subarray(n._index);return n._source.read().then(function(e){return n._array=v1,n._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:u6(t,e.value)}})}function f6(n){if((n|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var i=new Uint8Array(n);return i.set(this._array.subarray(this._index)),function s(){return t._source.read().then(function(l){return l.done?(t._array=v1,t._index=0,e>0?i.subarray(0,e):null):e+l.value.length>=n?(t._array=l.value,t._index=n-e,i.set(l.value.subarray(0,n-e),e),i):(i.set(l.value,e),e+=l.value.length,s())})}()}function p6(n){return typeof n.slice=="function"?n:new b0(typeof n.read=="function"?n:n.getReader())}function b0(n){this._source=n,this._array=v1,this._index=0}b0.prototype.read=d6;b0.prototype.slice=f6;b0.prototype.cancel=h6;var Qi,Rs=((Qi={})[Qi.Byte=0]="Byte",Qi[Qi.UByte=1]="UByte",Qi[Qi.Bool=2]="Bool",Qi[Qi.Short=3]="Short",Qi[Qi.UShort=4]="UShort",Qi[Qi.Int=5]="Int",Qi[Qi.UInt=6]="UInt",Qi[Qi.Long=7]="Long",Qi[Qi.ULong=8]="ULong",Qi[Qi.Float=9]="Float",Qi[Qi.Double=10]="Double",Qi[Qi.String=11]="String",Qi[Qi.Json=12]="Json",Qi[Qi.DateTime=13]="DateTime",Qi[Qi.Binary=14]="Binary",Qi);class vs{constructor(){ni(this,"bb",null);ni(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new vs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+cm),(e||new vs).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Rs.Byte}title(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){let t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}unique(){let t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}primaryKey(){let t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}metadata(t){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,Rs.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){let e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,i,s,l,c,o,p,m,x,v,b){return vs.startColumn(t),vs.addName(t,e),vs.addType(t,i),vs.addTitle(t,s),vs.addDescription(t,l),vs.addWidth(t,c),vs.addPrecision(t,o),vs.addScale(t,p),vs.addNullable(t,m),vs.addUnique(t,x),vs.addPrimaryKey(t,v),vs.addMetadata(t,b),vs.endColumn(t)}}class _a{constructor(){ni(this,"bb",null);ni(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new _a).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+cm),(e||new _a).__init(t.readInt32(t.position())+t.position(),t)}org(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,i,s,l,c,o){return _a.startCrs(t),_a.addOrg(t,e),_a.addCode(t,i),_a.addName(t,s),_a.addDescription(t,l),_a.addWkt(t,c),_a.addCodeString(t,o),_a.endCrs(t)}}var Ui,Xs=((Ui={})[Ui.Unknown=0]="Unknown",Ui[Ui.Point=1]="Point",Ui[Ui.LineString=2]="LineString",Ui[Ui.Polygon=3]="Polygon",Ui[Ui.MultiPoint=4]="MultiPoint",Ui[Ui.MultiLineString=5]="MultiLineString",Ui[Ui.MultiPolygon=6]="MultiPolygon",Ui[Ui.GeometryCollection=7]="GeometryCollection",Ui[Ui.CircularString=8]="CircularString",Ui[Ui.CompoundCurve=9]="CompoundCurve",Ui[Ui.CurvePolygon=10]="CurvePolygon",Ui[Ui.MultiCurve=11]="MultiCurve",Ui[Ui.MultiSurface=12]="MultiSurface",Ui[Ui.Curve=13]="Curve",Ui[Ui.Surface=14]="Surface",Ui[Ui.PolyhedralSurface=15]="PolyhedralSurface",Ui[Ui.TIN=16]="TIN",Ui[Ui.Triangle=17]="Triangle",Ui);class Xg{constructor(){ni(this,"bb",null);ni(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new Xg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+cm),(e||new Xg).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}envelopeLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Xs.Unknown}hasZ(){let t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasM(){let t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasT(){let t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasTm(){let t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}columns(t,e){let i=this.bb.__offset(this.bb_pos,18);return i?(e||new vs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){let e=this.bb.__offset(this.bb_pos,24);return e?(t||new _a).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){let e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,Xs.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}class or{constructor(){ni(this,"bb",null);ni(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new or).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+cm),(e||new or).__init(t.readInt32(t.position())+t.position(),t)}ends(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}endsLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){let t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}xyLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}zLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){let t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}mLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){let t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}tLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){let t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}tmLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):Xs.Unknown}parts(t,e){let i=this.bb.__offset(this.bb_pos,18);return i?(e||new or).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}partsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addInt64(e[i]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,Xs.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,i,s,l,c,o,p,m){return or.startGeometry(t),or.addEnds(t,e),or.addXy(t,i),or.addZ(t,s),or.addM(t,l),or.addT(t,c),or.addTm(t,o),or.addType(t,p),or.addParts(t,m),or.endGeometry(t)}}class Oa{constructor(){ni(this,"bb",null);ni(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new Oa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+cm),(e||new Oa).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){let e=this.bb.__offset(this.bb_pos,4);return e?(t||new or).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){let i=this.bb.__offset(this.bb_pos,8);return i?(e||new vs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let i=e.length-1;i>=0;i--)t.addInt8(e[i]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,i,s){return Oa.startFeature(t),Oa.addGeometry(t,e),Oa.addProperties(t,i),Oa.addColumns(t,s),Oa.endFeature(t)}}function b1(n){let t=Xg.getRootAsHeader(n),e=t.featuresCount(),i=t.indexNodeSize(),s=[];for(let o=0;o<t.columnsLength();o++){let p=t.columns(o);if(!p)throw Error("Column unexpectedly missing");if(!p.name())throw Error("Column name unexpectedly missing");s.push({name:p.name(),type:p.type(),title:p.title(),description:p.description(),width:p.width(),precision:p.precision(),scale:p.scale(),nullable:p.nullable(),unique:p.unique(),primary_key:p.primaryKey()})}let l=t.crs(),c=l?{org:l.org(),code:l.code(),name:l.name(),description:l.description(),wkt:l.wkt(),code_string:l.codeString()}:null;return{geometryType:t.geometryType(),columns:s,envelope:null,featuresCount:Number(e),indexNodeSize:i,crs:c,title:t.title(),description:t.description(),metadata:t.metadata()}}function Ox(n,t){let e=[];for(let i=0;i<n.length;i+=2){let s=[n[i],n[i+1]];t&&s.push(t[i>>1]),e.push(s)}return e}new TextEncoder;let kT=new TextDecoder;function m6(n,t){let e={};if(!t||t.length===0)return e;let i=n.propertiesArray();if(!i)return e;let s=new DataView(i.buffer,i.byteOffset),l=n.propertiesLength(),c=0;for(;c<l;){let o=s.getUint16(c,!0);c+=2;let p=t[o],m=p.name;switch(p.type){case Rs.Bool:e[m]=!!s.getUint8(c),c+=1;break;case Rs.Byte:e[m]=s.getInt8(c),c+=1;break;case Rs.UByte:e[m]=s.getUint8(c),c+=1;break;case Rs.Short:e[m]=s.getInt16(c,!0),c+=2;break;case Rs.UShort:e[m]=s.getUint16(c,!0),c+=2;break;case Rs.Int:e[m]=s.getInt32(c,!0),c+=4;break;case Rs.UInt:e[m]=s.getUint32(c,!0),c+=4;break;case Rs.Long:e[m]=Number(s.getBigInt64(c,!0)),c+=8;break;case Rs.ULong:e[m]=Number(s.getBigUint64(c,!0)),c+=8;break;case Rs.Float:e[m]=s.getFloat32(c,!0),c+=4;break;case Rs.Double:e[m]=s.getFloat64(c,!0),c+=8;break;case Rs.DateTime:case Rs.String:{let x=s.getUint32(c,!0);c+=4,e[m]=kT.decode(i.subarray(c,c+x)),c+=x;break}case Rs.Json:{let x=s.getUint32(c,!0);c+=4;let v=kT.decode(i.subarray(c,c+x));e[m]=JSON.parse(v),c+=x;break}case Rs.Binary:{let x=s.getUint32(c,!0);c+=4,e[m]=i.subarray(c,c+x),c+=x;break}default:throw Error("Unknown type "+p.type)}}return e}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var db=function(n,t){return db=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])},db(n,t)};function _6(n,t){db(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function bd(n,t,e,i){function s(l){return l instanceof e?l:new e(function(c){c(l)})}return new(e||(e=Promise))(function(l,c){function o(x){try{m(i.next(x))}catch(v){c(v)}}function p(x){try{m(i.throw(x))}catch(v){c(v)}}function m(x){x.done?l(x.value):s(x.value).then(o,p)}m((i=i.apply(n,[])).next())})}function ec(n,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,s,l,c;return c={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function o(m){return function(x){return p([m,x])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(l=m[0]&2?s.return:m[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,m[1])).done)return l;switch(s=0,l&&(m=[m[0]&2,l.value]),m[0]){case 0:case 1:l=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,s=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(m[0]===6||m[0]===2)){e=0;continue}if(m[0]===3&&(!l||m[1]>l[0]&&m[1]<l[3])){e.label=m[1];break}if(m[0]===6&&e.label<l[1]){e.label=l[1],l=m;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(m);break}l[2]&&e.ops.pop(),e.trys.pop();continue}m=t.call(n,e)}catch(x){m=[6,x],s=0}finally{i=l=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function kd(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wp(n){return this instanceof Wp?(this.v=n,this):new Wp(n)}function g6(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(n,t||[]),s,l=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(b){i[b]&&(s[b]=function(E){return new Promise(function(D,k){l.push([b,E,D,k])>1||o(b,E)})})}function o(b,E){try{p(i[b](E))}catch(D){v(l[0][3],D)}}function p(b){b.value instanceof Wp?Promise.resolve(b.value.v).then(m,x):v(l[0][2],b)}function m(b){o("next",b)}function x(b){o("throw",b)}function v(b,E){b(E),l.shift(),l.length&&o(l[0][0],l[0][1])}}var WA=function(n){_6(t,n);function t(e){var i=n.call(this,e)||this;return Object.defineProperty(i,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(i,i.constructor.prototype):i.__proto__=i.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(i,i.constructor),i}return t}(Error);(function(){function n(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),n.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();function fb(n){n!=null&&typeof n.then=="function"&&n.then(Yg,Yg)}var Bx=0,FT=1,fh=2,$g=3,pb=4,Zg=1024,Yg=function(){};function id(n){var t=n.err,e=Promise.resolve(n.execution).then(function(i){if(t!=null)throw t;return i});return n.err=void 0,n.execution=e.then(function(){},function(){}),n.pending===void 0?e:n.pending.then(function(){return e})}function th(n,t){var e=n.state>=$g;return Promise.resolve(t).then(function(i){return!e&&n.state>=pb?id(n).then(function(s){return{value:s,done:!0}}):{value:i,done:e}})}function w1(n,t){var e,i;if(!(n.state>=fh))if(n.state=fh,n.onnext(),n.onstop(),n.err==null&&(n.err=t),n.pushes.length===0&&(typeof n.buffer>"u"||n.buffer.empty))Cp(n);else try{for(var s=kd(n.pushes),l=s.next();!l.done;l=s.next()){var c=l.value;c.resolve()}}catch(o){e={error:o}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}}function Cp(n){var t,e;if(!(n.state>=$g)){n.state<fh&&w1(n),n.state=$g,n.buffer=void 0;try{for(var i=kd(n.nexts),s=i.next();!s.done;s=i.next()){var l=s.value,c=n.pending===void 0?id(n):n.pending.then(function(){return id(n)});l.resolve(th(n,c))}}catch(o){t={error:o}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}n.pushes=[],n.nexts=[]}}function zT(n){n.state>=pb||(n.state<$g&&Cp(n),n.state=pb)}function y6(n,t){if(fb(t),n.pushes.length>=Zg)throw new WA("No more than "+Zg+" pending calls to push are allowed on a single repeater.");if(n.state>=fh)return Promise.resolve(void 0);var e=n.pending===void 0?Promise.resolve(t):n.pending.then(function(){return t});e=e.catch(function(p){n.state<fh&&(n.err=p),zT(n)});var i;if(n.nexts.length){var s=n.nexts.shift();s.resolve(th(n,e)),n.nexts.length?i=Promise.resolve(n.nexts[0].value):typeof n.buffer<"u"&&!n.buffer.full?i=Promise.resolve(void 0):i=new Promise(function(p){return n.onnext=p})}else typeof n.buffer<"u"&&!n.buffer.full?(n.buffer.add(e),i=Promise.resolve(void 0)):i=new Promise(function(p){return n.pushes.push({resolve:p,value:e})});var l=!0,c={},o=i.catch(function(p){if(l)throw p});return c.then=function(p,m){return l=!1,Promise.prototype.then.call(i,p,m)},c.catch=function(p){return l=!1,Promise.prototype.catch.call(i,p)},c.finally=i.finally.bind(i),n.pending=e.then(function(){return o}).catch(function(p){n.err=p,zT(n)}),c}function x6(n){var t=w1.bind(null,n),e=new Promise(function(i){return n.onstop=i});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function v6(n){if(!(n.state>=FT)){n.state=FT;var t=y6.bind(null,n),e=x6(n);n.execution=new Promise(function(i){return i(n.executor(t,e))}),n.execution.catch(function(){return w1(n)})}}var ig=new WeakMap,hm=function(){function n(t,e){ig.set(this,{executor:t,buffer:e,err:void 0,state:Bx,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Yg,onstop:Yg})}return n.prototype.next=function(t){fb(t);var e=ig.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=Zg)throw new WA("No more than "+Zg+" pending calls to next are allowed on a single repeater.");if(e.state<=Bx&&v6(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var i=th(e,e.buffer.remove());if(e.pushes.length){var s=e.pushes.shift();e.buffer.add(s.value),e.onnext=s.resolve}return i}else if(e.pushes.length){var l=e.pushes.shift();return e.onnext=l.resolve,th(e,l.value)}else if(e.state>=fh)return Cp(e),th(e,id(e));return new Promise(function(c){return e.nexts.push({resolve:c,value:t})})},n.prototype.return=function(t){fb(t);var e=ig.get(this);if(e===void 0)throw new Error("WeakMap error");return Cp(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),th(e,id(e))},n.prototype.throw=function(t){var e=ig.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=Bx||e.state>=fh||typeof e.buffer<"u"&&!e.buffer.empty?(Cp(e),e.err==null&&(e.err=t),th(e,id(e))):this.next(Promise.reject(t))},n.prototype[Symbol.asyncIterator]=function(){return this},n.race=b6,n.merge=w6,n.zip=M6,n.latest=S6,n}();function w0(n,t){var e,i,s=[],l=function(m){m!=null&&typeof m[Symbol.asyncIterator]=="function"?s.push(m[Symbol.asyncIterator]()):m!=null&&typeof m[Symbol.iterator]=="function"?s.push(m[Symbol.iterator]()):s.push(function(){return g6(this,arguments,function(){return ec(this,function(b){switch(b.label){case 0:return t.yieldValues?[4,Wp(m)]:[3,3];case 1:return[4,b.sent()];case 2:b.sent(),b.label=3;case 3:return t.returnValues?[4,Wp(m)]:[3,5];case 4:return[2,b.sent()];case 5:return[2]}})})}())};try{for(var c=kd(n),o=c.next();!o.done;o=c.next()){var p=o.value;l(p)}}catch(m){e={error:m}}finally{try{o&&!o.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}return s}function b6(n){var t=this,e=w0(n,{returnValues:!0});return new hm(function(i,s){return bd(t,void 0,void 0,function(){var l,c,o,p,m,x;return ec(this,function(v){switch(v.label){case 0:if(!e.length)return s(),[2];c=!1,s.then(function(){l(),c=!0}),v.label=1;case 1:v.trys.push([1,,5,7]),p=void 0,m=0,x=function(){var b,E,D,k,P,I;return ec(this,function(V){switch(V.label){case 0:b=m;try{for(E=(P=void 0,kd(e)),D=E.next();!D.done;D=E.next())k=D.value,Promise.resolve(k.next()).then(function(U){U.done?(s(),o===void 0&&(o=U)):m===b&&(m++,l(U))},function(U){return s(U)})}catch(U){P={error:U}}finally{try{D&&!D.done&&(I=E.return)&&I.call(E)}finally{if(P)throw P.error}}return[4,new Promise(function(U){return l=U})];case 1:return p=V.sent(),p===void 0?[3,3]:[4,i(p.value)];case 2:V.sent(),V.label=3;case 3:return[2]}})},v.label=2;case 2:return c?[3,4]:[5,x()];case 3:return v.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return s(),[4,Promise.race(e.map(function(b){return b.return&&b.return()}))];case 6:return v.sent(),[7];case 7:return[2]}})})})}function w6(n){var t=this,e=w0(n,{yieldValues:!0});return new hm(function(i,s){return bd(t,void 0,void 0,function(){var l,c,o,p=this;return ec(this,function(m){switch(m.label){case 0:if(!e.length)return s(),[2];l=[],c=!1,s.then(function(){var x,v;c=!0;try{for(var b=kd(l),E=b.next();!E.done;E=b.next()){var D=E.value;D()}}catch(k){x={error:k}}finally{try{E&&!E.done&&(v=b.return)&&v.call(b)}finally{if(x)throw x.error}}}),m.label=1;case 1:return m.trys.push([1,,3,4]),[4,Promise.all(e.map(function(x,v){return bd(p,void 0,void 0,function(){var b,E;return ec(this,function(D){switch(D.label){case 0:D.trys.push([0,,6,9]),D.label=1;case 1:return c?[3,5]:(Promise.resolve(x.next()).then(function(k){return l[v](k)},function(k){return s(k)}),[4,new Promise(function(k){l[v]=k})]);case 2:return b=D.sent(),b===void 0?[3,4]:b.done?(o=b,[2]):[4,i(b.value)];case 3:D.sent(),D.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return E=x.return,E?[4,x.return()]:[3,8];case 7:E=D.sent(),D.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return m.sent(),[2,o&&o.value];case 3:return s(),[7];case 4:return[2]}})})})}function M6(n){var t=this,e=w0(n,{returnValues:!0});return new hm(function(i,s){return bd(t,void 0,void 0,function(){var l,c,o,p;return ec(this,function(m){switch(m.label){case 0:if(!e.length)return s(),[2,[]];c=!1,s.then(function(){l(),c=!0}),m.label=1;case 1:m.trys.push([1,,6,8]),m.label=2;case 2:return c?[3,5]:(Promise.all(e.map(function(x){return x.next()})).then(function(x){return l(x)},function(x){return s(x)}),[4,new Promise(function(x){return l=x})]);case 3:return o=m.sent(),o===void 0?[2]:(p=o.map(function(x){return x.value}),o.some(function(x){return x.done})?[2,p]:[4,i(p)]);case 4:return m.sent(),[3,2];case 5:return[3,8];case 6:return s(),[4,Promise.all(e.map(function(x){return x.return&&x.return()}))];case 7:return m.sent(),[7];case 8:return[2]}})})})}function S6(n){var t=this,e=w0(n,{yieldValues:!0,returnValues:!0});return new hm(function(i,s){return bd(t,void 0,void 0,function(){var l,c,o,p,m,x=this;return ec(this,function(v){switch(v.label){case 0:if(!e.length)return s(),[2,[]];c=[],o=!1,s.then(function(){var b,E;l();try{for(var D=kd(c),k=D.next();!k.done;k=D.next()){var P=k.value;P()}}catch(I){b={error:I}}finally{try{k&&!k.done&&(E=D.return)&&E.call(D)}finally{if(b)throw b.error}}o=!0}),v.label=1;case 1:return v.trys.push([1,,5,7]),Promise.all(e.map(function(b){return b.next()})).then(function(b){return l(b)},function(b){return s(b)}),[4,new Promise(function(b){return l=b})];case 2:return p=v.sent(),p===void 0?[2]:(m=p.map(function(b){return b.value}),p.every(function(b){return b.done})?[2,m]:[4,i(m.slice())]);case 3:return v.sent(),[4,Promise.all(e.map(function(b,E){return bd(x,void 0,void 0,function(){var D;return ec(this,function(k){switch(k.label){case 0:if(p[E].done)return[2,p[E].value];k.label=1;case 1:return o?[3,4]:(Promise.resolve(b.next()).then(function(P){return c[E](P)},function(P){return s(P)}),[4,new Promise(function(P){return c[E]=P})]);case 2:return D=k.sent(),D===void 0?[2,p[E].value]:D.done?[2,D.value]:(m[E]=D.value,[4,i(m.slice())]);case 3:return k.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,v.sent()];case 5:return s(),[4,Promise.all(e.map(function(b){return b.return&&b.return()}))];case 6:return v.sent(),[7];case 7:return[2]}})})})}const c0=class c0{constructor(){ni(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}};ni(c0,"global",new c0);let Kg=c0;const T6=40,E6=16;function M1(n,t){t=Math.min(Math.max(+t,2),65535);let e=n,i=e;do i+=e=Math.ceil(e/t);while(e!==1);return 40*i}function A6(n,t){if(t<2)throw Error("Node size must be at least 2");if(n===0)throw Error("Number of items must be greater than 0");let e=n,i=e,s=[e];do i+=e=Math.ceil(e/t),s.push(e);while(e!==1);let l=[];for(let o of(e=i,s))l.push(e-o),e-=o;let c=[];for(let o=0;o<s.length;o++)c.push([l[o],l[o]+s[o]]);return c}async function*C6(n,t,e,i){class s{constructor(E,D){ni(this,"_level");ni(this,"nodes");this._level=D,this.nodes=E}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(E){this.nodes[1]=E}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:l,minY:c,maxX:o,maxY:p}=e,m=A6(n,t),x=m[0][0],v=[new s([0,1],m.length-1)];for(;v.length!=0;){let b=v.shift(),E=b.startNodeIdx(),D=E>=x,k=(()=>{let[,V]=m[b.level()],U=Math.min(b.endNodeIdx()+t,V);return D&&U<V?U+1:U})(),P=k-E,I=new DataView(await i(40*E,40*P));for(let V=E;V<k;V++){let U=V-E,B=40*U;if(o<I.getFloat64(B+0,!0)||p<I.getFloat64(B+8,!0)||l>I.getFloat64(B+16,!0)||c>I.getFloat64(B+24,!0))continue;let Z=I.getBigUint64(B+32,!0);if(D){let q=(()=>{if(!(V<n-1))return null;{let ct=(U+1)*40;return I.getBigUint64(ct+32,!0)-Z}})(),J=V-x;yield[Number(Z),J,Number(q)];continue}let Y=Kg.global.extraRequestThreshold()/40,K=v[v.length-1];if(K!==void 0&&K.level()==b.level()-1&&Z<K.endNodeIdx()+Y){K.extendEndNodeIdx(Number(Z));continue}let nt=(()=>{let q=b.level()-1;return new s([Number(Z),Number(Z)+1],q)})();K!==void 0&&(K.level(),nt.level()),v.push(nt)}}}const ih=new Uint8Array([102,103,98,3,102,103,98,0]),Vo=4;class S1{constructor(t,e,i,s,l){ni(this,"headerClient");ni(this,"header");ni(this,"headerLength");ni(this,"indexLength");ni(this,"nocache");this.headerClient=t,this.header=e,this.headerLength=i,this.indexLength=s,this.nocache=l}static async open(t,e){let i,s=new OT(t,e),l=2024+(()=>{let m,x=0;for(m=0;m<3;m++)x+=E6**m*T6;return x})();if(!new Uint8Array(await s.getRange(0,8,l,"header")).subarray(0,3).every((m,x)=>ih[x]===m))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,l,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let c=await s.getRange(12,i,l,"header"),o=b1(new Wo(new Uint8Array(c))),p=M1(o.featuresCount,o.indexNodeSize);return new S1(s,o,i,p,e)}async*selectBbox(t){let e=this.lengthBeforeTree(),i=this.headerClient,s=async function(p,m){return i.getRange(e+p,m,0,"index")},l=[],c=[];for await(let p of C6(this.header.featuresCount,this.header.indexNodeSize,t,s)){let[m,x]=p,[,,v]=p;if(v||(v=4),c.length==0){c.push([m,v,x]);continue}let b=c[c.length-1];m-(b[0]+b[1])>Kg.global.extraRequestThreshold()&&(l.push(c),c=[]),c.push([m,v,x])}this.headerClient.logUsage("header+index"),c.length>0&&l.push(c);let o=l.flatMap(p=>this.readFeatureBatch(p,this.nocache));yield*hm.merge(o)}lengthBeforeTree(){return ih.length+Vo+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new OT(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){let[i]=t[0],[s,l]=t[t.length-1],c=this.buildFeatureClient(e),o=s+l-i;for(let[p,,m]of t){let x=await this.readFeature(c,p,o);yield{id:m,feature:x},o=0}c.logUsage("feature")}async readFeature(t,e,i){let s,l=e+this.lengthBeforeFeatures();s=new DataView(await t.getRange(l,4,i,"feature length")).getUint32(0,!0);let c=new Uint8Array(await t.getRange(l+4,s,i,"feature data")),o=new Uint8Array(s+Vo);o.set(c,Vo);let p=new Wo(o);return p.setPosition(Vo),Oa.getRootAsFeature(p)}}class OT{constructor(t,e){ni(this,"httpClient");ni(this,"bytesEverUsed",0);ni(this,"bytesEverFetched",0);ni(this,"buffer",new ArrayBuffer(0));ni(this,"head",0);if(typeof t=="string")this.httpClient=new BT(t,e);else if(t instanceof BT)this.httpClient=t;else throw Error("Unknown source ")}async getRange(t,e,i,s){this.bytesEverUsed+=e;let l=t-this.head,c=l+e;if(l>=0&&c<=this.buffer.byteLength)return this.buffer.slice(l,c);let o=Math.max(e,i);return this.bytesEverFetched+=o,this.buffer=await this.httpClient.getRange(t,o,s),this.head=t,this.buffer.slice(0,e)}logUsage(t){t.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class BT{constructor(t,e){ni(this,"url");ni(this,"nocache");ni(this,"requestsEverMade",0);ni(this,"bytesEverRequested",0);this.url=t,this.nocache=e}async getRange(t,e,i){this.requestsEverMade+=1,this.bytesEverRequested+=e;let s={Range:`bytes=${t}-${t+e-1}`};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}function P6(n,t,e){if(!n.subarray(0,3).every((x,v)=>ih[v]===x))throw Error("Not a FlatGeobuf file");let i=new Wo(n),s=i.readUint32(ih.length);i.setPosition(ih.length+Vo);let l=b1(i),c=ih.length+Vo+s,{indexNodeSize:o,featuresCount:p}=l;o>0&&(c+=M1(p,o));let m=[];for(;c<i.capacity();){let x=i.readUint32(c);i.setPosition(c+Vo);let v=Oa.getRootAsFeature(i);m.push(t(m.length,v,l)),c+=Vo+x}return m}async function*I6(n,t,e){let i,s=p6(n),l=async E=>await s.slice(E),c=new Uint8Array(await l(8));if(!c.subarray(0,3).every((E,D)=>ih[D]===E))throw Error("Not a FlatGeobuf file");c=new Uint8Array(await l(4));let o=new Wo(c),p=o.readUint32(0);c=new Uint8Array(await l(p));let m=b1(o=new Wo(c)),{indexNodeSize:x,featuresCount:v}=m;if(x>0){let E=M1(v,x);await l(E)}let b=0;for(;i=await D6(l,m,t,b++);)yield i}async function*R6(n,t,e,i,s=!1){let l=await S1.open(n,s);for await(let c of l.selectBbox(t))yield e(c.id,c.feature,l.header)}async function D6(n,t,e,i){let s=new Uint8Array(await n(4,"feature length"));if(s.byteLength===0)return;let l=new Wo(s),c=l.readUint32(0);s=new Uint8Array(await n(c,"feature data"));let o=new Uint8Array(c+4);return o.set(s,4),(l=new Wo(o)).setPosition(Vo),e(i,Oa.getRootAsFeature(l),t)}const L6={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class qA{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||L6[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const um=6378137,Wu=Math.PI*um,k6=[-Wu,-Wu,Wu,Wu],F6=[-180,-85,180,85],ng=um*Math.log(Math.tan(Math.PI/2));class Eu extends qA{constructor(t){super({code:t,units:"m",extent:k6,global:!0,worldExtent:F6,getPointResolution:function(e,i){return e/Math.cosh(i[1]/um)}})}}const NT=[new Eu("EPSG:3857"),new Eu("EPSG:102100"),new Eu("EPSG:102113"),new Eu("EPSG:900913"),new Eu("http://www.opengis.net/def/crs/EPSG/0/3857"),new Eu("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z6(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let l=0;l<s;l+=i){t[l]=Wu*n[l]/180;let c=um*Math.log(Math.tan(Math.PI*(+n[l+1]+90)/360));c>ng?c=ng:c<-ng&&(c=-ng),t[l+1]=c}return t}function O6(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let l=0;l<s;l+=i)t[l]=180*n[l]/Wu,t[l+1]=360*Math.atan(Math.exp(n[l+1]/um))/Math.PI-90;return t}const B6=6378137,UT=[-180,-90,180,90],N6=Math.PI*B6/180;class Hc extends qA{constructor(t,e){super({code:t,units:"degrees",extent:UT,axisOrientation:e,global:!0,metersPerUnit:N6,worldExtent:UT})}}const VT=[new Hc("CRS:84"),new Hc("EPSG:4326","neu"),new Hc("urn:ogc:def:crs:OGC:1.3:CRS84"),new Hc("urn:ogc:def:crs:OGC:2:84"),new Hc("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Hc("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Hc("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Nx={};function Jg(n,t,e){const i=n.getCode(),s=t.getCode();i in Nx||(Nx[i]={}),Nx[i][s]=e}function XA(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function U6(n){n.getCode(),Jg(n,n,XA)}function V6(n){n.forEach(U6)}function GT(n){V6(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Jg(t,e,XA)})})}function G6(n,t,e,i){n.forEach(function(s){t.forEach(function(l){Jg(s,l,e),Jg(l,s,i)})})}function H6(){GT(NT),GT(VT),G6(VT,NT,z6,O6)}H6();function mb(n,t){let e=t;if(e===Xs.Unknown&&(e=n.type()),e===Xs.GeometryCollection){let s=[];for(let l=0;l<n.partsLength();l++){let c=n.parts(l),o=c.type();s.push(mb(c,o))}return{type:Xs[e],geometries:s}}if(e===Xs.MultiPolygon){let s=[];for(let l=0;l<n.partsLength();l++)s.push(mb(n.parts(l),Xs.Polygon));return{type:Xs[e],coordinates:s.map(l=>l.coordinates)}}let i=function(s,l){let c=s.xyArray(),o=s.zArray();switch(l){case Xs.Point:{let p=Array.from(c);return o&&p.push(o[0]),p}case Xs.MultiPoint:case Xs.LineString:return Ox(c,o);case Xs.MultiLineString:case Xs.Polygon:return function(p,m,x){let v;if(!x||x.length===0)return[Ox(p,m)];let b=0,E=Array.from(x).map(D=>p.slice(b,b=D<<1));return m&&(b=0,v=Array.from(x).map(D=>m.slice(b,b=D))),E.map((D,k)=>Ox(D,v?v[k]:void 0))}(c,o,s.endsArray())}}(n,e);return{type:Xs[e],coordinates:i}}function T1(n,t,e){let i=e.columns;return{type:"Feature",id:n,geometry:mb(t.geometry(),e.geometryType),properties:m6(t,i)}}function j6(n,t){return{type:"FeatureCollection",features:P6(n,T1)}}function W6(n,t){return I6(n,T1)}function q6(n,t,e,i=!1){return R6(n,t,T1,e,i)}function $A(n,t,e,i=!1){return n instanceof Uint8Array?j6(n):n instanceof ReadableStream?W6(n):q6(n,t,e,i)}class X6{constructor(t){ni(this,"center");this.center=t}async load(t){const e=await fetch(t),i=$A(e.body),s=[],l=[],c=[];for await(const o of i)this.processFeature(o,s,l,c);return this.createBufferGeometry(s,l,c)}processFeature(t,e,i,s){t.geometry.coordinates.forEach(c=>{const{vertices:o,outerVertices2D:p,holes:m,axis:x}=this.extractSurfaceData(c),v=this.computeUVs(o,x);s.push(...v);const b=this.triangulateSurface(p,m);this.mergeVerticesAndIndices(e,i,o,b)})}extractSurfaceData(t){const e=[],i=[],s=[];let l="z";return t.forEach((c,o)=>{const p=[];c.forEach((k,P)=>{P<3&&p.push([k[0]-this.center[0],k[1]-this.center[1],k[2]])});const m=this.subtractVectors(p[1],p[0]),x=this.subtractVectors(p[2],p[0]),v=this.normalizeVector(this.crossProduct(m,x)),b=Math.abs(v[0]),E=Math.abs(v[1]),D=Math.abs(v[2]);if(b>E&&b>D?l="x":E>b&&E>D?l="y":l="z",o===0)c.forEach((k,P)=>{P+1!==c.length&&(e.push(k[0]-this.center[0],k[1]-this.center[1],k[2]),l==="x"?i.push(k[1]-this.center[0],k[2]-this.center[1]):l==="y"?i.push(k[0]-this.center[0],k[2]-this.center[1]):l==="z"&&i.push(k[0]-this.center[0],k[1]-this.center[1]))});else{const k=[];c.forEach((P,I)=>{I+1!==c.length&&(e.push(P[0]-this.center[0],P[1]-this.center[1],P[2]),l==="x"?k.push(P[1]-this.center[0],P[2]-this.center[1]):l==="y"?k.push(P[0]-this.center[0],P[2]-this.center[1]):l==="z"&&k.push(P[0]-this.center[0],P[1]-this.center[1]))}),s.push(k)}}),{vertices:e,outerVertices2D:i,holes:s,axis:l}}triangulateSurface(t,e){let i;if(e.length>0){const s=[];let l=t.length/2;e.forEach(c=>{s.push(l),l+=c.length/2}),i=IT.triangulate(t.concat(...e),s)}else i=IT.triangulate(t);return this.isClockwise(t)&&i.reverse(),i}mergeVerticesAndIndices(t,e,i,s){const l=t.length/3;t.push(...i);const c=s.map(o=>o+l);e.push(...c)}createBufferGeometry(t,e,i){const s=new Br;s.setAttribute("position",new $n(new Float32Array(t),3)),s.setIndex(e),s.setAttribute("uv",new $n(new Float32Array(i),2));const l=new _i().makeRotationX(Math.PI/-2);return s.applyMatrix4(l),s.computeVertexNormals(),s}isClockwise(t){let e=0;for(let i=0;i<t.length;i+=2){const s=t[i],l=t[i+1],c=t[(i+2)%t.length],o=t[(i+3)%t.length];e+=s*o-c*l}return e/2<0}computeUVs(t,e){const i=[],s=(v,b,E)=>{switch(e){case"x":return[b,E];case"y":return[v,E];default:return[v,b]}};let l=1/0,c=-1/0,o=1/0,p=-1/0;for(let v=0;v<t.length;v+=3){const[b,E]=s(t[v],t[v+1],t[v+2]);l=Math.min(l,b),c=Math.max(c,b),o=Math.min(o,E),p=Math.max(p,E)}const m=c-l,x=p-o;if(m===0||x===0)return new Array(t.length/3*2).fill(0);for(let v=0;v<t.length;v+=3){const[b,E]=s(t[v],t[v+1],t[v+2]);i.push((b-l)/m,(E-o)/x)}return i}subtractVectors(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}crossProduct(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}normalizeVector(t){const e=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);return e===0?[0,0,0]:[t[0]/e,t[1]/e,t[2]/e]}}class $6{constructor(t){ni(this,"center");this.center=t}async load(t,e={color:new vi(16777215),height:0,speed:1}){const i=await fetch(t),s=$A(i.body),l=[],c=[],o=[],p=[],m=[];let x=0;for await(const E of s)E.geometry.coordinates.forEach(k=>{const P=[],I=[],V=[],U=[],B=[];let Z=0;k.forEach((Y,K)=>{if(P.push(Y[0]-this.center[0],Y[1]-this.center[1],0),U.push(e.color.r,e.color.g,e.color.b),B.push(e.speed||1),K>0){const nt=new _t(P[(K-1)*3],P[(K-1)*3+1],P[(K-1)*3+2]),q=new _t(Y[0],Y[1],0);Z+=nt.distanceTo(q)}V.push(Z)});for(let Y=0;Y<k.length-1;Y++)I.push(x+Y,x+Y+1);x+=k.length,l.push(...P),c.push(...I),o.push(...V),p.push(...U),m.push(...B)});const v=new Br;v.setAttribute("position",new na(l,3)),v.setIndex(c),v.setAttribute("a_distance",new na(o,1)),v.setAttribute("a_color",new na(p,3)),v.setAttribute("a_speed",new na(m,1));const b=new _i().makeRotationX(Math.PI/-2);return v.applyMatrix4(b),v.translate(0,e.height,0),v}}const Z6=async()=>new Promise(n=>{const t=document.getElementById("loading"),e=t.animate({opacity:[1,0]},{duration:300,fill:"forwards"});e.onfinish=()=>{t.remove(),n()}}),Y6=()=>{const n=document.getElementById("loading"),t=document.createElement("div");t.className="spinner",n.appendChild(t),document.body.appendChild(n)},ZA=0,K6=1,J6=2,HT=2,Ux=1.25,jT=1,Pp=6*4+4+4,M0=65535,Q6=Math.pow(2,-24),Vx=Symbol("SKIP_GENERATION");function tV(n){return n.index?n.index.count:n.attributes.position.count}function Fd(n){return tV(n)/3}function eV(n,t=ArrayBuffer){return n>65535?new Uint32Array(new t(4*n)):new Uint16Array(new t(2*n))}function iV(n,t){if(!n.index){const e=n.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=eV(e,i);n.setIndex(new $n(s,1));for(let l=0;l<e;l++)s[l]=l}}function YA(n,t){const e=Fd(n),i=t||n.drawRange,s=i.start/3,l=(i.start+i.count)/3,c=Math.max(0,s),o=Math.min(e,l)-c;return[{offset:Math.floor(c),count:Math.floor(o)}]}function KA(n,t){if(!n.groups||!n.groups.length)return YA(n,t);const e=[],i=new Set,s=t||n.drawRange,l=s.start/3,c=(s.start+s.count)/3;for(const p of n.groups){const m=p.start/3,x=(p.start+p.count)/3;i.add(Math.max(l,m)),i.add(Math.min(c,x))}const o=Array.from(i.values()).sort((p,m)=>p-m);for(let p=0;p<o.length-1;p++){const m=o[p],x=o[p+1];e.push({offset:Math.floor(m),count:Math.floor(x-m)})}return e}function nV(n,t){const e=Fd(n),i=KA(n,t).sort((c,o)=>c.offset-o.offset),s=i[i.length-1];s.count=Math.min(e-s.offset,s.count);let l=0;return i.forEach(({count:c})=>l+=c),e!==l}function Gx(n,t,e,i,s){let l=1/0,c=1/0,o=1/0,p=-1/0,m=-1/0,x=-1/0,v=1/0,b=1/0,E=1/0,D=-1/0,k=-1/0,P=-1/0;for(let I=t*6,V=(t+e)*6;I<V;I+=6){const U=n[I+0],B=n[I+1],Z=U-B,Y=U+B;Z<l&&(l=Z),Y>p&&(p=Y),U<v&&(v=U),U>D&&(D=U);const K=n[I+2],nt=n[I+3],q=K-nt,J=K+nt;q<c&&(c=q),J>m&&(m=J),K<b&&(b=K),K>k&&(k=K);const ct=n[I+4],St=n[I+5],wt=ct-St,Pt=ct+St;wt<o&&(o=wt),Pt>x&&(x=Pt),ct<E&&(E=ct),ct>P&&(P=ct)}i[0]=l,i[1]=c,i[2]=o,i[3]=p,i[4]=m,i[5]=x,s[0]=v,s[1]=b,s[2]=E,s[3]=D,s[4]=k,s[5]=P}function sV(n,t=null,e=null,i=null){const s=n.attributes.position,l=n.index?n.index.array:null,c=Fd(n),o=s.normalized;let p;t===null?(p=new Float32Array(c*6),e=0,i=c):(p=t,e=e||0,i=i||c);const m=s.array,x=s.offset||0;let v=3;s.isInterleavedBufferAttribute&&(v=s.data.stride);const b=["getX","getY","getZ"];for(let E=e;E<e+i;E++){const D=E*3,k=E*6;let P=D+0,I=D+1,V=D+2;l&&(P=l[P],I=l[I],V=l[V]),o||(P=P*v+x,I=I*v+x,V=V*v+x);for(let U=0;U<3;U++){let B,Z,Y;o?(B=s[b[U]](P),Z=s[b[U]](I),Y=s[b[U]](V)):(B=m[P+U],Z=m[I+U],Y=m[V+U]);let K=B;Z<K&&(K=Z),Y<K&&(K=Y);let nt=B;Z>nt&&(nt=Z),Y>nt&&(nt=Y);const q=(nt-K)/2,J=U*2;p[k+J+0]=K+q,p[k+J+1]=q+(Math.abs(K)+q)*Q6}}return p}function Gn(n,t,e){return e.min.x=t[n],e.min.y=t[n+1],e.min.z=t[n+2],e.max.x=t[n+3],e.max.y=t[n+4],e.max.z=t[n+5],e}function WT(n){let t=-1,e=-1/0;for(let i=0;i<3;i++){const s=n[i+3]-n[i];s>e&&(e=s,t=i)}return t}function qT(n,t){t.set(n)}function XT(n,t,e){let i,s;for(let l=0;l<3;l++){const c=l+3;i=n[l],s=t[l],e[l]=i<s?i:s,i=n[c],s=t[c],e[c]=i>s?i:s}}function sg(n,t,e){for(let i=0;i<3;i++){const s=t[n+2*i],l=t[n+2*i+1],c=s-l,o=s+l;c<e[i]&&(e[i]=c),o>e[i+3]&&(e[i+3]=o)}}function Qf(n){const t=n[3]-n[0],e=n[4]-n[1],i=n[5]-n[2];return 2*(t*e+e*i+i*t)}const Fo=32,rV=(n,t)=>n.candidate-t.candidate,zl=new Array(Fo).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),rg=new Float32Array(6);function aV(n,t,e,i,s,l){let c=-1,o=0;if(l===ZA)c=WT(t),c!==-1&&(o=(t[c]+t[c+3])/2);else if(l===K6)c=WT(n),c!==-1&&(o=oV(e,i,s,c));else if(l===J6){const p=Qf(n);let m=Ux*s;const x=i*6,v=(i+s)*6;for(let b=0;b<3;b++){const E=t[b],P=(t[b+3]-E)/Fo;if(s<Fo/4){const I=[...zl];I.length=s;let V=0;for(let B=x;B<v;B+=6,V++){const Z=I[V];Z.candidate=e[B+2*b],Z.count=0;const{bounds:Y,leftCacheBounds:K,rightCacheBounds:nt}=Z;for(let q=0;q<3;q++)nt[q]=1/0,nt[q+3]=-1/0,K[q]=1/0,K[q+3]=-1/0,Y[q]=1/0,Y[q+3]=-1/0;sg(B,e,Y)}I.sort(rV);let U=s;for(let B=0;B<U;B++){const Z=I[B];for(;B+1<U&&I[B+1].candidate===Z.candidate;)I.splice(B+1,1),U--}for(let B=x;B<v;B+=6){const Z=e[B+2*b];for(let Y=0;Y<U;Y++){const K=I[Y];Z>=K.candidate?sg(B,e,K.rightCacheBounds):(sg(B,e,K.leftCacheBounds),K.count++)}}for(let B=0;B<U;B++){const Z=I[B],Y=Z.count,K=s-Z.count,nt=Z.leftCacheBounds,q=Z.rightCacheBounds;let J=0;Y!==0&&(J=Qf(nt)/p);let ct=0;K!==0&&(ct=Qf(q)/p);const St=jT+Ux*(J*Y+ct*K);St<m&&(c=b,m=St,o=Z.candidate)}}else{for(let U=0;U<Fo;U++){const B=zl[U];B.count=0,B.candidate=E+P+U*P;const Z=B.bounds;for(let Y=0;Y<3;Y++)Z[Y]=1/0,Z[Y+3]=-1/0}for(let U=x;U<v;U+=6){let Y=~~((e[U+2*b]-E)/P);Y>=Fo&&(Y=Fo-1);const K=zl[Y];K.count++,sg(U,e,K.bounds)}const I=zl[Fo-1];qT(I.bounds,I.rightCacheBounds);for(let U=Fo-2;U>=0;U--){const B=zl[U],Z=zl[U+1];XT(B.bounds,Z.rightCacheBounds,B.rightCacheBounds)}let V=0;for(let U=0;U<Fo-1;U++){const B=zl[U],Z=B.count,Y=B.bounds,nt=zl[U+1].rightCacheBounds;Z!==0&&(V===0?qT(Y,rg):XT(Y,rg,rg)),V+=Z;let q=0,J=0;V!==0&&(q=Qf(rg)/p);const ct=s-V;ct!==0&&(J=Qf(nt)/p);const St=jT+Ux*(q*V+J*ct);St<m&&(c=b,m=St,o=B.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${l} used.`);return{axis:c,pos:o}}function oV(n,t,e,i){let s=0;for(let l=t,c=t+e;l<c;l++)s+=n[l*6+i*2];return s/e}class Hx{constructor(){this.boundingData=new Float32Array(6)}}function lV(n,t,e,i,s,l){let c=i,o=i+s-1;const p=l.pos,m=l.axis*2;for(;;){for(;c<=o&&e[c*6+m]<p;)c++;for(;c<=o&&e[o*6+m]>=p;)o--;if(c<o){for(let x=0;x<3;x++){let v=t[c*3+x];t[c*3+x]=t[o*3+x],t[o*3+x]=v}for(let x=0;x<6;x++){let v=e[c*6+x];e[c*6+x]=e[o*6+x],e[o*6+x]=v}c++,o--}else return c}}function cV(n,t,e,i,s,l){let c=i,o=i+s-1;const p=l.pos,m=l.axis*2;for(;;){for(;c<=o&&e[c*6+m]<p;)c++;for(;c<=o&&e[o*6+m]>=p;)o--;if(c<o){let x=n[c];n[c]=n[o],n[o]=x;for(let v=0;v<6;v++){let b=e[c*6+v];e[c*6+v]=e[o*6+v],e[o*6+v]=b}c++,o--}else return c}}function Dr(n,t){return t[n+15]===65535}function sa(n,t){return t[n+6]}function xa(n,t){return t[n+14]}function va(n){return n+8}function ba(n,t){return t[n+6]}function JA(n,t){return t[n+7]}let QA,mp,Rg,t2;const hV=Math.pow(2,32);function _b(n){return"count"in n?1:1+_b(n.left)+_b(n.right)}function uV(n,t,e){return QA=new Float32Array(e),mp=new Uint32Array(e),Rg=new Uint16Array(e),t2=new Uint8Array(e),gb(n,t)}function gb(n,t){const e=n/4,i=n/2,s="count"in t,l=t.boundingData;for(let c=0;c<6;c++)QA[e+c]=l[c];if(s)if(t.buffer){const c=t.buffer;t2.set(new Uint8Array(c),n);for(let o=n,p=n+c.byteLength;o<p;o+=Pp){const m=o/2;Dr(m,Rg)||(mp[o/4+6]+=e)}return n+c.byteLength}else{const c=t.offset,o=t.count;return mp[e+6]=c,Rg[i+14]=o,Rg[i+15]=M0,n+Pp}else{const c=t.left,o=t.right,p=t.splitAxis;let m;if(m=gb(n+Pp,c),m/4>hV)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return mp[e+6]=m/4,m=gb(m,o),mp[e+7]=p,m}}function dV(n,t){const e=(n.index?n.index.count:n.attributes.position.count)/3,i=e>2**16,s=i?4:2,l=t?new SharedArrayBuffer(e*s):new ArrayBuffer(e*s),c=i?new Uint32Array(l):new Uint16Array(l);for(let o=0,p=c.length;o<p;o++)c[o]=o;return c}function fV(n,t,e,i,s){const{maxDepth:l,verbose:c,maxLeafTris:o,strategy:p,onProgress:m,indirect:x}=s,v=n._indirectBuffer,b=n.geometry,E=b.index?b.index.array:null,D=x?cV:lV,k=Fd(b),P=new Float32Array(6);let I=!1;const V=new Hx;return Gx(t,e,i,V.boundingData,P),B(V,e,i,P),V;function U(Z){m&&m(Z/k)}function B(Z,Y,K,nt=null,q=0){if(!I&&q>=l&&(I=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(b))),K<=o||q>=l)return U(Y+K),Z.offset=Y,Z.count=K,Z;const J=aV(Z.boundingData,nt,t,Y,K,p);if(J.axis===-1)return U(Y+K),Z.offset=Y,Z.count=K,Z;const ct=D(v,E,t,Y,K,J);if(ct===Y||ct===Y+K)U(Y+K),Z.offset=Y,Z.count=K;else{Z.splitAxis=J.axis;const St=new Hx,wt=Y,Pt=ct-Y;Z.left=St,Gx(t,wt,Pt,St.boundingData,P),B(St,wt,Pt,P,q+1);const Gt=new Hx,Nt=ct,Zt=K-Pt;Z.right=Gt,Gx(t,Nt,Zt,Gt.boundingData,P),B(Gt,Nt,Zt,P,q+1)}return Z}}function pV(n,t){const e=n.geometry;t.indirect&&(n._indirectBuffer=dV(e,t.useSharedArrayBuffer),nV(e,t.range)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||iV(e,t);const i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=sV(e),l=t.indirect?YA(e,t.range):KA(e,t.range);n._roots=l.map(c=>{const o=fV(n,s,c.offset,c.count,t),p=_b(o),m=new i(Pp*p);return uV(0,o,m),m})}class qo{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,s=-1/0;for(let l=0,c=t.length;l<c;l++){const p=t[l][e];i=p<i?p:i,s=p>s?p:s}this.min=i,this.max=s}setFromPoints(t,e){let i=1/0,s=-1/0;for(let l=0,c=e.length;l<c;l++){const o=e[l],p=t.dot(o);i=p<i?p:i,s=p>s?p:s}this.min=i,this.max=s}isSeparated(t){return this.min>t.max||t.min>this.max}}qo.prototype.setFromBox=function(){const n=new _t;return function(e,i){const s=i.min,l=i.max;let c=1/0,o=-1/0;for(let p=0;p<=1;p++)for(let m=0;m<=1;m++)for(let x=0;x<=1;x++){n.x=s.x*p+l.x*(1-p),n.y=s.y*m+l.y*(1-m),n.z=s.z*x+l.z*(1-x);const v=e.dot(n);c=Math.min(v,c),o=Math.max(v,o)}this.min=c,this.max=o}}();const mV=function(){const n=new _t,t=new _t,e=new _t;return function(s,l,c){const o=s.start,p=n,m=l.start,x=t;e.subVectors(o,m),n.subVectors(s.end,s.start),t.subVectors(l.end,l.start);const v=e.dot(x),b=x.dot(p),E=x.dot(x),D=e.dot(p),P=p.dot(p)*E-b*b;let I,V;P!==0?I=(v*b-D*E)/P:I=0,V=(v+I*b)/E,c.x=I,c.y=V}}(),E1=function(){const n=new si,t=new _t,e=new _t;return function(s,l,c,o){mV(s,l,n);let p=n.x,m=n.y;if(p>=0&&p<=1&&m>=0&&m<=1){s.at(p,c),l.at(m,o);return}else if(p>=0&&p<=1){m<0?l.at(0,o):l.at(1,o),s.closestPointToPoint(o,!0,c);return}else if(m>=0&&m<=1){p<0?s.at(0,c):s.at(1,c),l.closestPointToPoint(c,!0,o);return}else{let x;p<0?x=s.start:x=s.end;let v;m<0?v=l.start:v=l.end;const b=t,E=e;if(s.closestPointToPoint(v,!0,t),l.closestPointToPoint(x,!0,e),b.distanceToSquared(v)<=E.distanceToSquared(x)){c.copy(b),o.copy(v);return}else{c.copy(x),o.copy(E);return}}}}(),_V=function(){const n=new _t,t=new _t,e=new Ja,i=new Ho;return function(l,c){const{radius:o,center:p}=l,{a:m,b:x,c:v}=c;if(i.start=m,i.end=x,i.closestPointToPoint(p,!0,n).distanceTo(p)<=o||(i.start=m,i.end=v,i.closestPointToPoint(p,!0,n).distanceTo(p)<=o)||(i.start=x,i.end=v,i.closestPointToPoint(p,!0,n).distanceTo(p)<=o))return!0;const k=c.getPlane(e);if(Math.abs(k.distanceToPoint(p))<=o){const I=k.projectPoint(p,t);if(c.containsPoint(I))return!0}return!1}}(),gV=1e-15;function jx(n){return Math.abs(n)<gV}class Ga extends Fs{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new _t),this.satBounds=new Array(4).fill().map(()=>new qo),this.points=[this.a,this.b,this.c],this.sphere=new Ys,this.plane=new Ja,this.needsUpdate=!0}intersectsSphere(t){return _V(t,this)}update(){const t=this.a,e=this.b,i=this.c,s=this.points,l=this.satAxes,c=this.satBounds,o=l[0],p=c[0];this.getNormal(o),p.setFromPoints(o,s);const m=l[1],x=c[1];m.subVectors(t,e),x.setFromPoints(m,s);const v=l[2],b=c[2];v.subVectors(e,i),b.setFromPoints(v,s);const E=l[3],D=c[3];E.subVectors(i,t),D.setFromPoints(E,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}Ga.prototype.closestPointToSegment=function(){const n=new _t,t=new _t,e=new Ho;return function(s,l=null,c=null){const{start:o,end:p}=s,m=this.points;let x,v=1/0;for(let b=0;b<3;b++){const E=(b+1)%3;e.start.copy(m[b]),e.end.copy(m[E]),E1(e,s,n,t),x=n.distanceToSquared(t),x<v&&(v=x,l&&l.copy(n),c&&c.copy(t))}return this.closestPointToPoint(o,n),x=o.distanceToSquared(n),x<v&&(v=x,l&&l.copy(n),c&&c.copy(o)),this.closestPointToPoint(p,n),x=p.distanceToSquared(n),x<v&&(v=x,l&&l.copy(n),c&&c.copy(p)),Math.sqrt(v)}}();Ga.prototype.intersectsTriangle=function(){const n=new Ga,t=new Array(3),e=new Array(3),i=new qo,s=new qo,l=new _t,c=new _t,o=new _t,p=new _t,m=new _t,x=new Ho,v=new Ho,b=new Ho,E=new _t;function D(k,P,I){const V=k.points;let U=0,B=-1;for(let Z=0;Z<3;Z++){const{start:Y,end:K}=x;Y.copy(V[Z]),K.copy(V[(Z+1)%3]),x.delta(c);const nt=jx(P.distanceToPoint(Y));if(jx(P.normal.dot(c))&&nt){I.copy(x),U=2;break}const q=P.intersectLine(x,E);if(!q&&nt&&E.copy(Y),(q||nt)&&!jx(E.distanceTo(K))){if(U<=1)(U===1?I.start:I.end).copy(E),nt&&(B=U);else if(U>=2){(B===1?I.start:I.end).copy(E),U=2;break}if(U++,U===2&&B===-1)break}}return U}return function(P,I=null,V=!1){this.needsUpdate&&this.update(),P.isExtendedTriangle?P.needsUpdate&&P.update():(n.copy(P),n.update(),P=n);const U=this.plane,B=P.plane;if(Math.abs(U.normal.dot(B.normal))>1-1e-10){const Z=this.satBounds,Y=this.satAxes;e[0]=P.a,e[1]=P.b,e[2]=P.c;for(let q=0;q<4;q++){const J=Z[q],ct=Y[q];if(i.setFromPoints(ct,e),J.isSeparated(i))return!1}const K=P.satBounds,nt=P.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let q=0;q<4;q++){const J=K[q],ct=nt[q];if(i.setFromPoints(ct,t),J.isSeparated(i))return!1}for(let q=0;q<4;q++){const J=Y[q];for(let ct=0;ct<4;ct++){const St=nt[ct];if(l.crossVectors(J,St),i.setFromPoints(l,t),s.setFromPoints(l,e),i.isSeparated(s))return!1}}return I&&(V||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),I.start.set(0,0,0),I.end.set(0,0,0)),!0}else{const Z=D(this,B,v);if(Z===1&&P.containsPoint(v.end))return I&&(I.start.copy(v.end),I.end.copy(v.end)),!0;if(Z!==2)return!1;const Y=D(P,U,b);if(Y===1&&this.containsPoint(b.end))return I&&(I.start.copy(b.end),I.end.copy(b.end)),!0;if(Y!==2)return!1;if(v.delta(o),b.delta(p),o.dot(p)<0){let wt=b.start;b.start=b.end,b.end=wt}const K=v.start.dot(o),nt=v.end.dot(o),q=b.start.dot(o),J=b.end.dot(o),ct=nt<q,St=K<J;return K!==J&&q!==nt&&ct===St?!1:(I&&(m.subVectors(v.start,b.start),m.dot(o)>0?I.start.copy(v.start):I.start.copy(b.start),m.subVectors(v.end,b.end),m.dot(o)<0?I.end.copy(v.end):I.end.copy(b.end)),!0)}}}();Ga.prototype.distanceToPoint=function(){const n=new _t;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}();Ga.prototype.distanceToTriangle=function(){const n=new _t,t=new _t,e=["a","b","c"],i=new Ho,s=new Ho;return function(c,o=null,p=null){const m=o||p?i:null;if(this.intersectsTriangle(c,m))return(o||p)&&(o&&m.getCenter(o),p&&m.getCenter(p)),0;let x=1/0;for(let v=0;v<3;v++){let b;const E=e[v],D=c[E];this.closestPointToPoint(D,n),b=D.distanceToSquared(n),b<x&&(x=b,o&&o.copy(n),p&&p.copy(D));const k=this[E];c.closestPointToPoint(k,n),b=k.distanceToSquared(n),b<x&&(x=b,o&&o.copy(k),p&&p.copy(n))}for(let v=0;v<3;v++){const b=e[v],E=e[(v+1)%3];i.set(this[b],this[E]);for(let D=0;D<3;D++){const k=e[D],P=e[(D+1)%3];s.set(c[k],c[P]),E1(i,s,n,t);const I=n.distanceToSquared(t);I<x&&(x=I,o&&o.copy(n),p&&p.copy(t))}}return Math.sqrt(x)}}();class xr{constructor(t,e,i){this.isOrientedBox=!0,this.min=new _t,this.max=new _t,this.matrix=new _i,this.invMatrix=new _i,this.points=new Array(8).fill().map(()=>new _t),this.satAxes=new Array(3).fill().map(()=>new _t),this.satBounds=new Array(3).fill().map(()=>new qo),this.alignedSatBounds=new Array(3).fill().map(()=>new qo),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}xr.prototype.update=function(){return function(){const t=this.matrix,e=this.min,i=this.max,s=this.points;for(let m=0;m<=1;m++)for(let x=0;x<=1;x++)for(let v=0;v<=1;v++){const b=1*m|2*x|4*v,E=s[b];E.x=m?i.x:e.x,E.y=x?i.y:e.y,E.z=v?i.z:e.z,E.applyMatrix4(t)}const l=this.satBounds,c=this.satAxes,o=s[0];for(let m=0;m<3;m++){const x=c[m],v=l[m],b=1<<m,E=s[b];x.subVectors(o,E),v.setFromPoints(x,s)}const p=this.alignedSatBounds;p[0].setFromPointsField(s,"x"),p[1].setFromPointsField(s,"y"),p[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();xr.prototype.intersectsBox=function(){const n=new qo;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,l=this.satBounds,c=this.satAxes,o=this.alignedSatBounds;if(n.min=i.x,n.max=s.x,o[0].isSeparated(n)||(n.min=i.y,n.max=s.y,o[1].isSeparated(n))||(n.min=i.z,n.max=s.z,o[2].isSeparated(n)))return!1;for(let p=0;p<3;p++){const m=c[p],x=l[p];if(n.setFromBox(m,e),x.isSeparated(n))return!1}return!0}}();xr.prototype.intersectsTriangle=function(){const n=new Ga,t=new Array(3),e=new qo,i=new qo,s=new _t;return function(c){this.needsUpdate&&this.update(),c.isExtendedTriangle?c.needsUpdate&&c.update():(n.copy(c),n.update(),c=n);const o=this.satBounds,p=this.satAxes;t[0]=c.a,t[1]=c.b,t[2]=c.c;for(let b=0;b<3;b++){const E=o[b],D=p[b];if(e.setFromPoints(D,t),E.isSeparated(e))return!1}const m=c.satBounds,x=c.satAxes,v=this.points;for(let b=0;b<3;b++){const E=m[b],D=x[b];if(e.setFromPoints(D,v),E.isSeparated(e))return!1}for(let b=0;b<3;b++){const E=p[b];for(let D=0;D<4;D++){const k=x[D];if(s.crossVectors(E,k),e.setFromPoints(s,t),i.setFromPoints(s,v),e.isSeparated(i))return!1}}return!0}}();xr.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();xr.prototype.distanceToPoint=function(){const n=new _t;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}();xr.prototype.distanceToBox=function(){const n=["x","y","z"],t=new Array(12).fill().map(()=>new Ho),e=new Array(12).fill().map(()=>new Ho),i=new _t,s=new _t;return function(c,o=0,p=null,m=null){if(this.needsUpdate&&this.update(),this.intersectsBox(c))return(p||m)&&(c.getCenter(s),this.closestPointToPoint(s,i),c.closestPointToPoint(i,s),p&&p.copy(i),m&&m.copy(s)),0;const x=o*o,v=c.min,b=c.max,E=this.points;let D=1/0;for(let P=0;P<8;P++){const I=E[P];s.copy(I).clamp(v,b);const V=I.distanceToSquared(s);if(V<D&&(D=V,p&&p.copy(I),m&&m.copy(s),V<x))return Math.sqrt(V)}let k=0;for(let P=0;P<3;P++)for(let I=0;I<=1;I++)for(let V=0;V<=1;V++){const U=(P+1)%3,B=(P+2)%3,Z=I<<U|V<<B,Y=1<<P|I<<U|V<<B,K=E[Z],nt=E[Y];t[k].set(K,nt);const J=n[P],ct=n[U],St=n[B],wt=e[k],Pt=wt.start,Gt=wt.end;Pt[J]=v[J],Pt[ct]=I?v[ct]:b[ct],Pt[St]=V?v[St]:b[ct],Gt[J]=b[J],Gt[ct]=I?v[ct]:b[ct],Gt[St]=V?v[St]:b[ct],k++}for(let P=0;P<=1;P++)for(let I=0;I<=1;I++)for(let V=0;V<=1;V++){s.x=P?b.x:v.x,s.y=I?b.y:v.y,s.z=V?b.z:v.z,this.closestPointToPoint(s,i);const U=s.distanceToSquared(i);if(U<D&&(D=U,p&&p.copy(i),m&&m.copy(s),U<x))return Math.sqrt(U)}for(let P=0;P<12;P++){const I=t[P];for(let V=0;V<12;V++){const U=e[V];E1(I,U,i,s);const B=i.distanceToSquared(s);if(B<D&&(D=B,p&&p.copy(i),m&&m.copy(s),B<x))return Math.sqrt(B)}}return Math.sqrt(D)}}();class A1{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class yV extends A1{constructor(){super(()=>new Ga)}}const wa=new yV;class xV{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const Tn=new xV;let Gl,qu;const Au=[],ag=new A1(()=>new Nn);function vV(n,t,e,i,s,l){Gl=ag.getPrimitive(),qu=ag.getPrimitive(),Au.push(Gl,qu),Tn.setBuffer(n._roots[t]);const c=yb(0,n.geometry,e,i,s,l);Tn.clearBuffer(),ag.releasePrimitive(Gl),ag.releasePrimitive(qu),Au.pop(),Au.pop();const o=Au.length;return o>0&&(qu=Au[o-1],Gl=Au[o-2]),c}function yb(n,t,e,i,s=null,l=0,c=0){const{float32Array:o,uint16Array:p,uint32Array:m}=Tn;let x=n*2;if(Dr(x,p)){const D=sa(n,m),k=xa(x,p);return Gn(n,o,Gl),i(D,k,!1,c,l+n,Gl)}else{let St=function(Pt){const{uint16Array:Gt,uint32Array:Nt}=Tn;let Zt=Pt*2;for(;!Dr(Zt,Gt);)Pt=va(Pt),Zt=Pt*2;return sa(Pt,Nt)},wt=function(Pt){const{uint16Array:Gt,uint32Array:Nt}=Tn;let Zt=Pt*2;for(;!Dr(Zt,Gt);)Pt=ba(Pt,Nt),Zt=Pt*2;return sa(Pt,Nt)+xa(Zt,Gt)};var b=St,E=wt;const D=va(n),k=ba(n,m);let P=D,I=k,V,U,B,Z;if(s&&(B=Gl,Z=qu,Gn(P,o,B),Gn(I,o,Z),V=s(B),U=s(Z),U<V)){P=k,I=D;const Pt=V;V=U,U=Pt,B=Z}B||(B=Gl,Gn(P,o,B));const Y=Dr(P*2,p),K=e(B,Y,V,c+1,l+P);let nt;if(K===HT){const Pt=St(P),Nt=wt(P)-Pt;nt=i(Pt,Nt,!0,c+1,l+P,B)}else nt=K&&yb(P,t,e,i,s,l,c+1);if(nt)return!0;Z=qu,Gn(I,o,Z);const q=Dr(I*2,p),J=e(Z,q,U,c+1,l+I);let ct;if(J===HT){const Pt=St(I),Nt=wt(I)-Pt;ct=i(Pt,Nt,!0,c+1,l+I,Z)}else ct=J&&yb(I,t,e,i,s,l,c+1);return!!ct}}const tp=new _t,Wx=new _t;function bV(n,t,e={},i=0,s=1/0){const l=i*i,c=s*s;let o=1/0,p=null;if(n.shapecast({boundsTraverseOrder:x=>(tp.copy(t).clamp(x.min,x.max),tp.distanceToSquared(t)),intersectsBounds:(x,v,b)=>b<o&&b<c,intersectsTriangle:(x,v)=>{x.closestPointToPoint(t,tp);const b=t.distanceToSquared(tp);return b<o&&(Wx.copy(tp),o=b,p=v),b<l}}),o===1/0)return null;const m=Math.sqrt(o);return e.point?e.point.copy(Wx):e.point=Wx.clone(),e.distance=m,e.faceIndex=p,e}const wV=parseInt(d0)>=169,jc=new _t,Wc=new _t,qc=new _t,og=new si,lg=new si,cg=new si,$T=new _t,ZT=new _t,YT=new _t,ep=new _t;function MV(n,t,e,i,s,l,c,o){let p;if(l===pr?p=n.intersectTriangle(i,e,t,!0,s):p=n.intersectTriangle(t,e,i,l!==Qr,s),p===null)return null;const m=n.origin.distanceTo(s);return m<c||m>o?null:{distance:m,point:s.clone()}}function SV(n,t,e,i,s,l,c,o,p,m,x){jc.fromBufferAttribute(t,l),Wc.fromBufferAttribute(t,c),qc.fromBufferAttribute(t,o);const v=MV(n,jc,Wc,qc,ep,p,m,x);if(v){const b=new _t;Fs.getBarycoord(ep,jc,Wc,qc,b),i&&(og.fromBufferAttribute(i,l),lg.fromBufferAttribute(i,c),cg.fromBufferAttribute(i,o),v.uv=Fs.getInterpolation(ep,jc,Wc,qc,og,lg,cg,new si)),s&&(og.fromBufferAttribute(s,l),lg.fromBufferAttribute(s,c),cg.fromBufferAttribute(s,o),v.uv1=Fs.getInterpolation(ep,jc,Wc,qc,og,lg,cg,new si)),e&&($T.fromBufferAttribute(e,l),ZT.fromBufferAttribute(e,c),YT.fromBufferAttribute(e,o),v.normal=Fs.getInterpolation(ep,jc,Wc,qc,$T,ZT,YT,new _t),v.normal.dot(n.direction)>0&&v.normal.multiplyScalar(-1));const E={a:l,b:c,c:o,normal:new _t,materialIndex:0};Fs.getNormal(jc,Wc,qc,E.normal),v.face=E,v.faceIndex=l,wV&&(v.barycoord=b)}return v}function S0(n,t,e,i,s,l,c){const o=i*3;let p=o+0,m=o+1,x=o+2;const v=n.index;n.index&&(p=v.getX(p),m=v.getX(m),x=v.getX(x));const{position:b,normal:E,uv:D,uv1:k}=n.attributes,P=SV(e,b,E,D,k,p,m,x,t,l,c);return P?(P.faceIndex=i,s&&s.push(P),P):null}function es(n,t,e,i){const s=n.a,l=n.b,c=n.c;let o=t,p=t+1,m=t+2;e&&(o=e.getX(o),p=e.getX(p),m=e.getX(m)),s.x=i.getX(o),s.y=i.getY(o),s.z=i.getZ(o),l.x=i.getX(p),l.y=i.getY(p),l.z=i.getZ(p),c.x=i.getX(m),c.y=i.getY(m),c.z=i.getZ(m)}function TV(n,t,e,i,s,l,c,o){const{geometry:p,_indirectBuffer:m}=n;for(let x=i,v=i+s;x<v;x++)S0(p,t,e,x,l,c,o)}function EV(n,t,e,i,s,l,c){const{geometry:o,_indirectBuffer:p}=n;let m=1/0,x=null;for(let v=i,b=i+s;v<b;v++){let E;E=S0(o,t,e,v,null,l,c),E&&E.distance<m&&(x=E,m=E.distance)}return x}function AV(n,t,e,i,s,l,c){const{geometry:o}=e,{index:p}=o,m=o.attributes.position;for(let x=n,v=t+n;x<v;x++){let b;if(b=x,es(c,b*3,p,m),c.needsUpdate=!0,i(c,b,s,l))return!0}return!1}function CV(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,i=e.index?e.index.array:null,s=e.attributes.position;let l,c,o,p,m=0;const x=n._roots;for(let b=0,E=x.length;b<E;b++)l=x[b],c=new Uint32Array(l),o=new Uint16Array(l),p=new Float32Array(l),v(0,m),m+=l.byteLength;function v(b,E,D=!1){const k=b*2;if(o[k+15]===M0){const I=c[b+6],V=o[k+14];let U=1/0,B=1/0,Z=1/0,Y=-1/0,K=-1/0,nt=-1/0;for(let q=3*I,J=3*(I+V);q<J;q++){let ct=i[q];const St=s.getX(ct),wt=s.getY(ct),Pt=s.getZ(ct);St<U&&(U=St),St>Y&&(Y=St),wt<B&&(B=wt),wt>K&&(K=wt),Pt<Z&&(Z=Pt),Pt>nt&&(nt=Pt)}return p[b+0]!==U||p[b+1]!==B||p[b+2]!==Z||p[b+3]!==Y||p[b+4]!==K||p[b+5]!==nt?(p[b+0]=U,p[b+1]=B,p[b+2]=Z,p[b+3]=Y,p[b+4]=K,p[b+5]=nt,!0):!1}else{const I=b+8,V=c[b+6],U=I+E,B=V+E;let Z=D,Y=!1,K=!1;t?Z||(Y=t.has(U),K=t.has(B),Z=!Y&&!K):(Y=!0,K=!0);const nt=Z||Y,q=Z||K;let J=!1;nt&&(J=v(I,E,Z));let ct=!1;q&&(ct=v(V,E,Z));const St=J||ct;if(St)for(let wt=0;wt<3;wt++){const Pt=I+wt,Gt=V+wt,Nt=p[Pt],Zt=p[Pt+3],qt=p[Gt],me=p[Gt+3];p[b+wt]=Nt<qt?Nt:qt,p[b+wt+3]=Zt>me?Zt:me}return St}}}function ic(n,t,e,i,s){let l,c,o,p,m,x;const v=1/e.direction.x,b=1/e.direction.y,E=1/e.direction.z,D=e.origin.x,k=e.origin.y,P=e.origin.z;let I=t[n],V=t[n+3],U=t[n+1],B=t[n+3+1],Z=t[n+2],Y=t[n+3+2];return v>=0?(l=(I-D)*v,c=(V-D)*v):(l=(V-D)*v,c=(I-D)*v),b>=0?(o=(U-k)*b,p=(B-k)*b):(o=(B-k)*b,p=(U-k)*b),l>p||o>c||((o>l||isNaN(l))&&(l=o),(p<c||isNaN(c))&&(c=p),E>=0?(m=(Z-P)*E,x=(Y-P)*E):(m=(Y-P)*E,x=(Z-P)*E),l>x||m>c)?!1:((m>l||l!==l)&&(l=m),(x<c||c!==c)&&(c=x),l<=s&&c>=i)}function PV(n,t,e,i,s,l,c,o){const{geometry:p,_indirectBuffer:m}=n;for(let x=i,v=i+s;x<v;x++){let b=m?m[x]:x;S0(p,t,e,b,l,c,o)}}function IV(n,t,e,i,s,l,c){const{geometry:o,_indirectBuffer:p}=n;let m=1/0,x=null;for(let v=i,b=i+s;v<b;v++){let E;E=S0(o,t,e,p?p[v]:v,null,l,c),E&&E.distance<m&&(x=E,m=E.distance)}return x}function RV(n,t,e,i,s,l,c){const{geometry:o}=e,{index:p}=o,m=o.attributes.position;for(let x=n,v=t+n;x<v;x++){let b;if(b=e.resolveTriangleIndex(x),es(c,b*3,p,m),c.needsUpdate=!0,i(c,b,s,l))return!0}return!1}function DV(n,t,e,i,s,l,c){Tn.setBuffer(n._roots[t]),xb(0,n,e,i,s,l,c),Tn.clearBuffer()}function xb(n,t,e,i,s,l,c){const{float32Array:o,uint16Array:p,uint32Array:m}=Tn,x=n*2;if(Dr(x,p)){const b=sa(n,m),E=xa(x,p);TV(t,e,i,b,E,s,l,c)}else{const b=va(n);ic(b,o,i,l,c)&&xb(b,t,e,i,s,l,c);const E=ba(n,m);ic(E,o,i,l,c)&&xb(E,t,e,i,s,l,c)}}const LV=["x","y","z"];function kV(n,t,e,i,s,l){Tn.setBuffer(n._roots[t]);const c=vb(0,n,e,i,s,l);return Tn.clearBuffer(),c}function vb(n,t,e,i,s,l){const{float32Array:c,uint16Array:o,uint32Array:p}=Tn;let m=n*2;if(Dr(m,o)){const v=sa(n,p),b=xa(m,o);return EV(t,e,i,v,b,s,l)}else{const v=JA(n,p),b=LV[v],D=i.direction[b]>=0;let k,P;D?(k=va(n),P=ba(n,p)):(k=ba(n,p),P=va(n));const V=ic(k,c,i,s,l)?vb(k,t,e,i,s,l):null;if(V){const Z=V.point[b];if(D?Z<=c[P+v]:Z>=c[P+v+3])return V}const B=ic(P,c,i,s,l)?vb(P,t,e,i,s,l):null;return V&&B?V.distance<=B.distance?V:B:V||B||null}}const hg=new Nn,Cu=new Ga,Pu=new Ga,ip=new _i,KT=new xr,ug=new xr;function FV(n,t,e,i){Tn.setBuffer(n._roots[t]);const s=bb(0,n,e,i);return Tn.clearBuffer(),s}function bb(n,t,e,i,s=null){const{float32Array:l,uint16Array:c,uint32Array:o}=Tn;let p=n*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),KT.set(e.boundingBox.min,e.boundingBox.max,i),s=KT),Dr(p,c)){const x=t.geometry,v=x.index,b=x.attributes.position,E=e.index,D=e.attributes.position,k=sa(n,o),P=xa(p,c);if(ip.copy(i).invert(),e.boundsTree)return Gn(n,l,ug),ug.matrix.copy(ip),ug.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:V=>ug.intersectsBox(V),intersectsTriangle:V=>{V.a.applyMatrix4(i),V.b.applyMatrix4(i),V.c.applyMatrix4(i),V.needsUpdate=!0;for(let U=k*3,B=(P+k)*3;U<B;U+=3)if(es(Pu,U,v,b),Pu.needsUpdate=!0,V.intersectsTriangle(Pu))return!0;return!1}});for(let I=k*3,V=(P+k)*3;I<V;I+=3){es(Cu,I,v,b),Cu.a.applyMatrix4(ip),Cu.b.applyMatrix4(ip),Cu.c.applyMatrix4(ip),Cu.needsUpdate=!0;for(let U=0,B=E.count;U<B;U+=3)if(es(Pu,U,E,D),Pu.needsUpdate=!0,Cu.intersectsTriangle(Pu))return!0}}else{const x=n+8,v=o[n+6];return Gn(x,l,hg),!!(s.intersectsBox(hg)&&bb(x,t,e,i,s)||(Gn(v,l,hg),s.intersectsBox(hg)&&bb(v,t,e,i,s)))}}const dg=new _i,qx=new xr,np=new xr,zV=new _t,OV=new _t,BV=new _t,NV=new _t;function UV(n,t,e,i={},s={},l=0,c=1/0){t.boundingBox||t.computeBoundingBox(),qx.set(t.boundingBox.min,t.boundingBox.max,e),qx.needsUpdate=!0;const o=n.geometry,p=o.attributes.position,m=o.index,x=t.attributes.position,v=t.index,b=wa.getPrimitive(),E=wa.getPrimitive();let D=zV,k=OV,P=null,I=null;s&&(P=BV,I=NV);let V=1/0,U=null,B=null;return dg.copy(e).invert(),np.matrix.copy(dg),n.shapecast({boundsTraverseOrder:Z=>qx.distanceToBox(Z),intersectsBounds:(Z,Y,K)=>K<V&&K<c?(Y&&(np.min.copy(Z.min),np.max.copy(Z.max),np.needsUpdate=!0),!0):!1,intersectsRange:(Z,Y)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:nt=>np.distanceToBox(nt),intersectsBounds:(nt,q,J)=>J<V&&J<c,intersectsRange:(nt,q)=>{for(let J=nt,ct=nt+q;J<ct;J++){es(E,3*J,v,x),E.a.applyMatrix4(e),E.b.applyMatrix4(e),E.c.applyMatrix4(e),E.needsUpdate=!0;for(let St=Z,wt=Z+Y;St<wt;St++){es(b,3*St,m,p),b.needsUpdate=!0;const Pt=b.distanceToTriangle(E,D,P);if(Pt<V&&(k.copy(D),I&&I.copy(P),V=Pt,U=St,B=J),Pt<l)return!0}}}});{const K=Fd(t);for(let nt=0,q=K;nt<q;nt++){es(E,3*nt,v,x),E.a.applyMatrix4(e),E.b.applyMatrix4(e),E.c.applyMatrix4(e),E.needsUpdate=!0;for(let J=Z,ct=Z+Y;J<ct;J++){es(b,3*J,m,p),b.needsUpdate=!0;const St=b.distanceToTriangle(E,D,P);if(St<V&&(k.copy(D),I&&I.copy(P),V=St,U=J,B=nt),St<l)return!0}}}}}),wa.releasePrimitive(b),wa.releasePrimitive(E),V===1/0?null:(i.point?i.point.copy(k):i.point=k.clone(),i.distance=V,i.faceIndex=U,s&&(s.point?s.point.copy(I):s.point=I.clone(),s.point.applyMatrix4(dg),k.applyMatrix4(dg),s.distance=k.sub(s.point).length(),s.faceIndex=B),i)}function VV(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,i=e.index?e.index.array:null,s=e.attributes.position;let l,c,o,p,m=0;const x=n._roots;for(let b=0,E=x.length;b<E;b++)l=x[b],c=new Uint32Array(l),o=new Uint16Array(l),p=new Float32Array(l),v(0,m),m+=l.byteLength;function v(b,E,D=!1){const k=b*2;if(o[k+15]===M0){const I=c[b+6],V=o[k+14];let U=1/0,B=1/0,Z=1/0,Y=-1/0,K=-1/0,nt=-1/0;for(let q=I,J=I+V;q<J;q++){const ct=3*n.resolveTriangleIndex(q);for(let St=0;St<3;St++){let wt=ct+St;wt=i?i[wt]:wt;const Pt=s.getX(wt),Gt=s.getY(wt),Nt=s.getZ(wt);Pt<U&&(U=Pt),Pt>Y&&(Y=Pt),Gt<B&&(B=Gt),Gt>K&&(K=Gt),Nt<Z&&(Z=Nt),Nt>nt&&(nt=Nt)}}return p[b+0]!==U||p[b+1]!==B||p[b+2]!==Z||p[b+3]!==Y||p[b+4]!==K||p[b+5]!==nt?(p[b+0]=U,p[b+1]=B,p[b+2]=Z,p[b+3]=Y,p[b+4]=K,p[b+5]=nt,!0):!1}else{const I=b+8,V=c[b+6],U=I+E,B=V+E;let Z=D,Y=!1,K=!1;t?Z||(Y=t.has(U),K=t.has(B),Z=!Y&&!K):(Y=!0,K=!0);const nt=Z||Y,q=Z||K;let J=!1;nt&&(J=v(I,E,Z));let ct=!1;q&&(ct=v(V,E,Z));const St=J||ct;if(St)for(let wt=0;wt<3;wt++){const Pt=I+wt,Gt=V+wt,Nt=p[Pt],Zt=p[Pt+3],qt=p[Gt],me=p[Gt+3];p[b+wt]=Nt<qt?Nt:qt,p[b+wt+3]=Zt>me?Zt:me}return St}}}function GV(n,t,e,i,s,l,c){Tn.setBuffer(n._roots[t]),wb(0,n,e,i,s,l,c),Tn.clearBuffer()}function wb(n,t,e,i,s,l,c){const{float32Array:o,uint16Array:p,uint32Array:m}=Tn,x=n*2;if(Dr(x,p)){const b=sa(n,m),E=xa(x,p);PV(t,e,i,b,E,s,l,c)}else{const b=va(n);ic(b,o,i,l,c)&&wb(b,t,e,i,s,l,c);const E=ba(n,m);ic(E,o,i,l,c)&&wb(E,t,e,i,s,l,c)}}const HV=["x","y","z"];function jV(n,t,e,i,s,l){Tn.setBuffer(n._roots[t]);const c=Mb(0,n,e,i,s,l);return Tn.clearBuffer(),c}function Mb(n,t,e,i,s,l){const{float32Array:c,uint16Array:o,uint32Array:p}=Tn;let m=n*2;if(Dr(m,o)){const v=sa(n,p),b=xa(m,o);return IV(t,e,i,v,b,s,l)}else{const v=JA(n,p),b=HV[v],D=i.direction[b]>=0;let k,P;D?(k=va(n),P=ba(n,p)):(k=ba(n,p),P=va(n));const V=ic(k,c,i,s,l)?Mb(k,t,e,i,s,l):null;if(V){const Z=V.point[b];if(D?Z<=c[P+v]:Z>=c[P+v+3])return V}const B=ic(P,c,i,s,l)?Mb(P,t,e,i,s,l):null;return V&&B?V.distance<=B.distance?V:B:V||B||null}}const fg=new Nn,Iu=new Ga,Ru=new Ga,sp=new _i,JT=new xr,pg=new xr;function WV(n,t,e,i){Tn.setBuffer(n._roots[t]);const s=Sb(0,n,e,i);return Tn.clearBuffer(),s}function Sb(n,t,e,i,s=null){const{float32Array:l,uint16Array:c,uint32Array:o}=Tn;let p=n*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),JT.set(e.boundingBox.min,e.boundingBox.max,i),s=JT),Dr(p,c)){const x=t.geometry,v=x.index,b=x.attributes.position,E=e.index,D=e.attributes.position,k=sa(n,o),P=xa(p,c);if(sp.copy(i).invert(),e.boundsTree)return Gn(n,l,pg),pg.matrix.copy(sp),pg.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:V=>pg.intersectsBox(V),intersectsTriangle:V=>{V.a.applyMatrix4(i),V.b.applyMatrix4(i),V.c.applyMatrix4(i),V.needsUpdate=!0;for(let U=k,B=P+k;U<B;U++)if(es(Ru,3*t.resolveTriangleIndex(U),v,b),Ru.needsUpdate=!0,V.intersectsTriangle(Ru))return!0;return!1}});for(let I=k,V=P+k;I<V;I++){const U=t.resolveTriangleIndex(I);es(Iu,3*U,v,b),Iu.a.applyMatrix4(sp),Iu.b.applyMatrix4(sp),Iu.c.applyMatrix4(sp),Iu.needsUpdate=!0;for(let B=0,Z=E.count;B<Z;B+=3)if(es(Ru,B,E,D),Ru.needsUpdate=!0,Iu.intersectsTriangle(Ru))return!0}}else{const x=n+8,v=o[n+6];return Gn(x,l,fg),!!(s.intersectsBox(fg)&&Sb(x,t,e,i,s)||(Gn(v,l,fg),s.intersectsBox(fg)&&Sb(v,t,e,i,s)))}}const mg=new _i,Xx=new xr,rp=new xr,qV=new _t,XV=new _t,$V=new _t,ZV=new _t;function YV(n,t,e,i={},s={},l=0,c=1/0){t.boundingBox||t.computeBoundingBox(),Xx.set(t.boundingBox.min,t.boundingBox.max,e),Xx.needsUpdate=!0;const o=n.geometry,p=o.attributes.position,m=o.index,x=t.attributes.position,v=t.index,b=wa.getPrimitive(),E=wa.getPrimitive();let D=qV,k=XV,P=null,I=null;s&&(P=$V,I=ZV);let V=1/0,U=null,B=null;return mg.copy(e).invert(),rp.matrix.copy(mg),n.shapecast({boundsTraverseOrder:Z=>Xx.distanceToBox(Z),intersectsBounds:(Z,Y,K)=>K<V&&K<c?(Y&&(rp.min.copy(Z.min),rp.max.copy(Z.max),rp.needsUpdate=!0),!0):!1,intersectsRange:(Z,Y)=>{if(t.boundsTree){const K=t.boundsTree;return K.shapecast({boundsTraverseOrder:nt=>rp.distanceToBox(nt),intersectsBounds:(nt,q,J)=>J<V&&J<c,intersectsRange:(nt,q)=>{for(let J=nt,ct=nt+q;J<ct;J++){const St=K.resolveTriangleIndex(J);es(E,3*St,v,x),E.a.applyMatrix4(e),E.b.applyMatrix4(e),E.c.applyMatrix4(e),E.needsUpdate=!0;for(let wt=Z,Pt=Z+Y;wt<Pt;wt++){const Gt=n.resolveTriangleIndex(wt);es(b,3*Gt,m,p),b.needsUpdate=!0;const Nt=b.distanceToTriangle(E,D,P);if(Nt<V&&(k.copy(D),I&&I.copy(P),V=Nt,U=wt,B=J),Nt<l)return!0}}}})}else{const K=Fd(t);for(let nt=0,q=K;nt<q;nt++){es(E,3*nt,v,x),E.a.applyMatrix4(e),E.b.applyMatrix4(e),E.c.applyMatrix4(e),E.needsUpdate=!0;for(let J=Z,ct=Z+Y;J<ct;J++){const St=n.resolveTriangleIndex(J);es(b,3*St,m,p),b.needsUpdate=!0;const wt=b.distanceToTriangle(E,D,P);if(wt<V&&(k.copy(D),I&&I.copy(P),V=wt,U=J,B=nt),wt<l)return!0}}}}}),wa.releasePrimitive(b),wa.releasePrimitive(E),V===1/0?null:(i.point?i.point.copy(k):i.point=k.clone(),i.distance=V,i.faceIndex=U,s&&(s.point?s.point.copy(I):s.point=I.clone(),s.point.applyMatrix4(mg),k.applyMatrix4(mg),s.distance=k.sub(s.point).length(),s.faceIndex=B),i)}function KV(){return typeof SharedArrayBuffer<"u"}const Ip=new Tn.constructor,Qg=new Tn.constructor,Bl=new A1(()=>new Nn),Du=new Nn,Lu=new Nn,$x=new Nn,Zx=new Nn;let Yx=!1;function JV(n,t,e,i){if(Yx)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Yx=!0;const s=n._roots,l=t._roots;let c,o=0,p=0;const m=new _i().copy(e).invert();for(let x=0,v=s.length;x<v;x++){Ip.setBuffer(s[x]),p=0;const b=Bl.getPrimitive();Gn(0,Ip.float32Array,b),b.applyMatrix4(m);for(let E=0,D=l.length;E<D&&(Qg.setBuffer(l[E]),c=za(0,0,e,m,i,o,p,0,0,b),Qg.clearBuffer(),p+=l[E].length,!c);E++);if(Bl.releasePrimitive(b),Ip.clearBuffer(),o+=s[x].length,c)break}return Yx=!1,c}function za(n,t,e,i,s,l=0,c=0,o=0,p=0,m=null,x=!1){let v,b;x?(v=Qg,b=Ip):(v=Ip,b=Qg);const E=v.float32Array,D=v.uint32Array,k=v.uint16Array,P=b.float32Array,I=b.uint32Array,V=b.uint16Array,U=n*2,B=t*2,Z=Dr(U,k),Y=Dr(B,V);let K=!1;if(Y&&Z)x?K=s(sa(t,I),xa(t*2,V),sa(n,D),xa(n*2,k),p,c+t,o,l+n):K=s(sa(n,D),xa(n*2,k),sa(t,I),xa(t*2,V),o,l+n,p,c+t);else if(Y){const nt=Bl.getPrimitive();Gn(t,P,nt),nt.applyMatrix4(e);const q=va(n),J=ba(n,D);Gn(q,E,Du),Gn(J,E,Lu);const ct=nt.intersectsBox(Du),St=nt.intersectsBox(Lu);K=ct&&za(t,q,i,e,s,c,l,p,o+1,nt,!x)||St&&za(t,J,i,e,s,c,l,p,o+1,nt,!x),Bl.releasePrimitive(nt)}else{const nt=va(t),q=ba(t,I);Gn(nt,P,$x),Gn(q,P,Zx);const J=m.intersectsBox($x),ct=m.intersectsBox(Zx);if(J&&ct)K=za(n,nt,e,i,s,l,c,o,p+1,m,x)||za(n,q,e,i,s,l,c,o,p+1,m,x);else if(J)if(Z)K=za(n,nt,e,i,s,l,c,o,p+1,m,x);else{const St=Bl.getPrimitive();St.copy($x).applyMatrix4(e);const wt=va(n),Pt=ba(n,D);Gn(wt,E,Du),Gn(Pt,E,Lu);const Gt=St.intersectsBox(Du),Nt=St.intersectsBox(Lu);K=Gt&&za(nt,wt,i,e,s,c,l,p,o+1,St,!x)||Nt&&za(nt,Pt,i,e,s,c,l,p,o+1,St,!x),Bl.releasePrimitive(St)}else if(ct)if(Z)K=za(n,q,e,i,s,l,c,o,p+1,m,x);else{const St=Bl.getPrimitive();St.copy(Zx).applyMatrix4(e);const wt=va(n),Pt=ba(n,D);Gn(wt,E,Du),Gn(Pt,E,Lu);const Gt=St.intersectsBox(Du),Nt=St.intersectsBox(Lu);K=Gt&&za(q,wt,i,e,s,c,l,p,o+1,St,!x)||Nt&&za(q,Pt,i,e,s,c,l,p,o+1,St,!x),Bl.releasePrimitive(St)}}return K}const _g=new xr,QT=new Nn,QV={strategy:ZA,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class C1{static serialize(t,e={}){e={cloneBuffers:!0,...e};const i=t.geometry,s=t._roots,l=t._indirectBuffer,c=i.getIndex();let o;return e.cloneBuffers?o={roots:s.map(p=>p.slice()),index:c?c.array.slice():null,indirectBuffer:l?l.slice():null}:o={roots:s,index:c?c.array:null,indirectBuffer:l},o}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};const{index:s,roots:l,indirectBuffer:c}=t,o=new C1(e,{...i,[Vx]:!0});if(o._roots=l,o._indirectBuffer=c||null,i.setIndex){const p=e.getIndex();if(p===null){const m=new $n(t.index,1,!1);e.setIndex(m)}else p.array!==s&&(p.array.set(s),p.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({...QV,[Vx]:!1},e),e.useSharedArrayBuffer&&!KV())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Vx]||(pV(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Nn))),this.resolveTriangleIndex=e.indirect?i=>this._indirectBuffer[i]:i=>i}refit(t=null){return(this.indirect?VV:CV)(this,t)}traverse(t,e=0){const i=this._roots[e],s=new Uint32Array(i),l=new Uint16Array(i);c(0);function c(o,p=0){const m=o*2,x=l[m+15]===M0;if(x){const v=s[o+6],b=l[m+14];t(p,x,new Float32Array(i,o*4,6),v,b)}else{const v=o+Pp/4,b=s[o+6],E=s[o+7];t(p,x,new Float32Array(i,o*4,6),E)||(c(v,p+1),c(b,p+1))}}}raycast(t,e=Va,i=0,s=1/0){const l=this._roots,c=this.geometry,o=[],p=e.isMaterial,m=Array.isArray(e),x=c.groups,v=p?e.side:e,b=this.indirect?GV:DV;for(let E=0,D=l.length;E<D;E++){const k=m?e[x[E].materialIndex].side:v,P=o.length;if(b(this,E,k,t,o,i,s),m){const I=x[E].materialIndex;for(let V=P,U=o.length;V<U;V++)o[V].face.materialIndex=I}}return o}raycastFirst(t,e=Va,i=0,s=1/0){const l=this._roots,c=this.geometry,o=e.isMaterial,p=Array.isArray(e);let m=null;const x=c.groups,v=o?e.side:e,b=this.indirect?jV:kV;for(let E=0,D=l.length;E<D;E++){const k=p?e[x[E].materialIndex].side:v,P=b(this,E,k,t,i,s);P!=null&&(m==null||P.distance<m.distance)&&(m=P,p&&(P.face.materialIndex=x[E].materialIndex))}return m}intersectsGeometry(t,e){let i=!1;const s=this._roots,l=this.indirect?WV:FV;for(let c=0,o=s.length;c<o&&(i=l(this,c,t,e),!i);c++);return i}shapecast(t){const e=wa.getPrimitive(),i=this.indirect?RV:AV;let{boundsTraverseOrder:s,intersectsBounds:l,intersectsRange:c,intersectsTriangle:o}=t;if(c&&o){const v=c;c=(b,E,D,k,P)=>v(b,E,D,k,P)?!0:i(b,E,this,o,D,k,e)}else c||(o?c=(v,b,E,D)=>i(v,b,this,o,E,D,e):c=(v,b,E)=>E);let p=!1,m=0;const x=this._roots;for(let v=0,b=x.length;v<b;v++){const E=x[v];if(p=vV(this,v,l,c,s,m),p)break;m+=E.byteLength}return wa.releasePrimitive(e),p}bvhcast(t,e,i){let{intersectsRanges:s,intersectsTriangles:l}=i;const c=wa.getPrimitive(),o=this.geometry.index,p=this.geometry.attributes.position,m=this.indirect?D=>{const k=this.resolveTriangleIndex(D);es(c,k*3,o,p)}:D=>{es(c,D*3,o,p)},x=wa.getPrimitive(),v=t.geometry.index,b=t.geometry.attributes.position,E=t.indirect?D=>{const k=t.resolveTriangleIndex(D);es(x,k*3,v,b)}:D=>{es(x,D*3,v,b)};if(l){const D=(k,P,I,V,U,B,Z,Y)=>{for(let K=I,nt=I+V;K<nt;K++){E(K),x.a.applyMatrix4(e),x.b.applyMatrix4(e),x.c.applyMatrix4(e),x.needsUpdate=!0;for(let q=k,J=k+P;q<J;q++)if(m(q),c.needsUpdate=!0,l(c,x,q,K,U,B,Z,Y))return!0}return!1};if(s){const k=s;s=function(P,I,V,U,B,Z,Y,K){return k(P,I,V,U,B,Z,Y,K)?!0:D(P,I,V,U,B,Z,Y,K)}}else s=D}return JV(this,t,e,s)}intersectsBox(t,e){return _g.set(t.min,t.max,e),_g.needsUpdate=!0,this.shapecast({intersectsBounds:i=>_g.intersectsBox(i),intersectsTriangle:i=>_g.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},s={},l=0,c=1/0){return(this.indirect?YV:UV)(this,t,e,i,s,l,c)}closestPointToPoint(t,e={},i=0,s=1/0){return bV(this,t,e,i,s)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(i=>{Gn(0,new Float32Array(i),QT),t.union(QT)}),t}}function tE(n,t,e){return n===null?null:(n.point.applyMatrix4(t.matrixWorld),n.distance=n.point.distanceTo(e.ray.origin),n.object=t,n)}const gg=new _h,eE=new _t,iE=new _i,t8=os.prototype.raycast,e8=$U.prototype.raycast,nE=new _t,Is=new os,yg=[];function i8(n,t){this.isBatchedMesh?n8.call(this,n,t):s8.call(this,n,t)}function n8(n,t){if(this.boundsTrees){const e=this.boundsTrees,i=this._drawInfo||this._instanceInfo,s=this._drawRanges||this._geometryInfo,l=this.matrixWorld;Is.material=this.material,Is.geometry=this.geometry;const c=Is.geometry.boundsTree,o=Is.geometry.drawRange;Is.geometry.boundingSphere===null&&(Is.geometry.boundingSphere=new Ys);for(let p=0,m=i.length;p<m;p++){if(!this.getVisibleAt(p))continue;const x=i[p].geometryIndex;if(Is.geometry.boundsTree=e[x],this.getMatrixAt(p,Is.matrixWorld).premultiply(l),!Is.geometry.boundsTree){this.getBoundingBoxAt(x,Is.geometry.boundingBox),this.getBoundingSphereAt(x,Is.geometry.boundingSphere);const v=s[x];Is.geometry.setDrawRange(v.start,v.count)}Is.raycast(n,yg);for(let v=0,b=yg.length;v<b;v++){const E=yg[v];E.object=this,E.batchId=p,t.push(E)}yg.length=0}Is.geometry.boundsTree=c,Is.geometry.drawRange=o,Is.material=null,Is.geometry=null}else e8.call(this,n,t)}function s8(n,t){if(this.geometry.boundsTree){if(this.material===void 0)return;iE.copy(this.matrixWorld).invert(),gg.copy(n.ray).applyMatrix4(iE),nE.setFromMatrixScale(this.matrixWorld),eE.copy(gg.direction).multiply(nE);const e=eE.length(),i=n.near/e,s=n.far/e,l=this.geometry.boundsTree;if(n.firstHitOnly===!0){const c=tE(l.raycastFirst(gg,this.material,i,s),this,n);c&&t.push(c)}else{const c=l.raycast(gg,this.material,i,s);for(let o=0,p=c.length;o<p;o++){const m=tE(c[o],this,n);m&&t.push(m)}}}else t8.call(this,n,t)}function Oo(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function e2(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var aa={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},wd={duration:.5,overwrite:!1,delay:0},P1,Ks,Rn,Ma=1e8,wn=1/Ma,Tb=Math.PI*2,r8=Tb/4,a8=0,i2=Math.sqrt,o8=Math.cos,l8=Math.sin,Ss=function(t){return typeof t=="string"},Hn=function(t){return typeof t=="function"},Xo=function(t){return typeof t=="number"},I1=function(t){return typeof t>"u"},co=function(t){return typeof t=="object"},kr=function(t){return t!==!1},R1=function(){return typeof window<"u"},xg=function(t){return Hn(t)||Ss(t)},n2=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Js=Array.isArray,Eb=/(?:-?\.?\d|\.)+/gi,s2=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Xu=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Kx=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,r2=/[+-]=-?[.\d]+/,a2=/[^,'"\[\]\s]+/gi,c8=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,zn,Ka,Ab,D1,oa={},t0={},o2,l2=function(t){return(t0=ph(t,oa))&&Nr},L1=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},qp=function(t,e){return!e&&console.warn(t)},c2=function(t,e){return t&&(oa[t]=e)&&t0&&(t0[t]=e)||oa},Xp=function(){return 0},h8={suppressEvents:!0,isStart:!0,kill:!1},Dg={suppressEvents:!0,kill:!1},u8={suppressEvents:!0},k1={},Zl=[],Cb={},h2,Jr={},Jx={},sE=30,Lg=[],F1="",z1=function(t){var e=t[0],i,s;if(co(e)||Hn(e)||(t=[t]),!(i=(e._gsap||{}).harness)){for(s=Lg.length;s--&&!Lg[s].targetTest(e););i=Lg[s]}for(s=t.length;s--;)t[s]&&(t[s]._gsap||(t[s]._gsap=new k2(t[s],i)))||t.splice(s,1);return t},sh=function(t){return t._gsap||z1(Sa(t))[0]._gsap},u2=function(t,e,i){return(i=t[e])&&Hn(i)?t[e]():I1(i)&&t.getAttribute&&t.getAttribute(e)||i},Fr=function(t,e){return(t=t.split(",")).forEach(e)||t},Xn=function(t){return Math.round(t*1e5)/1e5||0},ws=function(t){return Math.round(t*1e7)/1e7||0},nd=function(t,e){var i=e.charAt(0),s=parseFloat(e.substr(2));return t=parseFloat(t),i==="+"?t+s:i==="-"?t-s:i==="*"?t*s:t/s},d8=function(t,e){for(var i=e.length,s=0;t.indexOf(e[s])<0&&++s<i;);return s<i},e0=function(){var t=Zl.length,e=Zl.slice(0),i,s;for(Cb={},Zl.length=0,i=0;i<t;i++)s=e[i],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},d2=function(t,e,i,s){Zl.length&&!Ks&&e0(),t.render(e,i,Ks&&e<0&&(t._initted||t._startAt)),Zl.length&&!Ks&&e0()},f2=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(a2).length<2?e:Ss(t)?t.trim():t},p2=function(t){return t},Aa=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},f8=function(t){return function(e,i){for(var s in i)s in e||s==="duration"&&t||s==="ease"||(e[s]=i[s])}},ph=function(t,e){for(var i in e)t[i]=e[i];return t},rE=function n(t,e){for(var i in e)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(t[i]=co(e[i])?n(t[i]||(t[i]={}),e[i]):e[i]);return t},i0=function(t,e){var i={},s;for(s in t)s in e||(i[s]=t[s]);return i},Rp=function(t){var e=t.parent||zn,i=t.keyframes?f8(Js(t.keyframes)):Aa;if(kr(t.inherit))for(;e;)i(t,e.vars.defaults),e=e.parent||e._dp;return t},p8=function(t,e){for(var i=t.length,s=i===e.length;s&&i--&&t[i]===e[i];);return i<0},m2=function(t,e,i,s,l){var c=t[s],o;if(l)for(o=e[l];c&&c[l]>o;)c=c._prev;return c?(e._next=c._next,c._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[s]=e,e._prev=c,e.parent=e._dp=t,e},T0=function(t,e,i,s){i===void 0&&(i="_first"),s===void 0&&(s="_last");var l=e._prev,c=e._next;l?l._next=c:t[i]===e&&(t[i]=c),c?c._prev=l:t[s]===e&&(t[s]=l),e._next=e._prev=e.parent=null},nc=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},rh=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},m8=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Pb=function(t,e,i,s){return t._startAt&&(Ks?t._startAt.revert(Dg):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,s))},_8=function n(t){return!t||t._ts&&n(t.parent)},aE=function(t){return t._repeat?Md(t._tTime,t=t.duration()+t._rDelay)*t:0},Md=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},n0=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},E0=function(t){return t._end=ws(t._start+(t._tDur/Math.abs(t._ts||t._rts||wn)||0))},A0=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=ws(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),E0(t),i._dirty||rh(i,t)),t},_2=function(t,e){var i;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(i=n0(t.rawTime(),e),(!e._dur||dm(0,e.totalDuration(),i)-e._tTime>wn)&&e.render(i,!0)),rh(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-wn}},to=function(t,e,i,s){return e.parent&&nc(e),e._start=ws((Xo(i)?i:i||t!==zn?ga(t,i,e):t._time)+e._delay),e._end=ws(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),m2(t,e,"_first","_last",t._sort?"_start":0),Ib(e)||(t._recent=e),s||_2(t,e),t._ts<0&&A0(t,t._tTime),t},g2=function(t,e){return(oa.ScrollTrigger||L1("scrollTrigger",e))&&oa.ScrollTrigger.create(e,t)},y2=function(t,e,i,s,l){if(B1(t,e,l),!t._initted)return 1;if(!i&&t._pt&&!Ks&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&h2!==ta.frame)return Zl.push(t),t._lazy=[l,s],1},g8=function n(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||n(e))},Ib=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},y8=function(t,e,i,s){var l=t.ratio,c=e<0||!e&&(!t._start&&g8(t)&&!(!t._initted&&Ib(t))||(t._ts<0||t._dp._ts<0)&&!Ib(t))?0:1,o=t._rDelay,p=0,m,x,v;if(o&&t._repeat&&(p=dm(0,t._tDur,e),x=Md(p,o),t._yoyo&&x&1&&(c=1-c),x!==Md(t._tTime,o)&&(l=1-c,t.vars.repeatRefresh&&t._initted&&t.invalidate())),c!==l||Ks||s||t._zTime===wn||!e&&t._zTime){if(!t._initted&&y2(t,e,s,i,p))return;for(v=t._zTime,t._zTime=e||(i?wn:0),i||(i=e&&!v),t.ratio=c,t._from&&(c=1-c),t._time=0,t._tTime=p,m=t._pt;m;)m.r(c,m.d),m=m._next;e<0&&Pb(t,e,i,!0),t._onUpdate&&!i&&ra(t,"onUpdate"),p&&t._repeat&&!i&&t.parent&&ra(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===c&&(c&&nc(t,1),!i&&!Ks&&(ra(t,c?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},x8=function(t,e,i){var s;if(i>e)for(s=t._first;s&&s._start<=i;){if(s.data==="isPause"&&s._start>e)return s;s=s._next}else for(s=t._last;s&&s._start>=i;){if(s.data==="isPause"&&s._start<e)return s;s=s._prev}},Sd=function(t,e,i,s){var l=t._repeat,c=ws(e)||0,o=t._tTime/t._tDur;return o&&!s&&(t._time*=c/t._dur),t._dur=c,t._tDur=l?l<0?1e10:ws(c*(l+1)+t._rDelay*l):c,o>0&&!s&&A0(t,t._tTime=t._tDur*o),t.parent&&E0(t),i||rh(t.parent,t),t},oE=function(t){return t instanceof ur?rh(t):Sd(t,t._dur)},v8={_start:0,endTime:Xp,totalDuration:Xp},ga=function n(t,e,i){var s=t.labels,l=t._recent||v8,c=t.duration()>=Ma?l.endTime(!1):t._dur,o,p,m;return Ss(e)&&(isNaN(e)||e in s)?(p=e.charAt(0),m=e.substr(-1)==="%",o=e.indexOf("="),p==="<"||p===">"?(o>=0&&(e=e.replace(/=/,"")),(p==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(e.substr(1))||0)*(m?(o<0?l:i).totalDuration()/100:1)):o<0?(e in s||(s[e]=c),s[e]):(p=parseFloat(e.charAt(o-1)+e.substr(o+1)),m&&i&&(p=p/100*(Js(i)?i[0]:i).totalDuration()),o>1?n(t,e.substr(0,o-1),i)+p:c+p)):e==null?c:+e},Dp=function(t,e,i){var s=Xo(e[1]),l=(s?2:1)+(t<2?0:1),c=e[l],o,p;if(s&&(c.duration=e[1]),c.parent=i,t){for(o=c,p=i;p&&!("immediateRender"in o);)o=p.vars.defaults||{},p=kr(p.vars.inherit)&&p.parent;c.immediateRender=kr(o.immediateRender),t<2?c.runBackwards=1:c.startAt=e[l-1]}return new ts(e[0],c,e[l+1])},oc=function(t,e){return t||t===0?e(t):e},dm=function(t,e,i){return i<t?t:i>e?e:i},Zs=function(t,e){return!Ss(t)||!(e=c8.exec(t))?"":e[1]},b8=function(t,e,i){return oc(i,function(s){return dm(t,e,s)})},Rb=[].slice,x2=function(t,e){return t&&co(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&co(t[0]))&&!t.nodeType&&t!==Ka},w8=function(t,e,i){return i===void 0&&(i=[]),t.forEach(function(s){var l;return Ss(s)&&!e||x2(s,1)?(l=i).push.apply(l,Sa(s)):i.push(s)})||i},Sa=function(t,e,i){return Rn&&!e&&Rn.selector?Rn.selector(t):Ss(t)&&!i&&(Ab||!Td())?Rb.call((e||D1).querySelectorAll(t),0):Js(t)?w8(t,i):x2(t)?Rb.call(t,0):t?[t]:[]},Db=function(t){return t=Sa(t)[0]||qp("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return Sa(e,i.querySelectorAll?i:i===t?qp("Invalid scope")||D1.createElement("div"):t)}},v2=function(t){return t.sort(function(){return .5-Math.random()})},b2=function(t){if(Hn(t))return t;var e=co(t)?t:{each:t},i=ah(e.ease),s=e.from||0,l=parseFloat(e.base)||0,c={},o=s>0&&s<1,p=isNaN(s)||o,m=e.axis,x=s,v=s;return Ss(s)?x=v={center:.5,edges:.5,end:1}[s]||0:!o&&p&&(x=s[0],v=s[1]),function(b,E,D){var k=(D||e).length,P=c[k],I,V,U,B,Z,Y,K,nt,q;if(!P){if(q=e.grid==="auto"?0:(e.grid||[1,Ma])[1],!q){for(K=-Ma;K<(K=D[q++].getBoundingClientRect().left)&&q<k;);q<k&&q--}for(P=c[k]=[],I=p?Math.min(q,k)*x-.5:s%q,V=q===Ma?0:p?k*v/q-.5:s/q|0,K=0,nt=Ma,Y=0;Y<k;Y++)U=Y%q-I,B=V-(Y/q|0),P[Y]=Z=m?Math.abs(m==="y"?B:U):i2(U*U+B*B),Z>K&&(K=Z),Z<nt&&(nt=Z);s==="random"&&v2(P),P.max=K-nt,P.min=nt,P.v=k=(parseFloat(e.amount)||parseFloat(e.each)*(q>k?k-1:m?m==="y"?k/q:q:Math.max(q,k/q))||0)*(s==="edges"?-1:1),P.b=k<0?l-k:l,P.u=Zs(e.amount||e.each)||0,i=i&&k<0?R2(i):i}return k=(P[b]-P.min)/P.max||0,ws(P.b+(i?i(k):k)*P.v)+P.u}},Lb=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var s=ws(Math.round(parseFloat(i)/t)*t*e);return(s-s%1)/e+(Xo(i)?0:Zs(i))}},w2=function(t,e){var i=Js(t),s,l;return!i&&co(t)&&(s=i=t.radius||Ma,t.values?(t=Sa(t.values),(l=!Xo(t[0]))&&(s*=s)):t=Lb(t.increment)),oc(e,i?Hn(t)?function(c){return l=t(c),Math.abs(l-c)<=s?l:c}:function(c){for(var o=parseFloat(l?c.x:c),p=parseFloat(l?c.y:0),m=Ma,x=0,v=t.length,b,E;v--;)l?(b=t[v].x-o,E=t[v].y-p,b=b*b+E*E):b=Math.abs(t[v]-o),b<m&&(m=b,x=v);return x=!s||m<=s?t[x]:c,l||x===c||Xo(c)?x:x+Zs(c)}:Lb(t))},M2=function(t,e,i,s){return oc(Js(t)?!e:i===!0?!!(i=0):!s,function(){return Js(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(s=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+i*.99))/i)*i*s)/s})},M8=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(s){return e.reduce(function(l,c){return c(l)},s)}},S8=function(t,e){return function(i){return t(parseFloat(i))+(e||Zs(i))}},T8=function(t,e,i){return T2(t,e,0,1,i)},S2=function(t,e,i){return oc(i,function(s){return t[~~e(s)]})},E8=function n(t,e,i){var s=e-t;return Js(t)?S2(t,n(0,t.length),e):oc(i,function(l){return(s+(l-t)%s)%s+t})},A8=function n(t,e,i){var s=e-t,l=s*2;return Js(t)?S2(t,n(0,t.length-1),e):oc(i,function(c){return c=(l+(c-t)%l)%l||0,t+(c>s?l-c:c)})},$p=function(t){for(var e=0,i="",s,l,c,o;~(s=t.indexOf("random(",e));)c=t.indexOf(")",s),o=t.charAt(s+7)==="[",l=t.substr(s+7,c-s-7).match(o?a2:Eb),i+=t.substr(e,s-e)+M2(o?l:+l[0],o?0:+l[1],+l[2]||1e-5),e=c+1;return i+t.substr(e,t.length-e)},T2=function(t,e,i,s,l){var c=e-t,o=s-i;return oc(l,function(p){return i+((p-t)/c*o||0)})},C8=function n(t,e,i,s){var l=isNaN(t+e)?0:function(E){return(1-E)*t+E*e};if(!l){var c=Ss(t),o={},p,m,x,v,b;if(i===!0&&(s=1)&&(i=null),c)t={p:t},e={p:e};else if(Js(t)&&!Js(e)){for(x=[],v=t.length,b=v-2,m=1;m<v;m++)x.push(n(t[m-1],t[m]));v--,l=function(D){D*=v;var k=Math.min(b,~~D);return x[k](D-k)},i=e}else s||(t=ph(Js(t)?[]:{},t));if(!x){for(p in e)O1.call(o,t,p,"get",e[p]);l=function(D){return V1(D,o)||(c?t.p:t)}}}return oc(i,l)},lE=function(t,e,i){var s=t.labels,l=Ma,c,o,p;for(c in s)o=s[c]-e,o<0==!!i&&o&&l>(o=Math.abs(o))&&(p=c,l=o);return p},ra=function(t,e,i){var s=t.vars,l=s[e],c=Rn,o=t._ctx,p,m,x;if(l)return p=s[e+"Params"],m=s.callbackScope||t,i&&Zl.length&&e0(),o&&(Rn=o),x=p?l.apply(m,p):l.call(m),Rn=c,x},_p=function(t){return nc(t),t.scrollTrigger&&t.scrollTrigger.kill(!!Ks),t.progress()<1&&ra(t,"onInterrupt"),t},$u,E2=[],A2=function(t){if(t)if(t=!t.name&&t.default||t,R1()||t.headless){var e=t.name,i=Hn(t),s=e&&!i&&t.init?function(){this._props=[]}:t,l={init:Xp,render:V1,add:O1,kill:j8,modifier:H8,rawVars:0},c={targetTest:0,get:0,getSetter:U1,aliases:{},register:0};if(Td(),t!==s){if(Jr[e])return;Aa(s,Aa(i0(t,l),c)),ph(s.prototype,ph(l,i0(t,c))),Jr[s.prop=e]=s,t.targetTest&&(Lg.push(s),k1[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}c2(e,s),t.register&&t.register(Nr,s,zr)}else E2.push(t)},xn=255,gp={aqua:[0,xn,xn],lime:[0,xn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,xn],navy:[0,0,128],white:[xn,xn,xn],olive:[128,128,0],yellow:[xn,xn,0],orange:[xn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[xn,0,0],pink:[xn,192,203],cyan:[0,xn,xn],transparent:[xn,xn,xn,0]},Qx=function(t,e,i){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(i-e)*t*6:t<.5?i:t*3<2?e+(i-e)*(2/3-t)*6:e)*xn+.5|0},C2=function(t,e,i){var s=t?Xo(t)?[t>>16,t>>8&xn,t&xn]:0:gp.black,l,c,o,p,m,x,v,b,E,D;if(!s){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),gp[t])s=gp[t];else if(t.charAt(0)==="#"){if(t.length<6&&(l=t.charAt(1),c=t.charAt(2),o=t.charAt(3),t="#"+l+l+c+c+o+o+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return s=parseInt(t.substr(1,6),16),[s>>16,s>>8&xn,s&xn,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),s=[t>>16,t>>8&xn,t&xn]}else if(t.substr(0,3)==="hsl"){if(s=D=t.match(Eb),!e)p=+s[0]%360/360,m=+s[1]/100,x=+s[2]/100,c=x<=.5?x*(m+1):x+m-x*m,l=x*2-c,s.length>3&&(s[3]*=1),s[0]=Qx(p+1/3,l,c),s[1]=Qx(p,l,c),s[2]=Qx(p-1/3,l,c);else if(~t.indexOf("="))return s=t.match(s2),i&&s.length<4&&(s[3]=1),s}else s=t.match(Eb)||gp.transparent;s=s.map(Number)}return e&&!D&&(l=s[0]/xn,c=s[1]/xn,o=s[2]/xn,v=Math.max(l,c,o),b=Math.min(l,c,o),x=(v+b)/2,v===b?p=m=0:(E=v-b,m=x>.5?E/(2-v-b):E/(v+b),p=v===l?(c-o)/E+(c<o?6:0):v===c?(o-l)/E+2:(l-c)/E+4,p*=60),s[0]=~~(p+.5),s[1]=~~(m*100+.5),s[2]=~~(x*100+.5)),i&&s.length<4&&(s[3]=1),s},P2=function(t){var e=[],i=[],s=-1;return t.split(Yl).forEach(function(l){var c=l.match(Xu)||[];e.push.apply(e,c),i.push(s+=c.length+1)}),e.c=i,e},cE=function(t,e,i){var s="",l=(t+s).match(Yl),c=e?"hsla(":"rgba(",o=0,p,m,x,v;if(!l)return t;if(l=l.map(function(b){return(b=C2(b,e,1))&&c+(e?b[0]+","+b[1]+"%,"+b[2]+"%,"+b[3]:b.join(","))+")"}),i&&(x=P2(t),p=i.c,p.join(s)!==x.c.join(s)))for(m=t.replace(Yl,"1").split(Xu),v=m.length-1;o<v;o++)s+=m[o]+(~p.indexOf(o)?l.shift()||c+"0,0,0,0)":(x.length?x:l.length?l:i).shift());if(!m)for(m=t.split(Yl),v=m.length-1;o<v;o++)s+=m[o]+l[o];return s+m[v]},Yl=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in gp)n+="|"+t+"\\b";return new RegExp(n+")","gi")}(),P8=/hsl[a]?\(/,I2=function(t){var e=t.join(" "),i;if(Yl.lastIndex=0,Yl.test(e))return i=P8.test(e),t[1]=cE(t[1],i),t[0]=cE(t[0],i,P2(t[1])),!0},Zp,ta=function(){var n=Date.now,t=500,e=33,i=n(),s=i,l=1e3/240,c=l,o=[],p,m,x,v,b,E,D=function k(P){var I=n()-s,V=P===!0,U,B,Z,Y;if((I>t||I<0)&&(i+=I-e),s+=I,Z=s-i,U=Z-c,(U>0||V)&&(Y=++v.frame,b=Z-v.time*1e3,v.time=Z=Z/1e3,c+=U+(U>=l?4:l-U),B=1),V||(p=m(k)),B)for(E=0;E<o.length;E++)o[E](Z,b,Y,P)};return v={time:0,frame:0,tick:function(){D(!0)},deltaRatio:function(P){return b/(1e3/(P||60))},wake:function(){o2&&(!Ab&&R1()&&(Ka=Ab=window,D1=Ka.document||{},oa.gsap=Nr,(Ka.gsapVersions||(Ka.gsapVersions=[])).push(Nr.version),l2(t0||Ka.GreenSockGlobals||!Ka.gsap&&Ka||{}),E2.forEach(A2)),x=typeof requestAnimationFrame<"u"&&requestAnimationFrame,p&&v.sleep(),m=x||function(P){return setTimeout(P,c-v.time*1e3+1|0)},Zp=1,D(2))},sleep:function(){(x?cancelAnimationFrame:clearTimeout)(p),Zp=0,m=Xp},lagSmoothing:function(P,I){t=P||1/0,e=Math.min(I||33,t)},fps:function(P){l=1e3/(P||240),c=v.time*1e3+l},add:function(P,I,V){var U=I?function(B,Z,Y,K){P(B,Z,Y,K),v.remove(U)}:P;return v.remove(P),o[V?"unshift":"push"](U),Td(),U},remove:function(P,I){~(I=o.indexOf(P))&&o.splice(I,1)&&E>=I&&E--},_listeners:o},v}(),Td=function(){return!Zp&&ta.wake()},Wi={},I8=/^[\d.\-M][\d.\-,\s]/,R8=/["']/g,D8=function(t){for(var e={},i=t.substr(1,t.length-3).split(":"),s=i[0],l=1,c=i.length,o,p,m;l<c;l++)p=i[l],o=l!==c-1?p.lastIndexOf(","):p.length,m=p.substr(0,o),e[s]=isNaN(m)?m.replace(R8,"").trim():+m,s=p.substr(o+1).trim();return e},L8=function(t){var e=t.indexOf("(")+1,i=t.indexOf(")"),s=t.indexOf("(",e);return t.substring(e,~s&&s<i?t.indexOf(")",i+1):i)},k8=function(t){var e=(t+"").split("("),i=Wi[e[0]];return i&&e.length>1&&i.config?i.config.apply(null,~t.indexOf("{")?[D8(e[1])]:L8(t).split(",").map(f2)):Wi._CE&&I8.test(t)?Wi._CE("",t):i},R2=function(t){return function(e){return 1-t(1-e)}},D2=function n(t,e){for(var i=t._first,s;i;)i instanceof ur?n(i,e):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==e&&(i.timeline?n(i.timeline,e):(s=i._ease,i._ease=i._yEase,i._yEase=s,i._yoyo=e)),i=i._next},ah=function(t,e){return t&&(Hn(t)?t:Wi[t]||k8(t))||e},gh=function(t,e,i,s){i===void 0&&(i=function(p){return 1-e(1-p)}),s===void 0&&(s=function(p){return p<.5?e(p*2)/2:1-e((1-p)*2)/2});var l={easeIn:e,easeOut:i,easeInOut:s},c;return Fr(t,function(o){Wi[o]=oa[o]=l,Wi[c=o.toLowerCase()]=i;for(var p in l)Wi[c+(p==="easeIn"?".in":p==="easeOut"?".out":".inOut")]=Wi[o+"."+p]=l[p]}),l},L2=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},tv=function n(t,e,i){var s=e>=1?e:1,l=(i||(t?.3:.45))/(e<1?e:1),c=l/Tb*(Math.asin(1/s)||0),o=function(x){return x===1?1:s*Math.pow(2,-10*x)*l8((x-c)*l)+1},p=t==="out"?o:t==="in"?function(m){return 1-o(1-m)}:L2(o);return l=Tb/l,p.config=function(m,x){return n(t,m,x)},p},ev=function n(t,e){e===void 0&&(e=1.70158);var i=function(c){return c?--c*c*((e+1)*c+e)+1:0},s=t==="out"?i:t==="in"?function(l){return 1-i(1-l)}:L2(i);return s.config=function(l){return n(t,l)},s};Fr("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,t){var e=t<5?t+1:t;gh(n+",Power"+(e-1),t?function(i){return Math.pow(i,e)}:function(i){return i},function(i){return 1-Math.pow(1-i,e)},function(i){return i<.5?Math.pow(i*2,e)/2:1-Math.pow((1-i)*2,e)/2})});Wi.Linear.easeNone=Wi.none=Wi.Linear.easeIn;gh("Elastic",tv("in"),tv("out"),tv());(function(n,t){var e=1/t,i=2*e,s=2.5*e,l=function(o){return o<e?n*o*o:o<i?n*Math.pow(o-1.5/t,2)+.75:o<s?n*(o-=2.25/t)*o+.9375:n*Math.pow(o-2.625/t,2)+.984375};gh("Bounce",function(c){return 1-l(1-c)},l)})(7.5625,2.75);gh("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});gh("Circ",function(n){return-(i2(1-n*n)-1)});gh("Sine",function(n){return n===1?1:-o8(n*r8)+1});gh("Back",ev("in"),ev("out"),ev());Wi.SteppedEase=Wi.steps=oa.SteppedEase={config:function(t,e){t===void 0&&(t=1);var i=1/t,s=t+(e?0:1),l=e?1:0,c=1-wn;return function(o){return((s*dm(0,c,o)|0)+l)*i}}};wd.ease=Wi["quad.out"];Fr("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return F1+=n+","+n+"Params,"});var k2=function(t,e){this.id=a8++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:u2,this.set=e?e.getSetter:U1},Yp=function(){function n(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Sd(this,+e.duration,1,1),this.data=e.data,Rn&&(this._ctx=Rn,Rn.data.push(this)),Zp||ta.wake()}var t=n.prototype;return t.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},t.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},t.totalDuration=function(i){return arguments.length?(this._dirty=0,Sd(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(i,s){if(Td(),!arguments.length)return this._tTime;var l=this._dp;if(l&&l.smoothChildTiming&&this._ts){for(A0(this,i),!l._dp||l.parent||_2(l,this);l&&l.parent;)l.parent._time!==l._start+(l._ts>=0?l._tTime/l._ts:(l.totalDuration()-l._tTime)/-l._ts)&&l.totalTime(l._tTime,!0),l=l.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&to(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===wn||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),d2(this,i,s)),this},t.time=function(i,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+aE(this))%(this._dur+this._rDelay)||(i?this._dur:0),s):this._time},t.totalProgress=function(i,s){return arguments.length?this.totalTime(this.totalDuration()*i,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},t.progress=function(i,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+aE(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(i,s){var l=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*l,s):this._repeat?Md(this._tTime,l)+1:1},t.timeScale=function(i,s){if(!arguments.length)return this._rts===-wn?0:this._rts;if(this._rts===i)return this;var l=this.parent&&this._ts?n0(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-wn?0:this._rts,this.totalTime(dm(-Math.abs(this._delay),this._tDur,l),s!==!1),E0(this),m8(this)},t.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Td(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==wn&&(this._tTime-=wn)))),this):this._ps},t.startTime=function(i){if(arguments.length){this._start=i;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&to(s,this,i-this._delay),this}return this._start},t.endTime=function(i){return this._start+(kr(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(i){var s=this.parent||this._dp;return s?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?n0(s.rawTime(i),this):this._tTime:this._tTime},t.revert=function(i){i===void 0&&(i=u8);var s=Ks;return Ks=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),Ks=s,this},t.globalTime=function(i){for(var s=this,l=arguments.length?i:s.rawTime();s;)l=s._start+l/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(i):l},t.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,oE(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(i){if(arguments.length){var s=this._time;return this._rDelay=i,oE(this),s?this.time(s):this}return this._rDelay},t.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},t.seek=function(i,s){return this.totalTime(ga(this,i),kr(s))},t.restart=function(i,s){return this.play().totalTime(i?-this._delay:0,kr(s))},t.play=function(i,s){return i!=null&&this.seek(i,s),this.reversed(!1).paused(!1)},t.reverse=function(i,s){return i!=null&&this.seek(i||this.totalDuration(),s),this.reversed(!0).paused(!1)},t.pause=function(i,s){return i!=null&&this.seek(i,s),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-wn:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-wn,this},t.isActive=function(){var i=this.parent||this._dp,s=this._start,l;return!!(!i||this._ts&&this._initted&&i.isActive()&&(l=i.rawTime(!0))>=s&&l<this.endTime(!0)-wn)},t.eventCallback=function(i,s,l){var c=this.vars;return arguments.length>1?(s?(c[i]=s,l&&(c[i+"Params"]=l),i==="onUpdate"&&(this._onUpdate=s)):delete c[i],this):c[i]},t.then=function(i){var s=this;return new Promise(function(l){var c=Hn(i)?i:p2,o=function(){var m=s.then;s.then=null,Hn(c)&&(c=c(s))&&(c.then||c===s)&&(s.then=m),l(c),s.then=m};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?o():s._prom=o})},t.kill=function(){_p(this)},n}();Aa(Yp.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-wn,_prom:0,_ps:!1,_rts:1});var ur=function(n){e2(t,n);function t(i,s){var l;return i===void 0&&(i={}),l=n.call(this,i)||this,l.labels={},l.smoothChildTiming=!!i.smoothChildTiming,l.autoRemoveChildren=!!i.autoRemoveChildren,l._sort=kr(i.sortChildren),zn&&to(i.parent||zn,Oo(l),s),i.reversed&&l.reverse(),i.paused&&l.paused(!0),i.scrollTrigger&&g2(Oo(l),i.scrollTrigger),l}var e=t.prototype;return e.to=function(s,l,c){return Dp(0,arguments,this),this},e.from=function(s,l,c){return Dp(1,arguments,this),this},e.fromTo=function(s,l,c,o){return Dp(2,arguments,this),this},e.set=function(s,l,c){return l.duration=0,l.parent=this,Rp(l).repeatDelay||(l.repeat=0),l.immediateRender=!!l.immediateRender,new ts(s,l,ga(this,c),1),this},e.call=function(s,l,c){return to(this,ts.delayedCall(0,s,l),c)},e.staggerTo=function(s,l,c,o,p,m,x){return c.duration=l,c.stagger=c.stagger||o,c.onComplete=m,c.onCompleteParams=x,c.parent=this,new ts(s,c,ga(this,p)),this},e.staggerFrom=function(s,l,c,o,p,m,x){return c.runBackwards=1,Rp(c).immediateRender=kr(c.immediateRender),this.staggerTo(s,l,c,o,p,m,x)},e.staggerFromTo=function(s,l,c,o,p,m,x,v){return o.startAt=c,Rp(o).immediateRender=kr(o.immediateRender),this.staggerTo(s,l,o,p,m,x,v)},e.render=function(s,l,c){var o=this._time,p=this._dirty?this.totalDuration():this._tDur,m=this._dur,x=s<=0?0:ws(s),v=this._zTime<0!=s<0&&(this._initted||!m),b,E,D,k,P,I,V,U,B,Z,Y,K;if(this!==zn&&x>p&&s>=0&&(x=p),x!==this._tTime||c||v){if(o!==this._time&&m&&(x+=this._time-o,s+=this._time-o),b=x,B=this._start,U=this._ts,I=!U,v&&(m||(o=this._zTime),(s||!l)&&(this._zTime=s)),this._repeat){if(Y=this._yoyo,P=m+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(P*100+s,l,c);if(b=ws(x%P),x===p?(k=this._repeat,b=m):(k=~~(x/P),k&&k===x/P&&(b=m,k--),b>m&&(b=m)),Z=Md(this._tTime,P),!o&&this._tTime&&Z!==k&&this._tTime-Z*P-this._dur<=0&&(Z=k),Y&&k&1&&(b=m-b,K=1),k!==Z&&!this._lock){var nt=Y&&Z&1,q=nt===(Y&&k&1);if(k<Z&&(nt=!nt),o=nt?0:x%m?m:x,this._lock=1,this.render(o||(K?0:ws(k*P)),l,!m)._lock=0,this._tTime=x,!l&&this.parent&&ra(this,"onRepeat"),this.vars.repeatRefresh&&!K&&(this.invalidate()._lock=1),o&&o!==this._time||I!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(m=this._dur,p=this._tDur,q&&(this._lock=2,o=nt?m:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!K&&this.invalidate()),this._lock=0,!this._ts&&!I)return this;D2(this,K)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(V=x8(this,ws(o),ws(b)),V&&(x-=b-(b=V._start))),this._tTime=x,this._time=b,this._act=!U,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,o=0),!o&&b&&!l&&!k&&(ra(this,"onStart"),this._tTime!==x))return this;if(b>=o&&s>=0)for(E=this._first;E;){if(D=E._next,(E._act||b>=E._start)&&E._ts&&V!==E){if(E.parent!==this)return this.render(s,l,c);if(E.render(E._ts>0?(b-E._start)*E._ts:(E._dirty?E.totalDuration():E._tDur)+(b-E._start)*E._ts,l,c),b!==this._time||!this._ts&&!I){V=0,D&&(x+=this._zTime=-wn);break}}E=D}else{E=this._last;for(var J=s<0?s:b;E;){if(D=E._prev,(E._act||J<=E._end)&&E._ts&&V!==E){if(E.parent!==this)return this.render(s,l,c);if(E.render(E._ts>0?(J-E._start)*E._ts:(E._dirty?E.totalDuration():E._tDur)+(J-E._start)*E._ts,l,c||Ks&&(E._initted||E._startAt)),b!==this._time||!this._ts&&!I){V=0,D&&(x+=this._zTime=J?-wn:wn);break}}E=D}}if(V&&!l&&(this.pause(),V.render(b>=o?0:-wn)._zTime=b>=o?1:-1,this._ts))return this._start=B,E0(this),this.render(s,l,c);this._onUpdate&&!l&&ra(this,"onUpdate",!0),(x===p&&this._tTime>=this.totalDuration()||!x&&o)&&(B===this._start||Math.abs(U)!==Math.abs(this._ts))&&(this._lock||((s||!m)&&(x===p&&this._ts>0||!x&&this._ts<0)&&nc(this,1),!l&&!(s<0&&!o)&&(x||o||!p)&&(ra(this,x===p&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(x<p&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(s,l){var c=this;if(Xo(l)||(l=ga(this,l,s)),!(s instanceof Yp)){if(Js(s))return s.forEach(function(o){return c.add(o,l)}),this;if(Ss(s))return this.addLabel(s,l);if(Hn(s))s=ts.delayedCall(0,s);else return this}return this!==s?to(this,s,l):this},e.getChildren=function(s,l,c,o){s===void 0&&(s=!0),l===void 0&&(l=!0),c===void 0&&(c=!0),o===void 0&&(o=-Ma);for(var p=[],m=this._first;m;)m._start>=o&&(m instanceof ts?l&&p.push(m):(c&&p.push(m),s&&p.push.apply(p,m.getChildren(!0,l,c)))),m=m._next;return p},e.getById=function(s){for(var l=this.getChildren(1,1,1),c=l.length;c--;)if(l[c].vars.id===s)return l[c]},e.remove=function(s){return Ss(s)?this.removeLabel(s):Hn(s)?this.killTweensOf(s):(T0(this,s),s===this._recent&&(this._recent=this._last),rh(this))},e.totalTime=function(s,l){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ws(ta.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),n.prototype.totalTime.call(this,s,l),this._forcing=0,this):this._tTime},e.addLabel=function(s,l){return this.labels[s]=ga(this,l),this},e.removeLabel=function(s){return delete this.labels[s],this},e.addPause=function(s,l,c){var o=ts.delayedCall(0,l||Xp,c);return o.data="isPause",this._hasPause=1,to(this,o,ga(this,s))},e.removePause=function(s){var l=this._first;for(s=ga(this,s);l;)l._start===s&&l.data==="isPause"&&nc(l),l=l._next},e.killTweensOf=function(s,l,c){for(var o=this.getTweensOf(s,c),p=o.length;p--;)Hl!==o[p]&&o[p].kill(s,l);return this},e.getTweensOf=function(s,l){for(var c=[],o=Sa(s),p=this._first,m=Xo(l),x;p;)p instanceof ts?d8(p._targets,o)&&(m?(!Hl||p._initted&&p._ts)&&p.globalTime(0)<=l&&p.globalTime(p.totalDuration())>l:!l||p.isActive())&&c.push(p):(x=p.getTweensOf(o,l)).length&&c.push.apply(c,x),p=p._next;return c},e.tweenTo=function(s,l){l=l||{};var c=this,o=ga(c,s),p=l,m=p.startAt,x=p.onStart,v=p.onStartParams,b=p.immediateRender,E,D=ts.to(c,Aa({ease:l.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:l.duration||Math.abs((o-(m&&"time"in m?m.time:c._time))/c.timeScale())||wn,onStart:function(){if(c.pause(),!E){var P=l.duration||Math.abs((o-(m&&"time"in m?m.time:c._time))/c.timeScale());D._dur!==P&&Sd(D,P,0,1).render(D._time,!0,!0),E=1}x&&x.apply(D,v||[])}},l));return b?D.render(0):D},e.tweenFromTo=function(s,l,c){return this.tweenTo(l,Aa({startAt:{time:ga(this,s)}},c))},e.recent=function(){return this._recent},e.nextLabel=function(s){return s===void 0&&(s=this._time),lE(this,ga(this,s))},e.previousLabel=function(s){return s===void 0&&(s=this._time),lE(this,ga(this,s),1)},e.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+wn)},e.shiftChildren=function(s,l,c){c===void 0&&(c=0);for(var o=this._first,p=this.labels,m;o;)o._start>=c&&(o._start+=s,o._end+=s),o=o._next;if(l)for(m in p)p[m]>=c&&(p[m]+=s);return rh(this)},e.invalidate=function(s){var l=this._first;for(this._lock=0;l;)l.invalidate(s),l=l._next;return n.prototype.invalidate.call(this,s)},e.clear=function(s){s===void 0&&(s=!0);for(var l=this._first,c;l;)c=l._next,this.remove(l),l=c;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),rh(this)},e.totalDuration=function(s){var l=0,c=this,o=c._last,p=Ma,m,x,v;if(arguments.length)return c.timeScale((c._repeat<0?c.duration():c.totalDuration())/(c.reversed()?-s:s));if(c._dirty){for(v=c.parent;o;)m=o._prev,o._dirty&&o.totalDuration(),x=o._start,x>p&&c._sort&&o._ts&&!c._lock?(c._lock=1,to(c,o,x-o._delay,1)._lock=0):p=x,x<0&&o._ts&&(l-=x,(!v&&!c._dp||v&&v.smoothChildTiming)&&(c._start+=x/c._ts,c._time-=x,c._tTime-=x),c.shiftChildren(-x,!1,-1/0),p=0),o._end>l&&o._ts&&(l=o._end),o=m;Sd(c,c===zn&&c._time>l?c._time:l,1,1),c._dirty=0}return c._tDur},t.updateRoot=function(s){if(zn._ts&&(d2(zn,n0(s,zn)),h2=ta.frame),ta.frame>=sE){sE+=aa.autoSleep||120;var l=zn._first;if((!l||!l._ts)&&aa.autoSleep&&ta._listeners.length<2){for(;l&&!l._ts;)l=l._next;l||ta.sleep()}}},t}(Yp);Aa(ur.prototype,{_lock:0,_hasPause:0,_forcing:0});var F8=function(t,e,i,s,l,c,o){var p=new zr(this._pt,t,e,0,1,U2,null,l),m=0,x=0,v,b,E,D,k,P,I,V;for(p.b=i,p.e=s,i+="",s+="",(I=~s.indexOf("random("))&&(s=$p(s)),c&&(V=[i,s],c(V,t,e),i=V[0],s=V[1]),b=i.match(Kx)||[];v=Kx.exec(s);)D=v[0],k=s.substring(m,v.index),E?E=(E+1)%5:k.substr(-5)==="rgba("&&(E=1),D!==b[x++]&&(P=parseFloat(b[x-1])||0,p._pt={_next:p._pt,p:k||x===1?k:",",s:P,c:D.charAt(1)==="="?nd(P,D)-P:parseFloat(D)-P,m:E&&E<4?Math.round:0},m=Kx.lastIndex);return p.c=m<s.length?s.substring(m,s.length):"",p.fp=o,(r2.test(s)||I)&&(p.e=0),this._pt=p,p},O1=function(t,e,i,s,l,c,o,p,m,x){Hn(s)&&(s=s(l||0,t,c));var v=t[e],b=i!=="get"?i:Hn(v)?m?t[e.indexOf("set")||!Hn(t["get"+e.substr(3)])?e:"get"+e.substr(3)](m):t[e]():v,E=Hn(v)?m?U8:B2:N1,D;if(Ss(s)&&(~s.indexOf("random(")&&(s=$p(s)),s.charAt(1)==="="&&(D=nd(b,s)+(Zs(b)||0),(D||D===0)&&(s=D))),!x||b!==s||kb)return!isNaN(b*s)&&s!==""?(D=new zr(this._pt,t,e,+b||0,s-(b||0),typeof v=="boolean"?G8:N2,0,E),m&&(D.fp=m),o&&D.modifier(o,this,t),this._pt=D):(!v&&!(e in t)&&L1(e,s),F8.call(this,t,e,b,s,E,p||aa.stringFilter,m))},z8=function(t,e,i,s,l){if(Hn(t)&&(t=Lp(t,l,e,i,s)),!co(t)||t.style&&t.nodeType||Js(t)||n2(t))return Ss(t)?Lp(t,l,e,i,s):t;var c={},o;for(o in t)c[o]=Lp(t[o],l,e,i,s);return c},F2=function(t,e,i,s,l,c){var o,p,m,x;if(Jr[t]&&(o=new Jr[t]).init(l,o.rawVars?e[t]:z8(e[t],s,l,c,i),i,s,c)!==!1&&(i._pt=p=new zr(i._pt,l,t,0,1,o.render,o,0,o.priority),i!==$u))for(m=i._ptLookup[i._targets.indexOf(l)],x=o._props.length;x--;)m[o._props[x]]=p;return o},Hl,kb,B1=function n(t,e,i){var s=t.vars,l=s.ease,c=s.startAt,o=s.immediateRender,p=s.lazy,m=s.onUpdate,x=s.runBackwards,v=s.yoyoEase,b=s.keyframes,E=s.autoRevert,D=t._dur,k=t._startAt,P=t._targets,I=t.parent,V=I&&I.data==="nested"?I.vars.targets:P,U=t._overwrite==="auto"&&!P1,B=t.timeline,Z,Y,K,nt,q,J,ct,St,wt,Pt,Gt,Nt,Zt;if(B&&(!b||!l)&&(l="none"),t._ease=ah(l,wd.ease),t._yEase=v?R2(ah(v===!0?l:v,wd.ease)):0,v&&t._yoyo&&!t._repeat&&(v=t._yEase,t._yEase=t._ease,t._ease=v),t._from=!B&&!!s.runBackwards,!B||b&&!s.stagger){if(St=P[0]?sh(P[0]).harness:0,Nt=St&&s[St.prop],Z=i0(s,k1),k&&(k._zTime<0&&k.progress(1),e<0&&x&&o&&!E?k.render(-1,!0):k.revert(x&&D?Dg:h8),k._lazy=0),c){if(nc(t._startAt=ts.set(P,Aa({data:"isStart",overwrite:!1,parent:I,immediateRender:!0,lazy:!k&&kr(p),startAt:null,delay:0,onUpdate:m&&function(){return ra(t,"onUpdate")},stagger:0},c))),t._startAt._dp=0,t._startAt._sat=t,e<0&&(Ks||!o&&!E)&&t._startAt.revert(Dg),o&&D&&e<=0&&i<=0){e&&(t._zTime=e);return}}else if(x&&D&&!k){if(e&&(o=!1),K=Aa({overwrite:!1,data:"isFromStart",lazy:o&&!k&&kr(p),immediateRender:o,stagger:0,parent:I},Z),Nt&&(K[St.prop]=Nt),nc(t._startAt=ts.set(P,K)),t._startAt._dp=0,t._startAt._sat=t,e<0&&(Ks?t._startAt.revert(Dg):t._startAt.render(-1,!0)),t._zTime=e,!o)n(t._startAt,wn,wn);else if(!e)return}for(t._pt=t._ptCache=0,p=D&&kr(p)||p&&!D,Y=0;Y<P.length;Y++){if(q=P[Y],ct=q._gsap||z1(P)[Y]._gsap,t._ptLookup[Y]=Pt={},Cb[ct.id]&&Zl.length&&e0(),Gt=V===P?Y:V.indexOf(q),St&&(wt=new St).init(q,Nt||Z,t,Gt,V)!==!1&&(t._pt=nt=new zr(t._pt,q,wt.name,0,1,wt.render,wt,0,wt.priority),wt._props.forEach(function(qt){Pt[qt]=nt}),wt.priority&&(J=1)),!St||Nt)for(K in Z)Jr[K]&&(wt=F2(K,Z,t,Gt,q,V))?wt.priority&&(J=1):Pt[K]=nt=O1.call(t,q,K,"get",Z[K],Gt,V,0,s.stringFilter);t._op&&t._op[Y]&&t.kill(q,t._op[Y]),U&&t._pt&&(Hl=t,zn.killTweensOf(q,Pt,t.globalTime(e)),Zt=!t.parent,Hl=0),t._pt&&p&&(Cb[ct.id]=1)}J&&V2(t),t._onInit&&t._onInit(t)}t._onUpdate=m,t._initted=(!t._op||t._pt)&&!Zt,b&&e<=0&&B.render(Ma,!0,!0)},O8=function(t,e,i,s,l,c,o,p){var m=(t._pt&&t._ptCache||(t._ptCache={}))[e],x,v,b,E;if(!m)for(m=t._ptCache[e]=[],b=t._ptLookup,E=t._targets.length;E--;){if(x=b[E][e],x&&x.d&&x.d._pt)for(x=x.d._pt;x&&x.p!==e&&x.fp!==e;)x=x._next;if(!x)return kb=1,t.vars[e]="+=0",B1(t,o),kb=0,p?qp(e+" not eligible for reset"):1;m.push(x)}for(E=m.length;E--;)v=m[E],x=v._pt||v,x.s=(s||s===0)&&!l?s:x.s+(s||0)+c*x.c,x.c=i-x.s,v.e&&(v.e=Xn(i)+Zs(v.e)),v.b&&(v.b=x.s+Zs(v.b))},B8=function(t,e){var i=t[0]?sh(t[0]).harness:0,s=i&&i.aliases,l,c,o,p;if(!s)return e;l=ph({},e);for(c in s)if(c in l)for(p=s[c].split(","),o=p.length;o--;)l[p[o]]=l[c];return l},N8=function(t,e,i,s){var l=e.ease||s||"power1.inOut",c,o;if(Js(e))o=i[t]||(i[t]=[]),e.forEach(function(p,m){return o.push({t:m/(e.length-1)*100,v:p,e:l})});else for(c in e)o=i[c]||(i[c]=[]),c==="ease"||o.push({t:parseFloat(t),v:e[c],e:l})},Lp=function(t,e,i,s,l){return Hn(t)?t.call(e,i,s,l):Ss(t)&&~t.indexOf("random(")?$p(t):t},z2=F1+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",O2={};Fr(z2+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return O2[n]=1});var ts=function(n){e2(t,n);function t(i,s,l,c){var o;typeof s=="number"&&(l.duration=s,s=l,l=null),o=n.call(this,c?s:Rp(s))||this;var p=o.vars,m=p.duration,x=p.delay,v=p.immediateRender,b=p.stagger,E=p.overwrite,D=p.keyframes,k=p.defaults,P=p.scrollTrigger,I=p.yoyoEase,V=s.parent||zn,U=(Js(i)||n2(i)?Xo(i[0]):"length"in s)?[i]:Sa(i),B,Z,Y,K,nt,q,J,ct;if(o._targets=U.length?z1(U):qp("GSAP target "+i+" not found. https://gsap.com",!aa.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=E,D||b||xg(m)||xg(x)){if(s=o.vars,B=o.timeline=new ur({data:"nested",defaults:k||{},targets:V&&V.data==="nested"?V.vars.targets:U}),B.kill(),B.parent=B._dp=Oo(o),B._start=0,b||xg(m)||xg(x)){if(K=U.length,J=b&&b2(b),co(b))for(nt in b)~z2.indexOf(nt)&&(ct||(ct={}),ct[nt]=b[nt]);for(Z=0;Z<K;Z++)Y=i0(s,O2),Y.stagger=0,I&&(Y.yoyoEase=I),ct&&ph(Y,ct),q=U[Z],Y.duration=+Lp(m,Oo(o),Z,q,U),Y.delay=(+Lp(x,Oo(o),Z,q,U)||0)-o._delay,!b&&K===1&&Y.delay&&(o._delay=x=Y.delay,o._start+=x,Y.delay=0),B.to(q,Y,J?J(Z,q,U):0),B._ease=Wi.none;B.duration()?m=x=0:o.timeline=0}else if(D){Rp(Aa(B.vars.defaults,{ease:"none"})),B._ease=ah(D.ease||s.ease||"none");var St=0,wt,Pt,Gt;if(Js(D))D.forEach(function(Nt){return B.to(U,Nt,">")}),B.duration();else{Y={};for(nt in D)nt==="ease"||nt==="easeEach"||N8(nt,D[nt],Y,D.easeEach);for(nt in Y)for(wt=Y[nt].sort(function(Nt,Zt){return Nt.t-Zt.t}),St=0,Z=0;Z<wt.length;Z++)Pt=wt[Z],Gt={ease:Pt.e,duration:(Pt.t-(Z?wt[Z-1].t:0))/100*m},Gt[nt]=Pt.v,B.to(U,Gt,St),St+=Gt.duration;B.duration()<m&&B.to({},{duration:m-B.duration()})}}m||o.duration(m=B.duration())}else o.timeline=0;return E===!0&&!P1&&(Hl=Oo(o),zn.killTweensOf(U),Hl=0),to(V,Oo(o),l),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(v||!m&&!D&&o._start===ws(V._time)&&kr(v)&&_8(Oo(o))&&V.data!=="nested")&&(o._tTime=-wn,o.render(Math.max(0,-x)||0)),P&&g2(Oo(o),P),o}var e=t.prototype;return e.render=function(s,l,c){var o=this._time,p=this._tDur,m=this._dur,x=s<0,v=s>p-wn&&!x?p:s<wn?0:s,b,E,D,k,P,I,V,U,B;if(!m)y8(this,s,l,c);else if(v!==this._tTime||!s||c||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==x){if(b=v,U=this.timeline,this._repeat){if(k=m+this._rDelay,this._repeat<-1&&x)return this.totalTime(k*100+s,l,c);if(b=ws(v%k),v===p?(D=this._repeat,b=m):(D=~~(v/k),D&&D===ws(v/k)&&(b=m,D--),b>m&&(b=m)),I=this._yoyo&&D&1,I&&(B=this._yEase,b=m-b),P=Md(this._tTime,k),b===o&&!c&&this._initted&&D===P)return this._tTime=v,this;D!==P&&(U&&this._yEase&&D2(U,I),this.vars.repeatRefresh&&!I&&!this._lock&&this._time!==k&&this._initted&&(this._lock=c=1,this.render(ws(k*D),!0).invalidate()._lock=0))}if(!this._initted){if(y2(this,x?s:b,c,l,v))return this._tTime=0,this;if(o!==this._time&&!(c&&this.vars.repeatRefresh&&D!==P))return this;if(m!==this._dur)return this.render(s,l,c)}if(this._tTime=v,this._time=b,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=V=(B||this._ease)(b/m),this._from&&(this.ratio=V=1-V),b&&!o&&!l&&!D&&(ra(this,"onStart"),this._tTime!==v))return this;for(E=this._pt;E;)E.r(V,E.d),E=E._next;U&&U.render(s<0?s:U._dur*U._ease(b/this._dur),l,c)||this._startAt&&(this._zTime=s),this._onUpdate&&!l&&(x&&Pb(this,s,l,c),ra(this,"onUpdate")),this._repeat&&D!==P&&this.vars.onRepeat&&!l&&this.parent&&ra(this,"onRepeat"),(v===this._tDur||!v)&&this._tTime===v&&(x&&!this._onUpdate&&Pb(this,s,!0,!0),(s||!m)&&(v===this._tDur&&this._ts>0||!v&&this._ts<0)&&nc(this,1),!l&&!(x&&!o)&&(v||o||I)&&(ra(this,v===p?"onComplete":"onReverseComplete",!0),this._prom&&!(v<p&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),n.prototype.invalidate.call(this,s)},e.resetTo=function(s,l,c,o,p){Zp||ta.wake(),this._ts||this.play();var m=Math.min(this._dur,(this._dp._time-this._start)*this._ts),x;return this._initted||B1(this,m),x=this._ease(m/this._dur),O8(this,s,l,c,o,x,m,p)?this.resetTo(s,l,c,o,1):(A0(this,0),this.parent||m2(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(s,l){if(l===void 0&&(l="all"),!s&&(!l||l==="all"))return this._lazy=this._pt=0,this.parent?_p(this):this;if(this.timeline){var c=this.timeline.totalDuration();return this.timeline.killTweensOf(s,l,Hl&&Hl.vars.overwrite!==!0)._first||_p(this),this.parent&&c!==this.timeline.totalDuration()&&Sd(this,this._dur*this.timeline._tDur/c,0,1),this}var o=this._targets,p=s?Sa(s):o,m=this._ptLookup,x=this._pt,v,b,E,D,k,P,I;if((!l||l==="all")&&p8(o,p))return l==="all"&&(this._pt=0),_p(this);for(v=this._op=this._op||[],l!=="all"&&(Ss(l)&&(k={},Fr(l,function(V){return k[V]=1}),l=k),l=B8(o,l)),I=o.length;I--;)if(~p.indexOf(o[I])){b=m[I],l==="all"?(v[I]=l,D=b,E={}):(E=v[I]=v[I]||{},D=l);for(k in D)P=b&&b[k],P&&((!("kill"in P.d)||P.d.kill(k)===!0)&&T0(this,P,"_pt"),delete b[k]),E!=="all"&&(E[k]=1)}return this._initted&&!this._pt&&x&&_p(this),this},t.to=function(s,l){return new t(s,l,arguments[2])},t.from=function(s,l){return Dp(1,arguments)},t.delayedCall=function(s,l,c,o){return new t(l,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:l,onReverseComplete:l,onCompleteParams:c,onReverseCompleteParams:c,callbackScope:o})},t.fromTo=function(s,l,c){return Dp(2,arguments)},t.set=function(s,l){return l.duration=0,l.repeatDelay||(l.repeat=0),new t(s,l)},t.killTweensOf=function(s,l,c){return zn.killTweensOf(s,l,c)},t}(Yp);Aa(ts.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Fr("staggerTo,staggerFrom,staggerFromTo",function(n){ts[n]=function(){var t=new ur,e=Rb.call(arguments,0);return e.splice(n==="staggerFromTo"?5:4,0,0),t[n].apply(t,e)}});var N1=function(t,e,i){return t[e]=i},B2=function(t,e,i){return t[e](i)},U8=function(t,e,i,s){return t[e](s.fp,i)},V8=function(t,e,i){return t.setAttribute(e,i)},U1=function(t,e){return Hn(t[e])?B2:I1(t[e])&&t.setAttribute?V8:N1},N2=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},G8=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},U2=function(t,e){var i=e._pt,s="";if(!t&&e.b)s=e.b;else if(t===1&&e.e)s=e.e;else{for(;i;)s=i.p+(i.m?i.m(i.s+i.c*t):Math.round((i.s+i.c*t)*1e4)/1e4)+s,i=i._next;s+=e.c}e.set(e.t,e.p,s,e)},V1=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},H8=function(t,e,i,s){for(var l=this._pt,c;l;)c=l._next,l.p===s&&l.modifier(t,e,i),l=c},j8=function(t){for(var e=this._pt,i,s;e;)s=e._next,e.p===t&&!e.op||e.op===t?T0(this,e,"_pt"):e.dep||(i=1),e=s;return!i},W8=function(t,e,i,s){s.mSet(t,e,s.m.call(s.tween,i,s.mt),s)},V2=function(t){for(var e=t._pt,i,s,l,c;e;){for(i=e._next,s=l;s&&s.pr>e.pr;)s=s._next;(e._prev=s?s._prev:c)?e._prev._next=e:l=e,(e._next=s)?s._prev=e:c=e,e=i}t._pt=l},zr=function(){function n(e,i,s,l,c,o,p,m,x){this.t=i,this.s=l,this.c=c,this.p=s,this.r=o||N2,this.d=p||this,this.set=m||N1,this.pr=x||0,this._next=e,e&&(e._prev=this)}var t=n.prototype;return t.modifier=function(i,s,l){this.mSet=this.mSet||this.set,this.set=W8,this.m=i,this.mt=l,this.tween=s},n}();Fr(F1+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return k1[n]=1});oa.TweenMax=oa.TweenLite=ts;oa.TimelineLite=oa.TimelineMax=ur;zn=new ur({sortChildren:!1,defaults:wd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});aa.stringFilter=I2;var oh=[],kg={},q8=[],hE=0,X8=0,iv=function(t){return(kg[t]||q8).map(function(e){return e()})},Fb=function(){var t=Date.now(),e=[];t-hE>2&&(iv("matchMediaInit"),oh.forEach(function(i){var s=i.queries,l=i.conditions,c,o,p,m;for(o in s)c=Ka.matchMedia(s[o]).matches,c&&(p=1),c!==l[o]&&(l[o]=c,m=1);m&&(i.revert(),p&&e.push(i))}),iv("matchMediaRevert"),e.forEach(function(i){return i.onMatch(i,function(s){return i.add(null,s)})}),hE=t,iv("matchMedia"))},G2=function(){function n(e,i){this.selector=i&&Db(i),this.data=[],this._r=[],this.isReverted=!1,this.id=X8++,e&&this.add(e)}var t=n.prototype;return t.add=function(i,s,l){Hn(i)&&(l=s,s=i,i=Hn);var c=this,o=function(){var m=Rn,x=c.selector,v;return m&&m!==c&&m.data.push(c),l&&(c.selector=Db(l)),Rn=c,v=s.apply(c,arguments),Hn(v)&&c._r.push(v),Rn=m,c.selector=x,c.isReverted=!1,v};return c.last=o,i===Hn?o(c,function(p){return c.add(null,p)}):i?c[i]=o:o},t.ignore=function(i){var s=Rn;Rn=null,i(this),Rn=s},t.getTweens=function(){var i=[];return this.data.forEach(function(s){return s instanceof n?i.push.apply(i,s.getTweens()):s instanceof ts&&!(s.parent&&s.parent.data==="nested")&&i.push(s)}),i},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(i,s){var l=this;if(i?function(){for(var o=l.getTweens(),p=l.data.length,m;p--;)m=l.data[p],m.data==="isFlip"&&(m.revert(),m.getChildren(!0,!0,!1).forEach(function(x){return o.splice(o.indexOf(x),1)}));for(o.map(function(x){return{g:x._dur||x._delay||x._sat&&!x._sat.vars.immediateRender?x.globalTime(0):-1/0,t:x}}).sort(function(x,v){return v.g-x.g||-1/0}).forEach(function(x){return x.t.revert(i)}),p=l.data.length;p--;)m=l.data[p],m instanceof ur?m.data!=="nested"&&(m.scrollTrigger&&m.scrollTrigger.revert(),m.kill()):!(m instanceof ts)&&m.revert&&m.revert(i);l._r.forEach(function(x){return x(i,l)}),l.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),s)for(var c=oh.length;c--;)oh[c].id===this.id&&oh.splice(c,1)},t.revert=function(i){this.kill(i||{})},n}(),$8=function(){function n(e){this.contexts=[],this.scope=e,Rn&&Rn.data.push(this)}var t=n.prototype;return t.add=function(i,s,l){co(i)||(i={matches:i});var c=new G2(0,l||this.scope),o=c.conditions={},p,m,x;Rn&&!c.selector&&(c.selector=Rn.selector),this.contexts.push(c),s=c.add("onMatch",s),c.queries=i;for(m in i)m==="all"?x=1:(p=Ka.matchMedia(i[m]),p&&(oh.indexOf(c)<0&&oh.push(c),(o[m]=p.matches)&&(x=1),p.addListener?p.addListener(Fb):p.addEventListener("change",Fb)));return x&&s(c,function(v){return c.add(null,v)}),this},t.revert=function(i){this.kill(i||{})},t.kill=function(i){this.contexts.forEach(function(s){return s.kill(i,!0)})},n}(),s0={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(function(s){return A2(s)})},timeline:function(t){return new ur(t)},getTweensOf:function(t,e){return zn.getTweensOf(t,e)},getProperty:function(t,e,i,s){Ss(t)&&(t=Sa(t)[0]);var l=sh(t||{}).get,c=i?p2:f2;return i==="native"&&(i=""),t&&(e?c((Jr[e]&&Jr[e].get||l)(t,e,i,s)):function(o,p,m){return c((Jr[o]&&Jr[o].get||l)(t,o,p,m))})},quickSetter:function(t,e,i){if(t=Sa(t),t.length>1){var s=t.map(function(x){return Nr.quickSetter(x,e,i)}),l=s.length;return function(x){for(var v=l;v--;)s[v](x)}}t=t[0]||{};var c=Jr[e],o=sh(t),p=o.harness&&(o.harness.aliases||{})[e]||e,m=c?function(x){var v=new c;$u._pt=0,v.init(t,i?x+i:x,$u,0,[t]),v.render(1,v),$u._pt&&V1(1,$u)}:o.set(t,p);return c?m:function(x){return m(t,p,i?x+i:x,o,1)}},quickTo:function(t,e,i){var s,l=Nr.to(t,ph((s={},s[e]="+=0.1",s.paused=!0,s),i||{})),c=function(p,m,x){return l.resetTo(e,p,m,x)};return c.tween=l,c},isTweening:function(t){return zn.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=ah(t.ease,wd.ease)),rE(wd,t||{})},config:function(t){return rE(aa,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,s=t.plugins,l=t.defaults,c=t.extendTimeline;(s||"").split(",").forEach(function(o){return o&&!Jr[o]&&!oa[o]&&qp(e+" effect requires "+o+" plugin.")}),Jx[e]=function(o,p,m){return i(Sa(o),Aa(p||{},l),m)},c&&(ur.prototype[e]=function(o,p,m){return this.add(Jx[e](o,co(p)?p:(m=p)&&{},this),m)})},registerEase:function(t,e){Wi[t]=ah(e)},parseEase:function(t,e){return arguments.length?ah(t,e):Wi},getById:function(t){return zn.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var i=new ur(t),s,l;for(i.smoothChildTiming=kr(t.smoothChildTiming),zn.remove(i),i._dp=0,i._time=i._tTime=zn._time,s=zn._first;s;)l=s._next,(e||!(!s._dur&&s instanceof ts&&s.vars.onComplete===s._targets[0]))&&to(i,s,s._start-s._delay),s=l;return to(zn,i,0),i},context:function(t,e){return t?new G2(t,e):Rn},matchMedia:function(t){return new $8(t)},matchMediaRefresh:function(){return oh.forEach(function(t){var e=t.conditions,i,s;for(s in e)e[s]&&(e[s]=!1,i=1);i&&t.revert()})||Fb()},addEventListener:function(t,e){var i=kg[t]||(kg[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=kg[t],s=i&&i.indexOf(e);s>=0&&i.splice(s,1)},utils:{wrap:E8,wrapYoyo:A8,distribute:b2,random:M2,snap:w2,normalize:T8,getUnit:Zs,clamp:b8,splitColor:C2,toArray:Sa,selector:Db,mapRange:T2,pipe:M8,unitize:S8,interpolate:C8,shuffle:v2},install:l2,effects:Jx,ticker:ta,updateRoot:ur.updateRoot,plugins:Jr,globalTimeline:zn,core:{PropTween:zr,globals:c2,Tween:ts,Timeline:ur,Animation:Yp,getCache:sh,_removeLinkedListItem:T0,reverting:function(){return Ks},context:function(t){return t&&Rn&&(Rn.data.push(t),t._ctx=Rn),Rn},suppressOverwrites:function(t){return P1=t}}};Fr("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return s0[n]=ts[n]});ta.add(ur.updateRoot);$u=s0.to({},{duration:0});var Z8=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},Y8=function(t,e){var i=t._targets,s,l,c;for(s in e)for(l=i.length;l--;)c=t._ptLookup[l][s],c&&(c=c.d)&&(c._pt&&(c=Z8(c,s)),c&&c.modifier&&c.modifier(e[s],t,i[l],s))},nv=function(t,e){return{name:t,rawVars:1,init:function(s,l,c){c._onInit=function(o){var p,m;if(Ss(l)&&(p={},Fr(l,function(x){return p[x]=1}),l=p),e){p={};for(m in l)p[m]=e(l[m]);l=p}Y8(o,l)}}}},Nr=s0.registerPlugin({name:"attr",init:function(t,e,i,s,l){var c,o,p;this.tween=i;for(c in e)p=t.getAttribute(c)||"",o=this.add(t,"setAttribute",(p||0)+"",e[c],s,l,0,0,c),o.op=c,o.b=p,this._props.push(c)},render:function(t,e){for(var i=e._pt;i;)Ks?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},nv("roundProps",Lb),nv("modifiers"),nv("snap",w2))||s0;ts.version=ur.version=Nr.version="3.12.5";o2=1;R1()&&Td();Wi.Power0;Wi.Power1;Wi.Power2;Wi.Power3;Wi.Power4;Wi.Linear;Wi.Quad;Wi.Cubic;Wi.Quart;Wi.Quint;Wi.Strong;Wi.Elastic;Wi.Back;Wi.SteppedEase;Wi.Bounce;Wi.Sine;Wi.Expo;Wi.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var uE,jl,sd,G1,nh,dE,H1,K8=function(){return typeof window<"u"},$o={},Kc=180/Math.PI,rd=Math.PI/180,ku=Math.atan2,fE=1e8,j1=/([A-Z])/g,J8=/(left|right|width|margin|padding|x)/i,Q8=/[\s,\(]\S/,no={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},zb=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},tG=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},eG=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},iG=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},H2=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},j2=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},nG=function(t,e,i){return t.style[e]=i},sG=function(t,e,i){return t.style.setProperty(e,i)},rG=function(t,e,i){return t._gsap[e]=i},aG=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},oG=function(t,e,i,s,l){var c=t._gsap;c.scaleX=c.scaleY=i,c.renderTransform(l,c)},lG=function(t,e,i,s,l){var c=t._gsap;c[e]=i,c.renderTransform(l,c)},Bn="transform",Or=Bn+"Origin",cG=function n(t,e){var i=this,s=this.target,l=s.style,c=s._gsap;if(t in $o&&l){if(this.tfm=this.tfm||{},t!=="transform")t=no[t]||t,~t.indexOf(",")?t.split(",").forEach(function(o){return i.tfm[o]=Bo(s,o)}):this.tfm[t]=c.x?c[t]:Bo(s,t),t===Or&&(this.tfm.zOrigin=c.zOrigin);else return no.transform.split(",").forEach(function(o){return n.call(i,o,e)});if(this.props.indexOf(Bn)>=0)return;c.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Or,e,"")),t=Bn}(l||e)&&this.props.push(t,e,l[t])},W2=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},hG=function(){var t=this.props,e=this.target,i=e.style,s=e._gsap,l,c;for(l=0;l<t.length;l+=3)t[l+1]?e[t[l]]=t[l+2]:t[l+2]?i[t[l]]=t[l+2]:i.removeProperty(t[l].substr(0,2)==="--"?t[l]:t[l].replace(j1,"-$1").toLowerCase());if(this.tfm){for(c in this.tfm)s[c]=this.tfm[c];s.svg&&(s.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),l=H1(),(!l||!l.isStart)&&!i[Bn]&&(W2(i),s.zOrigin&&i[Or]&&(i[Or]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},q2=function(t,e){var i={target:t,props:[],revert:hG,save:cG};return t._gsap||Nr.core.getCache(t),e&&e.split(",").forEach(function(s){return i.save(s)}),i},X2,Ob=function(t,e){var i=jl.createElementNS?jl.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):jl.createElement(t);return i&&i.style?i:jl.createElement(t)},ao=function n(t,e,i){var s=getComputedStyle(t);return s[e]||s.getPropertyValue(e.replace(j1,"-$1").toLowerCase())||s.getPropertyValue(e)||!i&&n(t,Ed(e)||e,1)||""},pE="O,Moz,ms,Ms,Webkit".split(","),Ed=function(t,e,i){var s=e||nh,l=s.style,c=5;if(t in l&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);c--&&!(pE[c]+t in l););return c<0?null:(c===3?"ms":c>=0?pE[c]:"")+t},Bb=function(){K8()&&window.document&&(uE=window,jl=uE.document,sd=jl.documentElement,nh=Ob("div")||{style:{}},Ob("div"),Bn=Ed(Bn),Or=Bn+"Origin",nh.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",X2=!!Ed("perspective"),H1=Nr.core.reverting,G1=1)},sv=function n(t){var e=Ob("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,s=this.nextSibling,l=this.style.cssText,c;if(sd.appendChild(e),e.appendChild(this),this.style.display="block",t)try{c=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(c=this._gsapBBox());return i&&(s?i.insertBefore(this,s):i.appendChild(this)),sd.removeChild(e),this.style.cssText=l,c},mE=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},$2=function(t){var e;try{e=t.getBBox()}catch{e=sv.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===sv||(e=sv.call(t,!0)),e&&!e.width&&!e.x&&!e.y?{x:+mE(t,["x","cx","x1"])||0,y:+mE(t,["y","cy","y1"])||0,width:0,height:0}:e},Z2=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&$2(t))},mh=function(t,e){if(e){var i=t.style,s;e in $o&&e!==Or&&(e=Bn),i.removeProperty?(s=e.substr(0,2),(s==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),i.removeProperty(s==="--"?e:e.replace(j1,"-$1").toLowerCase())):i.removeAttribute(e)}},Wl=function(t,e,i,s,l,c){var o=new zr(t._pt,e,i,0,1,c?j2:H2);return t._pt=o,o.b=s,o.e=l,t._props.push(i),o},_E={deg:1,rad:1,turn:1},uG={grid:1,flex:1},sc=function n(t,e,i,s){var l=parseFloat(i)||0,c=(i+"").trim().substr((l+"").length)||"px",o=nh.style,p=J8.test(e),m=t.tagName.toLowerCase()==="svg",x=(m?"client":"offset")+(p?"Width":"Height"),v=100,b=s==="px",E=s==="%",D,k,P,I;if(s===c||!l||_E[s]||_E[c])return l;if(c!=="px"&&!b&&(l=n(t,e,i,"px")),I=t.getCTM&&Z2(t),(E||c==="%")&&($o[e]||~e.indexOf("adius")))return D=I?t.getBBox()[p?"width":"height"]:t[x],Xn(E?l/D*v:l/100*D);if(o[p?"width":"height"]=v+(b?c:s),k=~e.indexOf("adius")||s==="em"&&t.appendChild&&!m?t:t.parentNode,I&&(k=(t.ownerSVGElement||{}).parentNode),(!k||k===jl||!k.appendChild)&&(k=jl.body),P=k._gsap,P&&E&&P.width&&p&&P.time===ta.time&&!P.uncache)return Xn(l/P.width*v);if(E&&(e==="height"||e==="width")){var V=t.style[e];t.style[e]=v+s,D=t[x],V?t.style[e]=V:mh(t,e)}else(E||c==="%")&&!uG[ao(k,"display")]&&(o.position=ao(t,"position")),k===t&&(o.position="static"),k.appendChild(nh),D=nh[x],k.removeChild(nh),o.position="absolute";return p&&E&&(P=sh(k),P.time=ta.time,P.width=k[x]),Xn(b?D*l/v:D&&l?v/D*l:0)},Bo=function(t,e,i,s){var l;return G1||Bb(),e in no&&e!=="transform"&&(e=no[e],~e.indexOf(",")&&(e=e.split(",")[0])),$o[e]&&e!=="transform"?(l=Jp(t,s),l=e!=="transformOrigin"?l[e]:l.svg?l.origin:a0(ao(t,Or))+" "+l.zOrigin+"px"):(l=t.style[e],(!l||l==="auto"||s||~(l+"").indexOf("calc("))&&(l=r0[e]&&r0[e](t,e,i)||ao(t,e)||u2(t,e)||(e==="opacity"?1:0))),i&&!~(l+"").trim().indexOf(" ")?sc(t,e,l,i)+i:l},dG=function(t,e,i,s){if(!i||i==="none"){var l=Ed(e,t,1),c=l&&ao(t,l,1);c&&c!==i?(e=l,i=c):e==="borderColor"&&(i=ao(t,"borderTopColor"))}var o=new zr(this._pt,t.style,e,0,1,U2),p=0,m=0,x,v,b,E,D,k,P,I,V,U,B,Z;if(o.b=i,o.e=s,i+="",s+="",s==="auto"&&(k=t.style[e],t.style[e]=s,s=ao(t,e)||s,k?t.style[e]=k:mh(t,e)),x=[i,s],I2(x),i=x[0],s=x[1],b=i.match(Xu)||[],Z=s.match(Xu)||[],Z.length){for(;v=Xu.exec(s);)P=v[0],V=s.substring(p,v.index),D?D=(D+1)%5:(V.substr(-5)==="rgba("||V.substr(-5)==="hsla(")&&(D=1),P!==(k=b[m++]||"")&&(E=parseFloat(k)||0,B=k.substr((E+"").length),P.charAt(1)==="="&&(P=nd(E,P)+B),I=parseFloat(P),U=P.substr((I+"").length),p=Xu.lastIndex-U.length,U||(U=U||aa.units[e]||B,p===s.length&&(s+=U,o.e+=U)),B!==U&&(E=sc(t,e,k,U)||0),o._pt={_next:o._pt,p:V||m===1?V:",",s:E,c:I-E,m:D&&D<4||e==="zIndex"?Math.round:0});o.c=p<s.length?s.substring(p,s.length):""}else o.r=e==="display"&&s==="none"?j2:H2;return r2.test(s)&&(o.e=0),this._pt=o,o},gE={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},fG=function(t){var e=t.split(" "),i=e[0],s=e[1]||"50%";return(i==="top"||i==="bottom"||s==="left"||s==="right")&&(t=i,i=s,s=t),e[0]=gE[i]||i,e[1]=gE[s]||s,e.join(" ")},pG=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i=e.t,s=i.style,l=e.u,c=i._gsap,o,p,m;if(l==="all"||l===!0)s.cssText="",p=1;else for(l=l.split(","),m=l.length;--m>-1;)o=l[m],$o[o]&&(p=1,o=o==="transformOrigin"?Or:Bn),mh(i,o);p&&(mh(i,Bn),c&&(c.svg&&i.removeAttribute("transform"),Jp(i,1),c.uncache=1,W2(s)))}},r0={clearProps:function(t,e,i,s,l){if(l.data!=="isFromStart"){var c=t._pt=new zr(t._pt,e,i,0,0,pG);return c.u=s,c.pr=-10,c.tween=l,t._props.push(i),1}}},Kp=[1,0,0,1,0,0],Y2={},K2=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},yE=function(t){var e=ao(t,Bn);return K2(e)?Kp:e.substr(7).match(s2).map(Xn)},W1=function(t,e){var i=t._gsap||sh(t),s=t.style,l=yE(t),c,o,p,m;return i.svg&&t.getAttribute("transform")?(p=t.transform.baseVal.consolidate().matrix,l=[p.a,p.b,p.c,p.d,p.e,p.f],l.join(",")==="1,0,0,1,0,0"?Kp:l):(l===Kp&&!t.offsetParent&&t!==sd&&!i.svg&&(p=s.display,s.display="block",c=t.parentNode,(!c||!t.offsetParent)&&(m=1,o=t.nextElementSibling,sd.appendChild(t)),l=yE(t),p?s.display=p:mh(t,"display"),m&&(o?c.insertBefore(t,o):c?c.appendChild(t):sd.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Nb=function(t,e,i,s,l,c){var o=t._gsap,p=l||W1(t,!0),m=o.xOrigin||0,x=o.yOrigin||0,v=o.xOffset||0,b=o.yOffset||0,E=p[0],D=p[1],k=p[2],P=p[3],I=p[4],V=p[5],U=e.split(" "),B=parseFloat(U[0])||0,Z=parseFloat(U[1])||0,Y,K,nt,q;i?p!==Kp&&(K=E*P-D*k)&&(nt=B*(P/K)+Z*(-k/K)+(k*V-P*I)/K,q=B*(-D/K)+Z*(E/K)-(E*V-D*I)/K,B=nt,Z=q):(Y=$2(t),B=Y.x+(~U[0].indexOf("%")?B/100*Y.width:B),Z=Y.y+(~(U[1]||U[0]).indexOf("%")?Z/100*Y.height:Z)),s||s!==!1&&o.smooth?(I=B-m,V=Z-x,o.xOffset=v+(I*E+V*k)-I,o.yOffset=b+(I*D+V*P)-V):o.xOffset=o.yOffset=0,o.xOrigin=B,o.yOrigin=Z,o.smooth=!!s,o.origin=e,o.originIsAbsolute=!!i,t.style[Or]="0px 0px",c&&(Wl(c,o,"xOrigin",m,B),Wl(c,o,"yOrigin",x,Z),Wl(c,o,"xOffset",v,o.xOffset),Wl(c,o,"yOffset",b,o.yOffset)),t.setAttribute("data-svg-origin",B+" "+Z)},Jp=function(t,e){var i=t._gsap||new k2(t);if("x"in i&&!e&&!i.uncache)return i;var s=t.style,l=i.scaleX<0,c="px",o="deg",p=getComputedStyle(t),m=ao(t,Or)||"0",x,v,b,E,D,k,P,I,V,U,B,Z,Y,K,nt,q,J,ct,St,wt,Pt,Gt,Nt,Zt,qt,me,Ee,Le,ri,Ni,Jt,le;return x=v=b=k=P=I=V=U=B=0,E=D=1,i.svg=!!(t.getCTM&&Z2(t)),p.translate&&((p.translate!=="none"||p.scale!=="none"||p.rotate!=="none")&&(s[Bn]=(p.translate!=="none"?"translate3d("+(p.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(p.rotate!=="none"?"rotate("+p.rotate+") ":"")+(p.scale!=="none"?"scale("+p.scale.split(" ").join(",")+") ":"")+(p[Bn]!=="none"?p[Bn]:"")),s.scale=s.rotate=s.translate="none"),K=W1(t,i.svg),i.svg&&(i.uncache?(qt=t.getBBox(),m=i.xOrigin-qt.x+"px "+(i.yOrigin-qt.y)+"px",Zt=""):Zt=!e&&t.getAttribute("data-svg-origin"),Nb(t,Zt||m,!!Zt||i.originIsAbsolute,i.smooth!==!1,K)),Z=i.xOrigin||0,Y=i.yOrigin||0,K!==Kp&&(ct=K[0],St=K[1],wt=K[2],Pt=K[3],x=Gt=K[4],v=Nt=K[5],K.length===6?(E=Math.sqrt(ct*ct+St*St),D=Math.sqrt(Pt*Pt+wt*wt),k=ct||St?ku(St,ct)*Kc:0,V=wt||Pt?ku(wt,Pt)*Kc+k:0,V&&(D*=Math.abs(Math.cos(V*rd))),i.svg&&(x-=Z-(Z*ct+Y*wt),v-=Y-(Z*St+Y*Pt))):(le=K[6],Ni=K[7],Ee=K[8],Le=K[9],ri=K[10],Jt=K[11],x=K[12],v=K[13],b=K[14],nt=ku(le,ri),P=nt*Kc,nt&&(q=Math.cos(-nt),J=Math.sin(-nt),Zt=Gt*q+Ee*J,qt=Nt*q+Le*J,me=le*q+ri*J,Ee=Gt*-J+Ee*q,Le=Nt*-J+Le*q,ri=le*-J+ri*q,Jt=Ni*-J+Jt*q,Gt=Zt,Nt=qt,le=me),nt=ku(-wt,ri),I=nt*Kc,nt&&(q=Math.cos(-nt),J=Math.sin(-nt),Zt=ct*q-Ee*J,qt=St*q-Le*J,me=wt*q-ri*J,Jt=Pt*J+Jt*q,ct=Zt,St=qt,wt=me),nt=ku(St,ct),k=nt*Kc,nt&&(q=Math.cos(nt),J=Math.sin(nt),Zt=ct*q+St*J,qt=Gt*q+Nt*J,St=St*q-ct*J,Nt=Nt*q-Gt*J,ct=Zt,Gt=qt),P&&Math.abs(P)+Math.abs(k)>359.9&&(P=k=0,I=180-I),E=Xn(Math.sqrt(ct*ct+St*St+wt*wt)),D=Xn(Math.sqrt(Nt*Nt+le*le)),nt=ku(Gt,Nt),V=Math.abs(nt)>2e-4?nt*Kc:0,B=Jt?1/(Jt<0?-Jt:Jt):0),i.svg&&(Zt=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!K2(ao(t,Bn)),Zt&&t.setAttribute("transform",Zt))),Math.abs(V)>90&&Math.abs(V)<270&&(l?(E*=-1,V+=k<=0?180:-180,k+=k<=0?180:-180):(D*=-1,V+=V<=0?180:-180)),e=e||i.uncache,i.x=x-((i.xPercent=x&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-x)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+c,i.y=v-((i.yPercent=v&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-v)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+c,i.z=b+c,i.scaleX=Xn(E),i.scaleY=Xn(D),i.rotation=Xn(k)+o,i.rotationX=Xn(P)+o,i.rotationY=Xn(I)+o,i.skewX=V+o,i.skewY=U+o,i.transformPerspective=B+c,(i.zOrigin=parseFloat(m.split(" ")[2])||!e&&i.zOrigin||0)&&(s[Or]=a0(m)),i.xOffset=i.yOffset=0,i.force3D=aa.force3D,i.renderTransform=i.svg?_G:X2?J2:mG,i.uncache=0,i},a0=function(t){return(t=t.split(" "))[0]+" "+t[1]},rv=function(t,e,i){var s=Zs(e);return Xn(parseFloat(e)+parseFloat(sc(t,"x",i+"px",s)))+s},mG=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,J2(t,e)},Xc="0deg",ap="0px",$c=") ",J2=function(t,e){var i=e||this,s=i.xPercent,l=i.yPercent,c=i.x,o=i.y,p=i.z,m=i.rotation,x=i.rotationY,v=i.rotationX,b=i.skewX,E=i.skewY,D=i.scaleX,k=i.scaleY,P=i.transformPerspective,I=i.force3D,V=i.target,U=i.zOrigin,B="",Z=I==="auto"&&t&&t!==1||I===!0;if(U&&(v!==Xc||x!==Xc)){var Y=parseFloat(x)*rd,K=Math.sin(Y),nt=Math.cos(Y),q;Y=parseFloat(v)*rd,q=Math.cos(Y),c=rv(V,c,K*q*-U),o=rv(V,o,-Math.sin(Y)*-U),p=rv(V,p,nt*q*-U+U)}P!==ap&&(B+="perspective("+P+$c),(s||l)&&(B+="translate("+s+"%, "+l+"%) "),(Z||c!==ap||o!==ap||p!==ap)&&(B+=p!==ap||Z?"translate3d("+c+", "+o+", "+p+") ":"translate("+c+", "+o+$c),m!==Xc&&(B+="rotate("+m+$c),x!==Xc&&(B+="rotateY("+x+$c),v!==Xc&&(B+="rotateX("+v+$c),(b!==Xc||E!==Xc)&&(B+="skew("+b+", "+E+$c),(D!==1||k!==1)&&(B+="scale("+D+", "+k+$c),V.style[Bn]=B||"translate(0, 0)"},_G=function(t,e){var i=e||this,s=i.xPercent,l=i.yPercent,c=i.x,o=i.y,p=i.rotation,m=i.skewX,x=i.skewY,v=i.scaleX,b=i.scaleY,E=i.target,D=i.xOrigin,k=i.yOrigin,P=i.xOffset,I=i.yOffset,V=i.forceCSS,U=parseFloat(c),B=parseFloat(o),Z,Y,K,nt,q;p=parseFloat(p),m=parseFloat(m),x=parseFloat(x),x&&(x=parseFloat(x),m+=x,p+=x),p||m?(p*=rd,m*=rd,Z=Math.cos(p)*v,Y=Math.sin(p)*v,K=Math.sin(p-m)*-b,nt=Math.cos(p-m)*b,m&&(x*=rd,q=Math.tan(m-x),q=Math.sqrt(1+q*q),K*=q,nt*=q,x&&(q=Math.tan(x),q=Math.sqrt(1+q*q),Z*=q,Y*=q)),Z=Xn(Z),Y=Xn(Y),K=Xn(K),nt=Xn(nt)):(Z=v,nt=b,Y=K=0),(U&&!~(c+"").indexOf("px")||B&&!~(o+"").indexOf("px"))&&(U=sc(E,"x",c,"px"),B=sc(E,"y",o,"px")),(D||k||P||I)&&(U=Xn(U+D-(D*Z+k*K)+P),B=Xn(B+k-(D*Y+k*nt)+I)),(s||l)&&(q=E.getBBox(),U=Xn(U+s/100*q.width),B=Xn(B+l/100*q.height)),q="matrix("+Z+","+Y+","+K+","+nt+","+U+","+B+")",E.setAttribute("transform",q),V&&(E.style[Bn]=q)},gG=function(t,e,i,s,l){var c=360,o=Ss(l),p=parseFloat(l)*(o&&~l.indexOf("rad")?Kc:1),m=p-s,x=s+m+"deg",v,b;return o&&(v=l.split("_")[1],v==="short"&&(m%=c,m!==m%(c/2)&&(m+=m<0?c:-c)),v==="cw"&&m<0?m=(m+c*fE)%c-~~(m/c)*c:v==="ccw"&&m>0&&(m=(m-c*fE)%c-~~(m/c)*c)),t._pt=b=new zr(t._pt,e,i,s,m,tG),b.e=x,b.u="deg",t._props.push(i),b},xE=function(t,e){for(var i in e)t[i]=e[i];return t},yG=function(t,e,i){var s=xE({},i._gsap),l="perspective,force3D,transformOrigin,svgOrigin",c=i.style,o,p,m,x,v,b,E,D;s.svg?(m=i.getAttribute("transform"),i.setAttribute("transform",""),c[Bn]=e,o=Jp(i,1),mh(i,Bn),i.setAttribute("transform",m)):(m=getComputedStyle(i)[Bn],c[Bn]=e,o=Jp(i,1),c[Bn]=m);for(p in $o)m=s[p],x=o[p],m!==x&&l.indexOf(p)<0&&(E=Zs(m),D=Zs(x),v=E!==D?sc(i,p,m,D):parseFloat(m),b=parseFloat(x),t._pt=new zr(t._pt,o,p,v,b-v,zb),t._pt.u=D||0,t._props.push(p));xE(o,s)};Fr("padding,margin,Width,Radius",function(n,t){var e="Top",i="Right",s="Bottom",l="Left",c=(t<3?[e,i,s,l]:[e+l,e+i,s+i,s+l]).map(function(o){return t<2?n+o:"border"+o+n});r0[t>1?"border"+n:n]=function(o,p,m,x,v){var b,E;if(arguments.length<4)return b=c.map(function(D){return Bo(o,D,m)}),E=b.join(" "),E.split(b[0]).length===5?b[0]:E;b=(x+"").split(" "),E={},c.forEach(function(D,k){return E[D]=b[k]=b[k]||b[(k-1)/2|0]}),o.init(p,E,v)}});var Q2={name:"css",register:Bb,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,s,l){var c=this._props,o=t.style,p=i.vars.startAt,m,x,v,b,E,D,k,P,I,V,U,B,Z,Y,K,nt;G1||Bb(),this.styles=this.styles||q2(t),nt=this.styles.props,this.tween=i;for(k in e)if(k!=="autoRound"&&(x=e[k],!(Jr[k]&&F2(k,e,i,s,t,l)))){if(E=typeof x,D=r0[k],E==="function"&&(x=x.call(i,s,t,l),E=typeof x),E==="string"&&~x.indexOf("random(")&&(x=$p(x)),D)D(this,t,k,x,i)&&(K=1);else if(k.substr(0,2)==="--")m=(getComputedStyle(t).getPropertyValue(k)+"").trim(),x+="",Yl.lastIndex=0,Yl.test(m)||(P=Zs(m),I=Zs(x)),I?P!==I&&(m=sc(t,k,m,I)+I):P&&(x+=P),this.add(o,"setProperty",m,x,s,l,0,0,k),c.push(k),nt.push(k,0,o[k]);else if(E!=="undefined"){if(p&&k in p?(m=typeof p[k]=="function"?p[k].call(i,s,t,l):p[k],Ss(m)&&~m.indexOf("random(")&&(m=$p(m)),Zs(m+"")||m==="auto"||(m+=aa.units[k]||Zs(Bo(t,k))||""),(m+"").charAt(1)==="="&&(m=Bo(t,k))):m=Bo(t,k),b=parseFloat(m),V=E==="string"&&x.charAt(1)==="="&&x.substr(0,2),V&&(x=x.substr(2)),v=parseFloat(x),k in no&&(k==="autoAlpha"&&(b===1&&Bo(t,"visibility")==="hidden"&&v&&(b=0),nt.push("visibility",0,o.visibility),Wl(this,o,"visibility",b?"inherit":"hidden",v?"inherit":"hidden",!v)),k!=="scale"&&k!=="transform"&&(k=no[k],~k.indexOf(",")&&(k=k.split(",")[0]))),U=k in $o,U){if(this.styles.save(k),B||(Z=t._gsap,Z.renderTransform&&!e.parseTransform||Jp(t,e.parseTransform),Y=e.smoothOrigin!==!1&&Z.smooth,B=this._pt=new zr(this._pt,o,Bn,0,1,Z.renderTransform,Z,0,-1),B.dep=1),k==="scale")this._pt=new zr(this._pt,Z,"scaleY",Z.scaleY,(V?nd(Z.scaleY,V+v):v)-Z.scaleY||0,zb),this._pt.u=0,c.push("scaleY",k),k+="X";else if(k==="transformOrigin"){nt.push(Or,0,o[Or]),x=fG(x),Z.svg?Nb(t,x,0,Y,0,this):(I=parseFloat(x.split(" ")[2])||0,I!==Z.zOrigin&&Wl(this,Z,"zOrigin",Z.zOrigin,I),Wl(this,o,k,a0(m),a0(x)));continue}else if(k==="svgOrigin"){Nb(t,x,1,Y,0,this);continue}else if(k in Y2){gG(this,Z,k,b,V?nd(b,V+x):x);continue}else if(k==="smoothOrigin"){Wl(this,Z,"smooth",Z.smooth,x);continue}else if(k==="force3D"){Z[k]=x;continue}else if(k==="transform"){yG(this,x,t);continue}}else k in o||(k=Ed(k)||k);if(U||(v||v===0)&&(b||b===0)&&!Q8.test(x)&&k in o)P=(m+"").substr((b+"").length),v||(v=0),I=Zs(x)||(k in aa.units?aa.units[k]:P),P!==I&&(b=sc(t,k,m,I)),this._pt=new zr(this._pt,U?Z:o,k,b,(V?nd(b,V+v):v)-b,!U&&(I==="px"||k==="zIndex")&&e.autoRound!==!1?iG:zb),this._pt.u=I||0,P!==I&&I!=="%"&&(this._pt.b=m,this._pt.r=eG);else if(k in o)dG.call(this,t,k,m,V?V+x:x);else if(k in t)this.add(t,k,m||t[k],V?V+x:x,s,l);else if(k!=="parseTransform"){L1(k,x);continue}U||(k in o?nt.push(k,0,o[k]):nt.push(k,1,m||t[k])),c.push(k)}}K&&V2(this)},render:function(t,e){if(e.tween._time||!H1())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:Bo,aliases:no,getSetter:function(t,e,i){var s=no[e];return s&&s.indexOf(",")<0&&(e=s),e in $o&&e!==Or&&(t._gsap.x||Bo(t,"x"))?i&&dE===i?e==="scale"?aG:rG:(dE=i||{})&&(e==="scale"?oG:lG):t.style&&!I1(t.style[e])?nG:~e.indexOf("-")?sG:U1(t,e)},core:{_removeProperty:mh,_getMatrix:W1}};Nr.utils.checkPrefix=Ed;Nr.core.getStyleSaver=q2;(function(n,t,e,i){var s=Fr(n+","+t+","+e,function(l){$o[l]=1});Fr(t,function(l){aa.units[l]="deg",Y2[l]=1}),no[s[13]]=n+","+t,Fr(i,function(l){var c=l.split(":");no[c[1]]=s[c[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Fr("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){aa.units[n]="px"});Nr.registerPlugin(Q2);var yp=Nr.registerPlugin(Q2)||Nr;yp.core.Tween;const xG=`precision highp float;

out vec2 v_uv;
out vec3 v_normal;
out vec3 v_position;
out mat4 v_modelMatrix;


void main() {
    v_uv = uv;
    v_normal = normal;
    v_position = position;

       // 
    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    v_modelMatrix = modelMatrix;


    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,vG=`precision highp float;

in vec2 v_uv;
in vec3 v_normal;
in vec3 v_position;
in mat4 v_modelMatrix;

out vec4 fragColor;

void main() {

    float coefficient = 1.2;
    float power = 1.0;

    vec3 worldPosition = (v_modelMatrix * vec4(v_position, 1.0)).xyz;
    vec3 cameraToVertex = normalize(worldPosition - cameraPosition);
    float intensity = pow(coefficient + dot(cameraToVertex, normalize(v_normal)), power);

    vec3 color = vec3(1.0);

    fragColor = vec4(color, 1.0) * intensity;
}

`,bG=`precision highp float;

out vec2 v_uv;
out vec3 v_normal;
out vec3 v_position;
out mat4 v_modelMatrix;
out float v_fogDistance;


void main() {
    v_uv = uv;
    v_normal = normal;
    v_position = position;

       // 
    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    v_modelMatrix = modelMatrix;

    //  (0, 0, 0) 
    v_fogDistance = length(worldPosition.xyz);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,wG=`precision highp float;

in vec2 v_uv;
in vec3 v_normal;
in vec3 v_position;
in mat4 v_modelMatrix;
in float v_fogDistance;
uniform float u_fogFar;
uniform float u_fogNear;

out vec4 fragColor;

 float edgeFactor(vec2 p){
    float thickness = 5.0;
    	vec2 grid = abs(fract(p - 0.5) - 0.5) / fwidth(p) / thickness;
  		return min(grid.x, grid.y);
    }

void main() {

     // // //  ()
    float fogFactor = smoothstep(u_fogNear,u_fogFar,  v_fogDistance);
    float alpha = 1.0 - fogFactor; // 

    float coefficient = 1.2;
    float power = 1.0;

    vec3 worldPosition = (v_modelMatrix * vec4(v_position, 1.0)).xyz;
    vec3 cameraToVertex = normalize(worldPosition - cameraPosition);
    float intensity = pow(coefficient + dot(cameraToVertex, normalize(v_normal)), power);

    float a = edgeFactor(v_uv);


    vec3 color = vec3(0.76);


    // 
    fragColor = vec4(color, alpha - a) * intensity;
}

`,MG=`precision highp float;

out vec2 v_uv;
out vec3 v_normal;
out vec3 v_position;
out mat4 v_modelMatrix;
out float v_fogDistance;


void main() {
    v_uv = uv;
    v_normal = normal;
    v_position = position;

       // 
    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    v_modelMatrix = modelMatrix;

    //  (0, 0, 0) 
    v_fogDistance = length(worldPosition.xyz);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,SG=`precision highp float;

in vec2 v_uv;
in vec3 v_normal;
in vec3 v_position;
in mat4 v_modelMatrix;
in float v_fogDistance;
uniform float u_fogFar;
uniform float u_fogNear;

out vec4 fragColor;

 float edgeFactor(vec2 p){
    float thickness = 5.0;
    	vec2 grid = abs(fract(p - 0.5) - 0.5) / fwidth(p) / thickness;
  		return min(grid.x, grid.y);
    }

void main() {

     // // //  ()
    float fogFactor = smoothstep(u_fogNear,u_fogFar,  v_fogDistance);
    float alpha = 1.0 - fogFactor; // 

    float coefficient = 1.2;
    float power = 1.0;

    vec3 worldPosition = (v_modelMatrix * vec4(v_position, 1.0)).xyz;
    vec3 cameraToVertex = normalize(worldPosition - cameraPosition);
    float intensity = pow(coefficient + dot(cameraToVertex, normalize(v_normal)), power);

    float a = edgeFactor(v_uv);


    vec3 color = vec3(0.0, 0.9215686274509803, 1.0);


    // 
    fragColor = vec4(color, alpha - a) * intensity;
}

`,TG=`precision highp float;

in float a_distance;
in vec3 a_color;
in float a_speed;

uniform float u_time;

out vec2 v_uv;
out vec3 v_normal;
out float v_cumulativeDistance;
out vec3 v_color;
out float v_fogDistance;
out float v_speed;

void main() {
    v_uv = uv;
    v_normal = normal;
    v_cumulativeDistance = a_distance;
    v_color = a_color;
    v_speed = a_speed;

    //  (0, 0, 0) 
    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    v_fogDistance = length(worldPosition.xyz);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,EG=`precision highp float;

in vec2 v_uv;
in vec3 v_normal;
in vec3 v_color;
in float v_cumulativeDistance;
in float v_fogDistance;
in float v_speed;
uniform float u_time;
uniform float u_fogFar;
uniform float u_fogNear;

out vec4 fragColor;

void main() {
    float t = u_time * 5.0 * v_speed; // 

    // UV
    vec2 uv = v_uv;

    // 
    vec3 sub_color = vec3(1.0); // 
    vec3 main_color = v_color; // 

    // 
    float scale = 0.00005; // 
    float gradient = mod(v_cumulativeDistance * scale + t * -0.5, 1.0); // 01

    //  ()
    float fogFactor = smoothstep(u_fogNear, u_fogFar, v_fogDistance);

    // 
    float gradientAlpha = smoothstep(0.2, 0.8, gradient); // 
    float alpha = (1.0 - fogFactor) * gradientAlpha; // 

    // 
    vec3 color = mix(sub_color, main_color, gradient);

    fragColor = vec4(color, alpha); // 
}
`,AG=new Ea({transparent:!0,uniforms:tm,vertexShader:xG,fragmentShader:vG,glslVersion:md,depthWrite:!1}),op=new Ea({transparent:!0,uniforms:tm,vertexShader:bG,fragmentShader:wG,glslVersion:md,depthWrite:!1}),CG=new io({transparent:!0,color:new vi("rgb(0, 17, 23)"),opacity:.7,side:Qr}),Zc=new Ea({transparent:!0,uniforms:tm,vertexShader:MG,fragmentShader:SG,glslVersion:md,depthWrite:!1}),PG=new Ea({transparent:!0,uniforms:tm,vertexShader:TG,fragmentShader:EG,glslVersion:md}),IG=new io({transparent:!0,visible:!1,side:Qr}),RG=new io({color:new vi("rgb(220, 220, 220)"),transparent:!0,opacity:.5}),h0=class h0{constructor(t){ni(this,"elements");this.elements=this.initElements(t)}initElements(t){const e={};for(const[i,s]of Object.entries(t)){const l=document.querySelector(s);if(!l){console.warn(`: ${s}`);continue}e[i]=l}return e}static getInstance(t){return this.instance||(this.instance=new h0(t)),this.instance}get(t){return this.elements[t]||null}toggleClass(t,e="active"){const i=this.get(t);i?i.classList.toggle(e):console.error(` "${t}" `)}};ni(h0,"instance");let Ub=h0;const DG=n=>{const t={timestamp:Date.now()};localStorage.setItem(n,JSON.stringify(t))},LG=n=>{const t=localStorage.getItem(n);if(!t)return!0;const{timestamp:e}=JSON.parse(t);return Date.now()-e>=24*60*60*1e3},kG=n=>LG(n)?(DG(n),!0):!1;Y6();const vn=Ub.getInstance({mapContainer:"#map-container",mapOpenButton:"#map-open-button",mapCloseButton:"#map-close-button",viewButton:"#view-button",helpButton:"#help-button",githubButton:"#github-button",keyControl:"#key-control",joystickControl:"#joystick-control",operationGuide:"#operation-guide",guideCloseButton:"#guide-close-button",fullscreenButton:"#fullscreen-button"});os.prototype.raycast=i8;const FG=["FloorSurface","HitBox"],fm=new FU,ks=new hr(75,window.innerWidth/window.innerHeight,.1,1e5);ks.position.set(18,9,3);ks.zoom=.5;fm.add(ks);const C0=document.getElementById("three-canvas"),zG=C0.getContext("webgl2"),Sn=new X4(ks,C0);Sn.enableDamping=!0;Sn.enablePan=!1;Sn.enableZoom=!1;Sn.minDistance=1;Sn.maxDistance=7;Sn.maxPolarAngle=Math.PI/2+.35;Sn.minPolarAngle=Math.PI/2-.8;Sn.update();const Vb=n=>{n?(Sn.maxDistance=3,Sn.enablePan=!1,Sn.maxPolarAngle=Math.PI/2+.35,Sn.minPolarAngle=Math.PI/2-.8):(Sn.maxDistance=1e3,Sn.enablePan=!0,Sn.maxPolarAngle=Math.PI,Sn.minPolarAngle=0)};Vb(!0);const Ad=new R4(ks,C0);Ad.noPan=!0;Ad.noRotate=!0;Ad.zoomSpeed=.2;const Qp=new kU({canvas:C0,context:zG,alpha:!0});Qp.setSize(window.innerWidth,window.innerHeight);Qp.setPixelRatio(Math.min(window.devicePixelRatio,2));const Zu=new _1,Gb=new _t(0,-1,0);let Kl;const OG=()=>{const n=window.innerWidth,t=window.innerHeight;Qp.setPixelRatio(window.devicePixelRatio),Qp.setSize(n,t),ks.aspect=n/t,ks.updateProjectionMatrix(),iC()};window.addEventListener("resize",OG);const Cd={},BG=new $6(ld),av=async(n,t,e)=>{BG.load(n,e).then(i=>{const s=new IA(i,PG);s.name=t,fm.add(s)})},NG=new X6(ld),lr=async(n,t,e)=>{NG.load(n).then(i=>{FG.includes(t)&&(i.boundsTree=new C1(i));const s=new os(i,e);s.name=t,Cd[t]=s,fm.add(s)})},UG=async()=>{const n=[lr("plateau_shinjuku/ubld/FloorSurface.fgb","FloorSurface",CG),lr("plateau_shinjuku/ubld/HitBox.fgb","HitBox",IG)];await Promise.all(n),await VG("./models/Xbot.glb")};UG();const VG=n=>{new a5().load(n,function(t){const e=t.scene;e.traverse(p=>{p.isMesh&&(p.material.needUpdate=!0,p.material=RG)}),e.scale.set(.9,.9,.9);const i=uk(window.location.hash);if(i){const{angle:p,lat:m,lng:x}=i,v=fv(x,m);e.position.set(v.x,100,v.z),e.rotation.y=hh.degToRad(p+180)}else{const p=fv(XM[0],XM[1]);e.position.set(p.x,100,p.z),e.rotation.y=hh.degToRad(j3)}const s=Cd.FloorSurface;if(s){Zu.set(e.position,Gb);const p=Zu.intersectObject(s,!0);if(p.length>0)e.position.y=p[0].point.y;else{e.position.set(0,100,0),Zu.set(e.position,Gb);const m=Zu.intersectObject(s,!0);m.length>0?e.position.y=m[0].point.y:e.position.y=30.729000091552734}}fm.add(e);const l=t.animations,c=new P4(e),o=new Map;l.forEach(p=>{o.set(p.name,c.clipAction(p))}),Kl=new X5(e,c,o,Sn,Ad,ks,"agree"),Kl.update,Z6().then(async()=>{var m,x,v;const p=[lr("plateau_shinjuku/ubld/IntBuildingInstallation.fgb","IntBuildingInstallation",AG),lr("plateau_shinjuku/ubld/ClosureSurface.fgb","ClosureSurface",op),lr("plateau_shinjuku/ubld/RoofSurface.fgb","RoofSurface",op),lr("plateau_shinjuku/ubld/InteriorWallSurface.fgb","InteriorWallSurface",op),lr("plateau_shinjuku/ubld/Window.fgb","Window",op),lr("plateau_shinjuku/ubld/Door.fgb","Door",op),lr("plateau_shinjuku/bldg/53394525_Building.fgb","53394525_Building",Zc),lr("plateau_shinjuku/bldg/53394535_Building.fgb","53394535_Building",Zc),lr("plateau_shinjuku/bldg/53394526_Building.fgb","53394526_Building",Zc),lr("plateau_shinjuku/bldg/53394536_Building.fgb","53394536_Building",Zc),lr("plateau_shinjuku/brid/53394525_Bridge.fgb","53394525_Bridge",Zc),lr("plateau_shinjuku/brid/53394526_Bridge.fgb","53394526_Bridge",Zc),lr("plateau_shinjuku/brid/53394535_Bridge.fgb","53394535_Bridge",Zc),av("line/shinjuku_link.fgb","link",{color:new vi("rgb(255, 0, 204)"),height:40,speed:.8}),av("line/gsi_RailCL.fgb","RailCL",{color:new vi("rgb(85, 255, 0)"),height:60,speed:1.2}),av("line/gsi_road.fgb","road",{color:new vi("rgb(255, 255, 0)"),height:50,speed:1})];(m=vn.get("keyControl"))==null||m.classList.remove("hidden"),(x=vn.get("mapContainer"))==null||x.classList.remove("hidden"),(v=vn.get("joystickControl"))==null||v.classList.remove("hidden"),kG("userData")&&bn.set("showOperationGuide",!0),await Promise.all(p).then(()=>{})})})},Hb=new _4,tC=new H5("joystick-ball"),eC=()=>{requestAnimationFrame(eC);const n=Sn.target;Ad.target.set(n.x,n.y,n.z);let t=Hb.getDelta();if(Kl&&!bn.get("isFarView")&&!bn.get("showMapViewer")){const i=Kl.getPosition().clone();i.y+=1.5;const s=Cd.HitBox,l=Cd.FloorSurface,c=tC.getDirection();l&&s&&Kl.update(t,c,l,s)}Sn.update(),Ad.update(),Qp.render(fm,ks),tm.u_time.value=Hb.getElapsedTime()};eC();const GG=(n,t)=>{const e=Cd.FloorSurface,i=Cd.HitBox;Zu.set(new _t(n,100,t),Gb);const s=Zu.intersectObject(e,!0);let l=Hb.getDelta();if(s.length>0){const p=s[0].point.y;Kl.setModelPosition(n,p,t)}const c=tC.getDirection();Kl.update(l,c,e,i);const o=Kl.getModelRotationAngle();lb(n,t,o)},ov={position:ks.position.clone(),lookAt:{x:0,y:0,z:0}},lv={position:{x:300,y:200,z:100},lookAt:{x:0,y:0,z:0}},HG=n=>{var l,c,o;if((l=vn.get("keyControl"))==null||l.classList.toggle("hidden"),(c=vn.get("mapContainer"))==null||c.classList.toggle("hidden"),(o=vn.get("joystickControl"))==null||o.classList.toggle("hidden"),n){Vb(!1),ov.position=ks.position.clone();const p=Sn.target;ov.lookAt={x:p.x,y:p.y,z:p.z}}else{lv.position=ks.position.clone();const p=Sn.target;lv.lookAt={x:p.x,y:p.y,z:p.z}}const t=n?lv:ov;bn.set("isCameraAnimating",!0);const e=yp.to(ks.position,{x:t.position.x,y:t.position.y,z:t.position.z,duration:1,ease:"power1",onUpdate:()=>{ks.lookAt(t.lookAt.x,t.lookAt.y,t.lookAt.z)}}),i=yp.to(Sn.target,{x:t.lookAt.x,y:t.lookAt.y,z:t.lookAt.z,duration:1,ease:"power1",onUpdate:()=>{ks.lookAt(Sn.target.x,Sn.target.y,Sn.target.z)}}),s=yp.to(ks,{fov:n?45:75,duration:1,ease:"power1",onUpdate:()=>{ks.updateProjectionMatrix()}});yp.timeline({onComplete:()=>{n||Vb(!0),bn.set("isCameraAnimating",!1)}}).add(e).add(i,"-=1.0").add(s,"-=1.0")};let o0;var vE;(vE=vn.get("viewButton"))==null||vE.addEventListener("click",()=>{bn.get("isCameraAnimating")||bn.set("isFarView",!bn.get("isFarView"))});var bE;(bE=vn.get("helpButton"))==null||bE.addEventListener("click",()=>{bn.set("showOperationGuide",!bn.get("showOperationGuide"))});var wE;(wE=vn.get("mapOpenButton"))==null||wE.addEventListener("click",()=>{bn.set("showMapViewer",!0)});var ME;(ME=vn.get("mapCloseButton"))==null||ME.addEventListener("click",()=>{bn.set("showMapViewer",!1)});var SE;(SE=vn.get("githubButton"))==null||SE.addEventListener("click",()=>{window.open("https://github.com/satoshi7190/three-plateau-tps","_blank","noopener,noreferrer")});var TE;(TE=vn.get("guideCloseButton"))==null||TE.addEventListener("click",()=>{bn.set("showOperationGuide",!1)});var EE;(EE=vn.get("fullscreenButton"))==null||EE.addEventListener("click",()=>{bn.set("isFullScreen",!bn.get("isFullScreen"))});bn.subscribe("isFarView",n=>{var t,e,i,s,l,c,o,p;n?((t=vn.get("viewButton"))==null||t.classList.add("far-view"),(e=vn.get("viewButton"))==null||e.classList.remove("player-view"),(i=vn.get("operationGuide"))==null||i.classList.add("far-view"),(s=vn.get("operationGuide"))==null||s.classList.remove("player-view")):((l=vn.get("viewButton"))==null||l.classList.add("player-view"),(c=vn.get("viewButton"))==null||c.classList.remove("far-view"),(o=vn.get("operationGuide"))==null||o.classList.add("player-view"),(p=vn.get("operationGuide"))==null||p.classList.remove("far-view")),HG(n)});bn.subscribe("showOperationGuide",n=>{var t,e;n?(t=vn.get("operationGuide"))==null||t.classList.remove("hidden"):(e=vn.get("operationGuide"))==null||e.classList.add("hidden")});bn.subscribe("showMapViewer",n=>{var t,e,i,s;n?((t=vn.get("mapContainer"))==null||t.classList.add("active"),(e=vn.get("mapCloseButton"))==null||e.classList.remove("hidden")):((i=vn.get("mapContainer"))==null||i.classList.remove("active"),(s=vn.get("mapCloseButton"))==null||s.classList.add("hidden")),o0&&o0.remove()});bn.subscribe("isFullScreen",n=>{n?document.documentElement.requestFullscreen():document.exitFullscreen()});fr.on("click","FloorSurface",n=>{if(!bn.get("showMapViewer"))return;const t=document.createElement("div"),e=document.createElement("button");e.className="popup-button",e.textContent="Move to this location",t.appendChild(e),o0=new x0.Popup({closeButton:!1,anchor:"bottom"}).setLngLat(n.lngLat).setDOMContent(t).addTo(fr),e.onclick=async()=>{const i=fv(n.lngLat.lng,n.lngLat.lat);GG(i.x,i.z),o0.remove(),bn.set("showMapViewer",!1)}});fr.on("mouseover","FloorSurface",()=>{fr.getCanvas().style.cursor="pointer"});fr.on("mouseleave","FloorSurface",()=>{fr.getCanvas().style.cursor=""});const iC=()=>{const n=window.innerHeight,t=window.innerWidth;document.documentElement.style.setProperty("--full-height",`${n}px`),document.documentElement.style.setProperty("--full-width",`${t}px`)};iC()});export default jG();
